NW_CORE_SUBDIRS = tools include basis geom inp input \
	pstat rtdb task symmetry util peigs lapack

NW_MODULE_SUBDIRS = NWints atomscf ddscf gradients moints nwdft rimp2 \
	stepper driver dftgrad cphf ccsd vib mcscf esp hessian selci dplot \
	mp2_grad property

SUBDIRS = $(NW_CORE_SUBDIRS) $(NW_MODULE_SUBDIRS)

all: $(SUBDIRS)
	-!cd $** & nmake -nologo
	nmake -nologo link

OBJ =          $(OBJDIR)\nwchem.obj \
               $(OBJDIR)\stubs.obj

COMPILATION_DATE = (unknown)
CODE_BRANCH = (unknown)
LIB_DEFINES = -DCOMPILATION_DATE="'$(COMPILATION_DATE)'" \
              -DCOMPILATION_DIR="'$(TOPDIR)'" \
              -DNWCHEM_BRANCH="'$(CODE_BRANCH)'"

!INCLUDE config\NTmakefile.h

clean: $(SUBDIRS)
	if exist "$(OBJDIR)\*" erase /q "$(OBJDIR)\*"
	if exist "$(OBJDIR)" rmdir "$(OBJDIR)"
	-!cd $** & nmake -nologo clean

!INCLUDE config\NTmakelib.h

UTIL_LIBS = util.lib chemio.lib global.lib ma.lib peigs.lib linalg.lib \
	tcgmsg-mpi.lib armci.lib cvwmpi.lib wsock32.lib lapack.lib smaths.lib

LIBS = nwctask.lib ccsd.lib mcscf.lib selci.lib mp2.lib moints.lib \
	stepper.lib driver.lib dftgrad.lib nwdft.lib gradients.lib cphf.lib \
	esp.lib ddscf.lib guess.lib hessian.lib vib.lib util.lib rimp2.lib \
	property.lib nwints.lib dplot.lib $(UTIL_LIBS)

link: $(OBJDIR) $(OBJ)
	$(FC) /Fenw32.exe $(OBJ) /link /debug:full /debugtype:cv /pdb:none /libpath:"..\lib\win32" \
	/libpath:".\tools\lib\win32" /libpath:"$(MPI_LIB)" $(LIBS)
	@echo nw32.exe is built

!IF 0
	@if exist $(STAMP) erase $(STAMP)
	@if exist "*.i" erase "*.i"
#	@if exist "*.exe" erase "*.exe"
#	@if exist "*.ilk" erase "*.ilk"
#	@if exist "*.pdb" erase "*.pdb"
	@if exist $(LIBRARY_PATH) erase $(LIBRARY_PATH)
	@if exist "$(OBJDIR)\*" erase /q "$(OBJDIR)\*"
	@if exist "$(OBJDIR)" rmdir "$(OBJDIR)"
!ENDIF
