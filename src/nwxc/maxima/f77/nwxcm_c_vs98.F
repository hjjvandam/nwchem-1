C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_vs98.F 
C> The nwxcm_c_vs98 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_vs98 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& {{1}\over{\rho_\alpha^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\sqrt{\rho_\alpha}}}\\\\ 
C>   {\it t_3} &=& {{1}\over{\rho_\alpha^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{\rho_\alpha^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_5} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_4}+2.225569421150687\,{\it t_3}+.8004286349993635\,{\it t_2}+.1897004325747558\,{\it t_1}}}+1.0\right)\,\left(.1325688999052018\,{\it t_3}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_4}+3.844746237447211\,{\it t_3}+1.644733775567609\,{\it t_2}+.2405871291288192\,{\it t_1}}}+1.0\right)\,\left(.1274696188700087\,{\it t_3}+1.0\right)\\\\ 
C>   {\it t_6} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_7} &=& {\it t_6}\,\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_8} &=& {{2.0\,\tau_\alpha}\over{\rho_\alpha^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_9} &=& 0.00515088\,\left({\it t_8}+{\it t_7}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}}}\\\\ 
C>   {\it t_{11}} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_{12}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{13}} &=& {{1}\over{{\it t_9}^2}}\\\\ 
C>   {\it t_{14}} &=& {\it param}\left(11\right)\\\\ 
C>   {\it t_{15}} &=& {\it t_8}-9.11559972\\\\ 
C>   {\it t_{16}} &=& {\it param}\left(12\right)\\\\ 
C>   {\it t_{17}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{18}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\rho_\beta^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{\sqrt{\rho_\beta}}}\\\\ 
C>   {\it t_{21}} &=& {{1}\over{\rho_\beta^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\rho_\beta^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{23}} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{22}}+2.225569421150687\,{\it t_{21}}+.8004286349993635\,{\it t_{20}}+.1897004325747558\,{\it t_{19}}}}+1.0\right)\,\left(.1325688999052018\,{\it t_{21}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{22}}+3.844746237447211\,{\it t_{21}}+1.644733775567609\,{\it t_{20}}+.2405871291288192\,{\it t_{19}}}}+1.0\right)\,\left(.1274696188700087\,{\it t_{21}}+1.0\right)\\\\ 
C>   {\it t_{24}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{25}} &=& {\it t_{24}}\,\sigma_{\beta\beta}\\\\ 
C>   {\it t_{26}} &=& {{2.0\,\tau_\beta}\over{\rho_\beta^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_{27}} &=& 0.00515088\,\left({\it t_{26}}+{\it t_{25}}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{27}}}}\\\\ 
C>   {\it t_{29}} &=& {{1}\over{{\it t_{27}}^2}}\\\\ 
C>   {\it t_{30}} &=& {\it t_{26}}-9.11559972\\\\ 
C>   {\it t_{31}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{33}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{34}} &=& {\it t_{33}}^4\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{31}}^4}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{{\it t_{31}}}}\\\\ 
C>   {\it t_{37}} &=& \left({\it t_{33}}\,{\it t_{36}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{33}}\,{\it t_{36}}\right)^{{{4}\over{3}}}-2.0\\\\ 
C>   {\it t_{38}} &=& -1.923661050931536\,{\it t_{34}}\,{\it t_{35}}\,{\it t_{37}}\\\\ 
C>   {\it t_{39}} &=& {{1}\over{{\it t_{31}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{40}} &=& {{1}\over{\sqrt{{\it t_{31}}}}}\\\\ 
C>   {\it t_{41}} &=& {{1}\over{{\it t_{31}}^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{42}} &=& 0.00304966\,\left({\it t_{26}}+{\it t_8}+{\it t_{25}}+{\it t_7}-18.23119944\right)+1.0\\\\ 
C>   {\it t_{43}} &=& {{1}\over{{\it t_{42}}}}\\\\ 
C>   {\it t_{44}} &=& {\it t_{25}}+{\it t_7}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{{\it t_{42}}^2}}\\\\ 
C>   {\it t_{46}} &=& {\it t_{26}}+{\it t_8}-18.23119944\\\\ 
C>   {\it t_{47}} &=& {{1}\over{\rho_s^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{\sqrt{\rho_s}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{\rho_s^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{50}} &=& {{1}\over{\rho_s^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{51}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{52}} &=& {{2.0\,\tau_s}\over{\rho_s^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_{53}} &=& 0.00515088\,\left({\it t_{52}}+{\it t_{51}}\,\sigma_{ss}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{54}} &=& {{1}\over{{\it t_{53}}}}\\\\ 
C>   {\it t_{55}} &=& {{1}\over{{\it t_{53}}^2}}\\\\ 
C>   {\it t_{56}} &=& {\it t_{52}}-9.11559972\\\\ 
C>   f &=& 1.0\,\left({\it t_{31}}\,\left(-0.0598079686361971\,{\it t_{34}}\,{\it t_{35}}\,\left(.1274696188700087\,{\it t_{32}}+1.0\right)\,{\it t_{37}}\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{41}}+3.844746237447211\,{\it t_{32}}+1.644733775567609\,{\it t_{40}}+.2405871291288192\,{\it t_{39}}}}+1.0\right)+.01975163132168077\,\left(.06901399211255825\,{\it t_{32}}+1.0\right)\,\left({\it t_{38}}+1.923661050931536\,{\it t_{37}}\right)\,\log \left({{29.60881320326807}\over{8.15741470348764\,{\it t_{41}}+2.247591863577616\,{\it t_{32}}+.4300972471276643\,{\it t_{40}}+.1911512595127337\,{\it t_{39}}}}+1.0\right)-0.0621814\,\left(.1325688999052018\,{\it t_{32}}+1.0\right)\,\left({\it t_{38}}+1.0\right)\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{41}}+2.225569421150687\,{\it t_{32}}+.8004286349993635\,{\it t_{40}}+.1897004325747558\,{\it t_{39}}}}+1.0\right)\right)-{\it t_{23}}\,\rho_\beta-{\it t_5}\,\rho_\alpha\right)\,{\it t_{43}}\,\left({\it param}\left(3\right)\,{\it t_{46}}\,{\it t_{43}}+{\it param}\left(2\right)\,{\it t_{44}}\,{\it t_{43}}+{\it param}\left(6\right)\,{\it t_{46}}^2\,{\it t_{45}}+{\it param}\left(5\right)\,{\it t_{44}}\,{\it t_{46}}\,{\it t_{45}}+{\it param}\left(4\right)\,{\it t_{44}}^2\,{\it t_{45}}+{\it param}\left(1\right)\right)+1.0\,{\it t_{23}}\,\rho_\beta\,\left(1.0-{{0.125\,\sigma_{\beta\beta}}\over{\rho_\beta\,\tau_\beta}}\right)\,{\it t_{28}}\,\left({\it t_{18}}\,{\it t_{30}}\,{\it t_{28}}+{\it t_{17}}\,{\it t_{24}}\,\sigma_{\beta\beta}\,{\it t_{28}}+{\it t_{16}}\,{\it t_{30}}^2\,{\it t_{29}}+{\it t_{14}}\,{\it t_{24}}\,\sigma_{\beta\beta}\,{\it t_{30}}\,{\it t_{29}}+{{{\it t_{12}}\,\sigma_{\beta\beta}^2\,{\it t_{29}}}\over{\rho_\beta^{{{16}\over{3}}}}}+{\it t_{11}}\right)+1.0\,{\it t_5}\,\rho_\alpha\,\left(1.0-{{0.125\,\sigma_{\alpha\alpha}}\over{\rho_\alpha\,\tau_\alpha}}\right)\,{\it t_{10}}\,\left({\it t_{18}}\,{\it t_{15}}\,{\it t_{10}}+{\it t_{17}}\,{\it t_6}\,\sigma_{\alpha\alpha}\,{\it t_{10}}+{\it t_{16}}\,{\it t_{15}}^2\,{\it t_{13}}+{\it t_{14}}\,{\it t_6}\,\sigma_{\alpha\alpha}\,{\it t_{15}}\,{\it t_{13}}+{{{\it t_{12}}\,\sigma_{\alpha\alpha}^2\,{\it t_{13}}}\over{\rho_\alpha^{{{16}\over{3}}}}}+{\it t_{11}}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,\left(-6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{50}}+2.225569421150687\,{\it t_{49}}+.8004286349993635\,{\it t_{48}}+.1897004325747558\,{\it t_{47}}}}+1.0\right)\,\left(.1325688999052018\,{\it t_{49}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{50}}+3.844746237447211\,{\it t_{49}}+1.644733775567609\,{\it t_{48}}+.2405871291288192\,{\it t_{47}}}}+1.0\right)\,\left(.1274696188700087\,{\it t_{49}}+1.0\right)\right)\,\rho_s\,\left(1.0-{{0.125\,\sigma_{ss}}\over{\rho_s\,\tau_s}}\right)\,{\it t_{54}}\,\left({\it t_{18}}\,{\it t_{56}}\,{\it t_{54}}+{\it t_{17}}\,{\it t_{51}}\,\sigma_{ss}\,{\it t_{54}}+{\it t_{16}}\,{\it t_{56}}^2\,{\it t_{55}}+{\it t_{14}}\,{\it t_{51}}\,\sigma_{ss}\,{\it t_{56}}\,{\it t_{55}}+{{{\it t_{12}}\,\sigma_{ss}^2\,{\it t_{55}}}\over{\rho_s^{{{16}\over{3}}}}}+{\it t_{11}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] T van Voorhis, GE Scuseria, J.Chem.Phys. 109, 400 (1998)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.3005348 "> 
C> 10.1063/1.3005348 </a> 
C> 
      subroutine nwxcm_c_vs98(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Cmat,Mmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = 1/rhoa**6.666666666666666d-1
            t2 = rhoa**5.0d-1
            t3 = 1/t2
            t4 = 1/rhoa**3.333333333333333d-1
            t5 = 1/rhoa**1.6666666666666666d-1
            t6 = 1.1120374863094686d+1*t5+3.8447462374472113d+0*t4+1.644
     1         733775567609d+0*t3+2.4058712912881916d-1*t1
            t7 = 3.216395899738507d+1/t6+1.0d+0
            t8 = log(t7)
            t9 = 1.274696188700087d-1*t4+1.0d+0
            t10 = 5.982550435771079d+0*t5+2.2255694211506874d+0*t4+8.004
     1         286349993635d-1*t3+1.8970043257475583d-1*t1
            t11 = 1.6081979498692536d+1/t10+1.0d+0
            t12 = log(t11)
            t13 = 1.3256889990520176d-1*t4+1.0d+0
            t14 = -3.1090699999999993d-2*t8*t9-6.903522198342671d-18*t12
     1         *t13
            t15 = 1/rhoa
            t16 = 1/taua
            t17 = 1.0d+0-1.25d-1*gammaaa*t15*t16
            t18 = 1/rhoa**2.6666666666666666d+0
            t19 = 1/rhoa**1.6666666666666669d+0
            t20 = 2.0d+0*t19*taua
            t21 = 5.15088d-3*(t20+gammaaa*t18-9.11559972d+0)+1.0d+0
            t22 = 1/t21
            t23 = param(10)
            t24 = gammaaa**2
            t25 = 1/rhoa**5.333333333333333d+0
            t26 = 1/t21**2
            t27 = param(11)
            t28 = t20-9.11559972d+0
            t29 = param(12)
            t30 = t28**2
            t31 = param(8)
            t32 = param(9)
            t33 = t22*t28*t32+gammaaa*t18*t22*t31+t26*t29*t30+gammaaa*t1
     1         8*t26*t27*t28+t23*t24*t25*t26+param(7)
            t34 = 5.329846514438383d+0*t5+1.766435620181429d+0*t4+5.6598
     1         85156639418d-1*t3+1.19503784087549d-1*t1
            t35 = 1.6081979498692536d+1/t34+1.0d+0
            t36 = log(t35)
            t37 = 1.0522000558389212d-1*t4+1.0d+0
            t38 = -1.243628d-1*rhoa*t36*t37-2*rhoa*t14
            t39 = 4.0d+0*t19*taua
            t40 = 3.04966d-3*(t39+2*gammaaa*t18-1.823119944d+1)+1.0d+0
            t41 = 1/t40
            t42 = param(4)
            t43 = 1/t40**2
            t44 = param(5)
            t45 = t39-1.823119944d+1
            t46 = param(6)
            t47 = t45**2
            t48 = param(2)
            t49 = param(3)
            t50 = t41*t45*t49+2*gammaaa*t18*t41*t48+t43*t46*t47+2*gammaa
     1         a*t18*t43*t44*t45+4*t24*t25*t42*t43+param(1)
            t51 = 1/rhoa**3.6666666666666664d+0
            t52 = -3.3333333333333337d+0*t18*taua-2.6666666666666666d+0*
     1         gammaaa*t51
            t53 = 1/t21**3
            t54 = 1/rhoa**6.333333333333333d+0
            t55 = 1/t2**3
            t56 = 1/rhoa**1.3333333333333333d+0
            t57 = 1/rhoa**1.1666666666666667d+0
            t58 = 1.0d+0*(-1.8533958105157808d+0*t57-1.2815820791490704d
     1         +0*t56-8.223668877838045d-1*t55-1.6039141941921276d-1*t19
     2         )*t9/(t6**2*t7)+1.3210398931339265d-3*t56*t8+1.1102230246
     3         251565d-16*t13*(-9.970917392951799d-1*t57-7.4185647371689
     4         58d-1*t56-4.002143174996817d-1*t55-1.264669550498372d-1*t
     5         19)/(t10**2*t11)+3.0506411443514264d-19*t12*t56
            t59 = -6.666666666666667d+0*t18*taua-5.333333333333333d+0*ga
     1         mmaaa*t51
            t60 = 1/t40**3
            t61 = 1/rhoa**8
            t62 = (1.0d+0*t38*t41*(-4.879456d-2*t24*t42*t60*t61-1.219864
     1         d-2*t18*t46*t47*t60-2.439728d-2*gammaaa*t25*t44*t45*t60-6
     2         .09932d-3*t18*t43*t45*t49-1.219864d-2*gammaaa*t25*t43*t48
     3         +2*t18*t41*t48+2*t18*t43*t44*t45+8*gammaaa*t25*t42*t43)+2
     4         .0d+0*rhoa*t14*t17*t22*(-1.030176d-2*t23*t24*t53*t61-1.03
     5         0176d-2*t18*t29*t30*t53-1.030176d-2*gammaaa*t25*t27*t28*t
     6         53-5.15088d-3*t18*t26*t28*t32-5.15088d-3*gammaaa*t25*t26*
     7         t31+t18*t22*t31+t18*t26*t27*t28+2*gammaaa*t23*t25*t26)-6.
     8         09932d-3*t18*t38*t43*t50-1.030176d-2*t14*t17*t19*t26*t33-
     9         2.5d-1*t14*t16*t22*t33)*wght
            t63 = 1/rhoa**7
            t64 = 1/rhoa**4.333333333333333d+0
            fnc(iq) = (1.0d+0*t38*t41*t50+2.0d+0*rhoa*t14*t17*t22*t33)*w
     1         ght+fnc(iq)
            Amat(iq,D1_RA) = (t41*(1.0d+0*t38*(-6.666666666666667d+0*t18
     1         *t41*t49*taua-1.3333333333333333d+1*t18*t43*t45*t46*taua-
     2         1.3333333333333333d+1*gammaaa*t25*t43*t44*taua-6.09932d-3
     3         *t46*t47*t59*t60-1.219864d-2*gammaaa*t18*t44*t45*t59*t60-
     4         2.439728d-2*t24*t25*t42*t59*t60-3.04966d-3*t43*t45*t49*t5
     5         9-6.09932d-3*gammaaa*t18*t43*t48*t59-2.1333333333333332d+
     6         1*t24*t42*t43*t54-5.333333333333333d+0*gammaaa*t41*t48*t5
     7         1-5.333333333333333d+0*gammaaa*t43*t44*t45*t51)+1.0d+0*t5
     8         0*(-2*rhoa*t58+2.0d+0*rhoa*t37*(-8.883077524063971d-1*t57
     9         -5.888118733938097d-1*t56-2.829942578319709d-1*t55-7.9669
     :         18939169932d-2*t19)/(t34**2*t35)+4.361818170142819d-3*t36
     ;         *t4-1.243628d-1*t36*t37-2*t14))+t22*(2.0d+0*rhoa*t14*t17*
     <         (-3.3333333333333337d+0*t18*t22*t32*taua-6.66666666666666
     =         7d+0*t18*t26*t28*t29*taua-3.3333333333333337d+0*gammaaa*t
     >         25*t26*t27*taua-5.333333333333333d+0*t23*t24*t26*t54-1.03
     ?         0176d-2*t29*t30*t52*t53-1.030176d-2*gammaaa*t18*t27*t28*t
     @         52*t53-1.030176d-2*t23*t24*t25*t52*t53-5.15088d-3*t26*t28
     1         *t32*t52-5.15088d-3*gammaaa*t18*t26*t31*t52-2.66666666666
     2         66666d+0*gammaaa*t22*t31*t51-2.6666666666666666d+0*gammaa
     3         a*t26*t27*t28*t51)+2.0d+0*rhoa*t17*t33*t58+2.0d+0*t14*t17
     4         *t33)-3.04966d-3*t38*t43*t50*t59-1.030176d-2*rhoa*t14*t17
     5         *t26*t33*t52+2.5d-1*gammaaa*t14*t15*t16*t22*t33)*wght+Ama
     6         t(iq,D1_RA)
            Cmat(iq,D1_GAA) = t62+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t62+Cmat(iq,D1_GAB)
            Amat(iq,D1_TA) = (2.5d-1*gammaaa*t14*t22*t33/taua**2+1.0d+0*
     1         t38*t41*(-4.879456d-2*gammaaa*t44*t45*t60*t64-2.439728d-2
     2         *gammaaa*t43*t48*t64+8.0d+0*gammaaa*t43*t44*t64-9.758912d
     3         -2*t24*t42*t60*t63-2.439728d-2*t19*t46*t47*t60-1.219864d-
     4         2*t19*t43*t45*t49+4.0d+0*t19*t41*t49+8.0d+0*t19*t43*t45*t
     5         46)+2.0d+0*rhoa*t14*t17*t22*(-2.060352d-2*gammaaa*t27*t28
     6         *t53*t64-1.030176d-2*gammaaa*t26*t31*t64+2.0d+0*gammaaa*t
     7         26*t27*t64-2.060352d-2*t23*t24*t53*t63-2.060352d-2*t19*t2
     8         9*t30*t53-1.030176d-2*t19*t26*t28*t32+2.0d+0*t19*t22*t32+
     9         4.0d+0*t19*t26*t28*t29)-1.219864d-2*t19*t38*t43*t50-2.060
     :         352d-2*t1*t14*t17*t26*t33)*wght+Amat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhoa**6.666666666666666d-1
            t2 = rhoa**5.0d-1
            t3 = 1/t2
            t4 = 1/rhoa**3.333333333333333d-1
            t5 = 1/rhoa**1.6666666666666666d-1
            t6 = 1.1120374863094686d+1*t5+3.8447462374472113d+0*t4+1.644
     1         733775567609d+0*t3+2.4058712912881916d-1*t1
            t7 = 3.216395899738507d+1/t6+1.0d+0
            t8 = log(t7)
            t9 = 1.274696188700087d-1*t4+1.0d+0
            t10 = 5.982550435771079d+0*t5+2.2255694211506874d+0*t4+8.004
     1         286349993635d-1*t3+1.8970043257475583d-1*t1
            t11 = 1.6081979498692536d+1/t10+1.0d+0
            t12 = log(t11)
            t13 = 1.3256889990520176d-1*t4+1.0d+0
            t14 = -3.1090699999999993d-2*t8*t9-6.903522198342671d-18*t12
     1         *t13
            t15 = 1/rhoa
            t16 = 1/taua
            t17 = 1.0d+0-1.25d-1*gammaaa*t15*t16
            t18 = 1/rhoa**2.6666666666666666d+0
            t19 = gammaaa*t18
            t20 = 1/rhoa**1.6666666666666669d+0
            t21 = 2.0d+0*t20*taua
            t22 = 5.15088d-3*(t21+t19-9.11559972d+0)+1.0d+0
            t23 = 1/t22
            t24 = param(7)
            t25 = param(10)
            t26 = gammaaa**2
            t27 = 1/rhoa**5.333333333333333d+0
            t28 = 1/t22**2
            t29 = param(11)
            t30 = t21-9.11559972d+0
            t31 = param(12)
            t32 = t30**2
            t33 = param(8)
            t34 = param(9)
            t35 = t23*t30*t34+gammaaa*t18*t23*t33+t28*t31*t32+gammaaa*t1
     1         8*t28*t29*t30+t25*t26*t27*t28+t24
            t36 = 1/rhob**6.666666666666666d-1
            t37 = rhob**5.0d-1
            t38 = 1/t37
            t39 = 1/rhob**3.333333333333333d-1
            t40 = 1/rhob**1.6666666666666666d-1
            t41 = 1.1120374863094686d+1*t40+3.8447462374472113d+0*t39+1.
     1         644733775567609d+0*t38+2.4058712912881916d-1*t36
            t42 = 3.216395899738507d+1/t41+1.0d+0
            t43 = log(t42)
            t44 = 1.274696188700087d-1*t39+1.0d+0
            t45 = 5.982550435771079d+0*t40+2.2255694211506874d+0*t39+8.0
     1         04286349993635d-1*t38+1.8970043257475583d-1*t36
            t46 = 1.6081979498692536d+1/t45+1.0d+0
            t47 = log(t46)
            t48 = 1.3256889990520176d-1*t39+1.0d+0
            t49 = -6.903522198342671d-18*t47*t48-3.1090699999999993d-2*t
     1         43*t44
            t50 = 1/rhob
            t51 = 1/taub
            t52 = 1.0d+0-1.25d-1*gammabb*t50*t51
            t53 = 1/rhob**2.6666666666666666d+0
            t54 = gammabb*t53
            t55 = 1/rhob**1.6666666666666669d+0
            t56 = 2.0d+0*t55*taub
            t57 = 5.15088d-3*(t56+t54-9.11559972d+0)+1.0d+0
            t58 = 1/t57
            t59 = gammabb**2
            t60 = 1/rhob**5.333333333333333d+0
            t61 = 1/t57**2
            t62 = t56-9.11559972d+0
            t63 = t62**2
            t64 = t31*t61*t63+gammabb*t29*t53*t61*t62+t34*t58*t62+t25*t5
     1         9*t60*t61+gammabb*t33*t53*t58+t24
            t65 = rhob+rhoa
            t66 = 1/t65**3.333333333333333d-1
            t67 = 1.3256889990520176d-1*t66+1.0d+0
            t68 = rhoa-rhob
            t69 = t68**4
            t70 = 1/t65**4
            t71 = 1/t65
            t72 = 1.0d+0-t68*t71
            t73 = t68*t71+1.0d+0
            t74 = t73**1.3333333333333333d+0+t72**1.3333333333333333d+0-
     1         2.0d+0
            t75 = -1.923661050931536d+0*t69*t70*t74
            t76 = t75+1.0d+0
            t77 = 1/t65**6.666666666666666d-1
            t78 = t65**5.0d-1
            t79 = 1/t78
            t80 = 1/t65**1.6666666666666666d-1
            t81 = 5.982550435771079d+0*t80+8.004286349993635d-1*t79+1.89
     1         70043257475583d-1*t77+2.2255694211506874d+0*t66
            t82 = 1.6081979498692536d+1/t81+1.0d+0
            t83 = log(t82)
            t84 = -6.21814d-2*t67*t76*t83
            t85 = 6.901399211255825d-2*t66+1.0d+0
            t86 = t75+1.923661050931536d+0*t74
            t87 = 8.157414703487641d+0*t80+4.3009724712766434d-1*t79+1.9
     1         115125951273373d-1*t77+2.247591863577616d+0*t66
            t88 = 2.9608813203268075d+1/t87+1.0d+0
            t89 = log(t88)
            t90 = 1.9751631321680768d-2*t85*t86*t89
            t91 = 1.274696188700087d-1*t66+1.0d+0
            t92 = 1.1120374863094686d+1*t80+1.644733775567609d+0*t79+2.4
     1         058712912881916d-1*t77+3.8447462374472113d+0*t66
            t93 = 3.216395899738507d+1/t92+1.0d+0
            t94 = log(t93)
            t95 = -5.980796863619711d-2*t69*t70*t74*t91*t94
            t96 = t65*(t95+t90+t84)-rhob*t49-rhoa*t14
            t97 = 3.04966d-3*(t56+t54+t21+t19-1.823119944d+1)+1.0d+0
            t98 = 1/t97
            t99 = param(4)
            t100 = t54+t19
            t101 = t100**2
            t102 = 1/t97**2
            t103 = param(5)
            t104 = t56+t21-1.823119944d+1
            t105 = param(6)
            t106 = t104**2
            t107 = param(2)
            t108 = param(3)
            t109 = t101*t102*t99+t104*t108*t98+t100*t107*t98+t102*t105*t
     1         106+t100*t102*t103*t104+param(1)
            t110 = 1/rhoa**3.6666666666666664d+0
            t111 = -3.3333333333333337d+0*t18*taua-2.6666666666666666d+0
     1         *gammaaa*t110
            t112 = 1/t22**3
            t113 = 1/t2**3
            t114 = 1/rhoa**1.3333333333333333d+0
            t115 = 1/rhoa**1.1666666666666667d+0
            t116 = 1.0d+0*(-1.6039141941921276d-1*t20-1.8533958105157808
     1         d+0*t115-1.2815820791490704d+0*t114-8.223668877838045d-1*
     2         t113)*t9/(t6**2*t7)+1.3210398931339265d-3*t114*t8+1.11022
     3         30246251565d-16*t13*(-1.264669550498372d-1*t20-9.97091739
     4         2951799d-1*t115-7.418564737168958d-1*t114-4.0021431749968
     5         17d-1*t113)/(t10**2*t11)+3.0506411443514264d-19*t114*t12
            t117 = 1/t97**3
            t118 = 1/t65**1.6666666666666669d+0
            t119 = 1/t78**3
            t120 = 1/t65**1.3333333333333333d+0
            t121 = 1/t65**1.1666666666666667d+0
            t122 = 1.0d+0*(-9.970917392951799d-1*t121-7.418564737168958d
     1         -1*t120-4.002143174996817d-1*t119-1.264669550498372d-1*t1
     2         18)*t67*t76/(t81**2*t82)
            t123 = -5.848223622634647d-1*(-1.3595691172479402d+0*t121-7.
     1         491972878592053d-1*t120-2.1504862356383217d-1*t119-1.2743
     2         417300848914d-1*t118)*t85*t86/(t87**2*t88)
            t124 = 1.923661050931536d+0*(-1.8533958105157808d+0*t121-1.2
     1         815820791490704d+0*t120-8.223668877838045d-1*t119-1.60391
     2         41941921276d-1*t118)*t69*t70*t74*t91/(t92**2*t93)
            t125 = 1/t65**2
            t126 = t125*t68
            t127 = -t71
            t128 = t72**3.333333333333333d-1
            t129 = -t125*t68
            t130 = t73**3.333333333333333d-1
            t131 = 1.3333333333333333d+0*t130*(t71+t129)+1.3333333333333
     1         333d+0*(t127+t126)*t128
            t132 = -1.923661050931536d+0*t131*t69*t70
            t133 = 1/t65**5
            t134 = 7.694644203726144d+0*t133*t69*t74
            t135 = t68**3
            t136 = -7.694644203726144d+0*t135*t70*t74
            t137 = 2.747773264188437d-3*t120*t76*t83
            t138 = -4.5437964274821163d-4*t120*t86*t89
            t139 = 2.541232989148493d-3*t69*t74*t94/t65**5.3333333333333
     1         33d+0
            t140 = 2.3923187454478842d-1*t133*t69*t74*t91*t94
            t141 = 1/rhob**3.6666666666666664d+0
            t142 = -3.3333333333333337d+0*t53*taub-2.6666666666666666d+0
     1         *gammabb*t141
            t143 = 1/t57**3
            t144 = 1/t37**3
            t145 = 1/rhob**1.3333333333333333d+0
            t146 = 1/rhob**1.1666666666666667d+0
            t147 = 1.1102230246251565d-16*t48*(-1.264669550498372d-1*t55
     1         -9.970917392951799d-1*t146-7.418564737168958d-1*t145-4.00
     2         2143174996817d-1*t144)/(t45**2*t46)+1.0d+0*t44*(-1.603914
     3         1941921276d-1*t55-1.8533958105157808d+0*t146-1.2815820791
     4         490704d+0*t145-8.223668877838045d-1*t144)/(t41**2*t42)+3.
     5         0506411443514264d-19*t145*t47+1.3210398931339265d-3*t145*
     6         t43
            t148 = 1.3333333333333333d+0*t128*(t71+t126)+1.3333333333333
     1         333d+0*(t129+t127)*t130
            t149 = -1.923661050931536d+0*t148*t69*t70
            t150 = 7.694644203726144d+0*t135*t70*t74
            t151 = 1/rhoa**4.333333333333333d+0
            t152 = 1/rhob**4.333333333333333d+0
            fnc(iq) = (1.0d+0*t109*t96*t98+1.0d+0*rhob*t49*t52*t58*t64+1
     1         .0d+0*rhoa*t14*t17*t23*t35)*wght+fnc(iq)
            Amat(iq,D1_RA) = (t98*(1.0d+0*t96*(-3.3333333333333337d+0*t1
     1         08*t18*t98*taua-6.666666666666667d+0*t102*t104*t105*t18*t
     2         aua-3.3333333333333337d+0*t100*t102*t103*t18*taua-6.09932
     3         d-3*t101*t111*t117*t99-5.333333333333333d+0*gammaaa*t100*
     4         t102*t110*t99-2.6666666666666666d+0*gammaaa*t107*t110*t98
     5         -6.09932d-3*t105*t106*t111*t117-6.09932d-3*t100*t103*t104
     6         *t111*t117-3.04966d-3*t102*t104*t108*t111-3.04966d-3*t100
     7         *t102*t107*t111-2.6666666666666666d+0*gammaaa*t102*t103*t
     8         104*t110)+1.0d+0*t109*(t95+t65*(-2.3923187454478842d-1*t1
     9         35*t70*t74*t91*t94-5.980796863619711d-2*t131*t69*t70*t91*
     :         t94+1.9751631321680768d-2*(t136+t134+t132+1.9236610509315
     ;         36d+0*t131)*t85*t89-6.21814d-2*(t136+t134+t132)*t67*t83+t
     <         140+t139+t138+t137+t124+t123+t122)+t90+3.1090699999999993
     =         d-2*t8*t9+t84+6.903522198342671d-18*t12*t13-rhoa*t116))+t
     >         23*(1.0d+0*rhoa*t14*t17*(-3.3333333333333337d+0*t18*t23*t
     ?         34*taua-6.666666666666667d+0*t18*t28*t30*t31*taua-3.33333
     @         33333333337d+0*gammaaa*t27*t28*t29*taua-5.15088d-3*t111*t
     1         28*t30*t34-5.15088d-3*gammaaa*t111*t18*t28*t33-2.66666666
     2         66666666d+0*gammaaa*t110*t23*t33-1.030176d-2*t111*t112*t3
     3         1*t32-2.6666666666666666d+0*gammaaa*t110*t28*t29*t30-1.03
     4         0176d-2*gammaaa*t111*t112*t18*t29*t30-5.333333333333333d+
     5         0*t25*t26*t28/rhoa**6.333333333333333d+0-1.030176d-2*t111
     6         *t112*t25*t26*t27)+1.0d+0*t14*t17*t35+1.0d+0*rhoa*t116*t1
     7         7*t35)-3.04966d-3*t102*t109*t111*t96-5.15088d-3*rhoa*t111
     8         *t14*t17*t28*t35+1.25d-1*gammaaa*t14*t15*t16*t23*t35)*wgh
     9         t+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = (t98*(1.0d+0*t96*(-3.3333333333333337d+0*t1
     1         08*t53*t98*taub-6.666666666666667d+0*t102*t104*t105*t53*t
     2         aub-3.3333333333333337d+0*t100*t102*t103*t53*taub-6.09932
     3         d-3*t101*t117*t142*t99-5.333333333333333d+0*gammabb*t100*
     4         t102*t141*t99-2.6666666666666666d+0*gammabb*t107*t141*t98
     5         -6.09932d-3*t105*t106*t117*t142-6.09932d-3*t100*t103*t104
     6         *t117*t142-3.04966d-3*t102*t104*t108*t142-3.04966d-3*t100
     7         *t102*t107*t142-2.6666666666666666d+0*gammabb*t102*t103*t
     8         104*t141)+1.0d+0*t109*(t95+t65*(2.3923187454478842d-1*t13
     9         5*t70*t74*t91*t94-5.980796863619711d-2*t148*t69*t70*t91*t
     :         94+1.9751631321680768d-2*(t150+t149+1.923661050931536d+0*
     ;         t148+t134)*t85*t89-6.21814d-2*(t150+t149+t134)*t67*t83+t1
     <         40+t139+t138+t137+t124+t123+t122)+t90+t84+6.9035221983426
     =         71d-18*t47*t48+3.1090699999999993d-2*t43*t44-rhob*t147))+
     >         t58*(1.0d+0*rhob*t49*t52*(-6.666666666666667d+0*t31*t53*t
     ?         61*t62*taub-3.3333333333333337d+0*gammabb*t29*t60*t61*tau
     @         b-3.3333333333333337d+0*t34*t53*t58*taub-1.030176d-2*t142
     1         *t143*t31*t63-5.15088d-3*t142*t34*t61*t62-2.6666666666666
     2         666d+0*gammabb*t141*t29*t61*t62-1.030176d-2*gammabb*t142*
     3         t143*t29*t53*t62-5.333333333333333d+0*t25*t59*t61/rhob**6
     4         .333333333333333d+0-5.15088d-3*gammabb*t142*t33*t53*t61-1
     5         .030176d-2*t142*t143*t25*t59*t60-2.6666666666666666d+0*ga
     6         mmabb*t141*t33*t58)+1.0d+0*t49*t52*t64+1.0d+0*rhob*t147*t
     7         52*t64)-3.04966d-3*t102*t109*t142*t96-5.15088d-3*rhob*t14
     8         2*t49*t52*t61*t64+1.25d-1*gammabb*t49*t50*t51*t58*t64)*wg
     9         ht+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = (1.0d+0*t96*t98*(-6.09932d-3*t101*t117*t18
     1         *t99+2*t100*t102*t18*t99+t107*t18*t98-6.09932d-3*t105*t10
     2         6*t117*t18-6.09932d-3*t100*t103*t104*t117*t18-3.04966d-3*
     3         t102*t104*t108*t18-3.04966d-3*t100*t102*t107*t18+t102*t10
     4         3*t104*t18)-3.04966d-3*t102*t109*t18*t96-5.15088d-3*t14*t
     5         17*t20*t28*t35-1.25d-1*t14*t16*t23*t35+1.0d+0*rhoa*t14*t1
     6         7*t23*(-5.15088d-3*t18*t28*t30*t34-5.15088d-3*gammaaa*t27
     7         *t28*t33+t18*t23*t33-1.030176d-2*t112*t18*t31*t32+t18*t28
     8         *t29*t30-1.030176d-2*gammaaa*t112*t27*t29*t30+2*gammaaa*t
     9         25*t27*t28-1.030176d-2*t112*t25*t26/rhoa**8))*wght+Cmat(i
     :         q,D1_GAA)
            Cmat(iq,D1_GAB) = Cmat(iq,D1_GAB)
            Cmat(iq,D1_GBB) = (1.0d+0*t96*t98*(-6.09932d-3*t101*t117*t53
     1         *t99+2*t100*t102*t53*t99+t107*t53*t98-6.09932d-3*t105*t10
     2         6*t117*t53-6.09932d-3*t100*t103*t104*t117*t53-3.04966d-3*
     3         t102*t104*t108*t53-3.04966d-3*t100*t102*t107*t53+t102*t10
     4         3*t104*t53)-3.04966d-3*t102*t109*t53*t96-5.15088d-3*t49*t
     5         52*t55*t61*t64-1.25d-1*t49*t51*t58*t64+1.0d+0*rhob*t49*t5
     6         2*t58*(-1.030176d-2*t143*t31*t53*t63-5.15088d-3*t34*t53*t
     7         61*t62+t29*t53*t61*t62-1.030176d-2*gammabb*t143*t29*t60*t
     8         62-5.15088d-3*gammabb*t33*t60*t61+2*gammabb*t25*t60*t61-1
     9         .030176d-2*t143*t25*t59/rhob**8+t33*t53*t58))*wght+Cmat(i
     :         q,D1_GBB)
            Mmat(iq,D1_TA) = (1.25d-1*gammaaa*t14*t23*t35/taua**2+1.0d+0
     1         *t96*t98*(-1.219864d-2*t101*t117*t20*t99+2.0d+0*t108*t20*
     2         t98-1.219864d-2*t105*t106*t117*t20-1.219864d-2*t100*t103*
     3         t104*t117*t20-6.09932d-3*t102*t104*t108*t20-6.09932d-3*t1
     4         00*t102*t107*t20+4.0d+0*t102*t104*t105*t20+2.0d+0*t100*t1
     5         02*t103*t20)-6.09932d-3*t102*t109*t20*t96-1.030176d-2*t1*
     6         t14*t17*t28*t35+1.0d+0*rhoa*t14*t17*t23*(-1.030176d-2*t20
     7         *t28*t30*t34+2.0d+0*t20*t23*t34-1.030176d-2*gammaaa*t151*
     8         t28*t33-2.060352d-2*t112*t20*t31*t32+4.0d+0*t20*t28*t30*t
     9         31-2.060352d-2*gammaaa*t112*t151*t29*t30+2.0d+0*gammaaa*t
     :         151*t28*t29-2.060352d-2*t112*t25*t26/rhoa**7))*wght+Mmat(
     ;         iq,D1_TA)
            Mmat(iq,D1_TB) = (1.25d-1*gammabb*t49*t58*t64/taub**2+1.0d+0
     1         *t96*t98*(-1.219864d-2*t101*t117*t55*t99+2.0d+0*t108*t55*
     2         t98-1.219864d-2*t105*t106*t117*t55-1.219864d-2*t100*t103*
     3         t104*t117*t55-6.09932d-3*t102*t104*t108*t55-6.09932d-3*t1
     4         00*t102*t107*t55+4.0d+0*t102*t104*t105*t55+2.0d+0*t100*t1
     5         02*t103*t55)-6.09932d-3*t102*t109*t55*t96-1.030176d-2*t36
     6         *t49*t52*t61*t64+1.0d+0*rhob*t49*t52*t58*(-2.060352d-2*t1
     7         43*t31*t55*t63-1.030176d-2*t34*t55*t61*t62+4.0d+0*t31*t55
     8         *t61*t62-2.060352d-2*gammabb*t143*t152*t29*t62-1.030176d-
     9         2*gammabb*t152*t33*t61+2.0d+0*gammabb*t152*t29*t61-2.0603
     :         52d-2*t143*t25*t59/rhob**7+2.0d+0*t34*t55*t58))*wght+Mmat
     ;         (iq,D1_TB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = 1/rhoa**6.666666666666666d-1
            t2 = rhoa**5.0d-1
            t3 = 1/t2
            t4 = 1/rhoa**3.333333333333333d-1
            t5 = 1/rhoa**1.6666666666666666d-1
            t6 = 1.1120374863094686d+1*t5+3.8447462374472113d+0*t4+1.644
     1         733775567609d+0*t3+2.4058712912881916d-1*t1
            t7 = 3.216395899738507d+1/t6+1.0d+0
            t8 = log(t7)
            t9 = 1.274696188700087d-1*t4+1.0d+0
            t10 = 5.982550435771079d+0*t5+2.2255694211506874d+0*t4+8.004
     1         286349993635d-1*t3+1.8970043257475583d-1*t1
            t11 = 1.6081979498692536d+1/t10+1.0d+0
            t12 = log(t11)
            t13 = 1.3256889990520176d-1*t4+1.0d+0
            t14 = -3.1090699999999993d-2*t8*t9-6.903522198342671d-18*t12
     1         *t13
            t15 = 1/rhoa
            t16 = 1/taua
            t17 = 1.0d+0-1.25d-1*gammaaa*t15*t16
            t18 = 1/rhoa**2.6666666666666666d+0
            t19 = 1/rhoa**1.6666666666666669d+0
            t20 = 2.0d+0*t19*taua
            t21 = 5.15088d-3*(t20+gammaaa*t18-9.11559972d+0)+1.0d+0
            t22 = 1/t21
            t23 = param(10)
            t24 = gammaaa**2
            t25 = 1/rhoa**5.333333333333333d+0
            t26 = 1/t21**2
            t27 = param(11)
            t28 = t20-9.11559972d+0
            t29 = param(12)
            t30 = t28**2
            t31 = param(8)
            t32 = param(9)
            t33 = t22*t28*t32+gammaaa*t18*t22*t31+t26*t29*t30+gammaaa*t1
     1         8*t26*t27*t28+t23*t24*t25*t26+param(7)
            t34 = 1/rhoa**3.6666666666666664d+0
            t35 = -3.3333333333333337d+0*t18*taua-2.6666666666666666d+0*
     1         gammaaa*t34
            t36 = 1/t21**3
            t37 = 1/t2**3
            t38 = 1/rhoa**1.3333333333333333d+0
            t39 = 1/rhoa**1.1666666666666667d+0
            t40 = 1/rhoa**4.333333333333333d+0
            fnc(iq) = 1.0d+0*rhoa*t14*t17*t22*t33*wght+fnc(iq)
            Amat(iq,D1_RA) = t22*(1.0d+0*rhoa*t14*t17*(-3.33333333333333
     1         37d+0*t18*t22*t32*taua-6.666666666666667d+0*t18*t26*t28*t
     2         29*taua-3.3333333333333337d+0*gammaaa*t25*t26*t27*taua-1.
     3         030176d-2*t29*t30*t35*t36-1.030176d-2*gammaaa*t18*t27*t28
     4         *t35*t36-1.030176d-2*t23*t24*t25*t35*t36-5.15088d-3*t26*t
     5         28*t32*t35-5.15088d-3*gammaaa*t18*t26*t31*t35-2.666666666
     6         6666666d+0*gammaaa*t22*t31*t34-2.6666666666666666d+0*gamm
     7         aaa*t26*t27*t28*t34-5.333333333333333d+0*t23*t24*t26/rhoa
     8         **6.333333333333333d+0)*wght+1.0d+0*rhoa*t17*t33*(1.0d+0*
     9         (-1.8533958105157808d+0*t39-1.2815820791490704d+0*t38-8.2
     :         23668877838045d-1*t37-1.6039141941921276d-1*t19)*t9/(t6**
     ;         2*t7)+1.3210398931339265d-3*t38*t8+1.1102230246251565d-16
     <         *t13*(-9.970917392951799d-1*t39-7.418564737168958d-1*t38-
     =         4.002143174996817d-1*t37-1.264669550498372d-1*t19)/(t10**
     >         2*t11)+3.0506411443514264d-19*t12*t38)*wght+1.0d+0*t14*t1
     ?         7*t33*wght)-5.15088d-3*rhoa*t14*t17*t26*t33*t35*wght+1.25
     @         d-1*gammaaa*t14*t15*t16*t22*t33*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = 1.0d+0*rhoa*t14*t17*t22*(-1.030176d-2*t18*
     1         t29*t30*t36-1.030176d-2*gammaaa*t25*t27*t28*t36-1.030176d
     2         -2*t23*t24*t36/rhoa**8-5.15088d-3*t18*t26*t28*t32-5.15088
     3         d-3*gammaaa*t25*t26*t31+t18*t22*t31+t18*t26*t27*t28+2*gam
     4         maaa*t23*t25*t26)*wght-5.15088d-3*t14*t17*t19*t26*t33*wgh
     5         t-1.25d-1*t14*t16*t22*t33*wght+Cmat(iq,D1_GAA)
            Mmat(iq,D1_TA) = 1.25d-1*gammaaa*t14*t22*t33*wght/taua**2+1.
     1         0d+0*rhoa*t14*t17*t22*(-2.060352d-2*gammaaa*t27*t28*t36*t
     2         40-1.030176d-2*gammaaa*t26*t31*t40+2.0d+0*gammaaa*t26*t27
     3         *t40-2.060352d-2*t19*t29*t30*t36-2.060352d-2*t23*t24*t36/
     4         rhoa**7-1.030176d-2*t19*t26*t28*t32+2.0d+0*t19*t22*t32+4.
     5         0d+0*t19*t26*t28*t29)*wght-1.030176d-2*t1*t14*t17*t26*t33
     6         *wght+Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhob**6.666666666666666d-1
            t2 = rhob**5.0d-1
            t3 = 1/t2
            t4 = 1/rhob**3.333333333333333d-1
            t5 = 1/rhob**1.6666666666666666d-1
            t6 = 1.1120374863094686d+1*t5+3.8447462374472113d+0*t4+1.644
     1         733775567609d+0*t3+2.4058712912881916d-1*t1
            t7 = 3.216395899738507d+1/t6+1.0d+0
            t8 = log(t7)
            t9 = 1.274696188700087d-1*t4+1.0d+0
            t10 = 5.982550435771079d+0*t5+2.2255694211506874d+0*t4+8.004
     1         286349993635d-1*t3+1.8970043257475583d-1*t1
            t11 = 1.6081979498692536d+1/t10+1.0d+0
            t12 = log(t11)
            t13 = 1.3256889990520176d-1*t4+1.0d+0
            t14 = -3.1090699999999993d-2*t8*t9-6.903522198342671d-18*t12
     1         *t13
            t15 = 1/rhob
            t16 = 1/taub
            t17 = 1.0d+0-1.25d-1*gammabb*t15*t16
            t18 = 1/rhob**2.6666666666666666d+0
            t19 = 1/rhob**1.6666666666666669d+0
            t20 = 2.0d+0*t19*taub
            t21 = 5.15088d-3*(t20+gammabb*t18-9.11559972d+0)+1.0d+0
            t22 = 1/t21
            t23 = param(10)
            t24 = gammabb**2
            t25 = 1/rhob**5.333333333333333d+0
            t26 = 1/t21**2
            t27 = param(11)
            t28 = t20-9.11559972d+0
            t29 = param(12)
            t30 = t28**2
            t31 = param(8)
            t32 = param(9)
            t33 = t22*t28*t32+gammabb*t18*t22*t31+t26*t29*t30+gammabb*t1
     1         8*t26*t27*t28+t23*t24*t25*t26+param(7)
            t34 = 1/rhob**3.6666666666666664d+0
            t35 = -3.3333333333333337d+0*t18*taub-2.6666666666666666d+0*
     1         gammabb*t34
            t36 = 1/t21**3
            t37 = 1/t2**3
            t38 = 1/rhob**1.3333333333333333d+0
            t39 = 1/rhob**1.1666666666666667d+0
            t40 = 1/rhob**4.333333333333333d+0
            fnc(iq) = 1.0d+0*rhob*t14*t17*t22*t33*wght+fnc(iq)
            Amat(iq,D1_RB) = t22*(1.0d+0*rhob*t14*t17*(-3.33333333333333
     1         37d+0*t18*t22*t32*taub-6.666666666666667d+0*t18*t26*t28*t
     2         29*taub-3.3333333333333337d+0*gammabb*t25*t26*t27*taub-1.
     3         030176d-2*t29*t30*t35*t36-1.030176d-2*gammabb*t18*t27*t28
     4         *t35*t36-1.030176d-2*t23*t24*t25*t35*t36-5.15088d-3*t26*t
     5         28*t32*t35-5.15088d-3*gammabb*t18*t26*t31*t35-2.666666666
     6         6666666d+0*gammabb*t22*t31*t34-2.6666666666666666d+0*gamm
     7         abb*t26*t27*t28*t34-5.333333333333333d+0*t23*t24*t26/rhob
     8         **6.333333333333333d+0)*wght+1.0d+0*rhob*t17*t33*(1.0d+0*
     9         (-1.8533958105157808d+0*t39-1.2815820791490704d+0*t38-8.2
     :         23668877838045d-1*t37-1.6039141941921276d-1*t19)*t9/(t6**
     ;         2*t7)+1.3210398931339265d-3*t38*t8+1.1102230246251565d-16
     <         *t13*(-9.970917392951799d-1*t39-7.418564737168958d-1*t38-
     =         4.002143174996817d-1*t37-1.264669550498372d-1*t19)/(t10**
     >         2*t11)+3.0506411443514264d-19*t12*t38)*wght+1.0d+0*t14*t1
     ?         7*t33*wght)-5.15088d-3*rhob*t14*t17*t26*t33*t35*wght+1.25
     @         d-1*gammabb*t14*t15*t16*t22*t33*wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GBB) = 1.0d+0*rhob*t14*t17*t22*(-1.030176d-2*t18*
     1         t29*t30*t36-1.030176d-2*gammabb*t25*t27*t28*t36-1.030176d
     2         -2*t23*t24*t36/rhob**8-5.15088d-3*t18*t26*t28*t32-5.15088
     3         d-3*gammabb*t25*t26*t31+t18*t22*t31+t18*t26*t27*t28+2*gam
     4         mabb*t23*t25*t26)*wght-5.15088d-3*t14*t17*t19*t26*t33*wgh
     5         t-1.25d-1*t14*t16*t22*t33*wght+Cmat(iq,D1_GBB)
            Mmat(iq,D1_TB) = 1.25d-1*gammabb*t14*t22*t33*wght/taub**2+1.
     1         0d+0*rhob*t14*t17*t22*(-2.060352d-2*gammabb*t27*t28*t36*t
     2         40-1.030176d-2*gammabb*t26*t31*t40+2.0d+0*gammabb*t26*t27
     3         *t40-2.060352d-2*t19*t29*t30*t36-2.060352d-2*t23*t24*t36/
     4         rhob**7-1.030176d-2*t19*t26*t28*t32+2.0d+0*t19*t22*t32+4.
     5         0d+0*t19*t26*t28*t29)*wght-1.030176d-2*t1*t14*t17*t26*t33
     6         *wght+Mmat(iq,D1_TB)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_vs98 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& {{1}\over{\rho_\alpha^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\sqrt{\rho_\alpha}}}\\\\ 
C>   {\it t_3} &=& {{1}\over{\rho_\alpha^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{\rho_\alpha^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_5} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_4}+2.225569421150687\,{\it t_3}+.8004286349993635\,{\it t_2}+.1897004325747558\,{\it t_1}}}+1.0\right)\,\left(.1325688999052018\,{\it t_3}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_4}+3.844746237447211\,{\it t_3}+1.644733775567609\,{\it t_2}+.2405871291288192\,{\it t_1}}}+1.0\right)\,\left(.1274696188700087\,{\it t_3}+1.0\right)\\\\ 
C>   {\it t_6} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_7} &=& {\it t_6}\,\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_8} &=& {{2.0\,\tau_\alpha}\over{\rho_\alpha^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_9} &=& 0.00515088\,\left({\it t_8}+{\it t_7}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}}}\\\\ 
C>   {\it t_{11}} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_{12}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{13}} &=& {{1}\over{{\it t_9}^2}}\\\\ 
C>   {\it t_{14}} &=& {\it param}\left(11\right)\\\\ 
C>   {\it t_{15}} &=& {\it t_8}-9.11559972\\\\ 
C>   {\it t_{16}} &=& {\it param}\left(12\right)\\\\ 
C>   {\it t_{17}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{18}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\rho_\beta^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{\sqrt{\rho_\beta}}}\\\\ 
C>   {\it t_{21}} &=& {{1}\over{\rho_\beta^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\rho_\beta^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{23}} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{22}}+2.225569421150687\,{\it t_{21}}+.8004286349993635\,{\it t_{20}}+.1897004325747558\,{\it t_{19}}}}+1.0\right)\,\left(.1325688999052018\,{\it t_{21}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{22}}+3.844746237447211\,{\it t_{21}}+1.644733775567609\,{\it t_{20}}+.2405871291288192\,{\it t_{19}}}}+1.0\right)\,\left(.1274696188700087\,{\it t_{21}}+1.0\right)\\\\ 
C>   {\it t_{24}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{25}} &=& {\it t_{24}}\,\sigma_{\beta\beta}\\\\ 
C>   {\it t_{26}} &=& {{2.0\,\tau_\beta}\over{\rho_\beta^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_{27}} &=& 0.00515088\,\left({\it t_{26}}+{\it t_{25}}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{27}}}}\\\\ 
C>   {\it t_{29}} &=& {{1}\over{{\it t_{27}}^2}}\\\\ 
C>   {\it t_{30}} &=& {\it t_{26}}-9.11559972\\\\ 
C>   {\it t_{31}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{33}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{34}} &=& {\it t_{33}}^4\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{31}}^4}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{{\it t_{31}}}}\\\\ 
C>   {\it t_{37}} &=& \left({\it t_{33}}\,{\it t_{36}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{33}}\,{\it t_{36}}\right)^{{{4}\over{3}}}-2.0\\\\ 
C>   {\it t_{38}} &=& -1.923661050931536\,{\it t_{34}}\,{\it t_{35}}\,{\it t_{37}}\\\\ 
C>   {\it t_{39}} &=& {{1}\over{{\it t_{31}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{40}} &=& {{1}\over{\sqrt{{\it t_{31}}}}}\\\\ 
C>   {\it t_{41}} &=& {{1}\over{{\it t_{31}}^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{42}} &=& 0.00304966\,\left({\it t_{26}}+{\it t_8}+{\it t_{25}}+{\it t_7}-18.23119944\right)+1.0\\\\ 
C>   {\it t_{43}} &=& {{1}\over{{\it t_{42}}}}\\\\ 
C>   {\it t_{44}} &=& {\it t_{25}}+{\it t_7}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{{\it t_{42}}^2}}\\\\ 
C>   {\it t_{46}} &=& {\it t_{26}}+{\it t_8}-18.23119944\\\\ 
C>   {\it t_{47}} &=& {{1}\over{\rho_s^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{\sqrt{\rho_s}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{\rho_s^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{50}} &=& {{1}\over{\rho_s^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{51}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{52}} &=& {{2.0\,\tau_s}\over{\rho_s^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_{53}} &=& 0.00515088\,\left({\it t_{52}}+{\it t_{51}}\,\sigma_{ss}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{54}} &=& {{1}\over{{\it t_{53}}}}\\\\ 
C>   {\it t_{55}} &=& {{1}\over{{\it t_{53}}^2}}\\\\ 
C>   {\it t_{56}} &=& {\it t_{52}}-9.11559972\\\\ 
C>   f &=& 1.0\,\left({\it t_{31}}\,\left(-0.0598079686361971\,{\it t_{34}}\,{\it t_{35}}\,\left(.1274696188700087\,{\it t_{32}}+1.0\right)\,{\it t_{37}}\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{41}}+3.844746237447211\,{\it t_{32}}+1.644733775567609\,{\it t_{40}}+.2405871291288192\,{\it t_{39}}}}+1.0\right)+.01975163132168077\,\left(.06901399211255825\,{\it t_{32}}+1.0\right)\,\left({\it t_{38}}+1.923661050931536\,{\it t_{37}}\right)\,\log \left({{29.60881320326807}\over{8.15741470348764\,{\it t_{41}}+2.247591863577616\,{\it t_{32}}+.4300972471276643\,{\it t_{40}}+.1911512595127337\,{\it t_{39}}}}+1.0\right)-0.0621814\,\left(.1325688999052018\,{\it t_{32}}+1.0\right)\,\left({\it t_{38}}+1.0\right)\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{41}}+2.225569421150687\,{\it t_{32}}+.8004286349993635\,{\it t_{40}}+.1897004325747558\,{\it t_{39}}}}+1.0\right)\right)-{\it t_{23}}\,\rho_\beta-{\it t_5}\,\rho_\alpha\right)\,{\it t_{43}}\,\left({\it param}\left(3\right)\,{\it t_{46}}\,{\it t_{43}}+{\it param}\left(2\right)\,{\it t_{44}}\,{\it t_{43}}+{\it param}\left(6\right)\,{\it t_{46}}^2\,{\it t_{45}}+{\it param}\left(5\right)\,{\it t_{44}}\,{\it t_{46}}\,{\it t_{45}}+{\it param}\left(4\right)\,{\it t_{44}}^2\,{\it t_{45}}+{\it param}\left(1\right)\right)+1.0\,{\it t_{23}}\,\rho_\beta\,\left(1.0-{{0.125\,\sigma_{\beta\beta}}\over{\rho_\beta\,\tau_\beta}}\right)\,{\it t_{28}}\,\left({\it t_{18}}\,{\it t_{30}}\,{\it t_{28}}+{\it t_{17}}\,{\it t_{24}}\,\sigma_{\beta\beta}\,{\it t_{28}}+{\it t_{16}}\,{\it t_{30}}^2\,{\it t_{29}}+{\it t_{14}}\,{\it t_{24}}\,\sigma_{\beta\beta}\,{\it t_{30}}\,{\it t_{29}}+{{{\it t_{12}}\,\sigma_{\beta\beta}^2\,{\it t_{29}}}\over{\rho_\beta^{{{16}\over{3}}}}}+{\it t_{11}}\right)+1.0\,{\it t_5}\,\rho_\alpha\,\left(1.0-{{0.125\,\sigma_{\alpha\alpha}}\over{\rho_\alpha\,\tau_\alpha}}\right)\,{\it t_{10}}\,\left({\it t_{18}}\,{\it t_{15}}\,{\it t_{10}}+{\it t_{17}}\,{\it t_6}\,\sigma_{\alpha\alpha}\,{\it t_{10}}+{\it t_{16}}\,{\it t_{15}}^2\,{\it t_{13}}+{\it t_{14}}\,{\it t_6}\,\sigma_{\alpha\alpha}\,{\it t_{15}}\,{\it t_{13}}+{{{\it t_{12}}\,\sigma_{\alpha\alpha}^2\,{\it t_{13}}}\over{\rho_\alpha^{{{16}\over{3}}}}}+{\it t_{11}}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,\left(-6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{50}}+2.225569421150687\,{\it t_{49}}+.8004286349993635\,{\it t_{48}}+.1897004325747558\,{\it t_{47}}}}+1.0\right)\,\left(.1325688999052018\,{\it t_{49}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{50}}+3.844746237447211\,{\it t_{49}}+1.644733775567609\,{\it t_{48}}+.2405871291288192\,{\it t_{47}}}}+1.0\right)\,\left(.1274696188700087\,{\it t_{49}}+1.0\right)\right)\,\rho_s\,\left(1.0-{{0.125\,\sigma_{ss}}\over{\rho_s\,\tau_s}}\right)\,{\it t_{54}}\,\left({\it t_{18}}\,{\it t_{56}}\,{\it t_{54}}+{\it t_{17}}\,{\it t_{51}}\,\sigma_{ss}\,{\it t_{54}}+{\it t_{16}}\,{\it t_{56}}^2\,{\it t_{55}}+{\it t_{14}}\,{\it t_{51}}\,\sigma_{ss}\,{\it t_{56}}\,{\it t_{55}}+{{{\it t_{12}}\,\sigma_{ss}^2\,{\it t_{55}}}\over{\rho_s^{{{16}\over{3}}}}}+{\it t_{11}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] T van Voorhis, GE Scuseria, J.Chem.Phys. 109, 400 (1998)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.3005348 "> 
C> 10.1063/1.3005348 </a> 
C> 
      subroutine nwxcm_c_vs98_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Cmat,Cmat2,Mmat,Mmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_vs98 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& {{1}\over{\rho_\alpha^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\sqrt{\rho_\alpha}}}\\\\ 
C>   {\it t_3} &=& {{1}\over{\rho_\alpha^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{\rho_\alpha^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_5} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_4}+2.225569421150687\,{\it t_3}+.8004286349993635\,{\it t_2}+.1897004325747558\,{\it t_1}}}+1.0\right)\,\left(.1325688999052018\,{\it t_3}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_4}+3.844746237447211\,{\it t_3}+1.644733775567609\,{\it t_2}+.2405871291288192\,{\it t_1}}}+1.0\right)\,\left(.1274696188700087\,{\it t_3}+1.0\right)\\\\ 
C>   {\it t_6} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_7} &=& {\it t_6}\,\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_8} &=& {{2.0\,\tau_\alpha}\over{\rho_\alpha^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_9} &=& 0.00515088\,\left({\it t_8}+{\it t_7}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}}}\\\\ 
C>   {\it t_{11}} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_{12}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{13}} &=& {{1}\over{{\it t_9}^2}}\\\\ 
C>   {\it t_{14}} &=& {\it param}\left(11\right)\\\\ 
C>   {\it t_{15}} &=& {\it t_8}-9.11559972\\\\ 
C>   {\it t_{16}} &=& {\it param}\left(12\right)\\\\ 
C>   {\it t_{17}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{18}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\rho_\beta^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{\sqrt{\rho_\beta}}}\\\\ 
C>   {\it t_{21}} &=& {{1}\over{\rho_\beta^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\rho_\beta^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{23}} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{22}}+2.225569421150687\,{\it t_{21}}+.8004286349993635\,{\it t_{20}}+.1897004325747558\,{\it t_{19}}}}+1.0\right)\,\left(.1325688999052018\,{\it t_{21}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{22}}+3.844746237447211\,{\it t_{21}}+1.644733775567609\,{\it t_{20}}+.2405871291288192\,{\it t_{19}}}}+1.0\right)\,\left(.1274696188700087\,{\it t_{21}}+1.0\right)\\\\ 
C>   {\it t_{24}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{25}} &=& {\it t_{24}}\,\sigma_{\beta\beta}\\\\ 
C>   {\it t_{26}} &=& {{2.0\,\tau_\beta}\over{\rho_\beta^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_{27}} &=& 0.00515088\,\left({\it t_{26}}+{\it t_{25}}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{27}}}}\\\\ 
C>   {\it t_{29}} &=& {{1}\over{{\it t_{27}}^2}}\\\\ 
C>   {\it t_{30}} &=& {\it t_{26}}-9.11559972\\\\ 
C>   {\it t_{31}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{33}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{34}} &=& {\it t_{33}}^4\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{31}}^4}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{{\it t_{31}}}}\\\\ 
C>   {\it t_{37}} &=& \left({\it t_{33}}\,{\it t_{36}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{33}}\,{\it t_{36}}\right)^{{{4}\over{3}}}-2.0\\\\ 
C>   {\it t_{38}} &=& -1.923661050931536\,{\it t_{34}}\,{\it t_{35}}\,{\it t_{37}}\\\\ 
C>   {\it t_{39}} &=& {{1}\over{{\it t_{31}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{40}} &=& {{1}\over{\sqrt{{\it t_{31}}}}}\\\\ 
C>   {\it t_{41}} &=& {{1}\over{{\it t_{31}}^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{42}} &=& 0.00304966\,\left({\it t_{26}}+{\it t_8}+{\it t_{25}}+{\it t_7}-18.23119944\right)+1.0\\\\ 
C>   {\it t_{43}} &=& {{1}\over{{\it t_{42}}}}\\\\ 
C>   {\it t_{44}} &=& {\it t_{25}}+{\it t_7}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{{\it t_{42}}^2}}\\\\ 
C>   {\it t_{46}} &=& {\it t_{26}}+{\it t_8}-18.23119944\\\\ 
C>   {\it t_{47}} &=& {{1}\over{\rho_s^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{\sqrt{\rho_s}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{\rho_s^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{50}} &=& {{1}\over{\rho_s^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{51}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{52}} &=& {{2.0\,\tau_s}\over{\rho_s^{{{5}\over{3}}}}}\\\\ 
C>   {\it t_{53}} &=& 0.00515088\,\left({\it t_{52}}+{\it t_{51}}\,\sigma_{ss}-9.11559972\right)+1.0\\\\ 
C>   {\it t_{54}} &=& {{1}\over{{\it t_{53}}}}\\\\ 
C>   {\it t_{55}} &=& {{1}\over{{\it t_{53}}^2}}\\\\ 
C>   {\it t_{56}} &=& {\it t_{52}}-9.11559972\\\\ 
C>   f &=& 1.0\,\left({\it t_{31}}\,\left(-0.0598079686361971\,{\it t_{34}}\,{\it t_{35}}\,\left(.1274696188700087\,{\it t_{32}}+1.0\right)\,{\it t_{37}}\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{41}}+3.844746237447211\,{\it t_{32}}+1.644733775567609\,{\it t_{40}}+.2405871291288192\,{\it t_{39}}}}+1.0\right)+.01975163132168077\,\left(.06901399211255825\,{\it t_{32}}+1.0\right)\,\left({\it t_{38}}+1.923661050931536\,{\it t_{37}}\right)\,\log \left({{29.60881320326807}\over{8.15741470348764\,{\it t_{41}}+2.247591863577616\,{\it t_{32}}+.4300972471276643\,{\it t_{40}}+.1911512595127337\,{\it t_{39}}}}+1.0\right)-0.0621814\,\left(.1325688999052018\,{\it t_{32}}+1.0\right)\,\left({\it t_{38}}+1.0\right)\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{41}}+2.225569421150687\,{\it t_{32}}+.8004286349993635\,{\it t_{40}}+.1897004325747558\,{\it t_{39}}}}+1.0\right)\right)-{\it t_{23}}\,\rho_\beta-{\it t_5}\,\rho_\alpha\right)\,{\it t_{43}}\,\left({\it param}\left(3\right)\,{\it t_{46}}\,{\it t_{43}}+{\it param}\left(2\right)\,{\it t_{44}}\,{\it t_{43}}+{\it param}\left(6\right)\,{\it t_{46}}^2\,{\it t_{45}}+{\it param}\left(5\right)\,{\it t_{44}}\,{\it t_{46}}\,{\it t_{45}}+{\it param}\left(4\right)\,{\it t_{44}}^2\,{\it t_{45}}+{\it param}\left(1\right)\right)+1.0\,{\it t_{23}}\,\rho_\beta\,\left(1.0-{{0.125\,\sigma_{\beta\beta}}\over{\rho_\beta\,\tau_\beta}}\right)\,{\it t_{28}}\,\left({\it t_{18}}\,{\it t_{30}}\,{\it t_{28}}+{\it t_{17}}\,{\it t_{24}}\,\sigma_{\beta\beta}\,{\it t_{28}}+{\it t_{16}}\,{\it t_{30}}^2\,{\it t_{29}}+{\it t_{14}}\,{\it t_{24}}\,\sigma_{\beta\beta}\,{\it t_{30}}\,{\it t_{29}}+{{{\it t_{12}}\,\sigma_{\beta\beta}^2\,{\it t_{29}}}\over{\rho_\beta^{{{16}\over{3}}}}}+{\it t_{11}}\right)+1.0\,{\it t_5}\,\rho_\alpha\,\left(1.0-{{0.125\,\sigma_{\alpha\alpha}}\over{\rho_\alpha\,\tau_\alpha}}\right)\,{\it t_{10}}\,\left({\it t_{18}}\,{\it t_{15}}\,{\it t_{10}}+{\it t_{17}}\,{\it t_6}\,\sigma_{\alpha\alpha}\,{\it t_{10}}+{\it t_{16}}\,{\it t_{15}}^2\,{\it t_{13}}+{\it t_{14}}\,{\it t_6}\,\sigma_{\alpha\alpha}\,{\it t_{15}}\,{\it t_{13}}+{{{\it t_{12}}\,\sigma_{\alpha\alpha}^2\,{\it t_{13}}}\over{\rho_\alpha^{{{16}\over{3}}}}}+{\it t_{11}}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,\left(-6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{50}}+2.225569421150687\,{\it t_{49}}+.8004286349993635\,{\it t_{48}}+.1897004325747558\,{\it t_{47}}}}+1.0\right)\,\left(.1325688999052018\,{\it t_{49}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{50}}+3.844746237447211\,{\it t_{49}}+1.644733775567609\,{\it t_{48}}+.2405871291288192\,{\it t_{47}}}}+1.0\right)\,\left(.1274696188700087\,{\it t_{49}}+1.0\right)\right)\,\rho_s\,\left(1.0-{{0.125\,\sigma_{ss}}\over{\rho_s\,\tau_s}}\right)\,{\it t_{54}}\,\left({\it t_{18}}\,{\it t_{56}}\,{\it t_{54}}+{\it t_{17}}\,{\it t_{51}}\,\sigma_{ss}\,{\it t_{54}}+{\it t_{16}}\,{\it t_{56}}^2\,{\it t_{55}}+{\it t_{14}}\,{\it t_{51}}\,\sigma_{ss}\,{\it t_{56}}\,{\it t_{55}}+{{{\it t_{12}}\,\sigma_{ss}^2\,{\it t_{55}}}\over{\rho_s^{{{16}\over{3}}}}}+{\it t_{11}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] T van Voorhis, GE Scuseria, J.Chem.Phys. 109, 400 (1998)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.3005348 "> 
C> 10.1063/1.3005348 </a> 
C> 
      subroutine nwxcm_c_vs98_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3,Mmat,Mmat2,Mmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,NCOL_AMAT3)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,NCOL_CMAT3)  !< [Output] The 3rd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat3(nq,NCOL_MMAT3)  !< [Output] The 3rd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
