C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_tpss03.F 
C> The nwxcm_c_tpss03 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_tpss03 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_3} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_4} &=& \sqrt{{\it t_3}}\\\\ 
C>   {\it t_5} &=& {{1}\over{{\it t_4}}}\\\\ 
C>   {\it t_6} &=& {{1}\over{{\it t_3}}}\\\\ 
C>   {\it t_7} &=& \log \left({{1.269642451250142\,{\it t_4}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_5}+0.10186556948\right)\,{\it t_5}+0.22308199064\right)\,{\it t_5}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_8} &=& 0.1325688999052018\,{\it t_6}+1.0\\\\ 
C>   {\it t_9} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_7}\,{\it t_8}-0.0310907\,\log \left({{1.269642451250142\,{\it t_4}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_5}+0.10465751434\right)\,{\it t_5}+0.19269083139\right)\,{\it t_5}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_6}+1.0\right)\right)-0.0621814\,{\it t_7}\,{\it t_8}\\\\ 
C>   {\it t_{10}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_{10}}^{2.0}}}\\\\ 
C>   {\it t_{12}} &=& {{1}\over{e^{64.32793688582967\,{\it t_9}}}}-1.0\\\\ 
C>   {\it t_{13}} &=& {{0.2162211495206379\,{\it t_{11}}\,\sigma_{\alpha\alpha}}\over{{\it t_{12}}}}\\\\ 
C>   {\it t_{14}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{15}} &=& {\it t_{14}}\,{\it t_2}\\\\ 
C>   {\it t_{16}} &=& 2.26\,{\it t_{15}}^{6.0}+0.5\,{\it t_{15}}^{4.0}+0.87\,{\it t_{15}}^{2.0}+0.53\\\\ 
C>   {\it t_{17}} &=& 1.0-{\it t_{14}}\,{\it t_2}\\\\ 
C>   {\it t_{18}} &=& {\it t_{15}}+1.0\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\left({{0.0130605864926168\,\left({{1}\over{{\it t_{18}}^{1.333333333333333}}}+{{1}\over{{\it t_{17}}^{1.333333333333333}}}\right)\,\left({\it t_{18}}^2\,\sigma_{\beta\beta}-2.0\,{\it t_{17}}\,{\it t_{18}}\,\sigma_{\alpha\beta}+{\it t_{17}}^2\,\sigma_{\alpha\alpha}\right)}\over{{\it t_1}^{{{8}\over{3}}}}}+1.0\right)^{4.0}}}\\\\ 
C>   {\it t_{20}} &=& {\it t_{16}}\,{\it t_{19}}+1.0\\\\ 
C>   {\it t_{21}} &=& \sigma_{\beta\beta}+2.0\,\sigma_{\alpha\beta}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{22}} &=& {{{\it t_2}\,{\it t_{21}}}\over{\tau_\beta+\tau_\alpha}}\\\\ 
C>   {\it t_{23}} &=& {\it t_{22}}^{2.0}\\\\ 
C>   {\it t_{24}} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_{25}} &=& \sqrt{{\it t_{24}}}\\\\ 
C>   {\it t_{26}} &=& {{1}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{27}} &=& {{1}\over{{\it t_{24}}}}\\\\ 
C>   {\it t_{28}} &=& \log \left({{1.269642451250142\,{\it t_{25}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{26}}+0.10186556948\right)\,{\it t_{26}}+0.22308199064\right)\,{\it t_{26}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{29}} &=& 0.1325688999052018\,{\it t_{27}}+1.0\\\\ 
C>   {\it t_{30}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{28}}\,{\it t_{29}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{25}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{26}}+0.10465751434\right)\,{\it t_{26}}+0.19269083139\right)\,{\it t_{26}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{27}}+1.0\right)\right)-0.0621814\,{\it t_{28}}\,{\it t_{29}}\\\\ 
C>   {\it t_{31}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}^{2.0}}}\\\\ 
C>   {\it t_{33}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{30}}}}}-1.0\\\\ 
C>   {\it t_{34}} &=& {{0.2162211495206379\,{\it t_{32}}\,\sigma_{\beta\beta}}\over{{\it t_{33}}}}\\\\ 
C>   {\it t_{35}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{{\it t_{35}}}}\\\\ 
C>   {\it t_{37}} &=& 0.1325688999052018\,{\it t_{36}}+1.0\\\\ 
C>   {\it t_{38}} &=& \sqrt{{\it t_{35}}}\\\\ 
C>   {\it t_{39}} &=& {{1}\over{{\it t_{38}}}}\\\\ 
C>   {\it t_{40}} &=& \log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.02414199311453321\,{\it t_{39}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{41}} &=& 0.06901399211255826\,{\it t_{36}}+1.0\\\\ 
C>   {\it t_{42}} &=& \log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.01321299881039884\,{\it t_{39}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{43}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{18}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{17}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{14}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{37}}\,{\it t_{40}}-0.0310907\,\left(0.1274696188700087\,{\it t_{36}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.01530901310039024\,{\it t_{39}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{41}}\,{\it t_{42}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{41}}\,{\it t_{42}}\right)-0.0621814\,{\it t_{37}}\,{\it t_{40}}\\\\ 
C>   {\it t_{44}} &=& 0.5\,{\it t_{18}}^{{{2}\over{3}}}+0.5\,{\it t_{17}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{45}} &=& {\it t_{44}}^{3.0}\\\\ 
C>   {\it t_{46}} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{47}} &=& {{1}\over{{\it t_{46}}^{2.0}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{{\it t_{44}}^{2.0}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{e^{{{32.16396844291483\,{\it t_{43}}}\over{{\it t_{45}}}}}}}-1.0\\\\ 
C>   {\it t_{50}} &=& {{0.1362107888567592\,{\it t_{47}}\,{\it t_{48}}\,{\it t_{21}}}\over{{\it t_{49}}}}\\\\ 
C>   {\it t_{51}} &=& \left(0.03109069086965489\,{\it t_{45}}\,\log \left({{0.1362107888567592\,{\it t_{47}}\,{\it t_{48}}\,{\it t_{21}}\,\left({\it t_{50}}+1.0\right)}\over{{{0.01855337900098064\,{\it t_{21}}^{2.0}}\over{{\it t_{46}}^{4.0}\,{\it t_{44}}^{4.0}\,{\it t_{49}}^{2.0}}}+{\it t_{50}}+1.0}}+1.0\right)+1.0\,{\it t_{43}}\right)\,\left(0.015625\,{\it t_{16}}\,{\it t_{19}}\,{\it t_{23}}+1.0\right)-0.015625\,\rho_\beta\,{\it t_2}\,{\it t_{20}}\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{32}}\,\sigma_{\beta\beta}\,\left({\it t_{34}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{31}}^{4.0}\,{\it t_{33}}^{2.0}}}+{\it t_{34}}+1.0}}+1.0\right)+1.0\,{\it t_{30}}\right)\,{\it t_{23}}-0.015625\,\rho_\alpha\,{\it t_2}\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{11}}\,\sigma_{\alpha\alpha}\,\left({\it t_{13}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{10}}^{4.0}\,{\it t_{12}}^{2.0}}}+{\it t_{13}}+1.0}}+1.0\right)+1.0\,{\it t_9}\right)\,{\it t_{20}}\,{\it t_{23}}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,{\it t_{51}}\,\left(0.00546875\,{\it t_{22}}^{3.0}\,{\it t_{51}}+1.0\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.0\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] J Tao, JP Perdew, VN Staveroverov, GE Scuseria, Phys.Rev.Lett. 91, 146401 (2003)  , DOI: 
C> <a href="http://dx.doi.org/10.1103/PhysRevLett.91.146401 "> 
C> 10.1103/PhysRevLett.91.146401 </a> 
C> 
      subroutine nwxcm_c_tpss03(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Cmat,Mmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      double precision nwxcm_heaviside 
      external         nwxcm_heaviside 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = rhoa**3.333333333333333d-1
            t2 = t1**5.0d-1
            t3 = 1/t2
            t4 = 2.150807071909054d-2*t3+1.0186556948d-1
            t5 = 7.016926042943223d-1*t3*t4+2.2308199064d-1
            t6 = 7.016926042943223d-1*t3*t5+4.7231125998d-1
            t7 = 1/t6
            t8 = 1.4251254664507676d+0*t2*t7+1.0d+0
            t9 = log(t8)
            t10 = 1/t1
            t11 = 1.0522000558389215d-1*t10+1.0d+0
            t12 = rhoa**1.1666666666666667d+0
            t13 = 1/t12**2.0d+0
            t14 = exp(2.0000005873362642d+0*t11*t9)
            t15 = t14-1.0d+0
            t16 = 1/t15
            t17 = 1.0811057476031892d-1*gammaaa*t13*t16
            t18 = t17+1.0d+0
            t19 = gammaaa**2.0d+0
            t20 = 1/t12**4.0d+0
            t21 = 1/t15**2.0d+0
            t22 = 1.1687896375006504d-2*t19*t20*t21+t17+1.0d+0
            t23 = 1/t22
            t24 = 1.0811057476031892d-1*gammaaa*t13*t18*t23+1.0d+0
            t25 = 3.109069086965489d-2*log(t24)-6.21814d-2*t11*t9
            t26 = 1/rhoa
            t27 = 1/taua
            t28 = gammaaa*t26*t27
            t29 = t28**2.0d+0
            t30 = 8.28125d-3*t29+1.0d+0
            t31 = 1.530901310039024d-2*t3+1.0465751434d-1
            t32 = 7.876233178997433d-1*t3*t31+1.9269083139d-1
            t33 = 7.876233178997433d-1*t3*t32+4.3896648423d-1
            t34 = 1/t33
            t35 = 1.269642451250142d+0*t2*t34+1.0d+0
            t36 = log(t35)
            t37 = 1.2746961887000874d-1*t10+1.0d+0
            t38 = 2.4141993114533214d-2*t3+1.0186556948d-1
            t39 = 7.876233178997433d-1*t3*t38+2.2308199064d-1
            t40 = 7.876233178997433d-1*t3*t39+4.7231125998d-1
            t41 = 1/t40
            t42 = 1.269642451250142d+0*t2*t41+1.0d+0
            t43 = log(t42)
            t44 = 1.325688999052018d-1*t10+1.0d+0
            t45 = 9.999999999999991d-1*(6.21814d-2*t43*t44-3.10907d-2*t3
     1         6*t37)-6.21814d-2*t43*t44
            t46 = exp(-6.432793688582967d+1*t45)
            t47 = t46-1.0d+0
            t48 = 1/t47
            t49 = 2.162211495206379d-1*gammaaa*t13*t48
            t50 = t49+1.0d+0
            t51 = 1/t47**2.0d+0
            t52 = 4.6751585500026055d-2*t19*t20*t51+t49+1.0d+0
            t53 = 1/t52
            t54 = 2.162211495206379d-1*gammaaa*t13*t50*t53+1.0d+0
            t55 = 1.5545345434827443d-2*log(t54)+1.0d+0*t45
            t56 = t25*t30-2.390625d-2*t29*t55
            t57 = t28**3.0d+0
            t58 = 5.46875d-3*t56*t57+1.0d+0
            t59 = 1/rhoa**1.3333333333333333d+0
            t60 = 1/t8
            t61 = 1/rhoa**1.3333333333333336d+0
            t62 = 1/t2**3
            t63 = 1/rhoa**6.666666666666667d-1
            t64 = 2.375209110751279d-1*t3*t63*t7-1.4251254664507676d+0*t
     1         2*(7.016926042943223d-1*t3*(-1.1694876738238705d-1*t4*t62
     2         *t63-2.51534235937085d-3*t61)-1.1694876738238705d-1*t5*t6
     3         2*t63)/t6**2
            t65 = 1/t24
            t66 = rhoa**1.6666666666666674d-1
            t67 = 1/t12**3.0d+0
            t68 = -2.522580077740775d-1*gammaaa*t16*t66*t67
            t69 = 2.0000005873362642d+0*t11*t60*t64-7.014669098910309d-2
     1         *t59*t9
            t70 = -1.0811057476031892d-1*gammaaa*t13*t14*t69/t15**2
            t71 = 1/t22**2
            t72 = 1/t12**5.0d+0
            t73 = 1/t42
            t74 = 2.11607075208357d-1*t3*t41*t63-1.269642451250142d+0*t2
     1         *(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t38*t62
     2         *t63-3.169132786263567d-3*t61)-1.3127055298329054d-1*t39*
     3         t62*t63)/t40**2
            t75 = 9.999999999999991d-1*(6.21814d-2*t44*t73*t74-3.10907d-
     1         2*t37*(2.11607075208357d-1*t3*t34*t63-1.269642451250142d+
     2         0*t2*(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t31
     3         *t62*t63-2.0096226153166658d-3*t61)-1.3127055298329054d-1
     4         *t32*t62*t63)/t33**2)/t35-2.747773264188438d-3*t43*t59+1.
     5         3210398931339265d-3*t36*t59)-6.21814d-2*t44*t73*t74+2.747
     6         773264188438d-3*t43*t59
            t76 = 1/t54
            t77 = -5.045160155481552d-1*gammaaa*t48*t66*t67
            t78 = 1.3909060459745134d+1*gammaaa*t13*t46*t75/t47**2
            t79 = 1/t52**2
            t80 = 1/rhoa**2
            t81 = t30*(2.18090908507141d-3*t59*t9+3.109069086965489d-2*t
     1         65*(-1.0811057476031892d-1*gammaaa*t13*t18*t71*(-5.454351
     2         641669702d-2*t19*t21*t66*t72+t70-2.3375792750013008d-2*t1
     3         4*t19*t20*t69/t15**3.0d+0+t68)+1.0811057476031892d-1*gamm
     4         aaa*t13*t23*(t70+t68)-2.522580077740775d-1*gammaaa*t18*t2
     5         3*t66*t67)-6.21814d-2*t11*t60*t64)+4.78125d-2*gammaaa*t27
     6         *t28*t55*t80-1.6562500000000002d-2*gammaaa*t25*t27*t28*t8
     7         0-2.390625d-2*t29*(1.5545345434827443d-2*t76*(-2.16221149
     8         5206379d-1*gammaaa*t13*t50*(t78+t77+6.014866082716291d+0*
     9         t19*t20*t46*t75/t47**3.0d+0-2.1817406566678826d-1*t19*t51
     :         *t66*t72)*t79+2.162211495206379d-1*gammaaa*t13*t53*(t78+t
     ;         77)-5.045160155481552d-1*gammaaa*t50*t53*t66*t67)+1.0d+0*
     <         t75)
            t82 = -3.7163091430134354d-4*t29*t76*(-2.162211495206379d-1*
     1         gammaaa*t13*t50*(9.350317100005211d-2*gammaaa*t20*t51+2.1
     2         62211495206379d-1*t13*t48)*t79+2.162211495206379d-1*t13*t
     3         50*t53+4.675158550002605d-2*gammaaa*t20*t48*t53)+3.109069
     4         086965489d-2*t30*t65*(-1.0811057476031892d-1*gammaaa*t13*
     5         t18*(2.3375792750013008d-2*gammaaa*t20*t21+1.081105747603
     6         1892d-1*t13*t16)*t71+1.1687896375006507d-2*gammaaa*t16*t2
     7         0*t23+1.0811057476031892d-1*t13*t18*t23)-4.78125d-2*t26*t
     8         27*t28*t55+1.6562500000000002d-2*t25*t26*t27*t28
            t83 = 2.0d+0*rhoa*t56*(5.46875d-3*t57*t82+1.6406249999999997
     1         d-2*t26*t27*t29*t56)*wght+2.0d+0*rhoa*t58*t82*wght
            t84 = 1/taua**2
            t85 = 4.78125d-2*gammaaa*t26*t28*t55*t84-1.6562500000000002d
     1         -2*gammaaa*t25*t26*t28*t84
            fnc(iq) = 2.0d+0*rhoa*t56*t58*wght+fnc(iq)
            Amat(iq,D1_RA) = 2.0d+0*rhoa*t56*(5.46875d-3*t57*t81-1.64062
     1         49999999997d-2*gammaaa*t27*t29*t56*t80)*wght+2.0d+0*rhoa*
     2         t58*t81*wght+2.0d+0*t56*t58*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = t83+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t83+Cmat(iq,D1_GAB)
            Amat(iq,D1_TA) = 2.0d+0*rhoa*t56*(5.46875d-3*t57*t85-1.64062
     1         49999999997d-2*gammaaa*t26*t29*t56*t84)*wght+2.0d+0*rhoa*
     2         t58*t85*wght+Amat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob+rhoa
            t2 = rhoa**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.530901310039024d-2*t4+1.0465751434d-1
            t6 = 7.876233178997433d-1*t4*t5+1.9269083139d-1
            t7 = 7.876233178997433d-1*t4*t6+4.3896648423d-1
            t8 = 1/t7
            t9 = 1.269642451250142d+0*t3*t8+1.0d+0
            t10 = log(t9)
            t11 = 1/t2
            t12 = 1.2746961887000874d-1*t11+1.0d+0
            t13 = 2.4141993114533214d-2*t4+1.0186556948d-1
            t14 = 7.876233178997433d-1*t13*t4+2.2308199064d-1
            t15 = 7.876233178997433d-1*t14*t4+4.7231125998d-1
            t16 = 1/t15
            t17 = 1.269642451250142d+0*t16*t3+1.0d+0
            t18 = log(t17)
            t19 = 1.325688999052018d-1*t11+1.0d+0
            t20 = 9.999999999999991d-1*(6.21814d-2*t18*t19-3.10907d-2*t1
     1         0*t12)-6.21814d-2*t18*t19
            t21 = rhoa**1.1666666666666667d+0
            t22 = 1/t21**2.0d+0
            t23 = exp(-6.432793688582967d+1*t20)
            t24 = t23-1.0d+0
            t25 = 1/t24
            t26 = 2.162211495206379d-1*gammaaa*t22*t25
            t27 = t26+1.0d+0
            t28 = gammaaa**2.0d+0
            t29 = 1/t21**4.0d+0
            t30 = 1/t24**2.0d+0
            t31 = 4.6751585500026055d-2*t28*t29*t30+t26+1.0d+0
            t32 = 1/t31
            t33 = 2.162211495206379d-1*gammaaa*t22*t27*t32+1.0d+0
            t34 = 1.5545345434827443d-2*log(t33)+1.0d+0*t20
            t35 = 1/t1
            t36 = rhoa-rhob
            t37 = t35*t36
            t38 = 2.2599999999999998d+0*t37**6.0d+0+5.0d-1*t37**4.0d+0+8
     1         .7d-1*t37**2.0d+0+5.3d-1
            t39 = 1/t1**2.6666666666666666d+0
            t40 = 1.0d+0-t35*t36
            t41 = t37+1.0d+0
            t42 = 1/t41**1.333333333333333d+0+1/t40**1.333333333333333d+
     1         0
            t43 = t40**2
            t44 = t41**2
            t45 = gammabb*t44+gammaaa*t43-2.0d+0*gammaab*t40*t41
            t46 = 1.3060586492616802d-2*t39*t42*t45+1.0d+0
            t47 = 1/t46**4.0d+0
            t48 = t38*t47+1.0d+0
            t49 = gammabb+2.0d+0*gammaab+gammaaa
            t50 = taub+taua
            t51 = 1/t50
            t52 = t35*t49*t51
            t53 = t52**2.0d+0
            t54 = rhob**3.333333333333333d-1
            t55 = t54**5.0d-1
            t56 = 1/t55
            t57 = 1.530901310039024d-2*t56+1.0465751434d-1
            t58 = 7.876233178997433d-1*t56*t57+1.9269083139d-1
            t59 = 7.876233178997433d-1*t56*t58+4.3896648423d-1
            t60 = 1/t59
            t61 = 1.269642451250142d+0*t55*t60+1.0d+0
            t62 = log(t61)
            t63 = 1/t54
            t64 = 1.2746961887000874d-1*t63+1.0d+0
            t65 = 2.4141993114533214d-2*t56+1.0186556948d-1
            t66 = 7.876233178997433d-1*t56*t65+2.2308199064d-1
            t67 = 7.876233178997433d-1*t56*t66+4.7231125998d-1
            t68 = 1/t67
            t69 = 1.269642451250142d+0*t55*t68+1.0d+0
            t70 = log(t69)
            t71 = 1.325688999052018d-1*t63+1.0d+0
            t72 = 9.999999999999991d-1*(6.21814d-2*t70*t71-3.10907d-2*t6
     1         2*t64)-6.21814d-2*t70*t71
            t73 = rhob**1.1666666666666667d+0
            t74 = 1/t73**2.0d+0
            t75 = exp(-6.432793688582967d+1*t72)
            t76 = t75-1.0d+0
            t77 = 1/t76
            t78 = 2.162211495206379d-1*gammabb*t74*t77
            t79 = t78+1.0d+0
            t80 = gammabb**2.0d+0
            t81 = 1/t73**4.0d+0
            t82 = 1/t76**2.0d+0
            t83 = 4.6751585500026055d-2*t80*t81*t82+t78+1.0d+0
            t84 = 1/t83
            t85 = 2.162211495206379d-1*gammabb*t74*t79*t84+1.0d+0
            t86 = 1.5545345434827443d-2*log(t85)+1.0d+0*t72
            t87 = t1**3.333333333333333d-1
            t88 = 1/t87
            t89 = 1.325688999052018d-1*t88+1.0d+0
            t90 = t87**5.0d-1
            t91 = 1/t90
            t92 = 2.4141993114533214d-2*t91+1.0186556948d-1
            t93 = 7.876233178997433d-1*t91*t92+2.2308199064d-1
            t94 = 7.876233178997433d-1*t91*t93+4.7231125998d-1
            t95 = 1/t94
            t96 = 1.269642451250142d+0*t90*t95+1.0d+0
            t97 = log(t96)
            t98 = 1.923661050931536d+0*t41**1.3333333333333333d+0+1.9236
     1         61050931536d+0*t40**1.3333333333333333d+0-3.8473221018630
     2         72d+0
            t99 = 6.901399211255826d-2*t88+1.0d+0
            t100 = 1.3212998810398843d-2*t91+2.9729725188d-2
            t101 = 7.876233178997433d-1*t100*t91+1.2236585478d-1
            t102 = 7.876233178997433d-1*t101*t91+3.497952466d-1
            t103 = 1/t102
            t104 = 1.269642451250142d+0*t103*t90+1.0d+0
            t105 = log(t104)
            t106 = t36**4
            t107 = 1/t1**4
            t108 = 1.2746961887000874d-1*t88+1.0d+0
            t109 = 1.530901310039024d-2*t91+1.0465751434d-1
            t110 = 7.876233178997433d-1*t109*t91+1.9269083139d-1
            t111 = 7.876233178997433d-1*t110*t91+4.3896648423d-1
            t112 = 1/t111
            t113 = 1.269642451250142d+0*t112*t90+1.0d+0
            t114 = log(t113)
            t115 = 1.709920934161365d+0*(6.21814d-2*t89*t97-3.10907d-2*t
     1         108*t114)-3.37738d-2*t105*t99
            t116 = 3.37738d-2*t105*t99+t106*t107*t115
            t117 = 5.848223622634648d-1*t116*t98-6.21814d-2*t89*t97
            t118 = 5.0d-1*t41**6.666666666666666d-1+5.0d-1*t40**6.666666
     1         666666666d-1
            t119 = t118**3.0d+0
            t120 = t1**1.1666666666666667d+0
            t121 = 1/t120**2.0d+0
            t122 = t118**2.0d+0
            t123 = 1/t122
            t124 = 1/t119
            t125 = exp(-3.216396844291483d+1*t117*t124)
            t126 = t125-1.0d+0
            t127 = 1/t126
            t128 = 1.3621078885675922d-1*t121*t123*t127*t49
            t129 = t128+1.0d+0
            t130 = t49**2.0d+0
            t131 = 1/t120**4.0d+0
            t132 = 1/t118**4.0d+0
            t133 = 1/t126**2.0d+0
            t134 = 1.855337900098064d-2*t130*t131*t132*t133+t128+1.0d+0
            t135 = 1/t134
            t136 = 1.3621078885675922d-1*t121*t123*t129*t135*t49+1.0d+0
            t137 = log(t136)
            t138 = 3.109069086965489d-2*t119*t137+1.0d+0*t117
            t139 = 1.5625d-2*t38*t47*t53+1.0d+0
            t140 = -1.5625d-2*rhob*t35*t48*t53*t86-1.5625d-2*rhoa*t34*t3
     1         5*t48*t53+t138*t139
            t141 = t52**3.0d+0
            t142 = 5.46875d-3*t140*t141+1.0d+0
            t143 = 1/t1**3
            t144 = 3.125d-2*rhoa*t143*t34*t48*t49*t51*t52
            t145 = 3.125d-2*rhob*t143*t48*t49*t51*t52*t86
            t146 = 1/t1**2
            t147 = t146*t36
            t148 = -t35
            t149 = t148+t147
            t150 = -t146*t36
            t151 = t35+t150
            t152 = 1/t40**2.333333333333333d+0
            t153 = 1/t41**2.333333333333333d+0
            t154 = 1/t1**3.6666666666666664d+0
            t155 = -3.482823064697814d-2*t154*t42*t45
            t156 = 1.3060586492616802d-2*(-1.333333333333333d+0*t151*t15
     1         3-1.333333333333333d+0*t149*t152)*t39*t45+1.3060586492616
     2         802d-2*t39*(2*gammabb*t151*t41-2.0d+0*gammaab*t149*t41-2.
     3         0d+0*gammaab*t151*t40+2*gammaaa*t149*t40)*t42+t155
            t157 = 1/t46**5.0d+0
            t158 = t37**3.0d+0
            t159 = t37**5.0d+0
            t160 = 1.74d+0*t151*t37+1.356d+1*t151*t159+2.0d+0*t151*t158
            t161 = t160*t47-4.0d+0*t156*t157*t38
            t162 = 1.5625d-2*rhoa*t146*t34*t48*t53
            t163 = 1/rhoa**1.3333333333333333d+0
            t164 = 1/rhoa**1.3333333333333336d+0
            t165 = 1/t3**3
            t166 = 1/rhoa**6.666666666666667d-1
            t167 = 1/t17
            t168 = 2.11607075208357d-1*t16*t166*t4-1.269642451250142d+0*
     1         t3*(7.876233178997433d-1*(-1.3127055298329054d-1*t13*t165
     2         *t166-3.169132786263567d-3*t164)*t4-1.3127055298329054d-1
     3         *t14*t165*t166)/t15**2
            t169 = 9.999999999999991d-1*(-3.10907d-2*t12*(2.116070752083
     1         57d-1*t166*t4*t8-1.269642451250142d+0*t3*(7.8762331789974
     2         33d-1*t4*(-1.3127055298329054d-1*t165*t166*t5-2.009622615
     3         3166658d-3*t164)-1.3127055298329054d-1*t165*t166*t6)/t7**
     4         2)/t9+6.21814d-2*t167*t168*t19-2.747773264188438d-3*t163*
     5         t18+1.3210398931339265d-3*t10*t163)-6.21814d-2*t167*t168*
     6         t19+2.747773264188438d-3*t163*t18
            t170 = 1/t33
            t171 = rhoa**1.6666666666666674d-1
            t172 = 1/t21**3.0d+0
            t173 = -5.045160155481552d-1*gammaaa*t171*t172*t25
            t174 = 1.3909060459745134d+1*gammaaa*t169*t22*t23/t24**2
            t175 = 1/t31**2
            t176 = 1.5625d-2*rhob*t146*t48*t53*t86
            t177 = -3.125d-2*t146*t38*t47*t49*t51*t52
            t178 = 1/t1**1.3333333333333336d+0
            t179 = 1/t1**6.666666666666667d-1
            t180 = 1/t90**3
            t181 = 2.11607075208357d-1*t179*t91*t95-1.269642451250142d+0
     1         *t90*(7.876233178997433d-1*t91*(-1.3127055298329054d-1*t1
     2         79*t180*t92-3.169132786263567d-3*t178)-1.3127055298329054
     3         d-1*t179*t180*t93)/t94**2
            t182 = 1/t96
            t183 = -6.21814d-2*t181*t182*t89
            t184 = 1/t1**1.3333333333333333d+0
            t185 = 2.747773264188438d-3*t184*t97
            t186 = 2.11607075208357d-1*t103*t179*t91-1.269642451250142d+
     1         0*t90*(7.876233178997433d-1*(-1.3127055298329054d-1*t100*
     2         t179*t180-1.7344776604086162d-3*t178)*t91-1.3127055298329
     3         054d-1*t101*t179*t180)/t102**2
            t187 = 1/t104
            t188 = 3.37738d-2*t186*t187*t99
            t189 = -7.769549222703733d-4*t105*t184
            t190 = t106*t107*(-3.37738d-2*t186*t187*t99+1.70992093416136
     1         5d+0*(-2.747773264188438d-3*t184*t97-3.10907d-2*t108*(2.1
     2         1607075208357d-1*t112*t179*t91-1.269642451250142d+0*t90*(
     3         7.876233178997433d-1*(-1.3127055298329054d-1*t109*t179*t1
     4         80-2.0096226153166658d-3*t178)*t91-1.3127055298329054d-1*
     5         t110*t179*t180)/t111**2)/t113+6.21814d-2*t181*t182*t89+1.
     6         3210398931339265d-3*t114*t184)+7.769549222703733d-4*t105*
     7         t184)
            t191 = -4*t106*t115/t1**5
            t192 = t36**3
            t193 = t40**3.333333333333333d-1
            t194 = t41**3.333333333333333d-1
            t195 = 5.848223622634648d-1*(4*t107*t115*t192+t191+t190+t189
     1         +t188)*t98+5.848223622634648d-1*t116*(2.564881401242048d+
     2         0*t151*t194+2.564881401242048d+0*t149*t193)+t185+t183
            t196 = 1/t136
            t197 = 1/t193
            t198 = 1/t194
            t199 = 3.333333333333333d-1*t151*t198+3.333333333333333d-1*t
     1         149*t197
            t200 = t1**1.6666666666666674d-1
            t201 = 1/t120**3.0d+0
            t202 = -3.1782517399910487d-1*t123*t129*t135*t200*t201*t49
            t203 = -2.7242157771351844d-1*t121*t124*t127*t199*t49
            t204 = -3.1782517399910487d-1*t123*t127*t200*t201*t49
            t205 = 1/t126**2
            t206 = 9.649190532874448d+1*t117*t132*t199-3.216396844291483
     1         d+1*t124*t195
            t207 = -1.3621078885675922d-1*t121*t123*t125*t205*t206*t49
            t208 = 1/t134**2
            t209 = 1/t118**5.0d+0
            t210 = -8.658243533790966d-2*t130*t132*t133*t200/t120**5.0d+
     1         0
            t211 = 1/t126**3.0d+0
            t212 = -1.5625d-2*rhob*t161*t35*t53*t86+t138*(1.5625d-2*t160
     1         *t47*t53-6.25d-2*t156*t157*t38*t53+t177)-1.5625d-2*t34*t3
     2         5*t48*t53-1.5625d-2*rhoa*(1.5545345434827443d-2*t170*(-5.
     3         045160155481552d-1*gammaaa*t171*t172*t27*t32+2.1622114952
     4         06379d-1*gammaaa*(t174+t173)*t22*t32-2.162211495206379d-1
     5         *gammaaa*t175*t22*t27*(-2.1817406566678826d-1*t171*t28*t3
     6         0/t21**5.0d+0+6.014866082716291d+0*t169*t23*t28*t29/t24**
     7         3.0d+0+t174+t173))+1.0d+0*t169)*t35*t48*t53-1.5625d-2*rho
     8         a*t161*t34*t35*t53+t139*(3.109069086965489d-2*t119*t196*(
     9         -1.3621078885675922d-1*t121*t123*t129*t208*(-3.7106758001
     :         96128d-2*t125*t130*t131*t132*t206*t211+t210-7.42135160039
     ;         2256d-2*t130*t131*t133*t199*t209+t207+t204+t203)*t49+1.36
     <         21078885675922d-1*t121*t123*t135*(t207+t204+t203)*t49-2.7
     =         242157771351844d-1*t121*t124*t129*t135*t199*t49+t202)+9.3
     >         27207260896466d-2*t122*t137*t199+1.0d+0*t195)+t176+t162+t
     ?         145+t144
            t213 = -1.6406249999999997d-2*t140*t146*t49*t51*t53
            t214 = 1.0d+0*t140*t142*wght
            t215 = t150+t148
            t216 = t35+t147
            t217 = 1.3060586492616802d-2*(-1.333333333333333d+0*t152*t21
     1         6-1.333333333333333d+0*t153*t215)*t39*t45+1.3060586492616
     2         802d-2*t39*(-2.0d+0*gammaab*t216*t41+2*gammabb*t215*t41+2
     3         *gammaaa*t216*t40-2.0d+0*gammaab*t215*t40)*t42+t155
            t218 = 1.74d+0*t215*t37+1.356d+1*t159*t215+2.0d+0*t158*t215
            t219 = t218*t47-4.0d+0*t157*t217*t38
            t220 = 1/rhob**1.3333333333333333d+0
            t221 = 1/rhob**1.3333333333333336d+0
            t222 = 1/t55**3
            t223 = 1/rhob**6.666666666666667d-1
            t224 = 1/t69
            t225 = 2.11607075208357d-1*t223*t56*t68-1.269642451250142d+0
     1         *t55*(7.876233178997433d-1*t56*(-1.3127055298329054d-1*t2
     2         22*t223*t65-3.169132786263567d-3*t221)-1.3127055298329054
     3         d-1*t222*t223*t66)/t67**2
            t226 = 9.999999999999991d-1*(6.21814d-2*t224*t225*t71-2.7477
     1         73264188438d-3*t220*t70-3.10907d-2*(2.11607075208357d-1*t
     2         223*t56*t60-1.269642451250142d+0*t55*(7.876233178997433d-
     3         1*t56*(-1.3127055298329054d-1*t222*t223*t57-2.00962261531
     4         66658d-3*t221)-1.3127055298329054d-1*t222*t223*t58)/t59**
     5         2)*t64/t61+1.3210398931339265d-3*t220*t62)-6.21814d-2*t22
     6         4*t225*t71+2.747773264188438d-3*t220*t70
            t227 = 1/t85
            t228 = rhob**1.6666666666666674d-1
            t229 = 1/t73**3.0d+0
            t230 = -5.045160155481552d-1*gammabb*t228*t229*t77
            t231 = 1.3909060459745134d+1*gammabb*t226*t74*t75/t76**2
            t232 = 1/t83**2
            t233 = 5.848223622634648d-1*(-4*t107*t115*t192+t191+t190+t18
     1         9+t188)*t98+5.848223622634648d-1*t116*(2.564881401242048d
     2         +0*t193*t216+2.564881401242048d+0*t194*t215)+t185+t183
            t234 = 3.333333333333333d-1*t197*t216+3.333333333333333d-1*t
     1         198*t215
            t235 = -2.7242157771351844d-1*t121*t124*t127*t234*t49
            t236 = 9.649190532874448d+1*t117*t132*t234-3.216396844291483
     1         d+1*t124*t233
            t237 = -1.3621078885675922d-1*t121*t123*t125*t205*t236*t49
            t238 = -1.5625d-2*t35*t48*t53*t86-1.5625d-2*rhob*t219*t35*t5
     1         3*t86-1.5625d-2*rhob*t35*t48*t53*(1.5545345434827443d-2*t
     2         227*(-5.045160155481552d-1*gammabb*t228*t229*t79*t84+2.16
     3         2211495206379d-1*gammabb*(t231+t230)*t74*t84-2.1622114952
     4         06379d-1*gammabb*t232*t74*t79*(-2.1817406566678826d-1*t22
     5         8*t80*t82/t73**5.0d+0+6.014866082716291d+0*t226*t75*t80*t
     6         81/t76**3.0d+0+t231+t230))+1.0d+0*t226)+t138*(1.5625d-2*t
     7         218*t47*t53-6.25d-2*t157*t217*t38*t53+t177)-1.5625d-2*rho
     8         a*t219*t34*t35*t53+t139*(3.109069086965489d-2*t119*t196*(
     9         -1.3621078885675922d-1*t121*t123*t129*t208*(t237-3.710675
     :         800196128d-2*t125*t130*t131*t132*t211*t236+t235-7.4213516
     ;         00392256d-2*t130*t131*t133*t209*t234+t210+t204)*t49+1.362
     <         1078885675922d-1*t121*t123*t135*(t237+t235+t204)*t49-2.72
     =         42157771351844d-1*t121*t124*t129*t135*t234*t49+t202)+9.32
     >         7207260896466d-2*t122*t137*t234+1.0d+0*t233)+t176+t162+t1
     ?         45+t144
            t239 = -3.125d-2*rhoa*t146*t34*t48*t51*t52
            t240 = -3.125d-2*rhob*t146*t48*t51*t52*t86
            t241 = 3.125d-2*t35*t38*t47*t51*t52
            t242 = 3.109069086965489d-2*t119*t139*t196*(-1.3621078885675
     1         922d-1*t121*t123*t129*t208*t49*(3.710675800196128d-2*t131
     2         *t132*t133*t49+1.3621078885675922d-1*t121*t123*t127)+1.85
     3         5337900098064d-2*t127*t131*t132*t135*t49+1.36210788856759
     4         22d-1*t121*t123*t129*t135)
            t243 = 8.162866557885502d-4*rhob*t154*t157*t38*t42*t43*t53*t
     1         86+t138*(t241-8.162866557885502d-4*t157*t38*t39*t42*t43*t
     2         53)-2.4289602241917876d-4*rhoa*t170*(4.675158550002605d-2
     3         *gammaaa*t25*t29*t32+2.162211495206379d-1*t22*t27*t32-2.1
     4         62211495206379d-1*gammaaa*t175*t22*t27*(9.350317100005211
     5         d-2*gammaaa*t29*t30+2.162211495206379d-1*t22*t25))*t35*t4
     6         8*t53+8.162866557885502d-4*rhoa*t154*t157*t34*t38*t42*t43
     7         *t53+t242+t240+t239
            t244 = 1.6406249999999997d-2*t140*t35*t51*t53
            t245 = -1.6325733115771002d-3*rhob*t154*t157*t38*t40*t41*t42
     1         *t53*t86-6.25d-2*rhob*t146*t48*t51*t52*t86+t138*(1.632573
     2         3115771002d-3*t157*t38*t39*t40*t41*t42*t53+6.25d-2*t35*t3
     3         8*t47*t51*t52)-1.6325733115771002d-3*rhoa*t154*t157*t34*t
     4         38*t40*t41*t42*t53-6.25d-2*rhoa*t146*t34*t48*t51*t52+3.10
     5         9069086965489d-2*t119*t139*t196*(-1.3621078885675922d-1*t
     6         121*t123*t129*t208*t49*(7.421351600392256d-2*t131*t132*t1
     7         33*t49+2.7242157771351844d-1*t121*t123*t127)+3.7106758001
     8         96128d-2*t127*t131*t132*t135*t49+2.7242157771351844d-1*t1
     9         21*t123*t129*t135)
            t246 = 8.162866557885502d-4*rhob*t154*t157*t38*t42*t44*t53*t
     1         86-2.4289602241917876d-4*rhob*t227*t35*t48*t53*(4.6751585
     2         50002605d-2*gammabb*t77*t81*t84+2.162211495206379d-1*t74*
     3         t79*t84-2.162211495206379d-1*gammabb*t232*t74*t79*(9.3503
     4         17100005211d-2*gammabb*t81*t82+2.162211495206379d-1*t74*t
     5         77))+t138*(t241-8.162866557885502d-4*t157*t38*t39*t42*t44
     6         *t53)+8.162866557885502d-4*rhoa*t154*t157*t34*t38*t42*t44
     7         *t53+t242+t240+t239
            t247 = 1/t50**2
            t248 = 3.125d-2*rhob*t146*t247*t48*t49*t52*t86+3.125d-2*rhoa
     1         *t146*t247*t34*t48*t49*t52-3.125d-2*t138*t247*t35*t38*t47
     2         *t49*t52
            t249 = 1.0d+0*t1*t140*(5.46875d-3*t141*t248-1.64062499999999
     1         97d-2*t140*t247*t35*t49*t53)*wght+1.0d+0*t1*t142*t248*wgh
     2         t
            fnc(iq) = 1.0d+0*t1*t140*t142*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*t140*(t213+5.46875d-3*t141*t212)*
     1         wght+1.0d+0*t1*t142*t212*wght+t214+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = 1.0d+0*t1*t140*(5.46875d-3*t141*t238+t213)*
     1         wght+1.0d+0*t1*t142*t238*wght+t214+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = 1.0d+0*t1*t140*(t244+5.46875d-3*t141*t243)
     1         *wght+1.0d+0*t1*t142*t243*wght+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = 1.0d+0*t1*t140*(3.2812499999999994d-2*t140
     1         *t35*t51*t53+5.46875d-3*t141*t245)*wght+1.0d+0*t1*t142*t2
     2         45*wght+Cmat(iq,D1_GAB)
            Cmat(iq,D1_GBB) = 1.0d+0*t1*t140*(5.46875d-3*t141*t246+t244)
     1         *wght+1.0d+0*t1*t142*t246*wght+Cmat(iq,D1_GBB)
            Mmat(iq,D1_TA) = t249+Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = t249+Mmat(iq,D1_TB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            fnc(iq) = fnc(iq)
            Amat(iq,D1_RA) = Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = Cmat(iq,D1_GAA)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            fnc(iq) = fnc(iq)
            Amat(iq,D1_RB) = Amat(iq,D1_RB)
            Cmat(iq,D1_GBB) = Cmat(iq,D1_GBB)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_tpss03 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_3} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_4} &=& \sqrt{{\it t_3}}\\\\ 
C>   {\it t_5} &=& {{1}\over{{\it t_4}}}\\\\ 
C>   {\it t_6} &=& {{1}\over{{\it t_3}}}\\\\ 
C>   {\it t_7} &=& \log \left({{1.269642451250142\,{\it t_4}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_5}+0.10186556948\right)\,{\it t_5}+0.22308199064\right)\,{\it t_5}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_8} &=& 0.1325688999052018\,{\it t_6}+1.0\\\\ 
C>   {\it t_9} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_7}\,{\it t_8}-0.0310907\,\log \left({{1.269642451250142\,{\it t_4}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_5}+0.10465751434\right)\,{\it t_5}+0.19269083139\right)\,{\it t_5}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_6}+1.0\right)\right)-0.0621814\,{\it t_7}\,{\it t_8}\\\\ 
C>   {\it t_{10}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_{10}}^{2.0}}}\\\\ 
C>   {\it t_{12}} &=& {{1}\over{e^{64.32793688582967\,{\it t_9}}}}-1.0\\\\ 
C>   {\it t_{13}} &=& {{0.2162211495206379\,{\it t_{11}}\,\sigma_{\alpha\alpha}}\over{{\it t_{12}}}}\\\\ 
C>   {\it t_{14}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{15}} &=& {\it t_{14}}\,{\it t_2}\\\\ 
C>   {\it t_{16}} &=& 2.26\,{\it t_{15}}^{6.0}+0.5\,{\it t_{15}}^{4.0}+0.87\,{\it t_{15}}^{2.0}+0.53\\\\ 
C>   {\it t_{17}} &=& 1.0-{\it t_{14}}\,{\it t_2}\\\\ 
C>   {\it t_{18}} &=& {\it t_{15}}+1.0\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\left({{0.0130605864926168\,\left({{1}\over{{\it t_{18}}^{1.333333333333333}}}+{{1}\over{{\it t_{17}}^{1.333333333333333}}}\right)\,\left({\it t_{18}}^2\,\sigma_{\beta\beta}-2.0\,{\it t_{17}}\,{\it t_{18}}\,\sigma_{\alpha\beta}+{\it t_{17}}^2\,\sigma_{\alpha\alpha}\right)}\over{{\it t_1}^{{{8}\over{3}}}}}+1.0\right)^{4.0}}}\\\\ 
C>   {\it t_{20}} &=& {\it t_{16}}\,{\it t_{19}}+1.0\\\\ 
C>   {\it t_{21}} &=& \sigma_{\beta\beta}+2.0\,\sigma_{\alpha\beta}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{22}} &=& {{{\it t_2}\,{\it t_{21}}}\over{\tau_\beta+\tau_\alpha}}\\\\ 
C>   {\it t_{23}} &=& {\it t_{22}}^{2.0}\\\\ 
C>   {\it t_{24}} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_{25}} &=& \sqrt{{\it t_{24}}}\\\\ 
C>   {\it t_{26}} &=& {{1}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{27}} &=& {{1}\over{{\it t_{24}}}}\\\\ 
C>   {\it t_{28}} &=& \log \left({{1.269642451250142\,{\it t_{25}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{26}}+0.10186556948\right)\,{\it t_{26}}+0.22308199064\right)\,{\it t_{26}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{29}} &=& 0.1325688999052018\,{\it t_{27}}+1.0\\\\ 
C>   {\it t_{30}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{28}}\,{\it t_{29}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{25}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{26}}+0.10465751434\right)\,{\it t_{26}}+0.19269083139\right)\,{\it t_{26}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{27}}+1.0\right)\right)-0.0621814\,{\it t_{28}}\,{\it t_{29}}\\\\ 
C>   {\it t_{31}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}^{2.0}}}\\\\ 
C>   {\it t_{33}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{30}}}}}-1.0\\\\ 
C>   {\it t_{34}} &=& {{0.2162211495206379\,{\it t_{32}}\,\sigma_{\beta\beta}}\over{{\it t_{33}}}}\\\\ 
C>   {\it t_{35}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{{\it t_{35}}}}\\\\ 
C>   {\it t_{37}} &=& 0.1325688999052018\,{\it t_{36}}+1.0\\\\ 
C>   {\it t_{38}} &=& \sqrt{{\it t_{35}}}\\\\ 
C>   {\it t_{39}} &=& {{1}\over{{\it t_{38}}}}\\\\ 
C>   {\it t_{40}} &=& \log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.02414199311453321\,{\it t_{39}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{41}} &=& 0.06901399211255826\,{\it t_{36}}+1.0\\\\ 
C>   {\it t_{42}} &=& \log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.01321299881039884\,{\it t_{39}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{43}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{18}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{17}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{14}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{37}}\,{\it t_{40}}-0.0310907\,\left(0.1274696188700087\,{\it t_{36}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.01530901310039024\,{\it t_{39}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{41}}\,{\it t_{42}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{41}}\,{\it t_{42}}\right)-0.0621814\,{\it t_{37}}\,{\it t_{40}}\\\\ 
C>   {\it t_{44}} &=& 0.5\,{\it t_{18}}^{{{2}\over{3}}}+0.5\,{\it t_{17}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{45}} &=& {\it t_{44}}^{3.0}\\\\ 
C>   {\it t_{46}} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{47}} &=& {{1}\over{{\it t_{46}}^{2.0}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{{\it t_{44}}^{2.0}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{e^{{{32.16396844291483\,{\it t_{43}}}\over{{\it t_{45}}}}}}}-1.0\\\\ 
C>   {\it t_{50}} &=& {{0.1362107888567592\,{\it t_{47}}\,{\it t_{48}}\,{\it t_{21}}}\over{{\it t_{49}}}}\\\\ 
C>   {\it t_{51}} &=& \left(0.03109069086965489\,{\it t_{45}}\,\log \left({{0.1362107888567592\,{\it t_{47}}\,{\it t_{48}}\,{\it t_{21}}\,\left({\it t_{50}}+1.0\right)}\over{{{0.01855337900098064\,{\it t_{21}}^{2.0}}\over{{\it t_{46}}^{4.0}\,{\it t_{44}}^{4.0}\,{\it t_{49}}^{2.0}}}+{\it t_{50}}+1.0}}+1.0\right)+1.0\,{\it t_{43}}\right)\,\left(0.015625\,{\it t_{16}}\,{\it t_{19}}\,{\it t_{23}}+1.0\right)-0.015625\,\rho_\beta\,{\it t_2}\,{\it t_{20}}\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{32}}\,\sigma_{\beta\beta}\,\left({\it t_{34}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{31}}^{4.0}\,{\it t_{33}}^{2.0}}}+{\it t_{34}}+1.0}}+1.0\right)+1.0\,{\it t_{30}}\right)\,{\it t_{23}}-0.015625\,\rho_\alpha\,{\it t_2}\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{11}}\,\sigma_{\alpha\alpha}\,\left({\it t_{13}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{10}}^{4.0}\,{\it t_{12}}^{2.0}}}+{\it t_{13}}+1.0}}+1.0\right)+1.0\,{\it t_9}\right)\,{\it t_{20}}\,{\it t_{23}}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,{\it t_{51}}\,\left(0.00546875\,{\it t_{22}}^{3.0}\,{\it t_{51}}+1.0\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.0\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] J Tao, JP Perdew, VN Staveroverov, GE Scuseria, Phys.Rev.Lett. 91, 146401 (2003)  , DOI: 
C> <a href="http://dx.doi.org/10.1103/PhysRevLett.91.146401 "> 
C> 10.1103/PhysRevLett.91.146401 </a> 
C> 
      subroutine nwxcm_c_tpss03_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Cmat,Cmat2,Mmat,Mmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      double precision nwxcm_heaviside 
      external         nwxcm_heaviside 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_tpss03 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_3} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_4} &=& \sqrt{{\it t_3}}\\\\ 
C>   {\it t_5} &=& {{1}\over{{\it t_4}}}\\\\ 
C>   {\it t_6} &=& {{1}\over{{\it t_3}}}\\\\ 
C>   {\it t_7} &=& \log \left({{1.269642451250142\,{\it t_4}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_5}+0.10186556948\right)\,{\it t_5}+0.22308199064\right)\,{\it t_5}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_8} &=& 0.1325688999052018\,{\it t_6}+1.0\\\\ 
C>   {\it t_9} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_7}\,{\it t_8}-0.0310907\,\log \left({{1.269642451250142\,{\it t_4}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_5}+0.10465751434\right)\,{\it t_5}+0.19269083139\right)\,{\it t_5}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_6}+1.0\right)\right)-0.0621814\,{\it t_7}\,{\it t_8}\\\\ 
C>   {\it t_{10}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_{10}}^{2.0}}}\\\\ 
C>   {\it t_{12}} &=& {{1}\over{e^{64.32793688582967\,{\it t_9}}}}-1.0\\\\ 
C>   {\it t_{13}} &=& {{0.2162211495206379\,{\it t_{11}}\,\sigma_{\alpha\alpha}}\over{{\it t_{12}}}}\\\\ 
C>   {\it t_{14}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{15}} &=& {\it t_{14}}\,{\it t_2}\\\\ 
C>   {\it t_{16}} &=& 2.26\,{\it t_{15}}^{6.0}+0.5\,{\it t_{15}}^{4.0}+0.87\,{\it t_{15}}^{2.0}+0.53\\\\ 
C>   {\it t_{17}} &=& 1.0-{\it t_{14}}\,{\it t_2}\\\\ 
C>   {\it t_{18}} &=& {\it t_{15}}+1.0\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\left({{0.0130605864926168\,\left({{1}\over{{\it t_{18}}^{1.333333333333333}}}+{{1}\over{{\it t_{17}}^{1.333333333333333}}}\right)\,\left({\it t_{18}}^2\,\sigma_{\beta\beta}-2.0\,{\it t_{17}}\,{\it t_{18}}\,\sigma_{\alpha\beta}+{\it t_{17}}^2\,\sigma_{\alpha\alpha}\right)}\over{{\it t_1}^{{{8}\over{3}}}}}+1.0\right)^{4.0}}}\\\\ 
C>   {\it t_{20}} &=& {\it t_{16}}\,{\it t_{19}}+1.0\\\\ 
C>   {\it t_{21}} &=& \sigma_{\beta\beta}+2.0\,\sigma_{\alpha\beta}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{22}} &=& {{{\it t_2}\,{\it t_{21}}}\over{\tau_\beta+\tau_\alpha}}\\\\ 
C>   {\it t_{23}} &=& {\it t_{22}}^{2.0}\\\\ 
C>   {\it t_{24}} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_{25}} &=& \sqrt{{\it t_{24}}}\\\\ 
C>   {\it t_{26}} &=& {{1}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{27}} &=& {{1}\over{{\it t_{24}}}}\\\\ 
C>   {\it t_{28}} &=& \log \left({{1.269642451250142\,{\it t_{25}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{26}}+0.10186556948\right)\,{\it t_{26}}+0.22308199064\right)\,{\it t_{26}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{29}} &=& 0.1325688999052018\,{\it t_{27}}+1.0\\\\ 
C>   {\it t_{30}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{28}}\,{\it t_{29}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{25}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{26}}+0.10465751434\right)\,{\it t_{26}}+0.19269083139\right)\,{\it t_{26}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{27}}+1.0\right)\right)-0.0621814\,{\it t_{28}}\,{\it t_{29}}\\\\ 
C>   {\it t_{31}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}^{2.0}}}\\\\ 
C>   {\it t_{33}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{30}}}}}-1.0\\\\ 
C>   {\it t_{34}} &=& {{0.2162211495206379\,{\it t_{32}}\,\sigma_{\beta\beta}}\over{{\it t_{33}}}}\\\\ 
C>   {\it t_{35}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{{\it t_{35}}}}\\\\ 
C>   {\it t_{37}} &=& 0.1325688999052018\,{\it t_{36}}+1.0\\\\ 
C>   {\it t_{38}} &=& \sqrt{{\it t_{35}}}\\\\ 
C>   {\it t_{39}} &=& {{1}\over{{\it t_{38}}}}\\\\ 
C>   {\it t_{40}} &=& \log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.02414199311453321\,{\it t_{39}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{41}} &=& 0.06901399211255826\,{\it t_{36}}+1.0\\\\ 
C>   {\it t_{42}} &=& \log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.01321299881039884\,{\it t_{39}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{43}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{18}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{17}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{14}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{37}}\,{\it t_{40}}-0.0310907\,\left(0.1274696188700087\,{\it t_{36}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{38}}}\over{0.7876233178997433\,{\it t_{39}}\,\left(0.7876233178997433\,{\it t_{39}}\,\left(0.01530901310039024\,{\it t_{39}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{41}}\,{\it t_{42}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{41}}\,{\it t_{42}}\right)-0.0621814\,{\it t_{37}}\,{\it t_{40}}\\\\ 
C>   {\it t_{44}} &=& 0.5\,{\it t_{18}}^{{{2}\over{3}}}+0.5\,{\it t_{17}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{45}} &=& {\it t_{44}}^{3.0}\\\\ 
C>   {\it t_{46}} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{47}} &=& {{1}\over{{\it t_{46}}^{2.0}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{{\it t_{44}}^{2.0}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{e^{{{32.16396844291483\,{\it t_{43}}}\over{{\it t_{45}}}}}}}-1.0\\\\ 
C>   {\it t_{50}} &=& {{0.1362107888567592\,{\it t_{47}}\,{\it t_{48}}\,{\it t_{21}}}\over{{\it t_{49}}}}\\\\ 
C>   {\it t_{51}} &=& \left(0.03109069086965489\,{\it t_{45}}\,\log \left({{0.1362107888567592\,{\it t_{47}}\,{\it t_{48}}\,{\it t_{21}}\,\left({\it t_{50}}+1.0\right)}\over{{{0.01855337900098064\,{\it t_{21}}^{2.0}}\over{{\it t_{46}}^{4.0}\,{\it t_{44}}^{4.0}\,{\it t_{49}}^{2.0}}}+{\it t_{50}}+1.0}}+1.0\right)+1.0\,{\it t_{43}}\right)\,\left(0.015625\,{\it t_{16}}\,{\it t_{19}}\,{\it t_{23}}+1.0\right)-0.015625\,\rho_\beta\,{\it t_2}\,{\it t_{20}}\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{32}}\,\sigma_{\beta\beta}\,\left({\it t_{34}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{31}}^{4.0}\,{\it t_{33}}^{2.0}}}+{\it t_{34}}+1.0}}+1.0\right)+1.0\,{\it t_{30}}\right)\,{\it t_{23}}-0.015625\,\rho_\alpha\,{\it t_2}\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{11}}\,\sigma_{\alpha\alpha}\,\left({\it t_{13}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{10}}^{4.0}\,{\it t_{12}}^{2.0}}}+{\it t_{13}}+1.0}}+1.0\right)+1.0\,{\it t_9}\right)\,{\it t_{20}}\,{\it t_{23}}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,{\it t_{51}}\,\left(0.00546875\,{\it t_{22}}^{3.0}\,{\it t_{51}}+1.0\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.0\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] J Tao, JP Perdew, VN Staveroverov, GE Scuseria, Phys.Rev.Lett. 91, 146401 (2003)  , DOI: 
C> <a href="http://dx.doi.org/10.1103/PhysRevLett.91.146401 "> 
C> 10.1103/PhysRevLett.91.146401 </a> 
C> 
      subroutine nwxcm_c_tpss03_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3,Mmat,Mmat2,Mmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,NCOL_AMAT3)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,NCOL_CMAT3)  !< [Output] The 3rd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat3(nq,NCOL_MMAT3)  !< [Output] The 3rd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      double precision nwxcm_heaviside 
      external         nwxcm_heaviside 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
