C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_pkzb99.F 
C> The nwxcm_c_pkzb99 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_pkzb99 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {{1}\over{\rho_\alpha}}\\\\ 
C>   {\it t_3} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_4} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_5} &=& \sqrt{{\it t_4}}\\\\ 
C>   {\it t_6} &=& {{1}\over{{\it t_5}}}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_4}}}\\\\ 
C>   {\it t_8} &=& \log \left({{1.269642451250142\,{\it t_5}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_6}+0.10186556948\right)\,{\it t_6}+0.22308199064\right)\,{\it t_6}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_9} &=& 0.1325688999052018\,{\it t_7}+1.0\\\\ 
C>   {\it t_{10}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_8}\,{\it t_9}-0.0310907\,\log \left({{1.269642451250142\,{\it t_5}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_6}+0.10465751434\right)\,{\it t_6}+0.19269083139\right)\,{\it t_6}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_7}+1.0\right)\right)-0.0621814\,{\it t_8}\,{\it t_9}\\\\ 
C>   {\it t_{11}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{12}} &=& {{1}\over{{\it t_{11}}^{2.0}}}\\\\ 
C>   {\it t_{13}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{10}}}}}-1.0\\\\ 
C>   {\it t_{14}} &=& {{0.2162211495206379\,{\it t_{12}}\,\sigma_{\alpha\alpha}}\over{{\it t_{13}}}}\\\\ 
C>   {\it t_{15}} &=& {{1}\over{\rho_\beta}}\\\\ 
C>   {\it t_{16}} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_{17}} &=& \sqrt{{\it t_{16}}}\\\\ 
C>   {\it t_{18}} &=& {{1}\over{{\it t_{17}}}}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{{\it t_{16}}}}\\\\ 
C>   {\it t_{20}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{18}}+0.10186556948\right)\,{\it t_{18}}+0.22308199064\right)\,{\it t_{18}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{21}} &=& 0.1325688999052018\,{\it t_{19}}+1.0\\\\ 
C>   {\it t_{22}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{20}}\,{\it t_{21}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{18}}+0.10465751434\right)\,{\it t_{18}}+0.19269083139\right)\,{\it t_{18}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{19}}+1.0\right)\right)-0.0621814\,{\it t_{20}}\,{\it t_{21}}\\\\ 
C>   {\it t_{23}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{23}}^{2.0}}}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{22}}}}}-1.0\\\\ 
C>   {\it t_{26}} &=& {{0.2162211495206379\,{\it t_{24}}\,\sigma_{\beta\beta}}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{27}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{27}}}}\\\\ 
C>   {\it t_{29}} &=& 0.1325688999052018\,{\it t_{28}}+1.0\\\\ 
C>   {\it t_{30}} &=& \sqrt{{\it t_{27}}}\\\\ 
C>   {\it t_{31}} &=& {{1}\over{{\it t_{30}}}}\\\\ 
C>   {\it t_{32}} &=& \log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.02414199311453321\,{\it t_{31}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{33}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{34}} &=& 1.0-{\it t_{33}}\,{\it t_3}\\\\ 
C>   {\it t_{35}} &=& {\it t_{33}}\,{\it t_3}+1.0\\\\ 
C>   {\it t_{36}} &=& 0.06901399211255826\,{\it t_{28}}+1.0\\\\ 
C>   {\it t_{37}} &=& \log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.01321299881039884\,{\it t_{31}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{38}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{35}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{34}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{33}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{29}}\,{\it t_{32}}-0.0310907\,\left(0.1274696188700087\,{\it t_{28}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.01530901310039024\,{\it t_{31}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{36}}\,{\it t_{37}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{36}}\,{\it t_{37}}\right)-0.0621814\,{\it t_{29}}\,{\it t_{32}}\\\\ 
C>   {\it t_{39}} &=& 0.5\,{\it t_{35}}^{{{2}\over{3}}}+0.5\,{\it t_{34}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{40}} &=& {\it t_{39}}^{3.0}\\\\ 
C>   {\it t_{41}} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{42}} &=& {{1}\over{{\it t_{41}}^{2.0}}}\\\\ 
C>   {\it t_{43}} &=& {{1}\over{{\it t_{39}}^{2.0}}}\\\\ 
C>   {\it t_{44}} &=& \sigma_{\beta\beta}+2.0\,\sigma_{\alpha\beta}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{e^{{{32.16396844291483\,{\it t_{38}}}\over{{\it t_{40}}}}}}}-1.0\\\\ 
C>   {\it t_{46}} &=& {{0.1362107888567592\,{\it t_{42}}\,{\it t_{43}}\,{\it t_{44}}}\over{{\it t_{45}}}}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left(\left(0.03109069086965489\,{\it t_{40}}\,\log \left({{0.1362107888567592\,{\it t_{42}}\,{\it t_{43}}\,{\it t_{44}}\,\left({\it t_{46}}+1.0\right)}\over{{{0.01855337900098064\,{\it t_{44}}^{2.0}}\over{{\it t_{41}}^{4.0}\,{\it t_{39}}^{4.0}\,{\it t_{45}}^{2.0}}}+{\it t_{46}}+1.0}}+1.0\right)+1.0\,{\it t_{38}}\right)\,\left({{0.53\,\left(0.125\,{\it t_{15}}\,\sigma_{\beta\beta}+0.125\,{\it t_2}\,\sigma_{\alpha\alpha}\right)^2}\over{\left(\tau_\beta+\tau_\alpha\right)^2}}+1.0\right)-{{0.02390625\,{\it t_{15}}\,{\it t_3}\,\sigma_{\beta\beta}^2\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{24}}\,\sigma_{\beta\beta}\,\left({\it t_{26}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{23}}^{4.0}\,{\it t_{25}}^{2.0}}}+{\it t_{26}}+1.0}}+1.0\right)+1.0\,{\it t_{22}}\right)}\over{\tau_\beta^2}}-{{0.02390625\,{\it t_2}\,{\it t_3}\,\sigma_{\alpha\alpha}^2\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{12}}\,\sigma_{\alpha\alpha}\,\left({\it t_{14}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{11}}^{4.0}\,{\it t_{13}}^{2.0}}}+{\it t_{14}}+1.0}}+1.0\right)+1.0\,{\it t_{10}}\right)}\over{\tau_\alpha^2}}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.0\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] JP Perdew, S Kurth, A Zupan, P Blaha, Phys.Rev.Lett. 82, 2544 (1999)  , DOI: 
C> <a href="http://dx.doi.org/10.1103/PhysRevLett.82.2544 "> 
C> 10.1103/PhysRevLett.82.2544 </a> 
C> 
      subroutine nwxcm_c_pkzb99(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Cmat,Mmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      double precision nwxcm_heaviside 
      external         nwxcm_heaviside 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = gammaaa**2
            t2 = 1/rhoa**2
            t3 = rhoa**3.333333333333333d-1
            t4 = t3**5.0d-1
            t5 = 1/t4
            t6 = 1.530901310039024d-2*t5+1.0465751434d-1
            t7 = 7.876233178997433d-1*t5*t6+1.9269083139d-1
            t8 = 7.876233178997433d-1*t5*t7+4.3896648423d-1
            t9 = 1/t8
            t10 = 1.269642451250142d+0*t4*t9+1.0d+0
            t11 = log(t10)
            t12 = 1/t3
            t13 = 1.2746961887000874d-1*t12+1.0d+0
            t14 = 2.4141993114533214d-2*t5+1.0186556948d-1
            t15 = 7.876233178997433d-1*t14*t5+2.2308199064d-1
            t16 = 7.876233178997433d-1*t15*t5+4.7231125998d-1
            t17 = 1/t16
            t18 = 1.269642451250142d+0*t17*t4+1.0d+0
            t19 = log(t18)
            t20 = 1.325688999052018d-1*t12+1.0d+0
            t21 = 9.999999999999991d-1*(6.21814d-2*t19*t20-3.10907d-2*t1
     1         1*t13)-6.21814d-2*t19*t20
            t22 = rhoa**1.1666666666666667d+0
            t23 = 1/t22**2.0d+0
            t24 = exp(-6.432793688582967d+1*t21)
            t25 = t24-1.0d+0
            t26 = 1/t25
            t27 = 2.162211495206379d-1*gammaaa*t23*t26
            t28 = t27+1.0d+0
            t29 = gammaaa**2.0d+0
            t30 = 1/t22**4.0d+0
            t31 = 1/t25**2.0d+0
            t32 = 4.6751585500026055d-2*t29*t30*t31+t27+1.0d+0
            t33 = 1/t32
            t34 = 2.162211495206379d-1*gammaaa*t23*t28*t33+1.0d+0
            t35 = 1.5545345434827443d-2*log(t34)+1.0d+0*t21
            t36 = 1/taua**2
            t37 = 2.150807071909054d-2*t5+1.0186556948d-1
            t38 = 7.016926042943223d-1*t37*t5+2.2308199064d-1
            t39 = 7.016926042943223d-1*t38*t5+4.7231125998d-1
            t40 = 1/t39
            t41 = 1.4251254664507676d+0*t4*t40+1.0d+0
            t42 = log(t41)
            t43 = 1.0522000558389215d-1*t12+1.0d+0
            t44 = exp(2.0000005873362642d+0*t42*t43)
            t45 = t44-1.0d+0
            t46 = 1/t45
            t47 = 1.0811057476031892d-1*gammaaa*t23*t46
            t48 = t47+1.0d+0
            t49 = 1/t45**2.0d+0
            t50 = 1.1687896375006504d-2*t29*t30*t49+t47+1.0d+0
            t51 = 1/t50
            t52 = 1.0811057476031892d-1*gammaaa*t23*t48*t51+1.0d+0
            t53 = 3.109069086965489d-2*log(t52)-6.21814d-2*t42*t43
            t54 = 8.28125d-3*t1*t2*t36+1.0d+0
            t55 = t53*t54-2.390625d-2*t1*t2*t35*t36
            t56 = 1/rhoa**1.3333333333333333d+0
            t57 = 1/rhoa**1.3333333333333336d+0
            t58 = 1/t4**3
            t59 = 1/rhoa**6.666666666666667d-1
            t60 = 1/t18
            t61 = 2.11607075208357d-1*t17*t5*t59-1.269642451250142d+0*t4
     1         *(7.876233178997433d-1*t5*(-1.3127055298329054d-1*t14*t58
     2         *t59-3.169132786263567d-3*t57)-1.3127055298329054d-1*t15*
     3         t58*t59)/t16**2
            t62 = 9.999999999999991d-1*(-3.10907d-2*t13*(2.1160707520835
     1         7d-1*t5*t59*t9-1.269642451250142d+0*t4*(7.876233178997433
     2         d-1*t5*(-1.3127055298329054d-1*t58*t59*t6-2.0096226153166
     3         658d-3*t57)-1.3127055298329054d-1*t58*t59*t7)/t8**2)/t10+
     4         6.21814d-2*t20*t60*t61-2.747773264188438d-3*t19*t56+1.321
     5         0398931339265d-3*t11*t56)-6.21814d-2*t20*t60*t61+2.747773
     6         264188438d-3*t19*t56
            t63 = 1/t34
            t64 = rhoa**1.6666666666666674d-1
            t65 = 1/t22**3.0d+0
            t66 = -5.045160155481552d-1*gammaaa*t26*t64*t65
            t67 = 1.3909060459745134d+1*gammaaa*t23*t24*t62/t25**2
            t68 = 1/t32**2
            t69 = 1/t22**5.0d+0
            t70 = 1/rhoa**3
            t71 = 1/t41
            t72 = 2.375209110751279d-1*t40*t5*t59-1.4251254664507676d+0*
     1         t4*(7.016926042943223d-1*t5*(-1.1694876738238705d-1*t37*t
     2         58*t59-2.51534235937085d-3*t57)-1.1694876738238705d-1*t38
     3         *t58*t59)/t39**2
            t73 = 1/t52
            t74 = -2.522580077740775d-1*gammaaa*t46*t64*t65
            t75 = 2.0000005873362642d+0*t43*t71*t72-7.014669098910309d-2
     1         *t42*t56
            t76 = -1.0811057476031892d-1*gammaaa*t23*t44*t75/t45**2
            t77 = 1/t50**2
            t78 = 2.0d+0*rhoa*(3.109069086965489d-2*t54*t73*(-1.08110574
     1         76031892d-1*gammaaa*t23*t48*(2.3375792750013008d-2*gammaa
     2         a*t30*t49+1.0811057476031892d-1*t23*t46)*t77+1.0811057476
     3         031892d-1*t23*t48*t51+1.1687896375006507d-2*gammaaa*t30*t
     4         46*t51)-3.7163091430134354d-4*t1*t2*t36*t63*(-2.162211495
     5         206379d-1*gammaaa*t23*t28*(9.350317100005211d-2*gammaaa*t
     6         30*t31+2.162211495206379d-1*t23*t26)*t68+4.67515855000260
     7         5d-2*gammaaa*t26*t30*t33+2.162211495206379d-1*t23*t28*t33
     8         )+t2*t36*(1.6562500000000002d-2*gammaaa*t53-4.78125d-2*ga
     9         mmaaa*t35))*wght
            fnc(iq) = 2.0d+0*rhoa*t55*wght+fnc(iq)
            Amat(iq,D1_RA) = 2.0d+0*rhoa*(t54*(3.109069086965489d-2*t73*
     1         (-1.0811057476031892d-1*gammaaa*t23*t48*(t76-2.3375792750
     2         013008d-2*t29*t30*t44*t75/t45**3.0d+0+t74-5.4543516416697
     3         02d-2*t29*t49*t64*t69)*t77+1.0811057476031892d-1*gammaaa*
     4         t23*t51*(t76+t74)-2.522580077740775d-1*gammaaa*t48*t51*t6
     5         4*t65)-6.21814d-2*t43*t71*t72+2.18090908507141d-3*t42*t56
     6         )-1.6562500000000002d-2*t1*t36*t53*t70+4.78125d-2*t1*t35*
     7         t36*t70-2.390625d-2*t1*t2*t36*(1.5545345434827443d-2*t63*
     8         (-2.162211495206379d-1*gammaaa*t23*t28*t68*(-2.1817406566
     9         678826d-1*t29*t31*t64*t69+t67+t66+6.014866082716291d+0*t2
     :         4*t29*t30*t62/t25**3.0d+0)+2.162211495206379d-1*gammaaa*t
     ;         23*t33*(t67+t66)-5.045160155481552d-1*gammaaa*t28*t33*t64
     <         *t65)+1.0d+0*t62))*wght+2.0d+0*t55*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = t78+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t78+Cmat(iq,D1_GAB)
            Amat(iq,D1_TA) = 2.0d+0*(4.78125d-2*t1*t35-1.656250000000000
     1         2d-2*t1*t53)*wght/(rhoa*taua**3)+Amat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob+rhoa
            t2 = gammaaa**2
            t3 = 1/rhoa
            t4 = rhoa**3.333333333333333d-1
            t5 = t4**5.0d-1
            t6 = 1/t5
            t7 = 1.530901310039024d-2*t6+1.0465751434d-1
            t8 = 7.876233178997433d-1*t6*t7+1.9269083139d-1
            t9 = 7.876233178997433d-1*t6*t8+4.3896648423d-1
            t10 = 1/t9
            t11 = 1.269642451250142d+0*t10*t5+1.0d+0
            t12 = log(t11)
            t13 = 1/t4
            t14 = 1.2746961887000874d-1*t13+1.0d+0
            t15 = 2.4141993114533214d-2*t6+1.0186556948d-1
            t16 = 7.876233178997433d-1*t15*t6+2.2308199064d-1
            t17 = 7.876233178997433d-1*t16*t6+4.7231125998d-1
            t18 = 1/t17
            t19 = 1.269642451250142d+0*t18*t5+1.0d+0
            t20 = log(t19)
            t21 = 1.325688999052018d-1*t13+1.0d+0
            t22 = 9.999999999999991d-1*(6.21814d-2*t20*t21-3.10907d-2*t1
     1         2*t14)-6.21814d-2*t20*t21
            t23 = rhoa**1.1666666666666667d+0
            t24 = 1/t23**2.0d+0
            t25 = exp(-6.432793688582967d+1*t22)
            t26 = t25-1.0d+0
            t27 = 1/t26
            t28 = 2.162211495206379d-1*gammaaa*t24*t27
            t29 = t28+1.0d+0
            t30 = gammaaa**2.0d+0
            t31 = 1/t23**4.0d+0
            t32 = 1/t26**2.0d+0
            t33 = 4.6751585500026055d-2*t30*t31*t32+t28+1.0d+0
            t34 = 1/t33
            t35 = 2.162211495206379d-1*gammaaa*t24*t29*t34+1.0d+0
            t36 = 1.5545345434827443d-2*log(t35)+1.0d+0*t22
            t37 = 1/t1
            t38 = 1/taua**2
            t39 = gammabb**2
            t40 = 1/rhob
            t41 = rhob**3.333333333333333d-1
            t42 = t41**5.0d-1
            t43 = 1/t42
            t44 = 1.530901310039024d-2*t43+1.0465751434d-1
            t45 = 7.876233178997433d-1*t43*t44+1.9269083139d-1
            t46 = 7.876233178997433d-1*t43*t45+4.3896648423d-1
            t47 = 1/t46
            t48 = 1.269642451250142d+0*t42*t47+1.0d+0
            t49 = log(t48)
            t50 = 1/t41
            t51 = 1.2746961887000874d-1*t50+1.0d+0
            t52 = 2.4141993114533214d-2*t43+1.0186556948d-1
            t53 = 7.876233178997433d-1*t43*t52+2.2308199064d-1
            t54 = 7.876233178997433d-1*t43*t53+4.7231125998d-1
            t55 = 1/t54
            t56 = 1.269642451250142d+0*t42*t55+1.0d+0
            t57 = log(t56)
            t58 = 1.325688999052018d-1*t50+1.0d+0
            t59 = 9.999999999999991d-1*(6.21814d-2*t57*t58-3.10907d-2*t4
     1         9*t51)-6.21814d-2*t57*t58
            t60 = rhob**1.1666666666666667d+0
            t61 = 1/t60**2.0d+0
            t62 = exp(-6.432793688582967d+1*t59)
            t63 = t62-1.0d+0
            t64 = 1/t63
            t65 = 2.162211495206379d-1*gammabb*t61*t64
            t66 = t65+1.0d+0
            t67 = gammabb**2.0d+0
            t68 = 1/t60**4.0d+0
            t69 = 1/t63**2.0d+0
            t70 = 4.6751585500026055d-2*t67*t68*t69+t65+1.0d+0
            t71 = 1/t70
            t72 = 2.162211495206379d-1*gammabb*t61*t66*t71+1.0d+0
            t73 = 1.5545345434827443d-2*log(t72)+1.0d+0*t59
            t74 = 1/taub**2
            t75 = t1**3.333333333333333d-1
            t76 = 1/t75
            t77 = 1.325688999052018d-1*t76+1.0d+0
            t78 = t75**5.0d-1
            t79 = 1/t78
            t80 = 2.4141993114533214d-2*t79+1.0186556948d-1
            t81 = 7.876233178997433d-1*t79*t80+2.2308199064d-1
            t82 = 7.876233178997433d-1*t79*t81+4.7231125998d-1
            t83 = 1/t82
            t84 = 1.269642451250142d+0*t78*t83+1.0d+0
            t85 = log(t84)
            t86 = rhoa-rhob
            t87 = 1.0d+0-t37*t86
            t88 = t37*t86+1.0d+0
            t89 = 1.923661050931536d+0*t88**1.3333333333333333d+0+1.9236
     1         61050931536d+0*t87**1.3333333333333333d+0-3.8473221018630
     2         72d+0
            t90 = 6.901399211255826d-2*t76+1.0d+0
            t91 = 1.3212998810398843d-2*t79+2.9729725188d-2
            t92 = 7.876233178997433d-1*t79*t91+1.2236585478d-1
            t93 = 7.876233178997433d-1*t79*t92+3.497952466d-1
            t94 = 1/t93
            t95 = 1.269642451250142d+0*t78*t94+1.0d+0
            t96 = log(t95)
            t97 = t86**4
            t98 = 1/t1**4
            t99 = 1.2746961887000874d-1*t76+1.0d+0
            t100 = 1.530901310039024d-2*t79+1.0465751434d-1
            t101 = 7.876233178997433d-1*t100*t79+1.9269083139d-1
            t102 = 7.876233178997433d-1*t101*t79+4.3896648423d-1
            t103 = 1/t102
            t104 = 1.269642451250142d+0*t103*t78+1.0d+0
            t105 = log(t104)
            t106 = 1.709920934161365d+0*(6.21814d-2*t77*t85-3.10907d-2*t
     1         105*t99)-3.37738d-2*t90*t96
            t107 = t106*t97*t98+3.37738d-2*t90*t96
            t108 = 5.848223622634648d-1*t107*t89-6.21814d-2*t77*t85
            t109 = 5.0d-1*t88**6.666666666666666d-1+5.0d-1*t87**6.666666
     1         666666666d-1
            t110 = t109**3.0d+0
            t111 = gammabb+2.0d+0*gammaab+gammaaa
            t112 = t1**1.1666666666666667d+0
            t113 = 1/t112**2.0d+0
            t114 = t109**2.0d+0
            t115 = 1/t114
            t116 = 1/t110
            t117 = exp(-3.216396844291483d+1*t108*t116)
            t118 = t117-1.0d+0
            t119 = 1/t118
            t120 = 1.3621078885675922d-1*t111*t113*t115*t119
            t121 = t120+1.0d+0
            t122 = t111**2.0d+0
            t123 = 1/t112**4.0d+0
            t124 = 1/t109**4.0d+0
            t125 = 1/t118**2.0d+0
            t126 = 1.855337900098064d-2*t122*t123*t124*t125+t120+1.0d+0
            t127 = 1/t126
            t128 = 1.3621078885675922d-1*t111*t113*t115*t121*t127+1.0d+0
            t129 = log(t128)
            t130 = 3.109069086965489d-2*t110*t129+1.0d+0*t108
            t131 = 1.25d-1*gammabb*t40+1.25d-1*gammaaa*t3
            t132 = t131**2
            t133 = taub+taua
            t134 = 1/t133**2
            t135 = 5.3d-1*t132*t134+1.0d+0
            t136 = -2.390625d-2*t37*t39*t40*t73*t74-2.390625d-2*t2*t3*t3
     1         6*t37*t38+t130*t135
            t137 = 1/t1**2
            t138 = 2.390625d-2*t137*t2*t3*t36*t38
            t139 = 1/rhoa**1.3333333333333333d+0
            t140 = 1/rhoa**1.3333333333333336d+0
            t141 = 1/t5**3
            t142 = 1/rhoa**6.666666666666667d-1
            t143 = 1/t19
            t144 = 2.11607075208357d-1*t142*t18*t6-1.269642451250142d+0*
     1         t5*(7.876233178997433d-1*(-1.3127055298329054d-1*t141*t14
     2         2*t15-3.169132786263567d-3*t140)*t6-1.3127055298329054d-1
     3         *t141*t142*t16)/t17**2
            t145 = 9.999999999999991d-1*(-3.10907d-2*t14*(2.116070752083
     1         57d-1*t10*t142*t6-1.269642451250142d+0*t5*(7.876233178997
     2         433d-1*t6*(-1.3127055298329054d-1*t141*t142*t7-2.00962261
     3         53166658d-3*t140)-1.3127055298329054d-1*t141*t142*t8)/t9*
     4         *2)/t11+6.21814d-2*t143*t144*t21-2.747773264188438d-3*t13
     5         9*t20+1.3210398931339265d-3*t12*t139)-6.21814d-2*t143*t14
     6         4*t21+2.747773264188438d-3*t139*t20
            t146 = 1/t35
            t147 = rhoa**1.6666666666666674d-1
            t148 = 1/t23**3.0d+0
            t149 = -5.045160155481552d-1*gammaaa*t147*t148*t27
            t150 = 1.3909060459745134d+1*gammaaa*t145*t24*t25/t26**2
            t151 = 1/t33**2
            t152 = 1/rhoa**2
            t153 = 2.390625d-2*t137*t39*t40*t73*t74
            t154 = 1/t1**1.3333333333333336d+0
            t155 = 1/t1**6.666666666666667d-1
            t156 = 1/t78**3
            t157 = 2.11607075208357d-1*t155*t79*t83-1.269642451250142d+0
     1         *t78*(7.876233178997433d-1*t79*(-1.3127055298329054d-1*t1
     2         55*t156*t80-3.169132786263567d-3*t154)-1.3127055298329054
     3         d-1*t155*t156*t81)/t82**2
            t158 = 1/t84
            t159 = -6.21814d-2*t157*t158*t77
            t160 = 1/t1**1.3333333333333333d+0
            t161 = 2.747773264188438d-3*t160*t85
            t162 = 2.11607075208357d-1*t155*t79*t94-1.269642451250142d+0
     1         *t78*(7.876233178997433d-1*t79*(-1.3127055298329054d-1*t1
     2         55*t156*t91-1.7344776604086162d-3*t154)-1.312705529832905
     3         4d-1*t155*t156*t92)/t93**2
            t163 = 1/t95
            t164 = 3.37738d-2*t162*t163*t90
            t165 = -7.769549222703733d-4*t160*t96
            t166 = t97*t98*(1.709920934161365d+0*(-3.10907d-2*(2.1160707
     1         5208357d-1*t103*t155*t79-1.269642451250142d+0*t78*(7.8762
     2         33178997433d-1*(-1.3127055298329054d-1*t100*t155*t156-2.0
     3         096226153166658d-3*t154)*t79-1.3127055298329054d-1*t101*t
     4         155*t156)/t102**2)*t99/t104-2.747773264188438d-3*t160*t85
     5         +6.21814d-2*t157*t158*t77+1.3210398931339265d-3*t105*t160
     6         )+7.769549222703733d-4*t160*t96-3.37738d-2*t162*t163*t90)
            t167 = -4*t106*t97/t1**5
            t168 = t86**3
            t169 = t137*t86
            t170 = -t37
            t171 = t170+t169
            t172 = t87**3.333333333333333d-1
            t173 = -t137*t86
            t174 = t37+t173
            t175 = t88**3.333333333333333d-1
            t176 = 5.848223622634648d-1*t89*(4*t106*t168*t98+t167+t166+t
     1         165+t164)+5.848223622634648d-1*t107*(2.564881401242048d+0
     2         *t174*t175+2.564881401242048d+0*t171*t172)+t161+t159
            t177 = 1/t128
            t178 = 1/t172
            t179 = 1/t175
            t180 = 3.333333333333333d-1*t174*t179+3.333333333333333d-1*t
     1         171*t178
            t181 = t1**1.6666666666666674d-1
            t182 = 1/t112**3.0d+0
            t183 = -3.1782517399910487d-1*t111*t115*t121*t127*t181*t182
            t184 = -2.7242157771351844d-1*t111*t113*t116*t119*t180
            t185 = -3.1782517399910487d-1*t111*t115*t119*t181*t182
            t186 = 1/t118**2
            t187 = 9.649190532874448d+1*t108*t124*t180-3.216396844291483
     1         d+1*t116*t176
            t188 = -1.3621078885675922d-1*t111*t113*t115*t117*t186*t187
            t189 = 1/t126**2
            t190 = 1/t109**5.0d+0
            t191 = -8.658243533790966d-2*t122*t124*t125*t181/t112**5.0d+
     1         0
            t192 = 1/t118**3.0d+0
            t193 = 1.0d+0*t136*wght
            t194 = 1/rhob**1.3333333333333333d+0
            t195 = 1/rhob**1.3333333333333336d+0
            t196 = 1/t42**3
            t197 = 1/rhob**6.666666666666667d-1
            t198 = 1/t56
            t199 = 2.11607075208357d-1*t197*t43*t55-1.269642451250142d+0
     1         *t42*(7.876233178997433d-1*t43*(-1.3127055298329054d-1*t1
     2         96*t197*t52-3.169132786263567d-3*t195)-1.3127055298329054
     3         d-1*t196*t197*t53)/t54**2
            t200 = 9.999999999999991d-1*(6.21814d-2*t198*t199*t58-2.7477
     1         73264188438d-3*t194*t57-3.10907d-2*(2.11607075208357d-1*t
     2         197*t43*t47-1.269642451250142d+0*t42*(7.876233178997433d-
     3         1*t43*(-1.3127055298329054d-1*t196*t197*t44-2.00962261531
     4         66658d-3*t195)-1.3127055298329054d-1*t196*t197*t45)/t46**
     5         2)*t51/t48+1.3210398931339265d-3*t194*t49)-6.21814d-2*t19
     6         8*t199*t58+2.747773264188438d-3*t194*t57
            t201 = 1/t72
            t202 = rhob**1.6666666666666674d-1
            t203 = 1/t60**3.0d+0
            t204 = -5.045160155481552d-1*gammabb*t202*t203*t64
            t205 = 1.3909060459745134d+1*gammabb*t200*t61*t62/t63**2
            t206 = 1/t70**2
            t207 = 1/rhob**2
            t208 = t37+t169
            t209 = t173+t170
            t210 = 5.848223622634648d-1*t89*(-4*t106*t168*t98+t167+t166+
     1         t165+t164)+5.848223622634648d-1*t107*(2.564881401242048d+
     2         0*t175*t209+2.564881401242048d+0*t172*t208)+t161+t159
            t211 = 3.333333333333333d-1*t179*t209+3.333333333333333d-1*t
     1         178*t208
            t212 = -2.7242157771351844d-1*t111*t113*t116*t119*t211
            t213 = 9.649190532874448d+1*t108*t124*t211-3.216396844291483
     1         d+1*t116*t210
            t214 = -1.3621078885675922d-1*t111*t113*t115*t117*t186*t213
            t215 = 3.109069086965489d-2*t110*t135*t177*(-1.3621078885675
     1         922d-1*t111*t113*t115*t121*(3.710675800196128d-2*t111*t12
     2         3*t124*t125+1.3621078885675922d-1*t113*t115*t119)*t189+1.
     3         855337900098064d-2*t111*t119*t123*t124*t127+1.36210788856
     4         75922d-1*t113*t115*t121*t127)
            t216 = -1.0600000000000001d+0*t130*t132/t133**3
            fnc(iq) = 1.0d+0*t1*t136*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*(2.390625d-2*t152*t2*t36*t37*t38-
     1         2.390625d-2*t2*t3*(1.5545345434827443d-2*t146*(-5.0451601
     2         55481552d-1*gammaaa*t147*t148*t29*t34+2.162211495206379d-
     3         1*gammaaa*(t150+t149)*t24*t34-2.162211495206379d-1*gammaa
     4         a*t151*t24*t29*(-2.1817406566678826d-1*t147*t30*t32/t23**
     5         5.0d+0+6.014866082716291d+0*t145*t25*t30*t31/t26**3.0d+0+
     6         t150+t149))+1.0d+0*t145)*t37*t38+t135*(3.109069086965489d
     7         -2*t110*t177*(-1.3621078885675922d-1*t111*t113*t115*t121*
     8         t189*(-3.710675800196128d-2*t117*t122*t123*t124*t187*t192
     9         +t191-7.421351600392256d-2*t122*t123*t125*t180*t190+t188+
     :         t185+t184)+1.3621078885675922d-1*t111*t113*t115*t127*(t18
     ;         8+t185+t184)+t183-2.7242157771351844d-1*t111*t113*t116*t1
     <         21*t127*t180)+9.327207260896466d-2*t114*t129*t180+1.0d+0*
     =         t176)+t153-1.325d-1*gammaaa*t130*t131*t134*t152+t138)*wgh
     >         t+t193+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = 1.0d+0*t1*(2.390625d-2*t207*t37*t39*t73*t74
     1         -2.390625d-2*t37*t39*t40*(1.5545345434827443d-2*t201*(-5.
     2         045160155481552d-1*gammabb*t202*t203*t66*t71+2.1622114952
     3         06379d-1*gammabb*(t205+t204)*t61*t71-2.162211495206379d-1
     4         *gammabb*t206*t61*t66*(-2.1817406566678826d-1*t202*t67*t6
     5         9/t60**5.0d+0+6.014866082716291d+0*t200*t62*t67*t68/t63**
     6         3.0d+0+t205+t204))+1.0d+0*t200)*t74+t135*(3.1090690869654
     7         89d-2*t110*t177*(-1.3621078885675922d-1*t111*t113*t115*t1
     8         21*t189*(t214-3.710675800196128d-2*t117*t122*t123*t124*t1
     9         92*t213+t212-7.421351600392256d-2*t122*t123*t125*t190*t21
     :         1+t191+t185)+1.3621078885675922d-1*t111*t113*t115*t127*(t
     ;         214+t212+t185)-2.7242157771351844d-1*t111*t113*t116*t121*
     <         t127*t211+t183)+9.327207260896466d-2*t114*t129*t211+1.0d+
     =         0*t210)-1.325d-1*gammabb*t130*t131*t134*t207+t153+t138)*w
     >         ght+t193+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = 1.0d+0*t1*(-4.78125d-2*gammaaa*t3*t36*t37*
     1         t38-3.7163091430134354d-4*t146*t2*t3*(4.675158550002605d-
     2         2*gammaaa*t27*t31*t34+2.162211495206379d-1*t24*t29*t34-2.
     3         162211495206379d-1*gammaaa*t151*t24*t29*(9.35031710000521
     4         1d-2*gammaaa*t31*t32+2.162211495206379d-1*t24*t27))*t37*t
     5         38+1.325d-1*t130*t131*t134*t3+t215)*wght+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = 3.109069086965489d-2*t1*t110*t135*t177*(-1
     1         .3621078885675922d-1*t111*t113*t115*t121*(7.4213516003922
     2         56d-2*t111*t123*t124*t125+2.7242157771351844d-1*t113*t115
     3         *t119)*t189+3.710675800196128d-2*t111*t119*t123*t124*t127
     4         +2.7242157771351844d-1*t113*t115*t121*t127)*wght+Cmat(iq,
     5         D1_GAB)
            Cmat(iq,D1_GBB) = 1.0d+0*t1*(-4.78125d-2*gammabb*t37*t40*t73
     1         *t74-3.7163091430134354d-4*t201*t37*t39*t40*(4.6751585500
     2         02605d-2*gammabb*t64*t68*t71+2.162211495206379d-1*t61*t66
     3         *t71-2.162211495206379d-1*gammabb*t206*t61*t66*(9.3503171
     4         00005211d-2*gammabb*t68*t69+2.162211495206379d-1*t61*t64)
     5         )*t74+1.325d-1*t130*t131*t134*t40+t215)*wght+Cmat(iq,D1_G
     6         BB)
            Mmat(iq,D1_TA) = 1.0d+0*t1*(4.78125d-2*t2*t3*t36*t37/taua**3
     1         +t216)*wght+Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = 1.0d+0*t1*(4.78125d-2*t37*t39*t40*t73/taub*
     1         *3+t216)*wght+Mmat(iq,D1_TB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            fnc(iq) = fnc(iq)
            Amat(iq,D1_RA) = Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = Cmat(iq,D1_GAA)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            fnc(iq) = fnc(iq)
            Amat(iq,D1_RB) = Amat(iq,D1_RB)
            Cmat(iq,D1_GBB) = Cmat(iq,D1_GBB)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_pkzb99 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {{1}\over{\rho_\alpha}}\\\\ 
C>   {\it t_3} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_4} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_5} &=& \sqrt{{\it t_4}}\\\\ 
C>   {\it t_6} &=& {{1}\over{{\it t_5}}}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_4}}}\\\\ 
C>   {\it t_8} &=& \log \left({{1.269642451250142\,{\it t_5}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_6}+0.10186556948\right)\,{\it t_6}+0.22308199064\right)\,{\it t_6}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_9} &=& 0.1325688999052018\,{\it t_7}+1.0\\\\ 
C>   {\it t_{10}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_8}\,{\it t_9}-0.0310907\,\log \left({{1.269642451250142\,{\it t_5}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_6}+0.10465751434\right)\,{\it t_6}+0.19269083139\right)\,{\it t_6}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_7}+1.0\right)\right)-0.0621814\,{\it t_8}\,{\it t_9}\\\\ 
C>   {\it t_{11}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{12}} &=& {{1}\over{{\it t_{11}}^{2.0}}}\\\\ 
C>   {\it t_{13}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{10}}}}}-1.0\\\\ 
C>   {\it t_{14}} &=& {{0.2162211495206379\,{\it t_{12}}\,\sigma_{\alpha\alpha}}\over{{\it t_{13}}}}\\\\ 
C>   {\it t_{15}} &=& {{1}\over{\rho_\beta}}\\\\ 
C>   {\it t_{16}} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_{17}} &=& \sqrt{{\it t_{16}}}\\\\ 
C>   {\it t_{18}} &=& {{1}\over{{\it t_{17}}}}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{{\it t_{16}}}}\\\\ 
C>   {\it t_{20}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{18}}+0.10186556948\right)\,{\it t_{18}}+0.22308199064\right)\,{\it t_{18}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{21}} &=& 0.1325688999052018\,{\it t_{19}}+1.0\\\\ 
C>   {\it t_{22}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{20}}\,{\it t_{21}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{18}}+0.10465751434\right)\,{\it t_{18}}+0.19269083139\right)\,{\it t_{18}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{19}}+1.0\right)\right)-0.0621814\,{\it t_{20}}\,{\it t_{21}}\\\\ 
C>   {\it t_{23}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{23}}^{2.0}}}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{22}}}}}-1.0\\\\ 
C>   {\it t_{26}} &=& {{0.2162211495206379\,{\it t_{24}}\,\sigma_{\beta\beta}}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{27}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{27}}}}\\\\ 
C>   {\it t_{29}} &=& 0.1325688999052018\,{\it t_{28}}+1.0\\\\ 
C>   {\it t_{30}} &=& \sqrt{{\it t_{27}}}\\\\ 
C>   {\it t_{31}} &=& {{1}\over{{\it t_{30}}}}\\\\ 
C>   {\it t_{32}} &=& \log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.02414199311453321\,{\it t_{31}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{33}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{34}} &=& 1.0-{\it t_{33}}\,{\it t_3}\\\\ 
C>   {\it t_{35}} &=& {\it t_{33}}\,{\it t_3}+1.0\\\\ 
C>   {\it t_{36}} &=& 0.06901399211255826\,{\it t_{28}}+1.0\\\\ 
C>   {\it t_{37}} &=& \log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.01321299881039884\,{\it t_{31}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{38}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{35}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{34}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{33}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{29}}\,{\it t_{32}}-0.0310907\,\left(0.1274696188700087\,{\it t_{28}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.01530901310039024\,{\it t_{31}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{36}}\,{\it t_{37}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{36}}\,{\it t_{37}}\right)-0.0621814\,{\it t_{29}}\,{\it t_{32}}\\\\ 
C>   {\it t_{39}} &=& 0.5\,{\it t_{35}}^{{{2}\over{3}}}+0.5\,{\it t_{34}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{40}} &=& {\it t_{39}}^{3.0}\\\\ 
C>   {\it t_{41}} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{42}} &=& {{1}\over{{\it t_{41}}^{2.0}}}\\\\ 
C>   {\it t_{43}} &=& {{1}\over{{\it t_{39}}^{2.0}}}\\\\ 
C>   {\it t_{44}} &=& \sigma_{\beta\beta}+2.0\,\sigma_{\alpha\beta}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{e^{{{32.16396844291483\,{\it t_{38}}}\over{{\it t_{40}}}}}}}-1.0\\\\ 
C>   {\it t_{46}} &=& {{0.1362107888567592\,{\it t_{42}}\,{\it t_{43}}\,{\it t_{44}}}\over{{\it t_{45}}}}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left(\left(0.03109069086965489\,{\it t_{40}}\,\log \left({{0.1362107888567592\,{\it t_{42}}\,{\it t_{43}}\,{\it t_{44}}\,\left({\it t_{46}}+1.0\right)}\over{{{0.01855337900098064\,{\it t_{44}}^{2.0}}\over{{\it t_{41}}^{4.0}\,{\it t_{39}}^{4.0}\,{\it t_{45}}^{2.0}}}+{\it t_{46}}+1.0}}+1.0\right)+1.0\,{\it t_{38}}\right)\,\left({{0.53\,\left(0.125\,{\it t_{15}}\,\sigma_{\beta\beta}+0.125\,{\it t_2}\,\sigma_{\alpha\alpha}\right)^2}\over{\left(\tau_\beta+\tau_\alpha\right)^2}}+1.0\right)-{{0.02390625\,{\it t_{15}}\,{\it t_3}\,\sigma_{\beta\beta}^2\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{24}}\,\sigma_{\beta\beta}\,\left({\it t_{26}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{23}}^{4.0}\,{\it t_{25}}^{2.0}}}+{\it t_{26}}+1.0}}+1.0\right)+1.0\,{\it t_{22}}\right)}\over{\tau_\beta^2}}-{{0.02390625\,{\it t_2}\,{\it t_3}\,\sigma_{\alpha\alpha}^2\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{12}}\,\sigma_{\alpha\alpha}\,\left({\it t_{14}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{11}}^{4.0}\,{\it t_{13}}^{2.0}}}+{\it t_{14}}+1.0}}+1.0\right)+1.0\,{\it t_{10}}\right)}\over{\tau_\alpha^2}}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.0\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] JP Perdew, S Kurth, A Zupan, P Blaha, Phys.Rev.Lett. 82, 2544 (1999)  , DOI: 
C> <a href="http://dx.doi.org/10.1103/PhysRevLett.82.2544 "> 
C> 10.1103/PhysRevLett.82.2544 </a> 
C> 
      subroutine nwxcm_c_pkzb99_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Cmat,Cmat2,Mmat,Mmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      double precision nwxcm_heaviside 
      external         nwxcm_heaviside 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_pkzb99 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {{1}\over{\rho_\alpha}}\\\\ 
C>   {\it t_3} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_4} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_5} &=& \sqrt{{\it t_4}}\\\\ 
C>   {\it t_6} &=& {{1}\over{{\it t_5}}}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_4}}}\\\\ 
C>   {\it t_8} &=& \log \left({{1.269642451250142\,{\it t_5}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_6}+0.10186556948\right)\,{\it t_6}+0.22308199064\right)\,{\it t_6}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_9} &=& 0.1325688999052018\,{\it t_7}+1.0\\\\ 
C>   {\it t_{10}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_8}\,{\it t_9}-0.0310907\,\log \left({{1.269642451250142\,{\it t_5}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_6}+0.10465751434\right)\,{\it t_6}+0.19269083139\right)\,{\it t_6}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_7}+1.0\right)\right)-0.0621814\,{\it t_8}\,{\it t_9}\\\\ 
C>   {\it t_{11}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{12}} &=& {{1}\over{{\it t_{11}}^{2.0}}}\\\\ 
C>   {\it t_{13}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{10}}}}}-1.0\\\\ 
C>   {\it t_{14}} &=& {{0.2162211495206379\,{\it t_{12}}\,\sigma_{\alpha\alpha}}\over{{\it t_{13}}}}\\\\ 
C>   {\it t_{15}} &=& {{1}\over{\rho_\beta}}\\\\ 
C>   {\it t_{16}} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_{17}} &=& \sqrt{{\it t_{16}}}\\\\ 
C>   {\it t_{18}} &=& {{1}\over{{\it t_{17}}}}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{{\it t_{16}}}}\\\\ 
C>   {\it t_{20}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{18}}+0.10186556948\right)\,{\it t_{18}}+0.22308199064\right)\,{\it t_{18}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{21}} &=& 0.1325688999052018\,{\it t_{19}}+1.0\\\\ 
C>   {\it t_{22}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{20}}\,{\it t_{21}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{18}}+0.10465751434\right)\,{\it t_{18}}+0.19269083139\right)\,{\it t_{18}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{19}}+1.0\right)\right)-0.0621814\,{\it t_{20}}\,{\it t_{21}}\\\\ 
C>   {\it t_{23}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{23}}^{2.0}}}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{e^{64.32793688582967\,{\it t_{22}}}}}-1.0\\\\ 
C>   {\it t_{26}} &=& {{0.2162211495206379\,{\it t_{24}}\,\sigma_{\beta\beta}}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{27}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{27}}}}\\\\ 
C>   {\it t_{29}} &=& 0.1325688999052018\,{\it t_{28}}+1.0\\\\ 
C>   {\it t_{30}} &=& \sqrt{{\it t_{27}}}\\\\ 
C>   {\it t_{31}} &=& {{1}\over{{\it t_{30}}}}\\\\ 
C>   {\it t_{32}} &=& \log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.02414199311453321\,{\it t_{31}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{33}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{34}} &=& 1.0-{\it t_{33}}\,{\it t_3}\\\\ 
C>   {\it t_{35}} &=& {\it t_{33}}\,{\it t_3}+1.0\\\\ 
C>   {\it t_{36}} &=& 0.06901399211255826\,{\it t_{28}}+1.0\\\\ 
C>   {\it t_{37}} &=& \log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.01321299881039884\,{\it t_{31}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{38}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{35}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{34}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{33}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{29}}\,{\it t_{32}}-0.0310907\,\left(0.1274696188700087\,{\it t_{28}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{30}}}\over{0.7876233178997433\,{\it t_{31}}\,\left(0.7876233178997433\,{\it t_{31}}\,\left(0.01530901310039024\,{\it t_{31}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{36}}\,{\it t_{37}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{36}}\,{\it t_{37}}\right)-0.0621814\,{\it t_{29}}\,{\it t_{32}}\\\\ 
C>   {\it t_{39}} &=& 0.5\,{\it t_{35}}^{{{2}\over{3}}}+0.5\,{\it t_{34}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{40}} &=& {\it t_{39}}^{3.0}\\\\ 
C>   {\it t_{41}} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{42}} &=& {{1}\over{{\it t_{41}}^{2.0}}}\\\\ 
C>   {\it t_{43}} &=& {{1}\over{{\it t_{39}}^{2.0}}}\\\\ 
C>   {\it t_{44}} &=& \sigma_{\beta\beta}+2.0\,\sigma_{\alpha\beta}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{e^{{{32.16396844291483\,{\it t_{38}}}\over{{\it t_{40}}}}}}}-1.0\\\\ 
C>   {\it t_{46}} &=& {{0.1362107888567592\,{\it t_{42}}\,{\it t_{43}}\,{\it t_{44}}}\over{{\it t_{45}}}}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left(\left(0.03109069086965489\,{\it t_{40}}\,\log \left({{0.1362107888567592\,{\it t_{42}}\,{\it t_{43}}\,{\it t_{44}}\,\left({\it t_{46}}+1.0\right)}\over{{{0.01855337900098064\,{\it t_{44}}^{2.0}}\over{{\it t_{41}}^{4.0}\,{\it t_{39}}^{4.0}\,{\it t_{45}}^{2.0}}}+{\it t_{46}}+1.0}}+1.0\right)+1.0\,{\it t_{38}}\right)\,\left({{0.53\,\left(0.125\,{\it t_{15}}\,\sigma_{\beta\beta}+0.125\,{\it t_2}\,\sigma_{\alpha\alpha}\right)^2}\over{\left(\tau_\beta+\tau_\alpha\right)^2}}+1.0\right)-{{0.02390625\,{\it t_{15}}\,{\it t_3}\,\sigma_{\beta\beta}^2\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{24}}\,\sigma_{\beta\beta}\,\left({\it t_{26}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{23}}^{4.0}\,{\it t_{25}}^{2.0}}}+{\it t_{26}}+1.0}}+1.0\right)+1.0\,{\it t_{22}}\right)}\over{\tau_\beta^2}}-{{0.02390625\,{\it t_2}\,{\it t_3}\,\sigma_{\alpha\alpha}^2\,\left(0.01554534543482744\,\log \left({{0.2162211495206379\,{\it t_{12}}\,\sigma_{\alpha\alpha}\,\left({\it t_{14}}+1.0\right)}\over{{{0.04675158550002605\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{11}}^{4.0}\,{\it t_{13}}^{2.0}}}+{\it t_{14}}+1.0}}+1.0\right)+1.0\,{\it t_{10}}\right)}\over{\tau_\alpha^2}}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.0\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] JP Perdew, S Kurth, A Zupan, P Blaha, Phys.Rev.Lett. 82, 2544 (1999)  , DOI: 
C> <a href="http://dx.doi.org/10.1103/PhysRevLett.82.2544 "> 
C> 10.1103/PhysRevLett.82.2544 </a> 
C> 
      subroutine nwxcm_c_pkzb99_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3,Mmat,Mmat2,Mmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,NCOL_AMAT3)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,NCOL_CMAT3)  !< [Output] The 3rd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat3(nq,NCOL_MMAT3)  !< [Output] The 3rd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      double precision nwxcm_heaviside 
      external         nwxcm_heaviside 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
