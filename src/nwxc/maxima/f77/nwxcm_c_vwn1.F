C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_vwn1.F 
C> The nwxcm_c_vwn1 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_vwn1 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {\it t_1}^{.3333333333333333}\\\\ 
C>   {\it t_3} &=& {{1}\over{\sqrt{{\it t_2}}}}\\\\ 
C>   {\it t_4} &=& 1.575246635799487\,{\it t_3}\\\\ 
C>   {\it t_5} &=& \arctan \left({{6.15199081975908}\over{{\it t_4}+3.72744}}\right)\\\\ 
C>   {\it t_6} &=& .7876233178997433\,{\it t_3}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_8} &=& .6203504908994001\,{\it t_7}\\\\ 
C>   {\it t_9} &=& {{1}\over{\left| 2.935818660072219\,{\it t_3}+{\it t_8}+12.9352\right| }}\\\\ 
C>   {\it t_{10}} &=& \log \left(1.0\,\left({\it t_6}+0.10498\right)^2\,{\it t_9}\right)\\\\ 
C>   {\it t_{11}} &=& \left| {\it t_7}\right| \\\\ 
C>   {\it t_{12}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_9}\right)\\\\ 
C>   {\it t_{13}} &=& -\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}+\rho_\alpha\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_3}+{\it t_8}+18.0578\right| }}\\\\ 
C>   {\it t_{17}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{18}} &=& {\it t_{17}}^{.3333333333333333}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\sqrt{{\it t_{18}}}}}\\\\ 
C>   {\it t_{20}} &=& 1.575246635799487\,{\it t_{19}}\\\\ 
C>   {\it t_{21}} &=& \arctan \left({{6.15199081975908}\over{{\it t_{20}}+3.72744}}\right)\\\\ 
C>   {\it t_{22}} &=& .7876233178997433\,{\it t_{19}}\\\\ 
C>   {\it t_{23}} &=& {{1}\over{{\it t_{18}}}}\\\\ 
C>   {\it t_{24}} &=& .6203504908994001\,{\it t_{23}}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{\left| 2.935818660072219\,{\it t_{19}}+{\it t_{24}}+12.9352\right| }}\\\\ 
C>   {\it t_{26}} &=& \log \left(1.0\,\left({\it t_{22}}+0.10498\right)^2\,{\it t_{25}}\right)\\\\ 
C>   {\it t_{27}} &=& \left| {\it t_{23}}\right| \\\\ 
C>   {\it t_{28}} &=& \log \left(.6203504908994001\,{\it t_{27}}\,{\it t_{25}}\right)\\\\ 
C>   {\it t_{29}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_{19}}+{\it t_{24}}+18.0578\right| }}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left(1.923661050931536\,\left(\left({\it t_{14}}\,{\it t_{15}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{14}}\,{\it t_{15}}\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{16}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_6}+0.325\right)^2\,{\it t_{16}}\right)-0.0310907\,{\it t_{12}}-9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_4}+7.06042}}\right)-.03878329487811301\,{\it t_5}\right)+0.0310907\,{\it t_{12}}+9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.03878329487811301\,{\it t_5}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{17}}\,\left(1.923661050931536\,\left(\left({{\rho_s+{\it t_{13}}}\over{{\it t_{17}}}}+1.0\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{27}}\,{\it t_{29}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_{22}}+0.325\right)^2\,{\it t_{29}}\right)-0.0310907\,{\it t_{28}}-9.690227711544375 \times 10^{-4}\,{\it t_{26}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_{20}}+7.06042}}\right)-.03878329487811301\,{\it t_{21}}\right)+0.0310907\,{\it t_{28}}+9.690227711544375 \times 10^{-4}\,{\it t_{26}}+.03878329487811301\,{\it t_{21}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] SH Vosko, L Wilk, M Nusair, Can.J.Phys. 58, 1200 (1980)  , DOI: 
C> <a href="http://dx.doi.org/10.1139/p80-159 "> 
C> 10.1139/p80-159 </a> 
C> 
      subroutine nwxcm_c_vwn1(param,tol_rho,ipol,nq,wght, 
     +rho,fnc,Amat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = 1/rhoa**1.6666666666666666d-1
            t2 = 1.4033852085886447d+0*t1+3.72744d+0
            t3 = 7.016926042943223d-1*t1+1.0498d-1
            t4 = t3**2
            t5 = rhoa**3.333333333333333d-1
            t6 = 1/t5
            t7 = 4.9237251092134837d-1*t6
            t8 = t7+2.615517080950829d+0*t1+1.29352d+1
            t9 = 1/t8
            t10 = t7+2.615517080950829d+0/t5**5.0d-1+1.29352d+1
            t11 = 1/t10
            t12 = 9.690227711544375d-4*log(1.0d+0*t4*t9)+3.10907d-2*log(
     1         4.9237251092134837d-1*t11*t6)+3.8783294878113006d-2*atan(
     2         6.15199081975908d+0/t2)
            t13 = 1/t2**2
            t14 = 1/rhoa**1.1666666666666667d+0
            t15 = 1/rhoa**1.3333333333333333d+0
            t16 = -1.6412417030711612d-1*t15-4.359195134918048d-1*t14
            fnc(iq) = 2.0d+0*rhoa*t12*wght+fnc(iq)
            Amat(iq,D1_RA) = 2.0d+0*rhoa*(9.690227711544375d-4*t8*(-2.33
     1         8975347647741d-1*t14*t3*t9-1.0d+0*t16*t4/t8**2)/t4+6.3144
     2         67057030003d-2*t10*t5*(-4.9237251092134837d-1*t16*t6/t10*
     3         *2-1.6412417030711612d-1*t11*t15)+5.580665928883042d-2*t1
     4         3*t14/(3.784699104639999d+1*t13+1))*wght+2.0d+0*t12*wght+
     5         Amat(iq,D1_RA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob+rhoa
            t2 = t1**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.5752466357994865d+0*t4
            t6 = t5+3.72744d+0
            t7 = atan(6.15199081975908d+0/t6)
            t8 = 7.876233178997433d-1*t4
            t9 = t8+1.0498d-1
            t10 = t9**2
            t11 = 1/t2
            t12 = 6.203504908994001d-1*t11
            t13 = 2.935818660072219d+0*t4+t12+1.29352d+1
            t14 = abs(t13)
            t15 = 1/t14
            t16 = log(1.0d+0*t10*t15)
            t17 = abs(t11)
            t18 = log(6.203504908994001d-1*t15*t17)
            t19 = rhoa-rhob
            t20 = 1/t1
            t21 = 1.0d+0-t19*t20
            t22 = t19*t20+1.0d+0
            t23 = t22**1.3333333333333333d+0+t21**1.3333333333333333d+0-
     1         2.0d+0
            t24 = t5+7.06042d+0
            t25 = t8+3.25d-1
            t26 = t25**2
            t27 = 5.560951426165704d+0*t4+t12+1.8057800000000002d+1
            t28 = abs(t27)
            t29 = 1/t28
            t30 = -3.8783294878113006d-2*t7+2.2478670955426108d-3*log(1.
     1         0d+0*t26*t29)+1.554535d-2*log(6.203504908994001d-1*t17*t2
     2         9)+5.249139316978092d-2*atan(4.7309269095601136d+0/t24)-3
     3         .10907d-2*t18-9.690227711544375d-4*t16
            t31 = 3.8783294878113006d-2*t7+1.923661050931536d+0*t23*t30+
     1         3.10907d-2*t18+9.690227711544375d-4*t16
            t32 = 1/t1**6.666666666666667d-1
            t33 = 1/t3**3
            t34 = 1/t6**2
            t35 = 1/(3.784699104639999d+1*t34+1)
            t36 = 6.264085709464389d-2*t32*t33*t34*t35
            t37 = 1/t10
            t38 = -2.067834969664667d-1/t1**1.3333333333333333d+0
            t39 = t38-4.8930311001203647d-1*t32*t33
            t40 = 1/t13
            t41 = -2.625411059665811d-1*t15*t32*t33*t9-1.0d+0*t10*t15*t3
     1         9*t40
            t42 = 9.690227711544375d-4*t14*t37*t41
            t43 = 1/t17
            t44 = 1/t1**1.6666666666666666d+0
            t45 = -2.067834969664667d-1*t15*t43*t44-6.203504908994001d-1
     1         *t15*t17*t39*t40
            t46 = 5.011795824473985d-2*t14*t43*t45
            t47 = 1/t24**2
            t48 = t38-9.26825237694284d-1*t32*t33
            t49 = 1/t27
            t50 = 1.923661050931536d+0*t23*(2.2478670955426108d-3*t28*(-
     1         1.0d+0*t26*t29*t48*t49-2.625411059665811d-1*t25*t29*t32*t
     2         33)/t26+2.5058979122369923d-2*t28*t43*(-6.203504908994001
     3         d-1*t17*t29*t48*t49-2.067834969664667d-1*t29*t43*t44)+6.5
     4         19760588836059d-2*t32*t33*t47/(2.238166942360001d+1*t47+1
     5         )-5.011795824473985d-2*t14*t43*t45-9.690227711544375d-4*t
     6         14*t37*t41-6.264085709464389d-2*t32*t33*t34*t35)
            t51 = 1/t1**2
            t52 = t19*t51
            t53 = -t20
            t54 = t21**3.333333333333333d-1
            t55 = -t19*t51
            t56 = t22**3.333333333333333d-1
            t57 = 1.0d+0*t31*wght
            fnc(iq) = 1.0d+0*t1*t31*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*(1.923661050931536d+0*t30*(1.3333
     1         333333333333d+0*(t55+t20)*t56+1.3333333333333333d+0*(t53+
     2         t52)*t54)+t50+t46+t42+t36)*wght+t57+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = 1.0d+0*t1*(1.923661050931536d+0*t30*(1.3333
     1         333333333333d+0*(t55+t53)*t56+1.3333333333333333d+0*(t52+
     2         t20)*t54)+t50+t46+t42+t36)*wght+t57+Amat(iq,D1_RB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = rhob+rhoa
            t2 = t1**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.5752466357994865d+0*t4
            t6 = t5+3.72744d+0
            t7 = atan(6.15199081975908d+0/t6)
            t8 = 7.876233178997433d-1*t4
            t9 = t8+1.0498d-1
            t10 = t9**2
            t11 = 1/t2
            t12 = 6.203504908994001d-1*t11
            t13 = 2.935818660072219d+0*t4+t12+1.29352d+1
            t14 = abs(t13)
            t15 = 1/t14
            t16 = log(1.0d+0*t10*t15)
            t17 = abs(t11)
            t18 = log(6.203504908994001d-1*t15*t17)
            t19 = rhoa-rhob
            t20 = 1/t1
            t21 = t19*t20+1.0d+0
            t22 = t21**1.3333333333333333d+0-2.0d+0
            t23 = t5+7.06042d+0
            t24 = t8+3.25d-1
            t25 = t24**2
            t26 = 5.560951426165704d+0*t4+t12+1.8057800000000002d+1
            t27 = abs(t26)
            t28 = 1/t27
            t29 = -3.8783294878113006d-2*t7+2.2478670955426108d-3*log(1.
     1         0d+0*t25*t28)+1.554535d-2*log(6.203504908994001d-1*t17*t2
     2         8)+5.249139316978092d-2*atan(4.7309269095601136d+0/t23)-3
     3         .10907d-2*t18-9.690227711544375d-4*t16
            t30 = 3.8783294878113006d-2*t7+1.923661050931536d+0*t22*t29+
     1         3.10907d-2*t18+9.690227711544375d-4*t16
            t31 = 1/t1**6.666666666666667d-1
            t32 = 1/t3**3
            t33 = 1/t6**2
            t34 = 1/(3.784699104639999d+1*t33+1)
            t35 = 1/t10
            t36 = -2.067834969664667d-1/t1**1.3333333333333333d+0
            t37 = t36-4.8930311001203647d-1*t31*t32
            t38 = 1/t13
            t39 = -2.625411059665811d-1*t15*t31*t32*t9-1.0d+0*t10*t15*t3
     1         7*t38
            t40 = 1/t17
            t41 = 1/t1**1.6666666666666666d+0
            t42 = -2.067834969664667d-1*t15*t40*t41-6.203504908994001d-1
     1         *t15*t17*t37*t38
            t43 = 1/t23**2
            t44 = t36-9.26825237694284d-1*t31*t32
            t45 = 1/t26
            fnc(iq) = 1.0d+0*t1*t30*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*(1.923661050931536d+0*t22*(2.2478
     1         670955426108d-3*t27*(-1.0d+0*t25*t28*t44*t45-2.6254110596
     2         65811d-1*t24*t28*t31*t32)/t25+2.5058979122369923d-2*t27*t
     3         40*(-6.203504908994001d-1*t17*t28*t44*t45-2.0678349696646
     4         67d-1*t28*t40*t41)+6.519760588836059d-2*t31*t32*t43/(2.23
     5         8166942360001d+1*t43+1)-5.011795824473985d-2*t14*t40*t42-
     6         9.690227711544375d-4*t14*t35*t39-6.264085709464389d-2*t31
     7         *t32*t33*t34)+5.011795824473985d-2*t14*t40*t42+9.69022771
     8         1544375d-4*t14*t35*t39+6.264085709464389d-2*t31*t32*t33*t
     9         34+2.564881401242048d+0*(t20-t19/t1**2)*t21**3.3333333333
     :         33333d-1*t29)*wght+1.0d+0*t30*wght+Amat(iq,D1_RA)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhob**1.6666666666666666d-1
            t2 = 1.4033852085886447d+0*t1
            t3 = t2+3.72744d+0
            t4 = atan(6.15199081975908d+0/t3)
            t5 = 7.016926042943223d-1*t1
            t6 = t5+1.0498d-1
            t7 = t6**2
            t8 = rhob**3.333333333333333d-1
            t9 = 1/t8
            t10 = 4.9237251092134837d-1*t9
            t11 = t10+2.615517080950829d+0*t1+1.29352d+1
            t12 = 1/t11
            t13 = log(1.0d+0*t12*t7)
            t14 = 2.615517080950829d+0/t8**5.0d-1+t10+1.29352d+1
            t15 = 1/t14
            t16 = t2+7.06042d+0
            t17 = t5+3.25d-1
            t18 = t17**2
            t19 = t10+4.954244497211719d+0*t1+1.8057800000000002d+1
            t20 = 1/t19
            t21 = -1.923661050931536d+0*(1.554535d-2*log(4.9237251092134
     1         837d-1*t20*t9)-3.10907d-2*log(4.9237251092134837d-1*t12*t
     2         9)-3.8783294878113006d-2*t4+2.2478670955426108d-3*log(1.0
     3         d+0*t18*t20)+5.249139316978092d-2*atan(4.7309269095601136
     4         d+0/t16)-9.690227711544375d-4*t13)+3.10907d-2*log(4.92372
     5         51092134837d-1*t15*t9)+3.8783294878113006d-2*t4+9.6902277
     6         11544375d-4*t13
            t22 = 1/t3**2
            t23 = 1/(3.784699104639999d+1*t22+1)
            t24 = 1/rhob**1.1666666666666667d+0
            t25 = 1/rhob**1.3333333333333333d+0
            t26 = -1.6412417030711612d-1*t25
            t27 = t26-4.359195134918048d-1*t24
            t28 = 1/t11**2
            t29 = -1.0d+0*t27*t28*t7-2.338975347647741d-1*t12*t24*t6
            t30 = 1/t7
            t31 = 1/t16**2
            t32 = t26-8.257074162019531d-1*t24
            t33 = 1/t19**2
            fnc(iq) = 2.0d+0*rhob*t21*wght+fnc(iq)
            Amat(iq,D1_RB) = 2.0d+0*rhob*(-1.923661050931536d+0*(3.15723
     1         35285150016d-2*t19*t8*(-4.9237251092134837d-1*t32*t33*t9-
     2         1.6412417030711612d-1*t20*t25)-6.314467057030003d-2*t11*t
     3         8*(-4.9237251092134837d-1*t27*t28*t9-1.6412417030711612d-
     4         1*t12*t25)+2.2478670955426108d-3*t19*(-1.0d+0*t18*t32*t33
     5         -2.338975347647741d-1*t17*t20*t24)/t18+5.808446351175949d
     6         -2*t24*t31/(2.238166942360001d+1*t31+1)-9.690227711544375
     7         d-4*t11*t29*t30-5.580665928883042d-2*t22*t23*t24)+6.31446
     8         7057030003d-2*t14*t8*(-4.9237251092134837d-1*t27*t9/t14**
     9         2-1.6412417030711612d-1*t15*t25)+9.690227711544375d-4*t11
     :         *t29*t30+5.580665928883042d-2*t22*t23*t24)*wght+2.0d+0*t2
     ;         1*wght+Amat(iq,D1_RB)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_vwn1 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {\it t_1}^{.3333333333333333}\\\\ 
C>   {\it t_3} &=& {{1}\over{\sqrt{{\it t_2}}}}\\\\ 
C>   {\it t_4} &=& 1.575246635799487\,{\it t_3}\\\\ 
C>   {\it t_5} &=& \arctan \left({{6.15199081975908}\over{{\it t_4}+3.72744}}\right)\\\\ 
C>   {\it t_6} &=& .7876233178997433\,{\it t_3}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_8} &=& .6203504908994001\,{\it t_7}\\\\ 
C>   {\it t_9} &=& {{1}\over{\left| 2.935818660072219\,{\it t_3}+{\it t_8}+12.9352\right| }}\\\\ 
C>   {\it t_{10}} &=& \log \left(1.0\,\left({\it t_6}+0.10498\right)^2\,{\it t_9}\right)\\\\ 
C>   {\it t_{11}} &=& \left| {\it t_7}\right| \\\\ 
C>   {\it t_{12}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_9}\right)\\\\ 
C>   {\it t_{13}} &=& -\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}+\rho_\alpha\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_3}+{\it t_8}+18.0578\right| }}\\\\ 
C>   {\it t_{17}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{18}} &=& {\it t_{17}}^{.3333333333333333}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\sqrt{{\it t_{18}}}}}\\\\ 
C>   {\it t_{20}} &=& 1.575246635799487\,{\it t_{19}}\\\\ 
C>   {\it t_{21}} &=& \arctan \left({{6.15199081975908}\over{{\it t_{20}}+3.72744}}\right)\\\\ 
C>   {\it t_{22}} &=& .7876233178997433\,{\it t_{19}}\\\\ 
C>   {\it t_{23}} &=& {{1}\over{{\it t_{18}}}}\\\\ 
C>   {\it t_{24}} &=& .6203504908994001\,{\it t_{23}}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{\left| 2.935818660072219\,{\it t_{19}}+{\it t_{24}}+12.9352\right| }}\\\\ 
C>   {\it t_{26}} &=& \log \left(1.0\,\left({\it t_{22}}+0.10498\right)^2\,{\it t_{25}}\right)\\\\ 
C>   {\it t_{27}} &=& \left| {\it t_{23}}\right| \\\\ 
C>   {\it t_{28}} &=& \log \left(.6203504908994001\,{\it t_{27}}\,{\it t_{25}}\right)\\\\ 
C>   {\it t_{29}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_{19}}+{\it t_{24}}+18.0578\right| }}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left(1.923661050931536\,\left(\left({\it t_{14}}\,{\it t_{15}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{14}}\,{\it t_{15}}\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{16}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_6}+0.325\right)^2\,{\it t_{16}}\right)-0.0310907\,{\it t_{12}}-9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_4}+7.06042}}\right)-.03878329487811301\,{\it t_5}\right)+0.0310907\,{\it t_{12}}+9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.03878329487811301\,{\it t_5}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{17}}\,\left(1.923661050931536\,\left(\left({{\rho_s+{\it t_{13}}}\over{{\it t_{17}}}}+1.0\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{27}}\,{\it t_{29}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_{22}}+0.325\right)^2\,{\it t_{29}}\right)-0.0310907\,{\it t_{28}}-9.690227711544375 \times 10^{-4}\,{\it t_{26}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_{20}}+7.06042}}\right)-.03878329487811301\,{\it t_{21}}\right)+0.0310907\,{\it t_{28}}+9.690227711544375 \times 10^{-4}\,{\it t_{26}}+.03878329487811301\,{\it t_{21}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] SH Vosko, L Wilk, M Nusair, Can.J.Phys. 58, 1200 (1980)  , DOI: 
C> <a href="http://dx.doi.org/10.1139/p80-159 "> 
C> 10.1139/p80-159 </a> 
C> 
      subroutine nwxcm_c_vwn1_d2(param,tol_rho,ipol,nq,wght, 
     +rho,fnc,Amat,Amat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
c 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = 1/rhoa**1.6666666666666666d-1
            t2 = 1.4033852085886447d+0*t1+3.72744d+0
            t3 = 7.016926042943223d-1*t1+1.0498d-1
            t4 = t3**2
            t5 = rhoa**3.333333333333333d-1
            t6 = 1/t5
            t7 = 4.9237251092134837d-1*t6
            t8 = t7+2.615517080950829d+0*t1+1.29352d+1
            t9 = 1/t8
            t10 = t7+2.615517080950829d+0/t5**5.0d-1+1.29352d+1
            t11 = 1/t10
            t12 = 9.690227711544375d-4*log(1.0d+0*t4*t9)+3.10907d-2*log(
     1         4.9237251092134837d-1*t11*t6)+3.8783294878113006d-2*atan(
     2         6.15199081975908d+0/t2)
            t13 = 1/t2**2
            t14 = 3.784699104639999d+1*t13+1
            t15 = 1/t14
            t16 = 1/rhoa**1.1666666666666667d+0
            t17 = 5.580665928883042d-2*t13*t15*t16
            t18 = 1/rhoa**1.3333333333333333d+0
            t19 = -1.6412417030711612d-1*t18-4.359195134918048d-1*t16
            t20 = 1/t8**2
            t21 = -2.338975347647741d-1*t16*t3*t9-1.0d+0*t19*t20*t4
            t22 = 1/t4
            t23 = 9.690227711544375d-4*t21*t22*t8
            t24 = 1/t10**2
            t25 = -4.9237251092134837d-1*t19*t24*t6-1.6412417030711612d-
     1         1*t11*t18
            t26 = 6.314467057030003d-2*t10*t25*t5+t23+t17
            t27 = 9.690227711544375d-4*t19*t21*t22
            t28 = 1/rhoa**2.3333333333333334d+0
            t29 = -9.88036578371829d-1*t28/(t14**2*t2**5)
            t30 = 2.610608006223023d-2*t15*t28/t2**3
            t31 = 1/rhoa**2.166666666666667d+0
            t32 = -6.510776917030215d-2*t13*t15*t31
            t33 = 2.2665203730395278d-4*t16*t21*t8/t3**3
            t34 = 1/rhoa**6.666666666666667d-1
            t35 = t19**2
            t36 = 1/t8**3
            t37 = 1/rhoa**2.333333333333333d+0
            t38 = 2.1883222707615482d-1*t37+5.08572765740439d-1*t31
            t39 = 9.690227711544375d-4*t22*t8*(2.728804572255698d-1*t3*t
     1         31*t9+2.735402838451935d-2*t28*t9-1.0d+0*t20*t38*t4+2.0d+
     2         0*t35*t36*t4+4.677950695295482d-1*t16*t19*t20*t3)
            t40 = -1.6412417030711612d-1*t18*t9-4.9237251092134837d-1*t1
     1         9*t20*t6
            fnc(iq) = 2.0d+0*rhoa*t12*wght+fnc(iq)
            Amat(iq,D1_RA) = 2.0d+0*rhoa*t26*wght+2.0d+0*t12*wght+Amat(i
     1         q,D1_RA)
            Amat2(iq,D2_RA_RA) = 2.0d+0*rhoa*(6.314467057030003d-2*t10*t
     1         5*(-4.9237251092134837d-1*t24*t38*t6+9.847450218426967d-1
     2         *t35*t6/t10**3+2.1883222707615482d-1*t11*t37+3.2824834061
     3         423225d-1*t18*t19*t24)+6.314467057030003d-2*t19*t25*t5+t3
     4         9+2.1048223523433343d-2*t10*t25*t34+t33+t32+t30+t29+t27)*
     5         wght+4.0d+0*t26*wght+Amat2(iq,D2_RA_RA)
            Amat2(iq,D2_RA_RB) = 2.0d+0*rhoa*(6.314467057030003d-2*t5*t8
     1         *(2.1883222707615482d-1*t37*t9-4.9237251092134837d-1*t20*
     2         t38*t6+9.847450218426967d-1*t35*t36*t6+3.2824834061423225
     3         d-1*t18*t19*t20)+2.1048223523433343d-2*t34*t40*t8+6.31446
     4         7057030003d-2*t19*t40*t5+t39+t33+t32+t30+t29+t27)*wght+4.
     5         0d+0*(6.314467057030003d-2*t40*t5*t8+t23+t17)*wght+Amat2(
     6         iq,D2_RA_RB)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob+rhoa
            t2 = t1**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.5752466357994865d+0*t4
            t6 = t5+3.72744d+0
            t7 = atan(6.15199081975908d+0/t6)
            t8 = 7.876233178997433d-1*t4
            t9 = t8+1.0498d-1
            t10 = t9**2
            t11 = 1/t2
            t12 = 6.203504908994001d-1*t11
            t13 = 2.935818660072219d+0*t4+t12+1.29352d+1
            t14 = abs(t13)
            t15 = 1/t14
            t16 = log(1.0d+0*t10*t15)
            t17 = abs(t11)
            t18 = log(6.203504908994001d-1*t15*t17)
            t19 = rhoa-rhob
            t20 = 1/t1
            t21 = 1.0d+0-t19*t20
            t22 = t19*t20+1.0d+0
            t23 = t22**1.3333333333333333d+0+t21**1.3333333333333333d+0-
     1         2.0d+0
            t24 = t5+7.06042d+0
            t25 = t8+3.25d-1
            t26 = t25**2
            t27 = 5.560951426165704d+0*t4+t12+1.8057800000000002d+1
            t28 = abs(t27)
            t29 = 1/t28
            t30 = -3.8783294878113006d-2*t7+2.2478670955426108d-3*log(1.
     1         0d+0*t26*t29)+1.554535d-2*log(6.203504908994001d-1*t17*t2
     2         9)+5.249139316978092d-2*atan(4.7309269095601136d+0/t24)-3
     3         .10907d-2*t18-9.690227711544375d-4*t16
            t31 = 3.8783294878113006d-2*t7+1.923661050931536d+0*t23*t30+
     1         3.10907d-2*t18+9.690227711544375d-4*t16
            t32 = 1/t1**6.666666666666667d-1
            t33 = 1/t3**3
            t34 = 1/t6**2
            t35 = 3.784699104639999d+1*t34+1
            t36 = 1/t35
            t37 = 6.264085709464389d-2*t32*t33*t34*t36
            t38 = 1/t10
            t39 = -2.067834969664667d-1/t1**1.3333333333333333d+0
            t40 = t39-4.8930311001203647d-1*t32*t33
            t41 = 1/t13
            t42 = -2.625411059665811d-1*t15*t32*t33*t9-1.0d+0*t10*t15*t4
     1         0*t41
            t43 = 9.690227711544375d-4*t14*t38*t42
            t44 = 1/t17
            t45 = 1/t1**1.6666666666666666d+0
            t46 = -2.067834969664667d-1*t15*t44*t45-6.203504908994001d-1
     1         *t15*t17*t40*t41
            t47 = 5.011795824473985d-2*t14*t44*t46
            t48 = 1/t24**2
            t49 = 2.238166942360001d+1*t48+1
            t50 = 1/t49
            t51 = 1/t26
            t52 = t39-9.26825237694284d-1*t32*t33
            t53 = 1/t27
            t54 = -1.0d+0*t26*t29*t52*t53-2.625411059665811d-1*t25*t29*t
     1         32*t33
            t55 = -6.203504908994001d-1*t17*t29*t52*t53-2.06783496966466
     1         7d-1*t29*t44*t45
            t56 = 2.5058979122369923d-2*t28*t44*t55+2.2478670955426108d-
     1         3*t28*t51*t54+6.519760588836059d-2*t32*t33*t48*t50-5.0117
     2         95824473985d-2*t14*t44*t46-9.690227711544375d-4*t14*t38*t
     3         42-6.264085709464389d-2*t32*t33*t34*t36
            t57 = 1.923661050931536d+0*t23*t56
            t58 = 1/t1**2
            t59 = t19*t58
            t60 = -t20
            t61 = t60+t59
            t62 = t21**3.333333333333333d-1
            t63 = -t19*t58
            t64 = t63+t20
            t65 = t22**3.333333333333333d-1
            t66 = 1.3333333333333333d+0*t64*t65+1.3333333333333333d+0*t6
     1         1*t62
            t67 = 1.923661050931536d+0*t30*t66+t57+t47+t43+t37
            t68 = 1.0d+0*t31*wght
            t69 = t59+t20
            t70 = t63+t60
            t71 = 1.3333333333333333d+0*t65*t70+1.3333333333333333d+0*t6
     1         2*t69
            t72 = 1.923661050931536d+0*t30*t71+t57+t47+t43+t37
            t73 = 1/t1**2.3333333333333334d+0
            t74 = 1/t6**5
            t75 = 1/t35**2
            t76 = -1.2448480831567728d+0*t73*t74*t75
            t77 = 1/t6**3
            t78 = 3.289159980064472d-2*t36*t73*t77
            t79 = 1/t1**1.3333333333333336d+0
            t80 = 1/t3**5
            t81 = -3.1320428547321943d-2*t34*t36*t79*t80
            t82 = 1/t1**1.6666666666666669d+0
            t83 = -4.176057139642926d-2*t33*t34*t36*t82
            t84 = 9.690227711544375d-4*t13*t15*t38*t40*t42
            t85 = 5.011795824473985d-2*t13*t15*t40*t44*t46
            t86 = t40**2
            t87 = 1/t13**2
            t88 = 2.7571132928862224d-1/t1**2.333333333333333d+0
            t89 = t88+3.262020733413577d-1*t33*t82+2.4465155500601823d-1
     1         *t79*t80
            t90 = 1.7502740397772074d-1*t15*t33*t82*t9+1.312705529832905
     1         4d-1*t15*t79*t80*t9+5.250822119331622d-1*t15*t32*t33*t40*
     2         t41*t9-1.0d+0*t10*t15*t41*t89+2.0d+0*t10*t15*t86*t87+3.44
     3         6391616107778d-2*t15*t73
            t91 = 9.690227711544375d-4*t14*t38*t90
            t92 = 1/t9**3
            t93 = 2.544083100456872d-4*t14*t32*t33*t42*t92
            t94 = 1/t1**2.6666666666666666d+0
            t95 = 2.7571132928862224d-1*t15*t44*t94-6.203504908994001d-1
     1         *t15*t17*t41*t89+1.2407009817988002d+0*t15*t17*t86*t87+4.
     2         135669939329334d-1*t15*t40*t41*t44*t45
            t96 = 5.011795824473985d-2*t14*t44*t95
            t97 = 1/t1**9.999999999999999d-1
            t98 = 1.670598608157995d-2*t14*t44*t46*t97
            t99 = t52**2
            t100 = 1/t27**2
            t101 = t88+6.178834917961894d-1*t33*t82+4.63412618847142d-1*
     1         t79*t80
            t102 = 1.923661050931536d+0*t23*(2.2478670955426108d-3*t28*t
     1         51*(2.0d+0*t100*t26*t29*t99+1.7502740397772074d-1*t25*t29
     2         *t33*t82+1.3127055298329054d-1*t25*t29*t79*t80+3.44639161
     3         6107778d-2*t29*t73+5.250822119331622d-1*t25*t29*t32*t33*t
     4         52*t53-1.0d+0*t101*t26*t29*t53)+2.5058979122369923d-2*t28
     5         *t44*(1.2407009817988002d+0*t100*t17*t29*t99+2.7571132928
     6         862224d-1*t29*t44*t94+4.135669939329334d-1*t29*t44*t45*t5
     7         2*t53-6.203504908994001d-1*t101*t17*t29*t53)+8.3529930407
     8         89976d-3*t28*t44*t55*t97-1.670598608157995d-2*t14*t44*t46
     9         *t97-5.011795824473985d-2*t14*t44*t95-2.544083100456872d-
     :         4*t14*t32*t33*t42*t92-9.690227711544375d-4*t14*t38*t90-4.
     ;         3465070592240396d-2*t33*t48*t50*t82+4.176057139642926d-2*
     <         t33*t34*t36*t82-3.2598802944180294d-2*t48*t50*t79*t80+3.1
     =         320428547321943d-2*t34*t36*t79*t80-3.289159980064472d-2*t
     >         36*t73*t77+1.2448480831567728d+0*t73*t74*t75+3.4234103112
     ?         606934d-2*t50*t73/t24**3-7.662163788798045d-1*t73/(t24**5
     @         *t49**2)+2.5058979122369923d-2*t27*t29*t44*t52*t55+2.2478
     1         670955426108d-3*t27*t29*t51*t52*t54+5.901575133296435d-4*
     2         t28*t32*t33*t54/t25**3-5.011795824473985d-2*t13*t15*t40*t
     3         44*t46-9.690227711544375d-4*t13*t15*t38*t40*t42)
            t103 = 1/t21**6.666666666666666d-1
            t104 = 1/t1**3
            t105 = -2*t104*t19
            t106 = 2*t58
            t107 = 1/t22**6.666666666666666d-1
            t108 = 2*t104*t19
            t109 = -2*t58
            fnc(iq) = 1.0d+0*t1*t31*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*t67*wght+t68+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = 1.0d+0*t1*t72*wght+t68+Amat(iq,D1_RB)
            Amat2(iq,D2_RA_RA) = 1.0d+0*t1*(t98+t96+t93+t91+t85+t84+t83+
     1         t81+t78+t76+3.847322101863072d+0*t56*t66+1.92366105093153
     2         6d+0*t30*(1.3333333333333333d+0*(t109+t108)*t65+4.4444444
     3         44444444d-1*t107*t64**2+1.3333333333333333d+0*(t106+t105)
     4         *t62+4.444444444444444d-1*t103*t61**2)+t102)*wght+2.0d+0*
     5         t67*wght+Amat2(iq,D2_RA_RA)
            Amat2(iq,D2_RA_RB) = 1.0d+0*t1*(t98+t96+t93+t91+t85+t84+t83+
     1         t81+t78+t76+1.923661050931536d+0*t56*t71+1.92366105093153
     2         6d+0*t30*(4.444444444444444d-1*t107*t64*t70+4.44444444444
     3         4444d-1*t103*t61*t69+2.6666666666666666d+0*t104*t19*t65-2
     4         .6666666666666666d+0*t104*t19*t62)+1.923661050931536d+0*t
     5         56*t66+t102)*wght+1.0d+0*t72*wght+1.0d+0*t67*wght+Amat2(i
     6         q,D2_RA_RB)
            Amat2(iq,D2_RB_RB) = 1.0d+0*t1*(t98+t96+t93+t91+t85+t84+t83+
     1         t81+t78+t76+3.847322101863072d+0*t56*t71+1.92366105093153
     2         6d+0*t30*(4.444444444444444d-1*t107*t70**2+4.444444444444
     3         444d-1*t103*t69**2+1.3333333333333333d+0*(t108+t106)*t65+
     4         1.3333333333333333d+0*(t109+t105)*t62)+t102)*wght+2.0d+0*
     5         t72*wght+Amat2(iq,D2_RB_RB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = rhob+rhoa
            t2 = t1**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.5752466357994865d+0*t4
            t6 = t5+3.72744d+0
            t7 = atan(6.15199081975908d+0/t6)
            t8 = 7.876233178997433d-1*t4
            t9 = t8+1.0498d-1
            t10 = t9**2
            t11 = 1/t2
            t12 = 6.203504908994001d-1*t11
            t13 = 2.935818660072219d+0*t4+t12+1.29352d+1
            t14 = abs(t13)
            t15 = 1/t14
            t16 = log(1.0d+0*t10*t15)
            t17 = abs(t11)
            t18 = log(6.203504908994001d-1*t15*t17)
            t19 = rhoa-rhob
            t20 = 1/t1
            t21 = t19*t20+1.0d+0
            t22 = t21**1.3333333333333333d+0-2.0d+0
            t23 = t5+7.06042d+0
            t24 = t8+3.25d-1
            t25 = t24**2
            t26 = 5.560951426165704d+0*t4+t12+1.8057800000000002d+1
            t27 = abs(t26)
            t28 = 1/t27
            t29 = -3.8783294878113006d-2*t7+2.2478670955426108d-3*log(1.
     1         0d+0*t25*t28)+1.554535d-2*log(6.203504908994001d-1*t17*t2
     2         8)+5.249139316978092d-2*atan(4.7309269095601136d+0/t23)-3
     3         .10907d-2*t18-9.690227711544375d-4*t16
            t30 = 3.8783294878113006d-2*t7+1.923661050931536d+0*t22*t29+
     1         3.10907d-2*t18+9.690227711544375d-4*t16
            t31 = 1/t1**6.666666666666667d-1
            t32 = 1/t3**3
            t33 = 1/t6**2
            t34 = 3.784699104639999d+1*t33+1
            t35 = 1/t34
            t36 = 1/t10
            t37 = -2.067834969664667d-1/t1**1.3333333333333333d+0
            t38 = t37-4.8930311001203647d-1*t31*t32
            t39 = 1/t13
            t40 = -2.625411059665811d-1*t15*t31*t32*t9-1.0d+0*t10*t15*t3
     1         8*t39
            t41 = 1/t17
            t42 = 1/t1**1.6666666666666666d+0
            t43 = -2.067834969664667d-1*t15*t41*t42-6.203504908994001d-1
     1         *t15*t17*t38*t39
            t44 = 1/t23**2
            t45 = 2.238166942360001d+1*t44+1
            t46 = 1/t45
            t47 = 1/t25
            t48 = t37-9.26825237694284d-1*t31*t32
            t49 = 1/t26
            t50 = -1.0d+0*t25*t28*t48*t49-2.625411059665811d-1*t24*t28*t
     1         31*t32
            t51 = -6.203504908994001d-1*t17*t28*t48*t49-2.06783496966466
     1         7d-1*t28*t41*t42
            t52 = 2.5058979122369923d-2*t27*t41*t51+2.2478670955426108d-
     1         3*t27*t47*t50+6.519760588836059d-2*t31*t32*t44*t46-5.0117
     2         95824473985d-2*t14*t41*t43-9.690227711544375d-4*t14*t36*t
     3         40-6.264085709464389d-2*t31*t32*t33*t35
            t53 = 1/t1**2
            t54 = t20-t19*t53
            t55 = t21**3.333333333333333d-1
            t56 = 2.564881401242048d+0*t29*t54*t55+1.923661050931536d+0*
     1         t22*t52+5.011795824473985d-2*t14*t41*t43+9.69022771154437
     2         5d-4*t14*t36*t40+6.264085709464389d-2*t31*t32*t33*t35
            t57 = 1/t1**2.3333333333333334d+0
            t58 = 1/t6**5
            t59 = 1/t34**2
            t60 = 1/t6**3
            t61 = 1/t1**1.3333333333333336d+0
            t62 = 1/t3**5
            t63 = 1/t1**1.6666666666666669d+0
            t64 = t38**2
            t65 = 1/t13**2
            t66 = 2.7571132928862224d-1/t1**2.333333333333333d+0
            t67 = t66+3.262020733413577d-1*t32*t63+2.4465155500601823d-1
     1         *t61*t62
            t68 = 1.7502740397772074d-1*t15*t32*t63*t9+1.312705529832905
     1         4d-1*t15*t61*t62*t9+5.250822119331622d-1*t15*t31*t32*t38*
     2         t39*t9-1.0d+0*t10*t15*t39*t67+2.0d+0*t10*t15*t64*t65+3.44
     3         6391616107778d-2*t15*t57
            t69 = 1/t9**3
            t70 = 1/t1**2.6666666666666666d+0
            t71 = 2.7571132928862224d-1*t15*t41*t70-6.203504908994001d-1
     1         *t15*t17*t39*t67+1.2407009817988002d+0*t15*t17*t64*t65+4.
     2         135669939329334d-1*t15*t38*t39*t41*t42
            t72 = 1/t1**9.999999999999999d-1
            t73 = t48**2
            t74 = 1/t26**2
            t75 = t66+6.178834917961894d-1*t32*t63+4.63412618847142d-1*t
     1         61*t62
            fnc(iq) = 1.0d+0*t1*t30*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*t56*wght+1.0d+0*t30*wght+Amat(iq,
     1         D1_RA)
            Amat2(iq,D2_RA_RA) = 1.0d+0*t1*(1.923661050931536d+0*t22*(2.
     1         2478670955426108d-3*t27*t47*(-1.0d+0*t25*t28*t49*t75+2.0d
     2         +0*t25*t28*t73*t74+1.7502740397772074d-1*t24*t28*t32*t63+
     3         1.3127055298329054d-1*t24*t28*t61*t62+3.446391616107778d-
     4         2*t28*t57+5.250822119331622d-1*t24*t28*t31*t32*t48*t49)+2
     5         .5058979122369923d-2*t27*t41*(-6.203504908994001d-1*t17*t
     6         28*t49*t75+1.2407009817988002d+0*t17*t28*t73*t74+2.757113
     7         2928862224d-1*t28*t41*t70+4.135669939329334d-1*t28*t41*t4
     8         2*t48*t49)+8.352993040789976d-3*t27*t41*t51*t72-1.6705986
     9         08157995d-2*t14*t41*t43*t72-5.011795824473985d-2*t14*t41*
     :         t71-2.544083100456872d-4*t14*t31*t32*t40*t69-9.6902277115
     ;         44375d-4*t14*t36*t68-4.3465070592240396d-2*t32*t44*t46*t6
     <         3+4.176057139642926d-2*t32*t33*t35*t63-3.2598802944180294
     =         d-2*t44*t46*t61*t62+3.1320428547321943d-2*t33*t35*t61*t62
     >         -3.289159980064472d-2*t35*t57*t60+1.2448480831567728d+0*t
     ?         57*t58*t59+3.4234103112606934d-2*t46*t57/t23**3-7.6621637
     @         88798045d-1*t57/(t23**5*t45**2)+2.5058979122369923d-2*t26
     1         *t28*t41*t48*t51+2.2478670955426108d-3*t26*t28*t47*t48*t5
     2         0+5.901575133296435d-4*t27*t31*t32*t50/t24**3-5.011795824
     3         473985d-2*t13*t15*t38*t41*t43-9.690227711544375d-4*t13*t1
     4         5*t36*t38*t40)+1.670598608157995d-2*t14*t41*t43*t72+5.011
     5         795824473985d-2*t14*t41*t71+2.544083100456872d-4*t14*t31*
     6         t32*t40*t69+9.690227711544375d-4*t14*t36*t68-4.1760571396
     7         42926d-2*t32*t33*t35*t63-3.1320428547321943d-2*t33*t35*t6
     8         1*t62+3.289159980064472d-2*t35*t57*t60-1.2448480831567728
     9         d+0*t57*t58*t59+5.129762802484096d+0*t52*t54*t55+2.564881
     :         401242048d+0*t29*(2*t19/t1**3-2*t53)*t55+8.54960467080682
     ;         5d-1*t29*t54**2/t21**6.666666666666666d-1+5.0117958244739
     <         85d-2*t13*t15*t38*t41*t43+9.690227711544375d-4*t13*t15*t3
     =         6*t38*t40)*wght+2.0d+0*t56*wght+Amat2(iq,D2_RA_RA)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhob**1.6666666666666666d-1
            t2 = 1.4033852085886447d+0*t1
            t3 = t2+3.72744d+0
            t4 = atan(6.15199081975908d+0/t3)
            t5 = 7.016926042943223d-1*t1
            t6 = t5+1.0498d-1
            t7 = t6**2
            t8 = rhob**3.333333333333333d-1
            t9 = 1/t8
            t10 = 4.9237251092134837d-1*t9
            t11 = t10+2.615517080950829d+0*t1+1.29352d+1
            t12 = 1/t11
            t13 = log(1.0d+0*t12*t7)
            t14 = 2.615517080950829d+0/t8**5.0d-1+t10+1.29352d+1
            t15 = 1/t14
            t16 = t2+7.06042d+0
            t17 = t5+3.25d-1
            t18 = t17**2
            t19 = t10+4.954244497211719d+0*t1+1.8057800000000002d+1
            t20 = 1/t19
            t21 = -1.923661050931536d+0*(1.554535d-2*log(4.9237251092134
     1         837d-1*t20*t9)-3.10907d-2*log(4.9237251092134837d-1*t12*t
     2         9)-3.8783294878113006d-2*t4+2.2478670955426108d-3*log(1.0
     3         d+0*t18*t20)+5.249139316978092d-2*atan(4.7309269095601136
     4         d+0/t16)-9.690227711544375d-4*t13)+3.10907d-2*log(4.92372
     5         51092134837d-1*t15*t9)+3.8783294878113006d-2*t4+9.6902277
     6         11544375d-4*t13
            t22 = 1/t3**2
            t23 = 3.784699104639999d+1*t22+1
            t24 = 1/t23
            t25 = 1/rhob**1.1666666666666667d+0
            t26 = 1/rhob**1.3333333333333333d+0
            t27 = -1.6412417030711612d-1*t26
            t28 = t27-4.359195134918048d-1*t25
            t29 = 1/t11**2
            t30 = -1.0d+0*t28*t29*t7-2.338975347647741d-1*t12*t25*t6
            t31 = 1/t7
            t32 = 1/t14**2
            t33 = -4.9237251092134837d-1*t28*t32*t9-1.6412417030711612d-
     1         1*t15*t26
            t34 = 1/t16**2
            t35 = 2.238166942360001d+1*t34+1
            t36 = 1/t35
            t37 = t27-8.257074162019531d-1*t25
            t38 = 1/t19**2
            t39 = -1.0d+0*t18*t37*t38-2.338975347647741d-1*t17*t20*t25
            t40 = 1/t18
            t41 = -4.9237251092134837d-1*t28*t29*t9-1.6412417030711612d-
     1         1*t12*t26
            t42 = -4.9237251092134837d-1*t37*t38*t9-1.6412417030711612d-
     1         1*t20*t26
            t43 = -1.923661050931536d+0*(3.1572335285150016d-2*t19*t42*t
     1         8-6.314467057030003d-2*t11*t41*t8+2.2478670955426108d-3*t
     2         19*t39*t40+5.808446351175949d-2*t25*t34*t36-9.69022771154
     3         4375d-4*t11*t30*t31-5.580665928883042d-2*t22*t24*t25)+6.3
     4         14467057030003d-2*t14*t33*t8+9.690227711544375d-4*t11*t30
     5         *t31+5.580665928883042d-2*t22*t24*t25
            t44 = 1/t23**2
            t45 = 1/t3**5
            t46 = 1/rhob**2.3333333333333334d+0
            t47 = 1/t3**3
            t48 = 1/rhob**2.166666666666667d+0
            t49 = 1/t6**3
            t50 = 1/rhob**6.666666666666667d-1
            t51 = t28**2
            t52 = 1/t11**3
            t53 = 1/rhob**2.333333333333333d+0
            t54 = 2.1883222707615482d-1*t53
            t55 = t54+5.08572765740439d-1*t48
            t56 = -1.0d+0*t29*t55*t7+2.0d+0*t51*t52*t7+2.728804572255698
     1         d-1*t12*t48*t6+4.677950695295482d-1*t25*t28*t29*t6+2.7354
     2         02838451935d-2*t12*t46
            t57 = t37**2
            t58 = 1/t19**3
            t59 = t54+9.633253189022787d-1*t48
            fnc(iq) = 2.0d+0*rhob*t21*wght+fnc(iq)
            Amat(iq,D1_RB) = 2.0d+0*rhob*t43*wght+2.0d+0*t21*wght+Amat(i
     1         q,D1_RB)
            Amat2(iq,D2_RB_RB) = 2.0d+0*rhob*(-1.923661050931536d+0*(3.1
     1         572335285150016d-2*t19*t8*(-4.9237251092134837d-1*t38*t59
     2         *t9+9.847450218426967d-1*t57*t58*t9+2.1883222707615482d-1
     3         *t20*t53+3.2824834061423225d-1*t26*t37*t38)-6.31446705703
     4         0003d-2*t11*t8*(-4.9237251092134837d-1*t29*t55*t9+9.84745
     5         0218426967d-1*t51*t52*t9+2.1883222707615482d-1*t12*t53+3.
     6         2824834061423225d-1*t26*t28*t29)+3.1572335285150016d-2*t3
     7         7*t42*t8-6.314467057030003d-2*t28*t41*t8+2.24786709554261
     8         08d-3*t19*t40*(-1.0d+0*t18*t38*t59+2.0d+0*t18*t57*t58+2.7
     9         28804572255698d-1*t17*t20*t48+2.735402838451935d-2*t20*t4
     :         6+4.677950695295482d-1*t17*t25*t37*t38)-9.690227711544375
     ;         d-4*t11*t31*t56+1.0524111761716672d-2*t19*t42*t50-2.10482
     <         23523433343d-2*t11*t41*t50-2.2665203730395278d-4*t11*t25*
     =         t30*t49-6.776520743038608d-2*t34*t36*t48+6.51077691703021
     >         5d-2*t22*t24*t48-2.610608006223023d-2*t24*t46*t47+9.88036
     ?         578371829d-1*t44*t45*t46+2.7171625647070036d-2*t36*t46/t1
     @         6**3-6.081463429345333d-1*t46/(t16**5*t35**2)+2.247867095
     1         5426108d-3*t37*t39*t40+5.257705721262695d-4*t19*t25*t39/t
     2         17**3-9.690227711544375d-4*t28*t30*t31)+6.314467057030003
     3         d-2*t14*t8*(-4.9237251092134837d-1*t32*t55*t9+9.847450218
     4         426967d-1*t51*t9/t14**3+2.1883222707615482d-1*t15*t53+3.2
     5         824834061423225d-1*t26*t28*t32)+6.314467057030003d-2*t28*
     6         t33*t8+9.690227711544375d-4*t11*t31*t56+2.104822352343334
     7         3d-2*t14*t33*t50+2.2665203730395278d-4*t11*t25*t30*t49-6.
     8         510776917030215d-2*t22*t24*t48+2.610608006223023d-2*t24*t
     9         46*t47-9.88036578371829d-1*t44*t45*t46+9.690227711544375d
     :         -4*t28*t30*t31)*wght+4.0d+0*t43*wght+Amat2(iq,D2_RB_RB)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_vwn1 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {\it t_1}^{.3333333333333333}\\\\ 
C>   {\it t_3} &=& {{1}\over{\sqrt{{\it t_2}}}}\\\\ 
C>   {\it t_4} &=& 1.575246635799487\,{\it t_3}\\\\ 
C>   {\it t_5} &=& \arctan \left({{6.15199081975908}\over{{\it t_4}+3.72744}}\right)\\\\ 
C>   {\it t_6} &=& .7876233178997433\,{\it t_3}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_8} &=& .6203504908994001\,{\it t_7}\\\\ 
C>   {\it t_9} &=& {{1}\over{\left| 2.935818660072219\,{\it t_3}+{\it t_8}+12.9352\right| }}\\\\ 
C>   {\it t_{10}} &=& \log \left(1.0\,\left({\it t_6}+0.10498\right)^2\,{\it t_9}\right)\\\\ 
C>   {\it t_{11}} &=& \left| {\it t_7}\right| \\\\ 
C>   {\it t_{12}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_9}\right)\\\\ 
C>   {\it t_{13}} &=& -\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}+\rho_\alpha\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_3}+{\it t_8}+18.0578\right| }}\\\\ 
C>   {\it t_{17}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{18}} &=& {\it t_{17}}^{.3333333333333333}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{\sqrt{{\it t_{18}}}}}\\\\ 
C>   {\it t_{20}} &=& 1.575246635799487\,{\it t_{19}}\\\\ 
C>   {\it t_{21}} &=& \arctan \left({{6.15199081975908}\over{{\it t_{20}}+3.72744}}\right)\\\\ 
C>   {\it t_{22}} &=& .7876233178997433\,{\it t_{19}}\\\\ 
C>   {\it t_{23}} &=& {{1}\over{{\it t_{18}}}}\\\\ 
C>   {\it t_{24}} &=& .6203504908994001\,{\it t_{23}}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{\left| 2.935818660072219\,{\it t_{19}}+{\it t_{24}}+12.9352\right| }}\\\\ 
C>   {\it t_{26}} &=& \log \left(1.0\,\left({\it t_{22}}+0.10498\right)^2\,{\it t_{25}}\right)\\\\ 
C>   {\it t_{27}} &=& \left| {\it t_{23}}\right| \\\\ 
C>   {\it t_{28}} &=& \log \left(.6203504908994001\,{\it t_{27}}\,{\it t_{25}}\right)\\\\ 
C>   {\it t_{29}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_{19}}+{\it t_{24}}+18.0578\right| }}\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left(1.923661050931536\,\left(\left({\it t_{14}}\,{\it t_{15}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{14}}\,{\it t_{15}}\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{16}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_6}+0.325\right)^2\,{\it t_{16}}\right)-0.0310907\,{\it t_{12}}-9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_4}+7.06042}}\right)-.03878329487811301\,{\it t_5}\right)+0.0310907\,{\it t_{12}}+9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.03878329487811301\,{\it t_5}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{17}}\,\left(1.923661050931536\,\left(\left({{\rho_s+{\it t_{13}}}\over{{\it t_{17}}}}+1.0\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{27}}\,{\it t_{29}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_{22}}+0.325\right)^2\,{\it t_{29}}\right)-0.0310907\,{\it t_{28}}-9.690227711544375 \times 10^{-4}\,{\it t_{26}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_{20}}+7.06042}}\right)-.03878329487811301\,{\it t_{21}}\right)+0.0310907\,{\it t_{28}}+9.690227711544375 \times 10^{-4}\,{\it t_{26}}+.03878329487811301\,{\it t_{21}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] SH Vosko, L Wilk, M Nusair, Can.J.Phys. 58, 1200 (1980)  , DOI: 
C> <a href="http://dx.doi.org/10.1139/p80-159 "> 
C> 10.1139/p80-159 </a> 
C> 
      subroutine nwxcm_c_vwn1_d3(param,tol_rho,ipol,nq,wght, 
     +rho,fnc,Amat,Amat2,Amat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,*)  !< [Output] The 3rd derivative wrt rho 
c 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
