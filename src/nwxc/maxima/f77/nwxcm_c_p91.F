C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_p91.F 
C> The nwxcm_c_p91 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_p91 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& -\rho_\beta\\\\ 
C>   {\it t_3} &=& {\it t_2}+\rho_\alpha\\\\ 
C>   {\it t_4} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_5} &=& 1.0-{\it t_3}\,{\it t_4}\\\\ 
C>   {\it t_6} &=& {\it t_3}\,{\it t_4}+1.0\\\\ 
C>   {\it t_7} &=& 0.5\,{\it t_6}^{{{2}\over{3}}}+0.5\,{\it t_5}^{{{2}\over{3}}}\\\\ 
C>   {\it t_8} &=& {\it t_7}^{3.0}\\\\ 
C>   {\it t_9} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}^{2.0}}}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_7}^{2.0}}}\\\\ 
C>   {\it t_{12}} &=& 2.0\,\sigma_{\alpha\beta}\\\\ 
C>   {\it t_{13}} &=& \sigma_{\beta\beta}+{\it t_{12}}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{14}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_{14}}}}\\\\ 
C>   {\it t_{16}} &=& 0.1325688999052018\,{\it t_{15}}+1.0\\\\ 
C>   {\it t_{17}} &=& \sqrt{{\it t_{14}}}\\\\ 
C>   {\it t_{18}} &=& {{1}\over{{\it t_{17}}}}\\\\ 
C>   {\it t_{19}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.02414199311453321\,{\it t_{18}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{20}} &=& 0.06901399211255826\,{\it t_{15}}+1.0\\\\ 
C>   {\it t_{21}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.01321299881039884\,{\it t_{18}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{22}} &=& {{1}\over{e^{{{40.42761511756372\,\left(0.5848223622634648\,\left(1.923661050931536\,{\it t_6}^{{{4}\over{3}}}+1.923661050931536\,{\it t_5}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_3}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{16}}\,{\it t_{19}}-0.0310907\,\left(0.1274696188700087\,{\it t_{15}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.01530901310039024\,{\it t_{18}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{20}}\,{\it t_{21}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{20}}\,{\it t_{21}}\right)-0.0621814\,{\it t_{16}}\,{\it t_{19}}\right)}\over{{\it t_8}}}}}}-1.0\\\\ 
C>   {\it t_{23}} &=& {{0.1712109500228822\,{\it t_{10}}\,{\it t_{11}}\,{\it t_{13}}}\over{{\it t_{22}}}}\\\\ 
C>   {\it t_{24}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{25}} &=& \rho_s+{\it t_2}\\\\ 
C>   {\it t_{26}} &=& {{{\it t_{25}}}\over{{\it t_{24}}}}+1.0\\\\ 
C>   {\it t_{27}} &=& \left| {\it t_{26}}\right| ^{2.0}\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{24}}^{1.166666666666667}\,{\it t_{26}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{29}} &=& {\it t_{28}}^{2.0}\\\\ 
C>   {\it t_{30}} &=& \sigma_{ss}+\sigma_{\beta\beta}+{\it t_{12}}\\\\ 
C>   {\it t_{31}} &=& {\it t_{24}}^{0.3333333333333333}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}}}\\\\ 
C>   {\it t_{33}} &=& 0.1325688999052018\,{\it t_{32}}+1.0\\\\ 
C>   {\it t_{34}} &=& \sqrt{{\it t_{31}}}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{34}}}}\\\\ 
C>   {\it t_{36}} &=& \log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.02414199311453321\,{\it t_{35}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{37}} &=& 0.06901399211255826\,{\it t_{32}}+1.0\\\\ 
C>   {\it t_{38}} &=& \log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.01321299881039884\,{\it t_{35}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{39}} &=& {{1}\over{e^{{{323.4209209405097\,\left(0.5848223622634648\,\left(1.923661050931536\,{\it t_{26}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{25}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{33}}\,{\it t_{36}}-0.0310907\,\left(0.1274696188700087\,{\it t_{32}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.01530901310039024\,{\it t_{35}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{37}}\,{\it t_{38}}\right)}\over{{\it t_{24}}^4}}+0.0337738\,{\it t_{37}}\,{\it t_{38}}\right)-0.0621814\,{\it t_{33}}\,{\it t_{36}}\right)}\over{{\it t_{27}}}}}}}-1.0\\\\ 
C>   {\it t_{40}} &=& {{0.6848438000915288\,{\it t_{29}}\,{\it t_{30}}}\over{{\it t_{39}}}}\\\\ 
C>   f &=& 0.02473556743557578\,{\it t_1}\,{\it t_8}\,\log \left({{0.1712109500228822\,{\it t_{10}}\,{\it t_{11}}\,{\it t_{13}}\,\left({\it t_{23}}+1.0\right)}\over{{{0.02931318940773786\,{\it t_{13}}^{2.0}}\over{{\it t_9}^{4.0}\,{\it t_7}^{4.0}\,{\it t_{22}}^{2.0}}}+{\it t_{23}}+1.0}}+1.0\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.003091945929446973\,{\it t_{24}}\,{\it t_{27}}\,\log \left({{0.6848438000915288\,{\it t_{29}}\,{\it t_{30}}\,\left({\it t_{40}}+1.0\right)}\over{{{0.4690110305238058\,{\it t_{28}}^{4.0}\,{\it t_{30}}^{2.0}}\over{{\it t_{39}}^{2.0}}}+{\it t_{40}}+1.0}}+1.0\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] JP Perdew, JA Chevary, SH Vosko, KA Jackson, MR Pederson, DJ Singh, C. Fiolhais, Phys.Rev. B 46, 6671 (1992)  , DOI: 
C> <a href="http://dx.doi.org/10.1021/jp050536c "> 
C> 10.1021/jp050536c </a> 
C> 
      subroutine nwxcm_c_p91(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,fnc,Amat,Cmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision rgamma(nq,*) !< [Input] The norm of the density 
                                    !< gradients 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,*)   !< [Output] The derivative wrt rgamma 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          if (rhoa.gt.tol_rho) then 
            t1 = rhoa**1.1666666666666667d+0
            t2 = 1/t1**2.0d+0
            t3 = rhoa**3.333333333333333d-1
            t4 = t3**5.0d-1
            t5 = 1/t4
            t6 = 2.150807071909054d-2*t5+1.0186556948d-1
            t7 = 7.016926042943223d-1*t5*t6+2.2308199064d-1
            t8 = 7.016926042943223d-1*t5*t7+4.7231125998d-1
            t9 = 1/t8
            t10 = 1.4251254664507676d+0*t4*t9+1.0d+0
            t11 = log(t10)
            t12 = 1.0522000558389215d-1/t3+1.0d+0
            t13 = exp(2.5138457066712766d+0*t11*t12)
            t14 = t13-1.0d+0
            t15 = 1/t14
            t16 = 1.35890221087399d-1*gammaaa*t15*t2
            t17 = t16+1.0d+0
            t18 = gammaaa**2.0d+0
            t19 = 1/t1**4.0d+0
            t20 = 1/t14**2.0d+0
            t21 = 1.8466152187182178d-2*t18*t19*t20+t16+1.0d+0
            t22 = 1/t21
            t23 = 1.35890221087399d-1*gammaaa*t17*t2*t22+1.0d+0
            t24 = log(t23)
            t25 = 1/t23
            t26 = rhoa**1.6666666666666674d-1
            t27 = 1/t1**3.0d+0
            t28 = -3.1707718253726436d-1*gammaaa*t15*t26*t27
            t29 = 1/t4**3
            t30 = 1/rhoa**6.666666666666667d-1
            t31 = 2.5138457066712766d+0*t12*(2.375209110751279d-1*t30*t5
     1         *t9-1.4251254664507676d+0*t4*(7.016926042943223d-1*t5*(-1
     2         .1694876738238705d-1*t29*t30*t6-2.51534235937085d-3/rhoa*
     3         *1.3333333333333336d+0)-1.1694876738238705d-1*t29*t30*t7)
     4         /t8**2)/t10-8.816895309766499d-2*t11/rhoa**1.333333333333
     5         3333d+0
            t32 = -1.35890221087399d-1*gammaaa*t13*t2*t31/t14**2
            t33 = 1/t21**2
            t34 = 4.947113487115156d-2*rhoa*t25*(-1.35890221087399d-1*ga
     1         mmaaa*t17*t2*(3.6932304374364355d-2*gammaaa*t19*t20+1.358
     2         90221087399d-1*t15*t2)*t33+1.35890221087399d-1*t17*t2*t22
     3         +1.8466152187182183d-2*gammaaa*t15*t19*t22)*wght
            fnc(iq) = 4.947113487115156d-2*rhoa*t24*wght+fnc(iq)
            Amat(iq,D1_RA) = 4.947113487115156d-2*rhoa*t25*(-1.358902210
     1         87399d-1*gammaaa*t17*t2*(t32-3.6932304374364355d-2*t13*t1
     2         8*t19*t31/t14**3.0d+0+t28-8.617537687351684d-2*t18*t20*t2
     3         6/t1**5.0d+0)*t33+1.35890221087399d-1*gammaaa*t2*t22*(t32
     4         +t28)-3.1707718253726436d-1*gammaaa*t17*t22*t26*t27)*wght
     5         +4.947113487115156d-2*t24*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = t34+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t34+Cmat(iq,D1_GAB)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob+rhoa
            t2 = rhoa-rhob
            t3 = 1/t1
            t4 = 1.0d+0-t2*t3
            t5 = t2*t3+1.0d+0
            t6 = 5.0d-1*t5**6.666666666666666d-1+5.0d-1*t4**6.6666666666
     1         66666d-1
            t7 = t6**3.0d+0
            t8 = gammabb+2.0d+0*gammaab+gammaaa
            t9 = t1**1.1666666666666667d+0
            t10 = 1/t9**2.0d+0
            t11 = t6**2.0d+0
            t12 = 1/t11
            t13 = 1/t7
            t14 = t1**3.333333333333333d-1
            t15 = 1/t14
            t16 = 1.325688999052018d-1*t15+1.0d+0
            t17 = t14**5.0d-1
            t18 = 1/t17
            t19 = 2.4141993114533214d-2*t18+1.0186556948d-1
            t20 = 7.876233178997433d-1*t18*t19+2.2308199064d-1
            t21 = 7.876233178997433d-1*t18*t20+4.7231125998d-1
            t22 = 1/t21
            t23 = 1.269642451250142d+0*t17*t22+1.0d+0
            t24 = log(t23)
            t25 = 1.923661050931536d+0*t5**1.3333333333333333d+0+1.92366
     1         1050931536d+0*t4**1.3333333333333333d+0-3.847322101863072
     2         d+0
            t26 = 6.901399211255826d-2*t15+1.0d+0
            t27 = 1.3212998810398843d-2*t18+2.9729725188d-2
            t28 = 7.876233178997433d-1*t18*t27+1.2236585478d-1
            t29 = 7.876233178997433d-1*t18*t28+3.497952466d-1
            t30 = 1/t29
            t31 = 1.269642451250142d+0*t17*t30+1.0d+0
            t32 = log(t31)
            t33 = t2**4
            t34 = 1/t1**4
            t35 = 1.2746961887000874d-1*t15+1.0d+0
            t36 = 1.530901310039024d-2*t18+1.0465751434d-1
            t37 = 7.876233178997433d-1*t18*t36+1.9269083139d-1
            t38 = 7.876233178997433d-1*t18*t37+4.3896648423d-1
            t39 = 1/t38
            t40 = 1.269642451250142d+0*t17*t39+1.0d+0
            t41 = log(t40)
            t42 = 1.709920934161365d+0*(6.21814d-2*t16*t24-3.10907d-2*t3
     1         5*t41)-3.37738d-2*t26*t32
            t43 = t33*t34*t42+3.37738d-2*t26*t32
            t44 = 5.848223622634648d-1*t25*t43-6.21814d-2*t16*t24
            t45 = exp(-4.042761511756372d+1*t13*t44)
            t46 = t45-1.0d+0
            t47 = 1/t46
            t48 = 1.712109500228822d-1*t10*t12*t47*t8
            t49 = t48+1.0d+0
            t50 = t8**2.0d+0
            t51 = 1/t9**4.0d+0
            t52 = 1/t6**4.0d+0
            t53 = 1/t46**2.0d+0
            t54 = 2.931318940773786d-2*t50*t51*t52*t53+t48+1.0d+0
            t55 = 1/t54
            t56 = 1.712109500228822d-1*t10*t12*t49*t55*t8+1.0d+0
            t57 = log(t56)
            t58 = 1/t56
            t59 = 1/t1**2
            t60 = t2*t59
            t61 = -t3
            t62 = t61+t60
            t63 = t4**3.333333333333333d-1
            t64 = 1/t63
            t65 = -t2*t59
            t66 = t65+t3
            t67 = t5**3.333333333333333d-1
            t68 = 1/t67
            t69 = 3.333333333333333d-1*t66*t68+3.333333333333333d-1*t62*
     1         t64
            t70 = t1**1.6666666666666674d-1
            t71 = 1/t9**3.0d+0
            t72 = -3.9949221672005847d-1*t12*t49*t55*t70*t71*t8
            t73 = -3.424219000457644d-1*t10*t13*t47*t69*t8
            t74 = -3.9949221672005847d-1*t12*t47*t70*t71*t8
            t75 = 1/t46**2
            t76 = 1/t1**1.3333333333333336d+0
            t77 = 1/t1**6.666666666666667d-1
            t78 = 1/t17**3
            t79 = 2.11607075208357d-1*t18*t22*t77-1.269642451250142d+0*t
     1         17*(7.876233178997433d-1*t18*(-1.3127055298329054d-1*t19*
     2         t77*t78-3.169132786263567d-3*t76)-1.3127055298329054d-1*t
     3         20*t77*t78)/t21**2
            t80 = 1/t23
            t81 = -6.21814d-2*t16*t79*t80
            t82 = 1/t1**1.3333333333333333d+0
            t83 = 2.747773264188438d-3*t24*t82
            t84 = 2.11607075208357d-1*t18*t30*t77-1.269642451250142d+0*t
     1         17*(7.876233178997433d-1*t18*(-1.3127055298329054d-1*t27*
     2         t77*t78-1.7344776604086162d-3*t76)-1.3127055298329054d-1*
     3         t28*t77*t78)/t29**2
            t85 = 1/t31
            t86 = 3.37738d-2*t26*t84*t85
            t87 = -7.769549222703733d-4*t32*t82
            t88 = t33*t34*(-3.37738d-2*t26*t84*t85+1.709920934161365d+0*
     1         (1.3210398931339265d-3*t41*t82-2.747773264188438d-3*t24*t
     2         82+6.21814d-2*t16*t79*t80-3.10907d-2*t35*(2.1160707520835
     3         7d-1*t18*t39*t77-1.269642451250142d+0*t17*(7.876233178997
     4         433d-1*t18*(-1.3127055298329054d-1*t36*t77*t78-2.00962261
     5         53166658d-3*t76)-1.3127055298329054d-1*t37*t77*t78)/t38**
     6         2)/t40)+7.769549222703733d-4*t32*t82)
            t89 = -4*t33*t42/t1**5
            t90 = t2**3
            t91 = 1.2128284535269115d+2*t44*t52*t69-4.042761511756372d+1
     1         *t13*(5.848223622634648d-1*t25*(4*t34*t42*t90+t89+t88+t87
     2         +t86)+t83+t81+5.848223622634648d-1*t43*(2.564881401242048
     3         d+0*t66*t67+2.564881401242048d+0*t62*t63))
            t92 = -1.712109500228822d-1*t10*t12*t45*t75*t8*t91
            t93 = 1/t54**2
            t94 = 1/t6**5.0d+0
            t95 = -1.367948839027767d-1*t50*t52*t53*t70/t9**5.0d+0
            t96 = 1/t46**3.0d+0
            t97 = 2.473556743557578d-2*t57*t7*wght
            t98 = t60+t3
            t99 = t65+t61
            t100 = 3.333333333333333d-1*t68*t99+3.333333333333333d-1*t64
     1         *t98
            t101 = -3.424219000457644d-1*t10*t100*t13*t47*t8
            t102 = 1.2128284535269115d+2*t100*t44*t52-4.042761511756372d
     1         +1*t13*(5.848223622634648d-1*t43*(2.564881401242048d+0*t6
     2         7*t99+2.564881401242048d+0*t63*t98)+5.848223622634648d-1*
     3         t25*(-4*t34*t42*t90+t89+t88+t87+t86)+t83+t81)
            t103 = -1.712109500228822d-1*t10*t102*t12*t45*t75*t8
            t104 = 2.473556743557578d-2*t1*t58*t7*(-1.712109500228822d-1
     1         *t10*t12*t49*t8*(5.862637881547572d-2*t51*t52*t53*t8+1.71
     2         2109500228822d-1*t10*t12*t47)*t93+2.9313189407737866d-2*t
     3         47*t51*t52*t55*t8+1.712109500228822d-1*t10*t12*t49*t55)*w
     4         ght
            fnc(iq) = 2.473556743557578d-2*t1*t57*t7*wght+fnc(iq)
            Amat(iq,D1_RA) = 2.473556743557578d-2*t1*t58*t7*(-1.71210950
     1         0228822d-1*t10*t12*t49*t8*t93*(-5.862637881547572d-2*t45*
     2         t50*t51*t52*t91*t96+t95-1.1725275763095144d-1*t50*t51*t53
     3         *t69*t94+t92+t74+t73)+1.712109500228822d-1*t10*t12*t55*t8
     4         *(t92+t74+t73)-3.424219000457644d-1*t10*t13*t49*t55*t69*t
     5         8+t72)*wght+7.420670230672733d-2*t1*t11*t57*t69*wght+t97+
     6         Amat(iq,D1_RA)
            Amat(iq,D1_RB) = 2.473556743557578d-2*t1*t58*t7*(-1.71210950
     1         0228822d-1*t10*t12*t49*t8*t93*(-5.862637881547572d-2*t102
     2         *t45*t50*t51*t52*t96+t95-1.1725275763095144d-1*t100*t50*t
     3         51*t53*t94+t74+t103+t101)+1.712109500228822d-1*t10*t12*t5
     4         5*(t74+t103+t101)*t8-3.424219000457644d-1*t10*t100*t13*t4
     5         9*t55*t8+t72)*wght+7.420670230672733d-2*t1*t100*t11*t57*w
     6         ght+t97+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = t104+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = 2.473556743557578d-2*t1*t58*t7*(-1.7121095
     1         00228822d-1*t10*t12*t49*t8*(1.1725275763095144d-1*t51*t52
     2         *t53*t8+3.424219000457644d-1*t10*t12*t47)*t93+5.862637881
     3         547573d-2*t47*t51*t52*t55*t8+3.424219000457644d-1*t10*t12
     4         *t49*t55)*wght+Cmat(iq,D1_GAB)
            Cmat(iq,D1_GBB) = t104+Cmat(iq,D1_GBB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = rhob+rhoa
            t2 = rhoa-rhob
            t3 = 1/t1
            t4 = t2*t3+1.0d+0
            t5 = abs(t4)
            t6 = t5**2.0d+0
            t7 = 1/t1**1.1666666666666667d+0
            t8 = 1/t4**6.666666666666666d-1
            t9 = t7*t8
            t10 = t9**2.0d+0
            t11 = sigmabb+2.0d+0*sigmaab+gammaaa
            t12 = 1/t6
            t13 = t1**3.333333333333333d-1
            t14 = 1/t13
            t15 = 1.325688999052018d-1*t14+1.0d+0
            t16 = t13**5.0d-1
            t17 = 1/t16
            t18 = 2.4141993114533214d-2*t17+1.0186556948d-1
            t19 = 7.876233178997433d-1*t17*t18+2.2308199064d-1
            t20 = 7.876233178997433d-1*t17*t19+4.7231125998d-1
            t21 = 1/t20
            t22 = 1.269642451250142d+0*t16*t21+1.0d+0
            t23 = log(t22)
            t24 = 1.923661050931536d+0*t4**1.3333333333333333d+0-3.84732
     1         2101863072d+0
            t25 = 6.901399211255826d-2*t14+1.0d+0
            t26 = 1.3212998810398843d-2*t17+2.9729725188d-2
            t27 = 7.876233178997433d-1*t17*t26+1.2236585478d-1
            t28 = 7.876233178997433d-1*t17*t27+3.497952466d-1
            t29 = 1/t28
            t30 = 1.269642451250142d+0*t16*t29+1.0d+0
            t31 = log(t30)
            t32 = t2**4
            t33 = 1/t1**4
            t34 = 1.2746961887000874d-1*t14+1.0d+0
            t35 = 1.530901310039024d-2*t17+1.0465751434d-1
            t36 = 7.876233178997433d-1*t17*t35+1.9269083139d-1
            t37 = 7.876233178997433d-1*t17*t36+4.3896648423d-1
            t38 = 1/t37
            t39 = 1.269642451250142d+0*t16*t38+1.0d+0
            t40 = log(t39)
            t41 = 1.709920934161365d+0*(6.21814d-2*t15*t23-3.10907d-2*t3
     1         4*t40)-3.37738d-2*t25*t31
            t42 = t32*t33*t41+3.37738d-2*t25*t31
            t43 = 5.848223622634648d-1*t24*t42-6.21814d-2*t15*t23
            t44 = exp(-3.234209209405097d+2*t12*t43)
            t45 = t44-1.0d+0
            t46 = 1/t45
            t47 = 6.848438000915288d-1*t10*t11*t46
            t48 = t47+1.0d+0
            t49 = t9**4.0d+0
            t50 = 1/t45**2.0d+0
            t51 = t11**2.0d+0
            t52 = 4.6901103052380577d-1*t49*t50*t51+t47+1.0d+0
            t53 = 1/t52
            t54 = 6.848438000915288d-1*t10*t11*t48*t53+1.0d+0
            t55 = log(t54)
            t56 = 1/t54
            t57 = 1/t52**2
            t58 = t3-t2/t1**2
            t59 = -1.1666666666666667d+0*t8/t1**2.166666666666667d+0-6.6
     1         66666666666666d-1*t58*t7/t4**1.6666666666666669d+0
            t60 = 1.3696876001830577d+0*t11*t46*t59*t7*t8
            t61 = 1/t1**1.3333333333333336d+0
            t62 = 1/t1**6.666666666666667d-1
            t63 = 1/t16**3
            t64 = 2.11607075208357d-1*t17*t21*t62-1.269642451250142d+0*t
     1         16*(7.876233178997433d-1*t17*(-1.3127055298329054d-1*t18*
     2         t62*t63-3.169132786263567d-3*t61)-1.3127055298329054d-1*t
     3         19*t62*t63)/t20**2
            t65 = 1/t22
            t66 = 1/t1**1.3333333333333333d+0
            t67 = 2.11607075208357d-1*t17*t29*t62-1.269642451250142d+0*t
     1         16*(7.876233178997433d-1*t17*(-1.3127055298329054d-1*t26*
     2         t62*t63-1.7344776604086162d-3*t61)-1.3127055298329054d-1*
     3         t27*t62*t63)/t28**2
            t68 = 1/t30
            t69 = 6.468418418810195d+2*t4*t43*t58/t5**4.0d+0-3.234209209
     1         405097d+2*t12*(5.848223622634648d-1*t24*(t32*t33*(-3.3773
     2         8d-2*t25*t67*t68+1.709920934161365d+0*(1.3210398931339265
     3         d-3*t40*t66-2.747773264188438d-3*t23*t66+6.21814d-2*t15*t
     4         64*t65-3.10907d-2*t34*(2.11607075208357d-1*t17*t38*t62-1.
     5         269642451250142d+0*t16*(7.876233178997433d-1*t17*(-1.3127
     6         055298329054d-1*t35*t62*t63-2.0096226153166658d-3*t61)-1.
     7         3127055298329054d-1*t36*t62*t63)/t37**2)/t39)+7.769549222
     8         703733d-4*t31*t66)+3.37738d-2*t25*t67*t68-7.7695492227037
     9         33d-4*t31*t66+4*t2**3*t33*t41-4*t32*t41/t1**5)+2.74777326
     :         4188438d-3*t23*t66-6.21814d-2*t15*t64*t65+1.5000000000000
     ;         002d+0*t4**3.333333333333333d-1*t42*t58)
            t70 = -6.848438000915288d-1*t10*t11*t44*t69/t45**2
            fnc(iq) = 3.0919459294469726d-3*t1*t55*t6*wght+fnc(iq)
            Amat(iq,D1_RA) = 3.0919459294469726d-3*t1*t56*t6*(-6.8484380
     1         00915288d-1*t10*t11*t48*t57*(1.8760441220952231d+0*t50*t5
     2         1*t59*t9**3.0d+0+t70-9.380220610476115d-1*t44*t49*t51*t69
     3         /t45**3.0d+0+t60)+1.3696876001830577d+0*t11*t48*t53*t59*t
     4         7*t8+6.848438000915288d-1*t10*t11*t53*(t70+t60))*wght+3.0
     5         919459294469726d-3*t55*t6*wght+6.183891858893945d-3*t1*t4
     6         *t55*t58*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = 3.0919459294469726d-3*t1*t56*(-6.848438000
     1         915288d-1*t10*t11*t48*(9.380220610476115d-1*t11*t49*t50+6
     2         .848438000915288d-1*t10*t46)*t57+4.690110305238058d-1*t11
     3         *t46*t49*t53+6.848438000915288d-1*t10*t48*t53)*t6*wght+Cm
     4         at(iq,D1_GAA)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob**1.1666666666666667d+0
            t2 = 1/t1**2.0d+0
            t3 = sigmabb+2.0d+0*sigmaab+gammabb
            t4 = rhob**3.333333333333333d-1
            t5 = t4**5.0d-1
            t6 = 1/t5
            t7 = 1.1771443702974159d-2*t6+2.9729725188d-2
            t8 = 7.016926042943223d-1*t6*t7+1.2236585478d-1
            t9 = 7.016926042943223d-1*t6*t8+3.497952466d-1
            t10 = 1/t9
            t11 = 1.4251254664507676d+0*t10*t5+1.0d+0
            t12 = log(t11)
            t13 = 1/t4
            t14 = 5.477644184000001d-2*t13+1.0d+0
            t15 = 2.150807071909054d-2*t6+1.0186556948d-1
            t16 = 7.016926042943223d-1*t15*t6+2.2308199064d-1
            t17 = 7.016926042943223d-1*t16*t6+4.7231125998d-1
            t18 = 1/t17
            t19 = 1.4251254664507676d+0*t18*t5+1.0d+0
            t20 = log(t19)
            t21 = 1.0522000558389215d-1*t13+1.0d+0
            t22 = exp(-3.234209209405097d+2*(-6.21814d-2*t20*t21-3.79955
     1         2500000001d-2*t12*t14))
            t23 = t22-1.0d+0
            t24 = 1/t23
            t25 = 1.35890221087399d-1*t2*t24*t3
            t26 = t25+1.0d+0
            t27 = 1/t1**4.0d+0
            t28 = 1/t23**2.0d+0
            t29 = t3**2.0d+0
            t30 = 1.8466152187182178d-2*t27*t28*t29+t25+1.0d+0
            t31 = 1/t30
            t32 = 1.35890221087399d-1*t2*t26*t3*t31+1.0d+0
            t33 = log(t32)
            t34 = 1/t32
            t35 = 1/t30**2
            t36 = rhob**1.6666666666666674d-1
            t37 = 1/t1**3.0d+0
            t38 = -3.1707718253726436d-1*t24*t3*t36*t37
            t39 = 1/rhob**1.3333333333333333d+0
            t40 = 1/rhob**1.3333333333333336d+0
            t41 = 1/t5**3
            t42 = 1/rhob**6.666666666666667d-1
            t43 = -3.799552500000001d-2*t14*(2.375209110751279d-1*t10*t4
     1         2*t6-1.4251254664507676d+0*t5*(7.016926042943223d-1*t6*(-
     2         1.1694876738238705d-1*t41*t42*t7-1.3766558313739896d-3*t4
     3         0)-1.1694876738238705d-1*t41*t42*t8)/t9**2)/t11-6.21814d-
     4         2*t21*(2.375209110751279d-1*t18*t42*t6-1.4251254664507676
     5         d+0*t5*(7.016926042943223d-1*(-1.1694876738238705d-1*t15*
     6         t41*t42-2.51534235937085d-3*t40)*t6-1.1694876738238705d-1
     7         *t16*t41*t42)/t17**2)/t19+2.18090908507141d-3*t20*t39+6.9
     8         37532217809221d-4*t12*t39
            t44 = 4.3949740450896063d+1*t2*t22*t3*t43/t23**2
            fnc(iq) = 6.183891858893945d-3*rhob*t33*wght+fnc(iq)
            Amat(iq,D1_RB) = 6.183891858893945d-3*rhob*t34*(-1.358902210
     1         87399d-1*t2*t26*t3*t35*(t44+1.1944679893212137d+1*t22*t27
     2         *t29*t43/t23**3.0d+0+t38-8.617537687351684d-2*t28*t29*t36
     3         /t1**5.0d+0)+1.35890221087399d-1*t2*t3*t31*(t44+t38)-3.17
     4         07718253726436d-1*t26*t3*t31*t36*t37)*wght+6.183891858893
     5         945d-3*t33*wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GBB) = 6.183891858893945d-3*rhob*t34*(-1.35890221
     1         087399d-1*t2*t26*t3*(3.6932304374364355d-2*t27*t28*t3+1.3
     2         5890221087399d-1*t2*t24)*t35+1.8466152187182183d-2*t24*t2
     3         7*t3*t31+1.35890221087399d-1*t2*t26*t31)*wght+Cmat(iq,D1_
     4         GBB)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_p91 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& -\rho_\beta\\\\ 
C>   {\it t_3} &=& {\it t_2}+\rho_\alpha\\\\ 
C>   {\it t_4} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_5} &=& 1.0-{\it t_3}\,{\it t_4}\\\\ 
C>   {\it t_6} &=& {\it t_3}\,{\it t_4}+1.0\\\\ 
C>   {\it t_7} &=& 0.5\,{\it t_6}^{{{2}\over{3}}}+0.5\,{\it t_5}^{{{2}\over{3}}}\\\\ 
C>   {\it t_8} &=& {\it t_7}^{3.0}\\\\ 
C>   {\it t_9} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}^{2.0}}}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_7}^{2.0}}}\\\\ 
C>   {\it t_{12}} &=& 2.0\,\sigma_{\alpha\beta}\\\\ 
C>   {\it t_{13}} &=& \sigma_{\beta\beta}+{\it t_{12}}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{14}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_{14}}}}\\\\ 
C>   {\it t_{16}} &=& 0.1325688999052018\,{\it t_{15}}+1.0\\\\ 
C>   {\it t_{17}} &=& \sqrt{{\it t_{14}}}\\\\ 
C>   {\it t_{18}} &=& {{1}\over{{\it t_{17}}}}\\\\ 
C>   {\it t_{19}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.02414199311453321\,{\it t_{18}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{20}} &=& 0.06901399211255826\,{\it t_{15}}+1.0\\\\ 
C>   {\it t_{21}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.01321299881039884\,{\it t_{18}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{22}} &=& {{1}\over{e^{{{40.42761511756372\,\left(0.5848223622634648\,\left(1.923661050931536\,{\it t_6}^{{{4}\over{3}}}+1.923661050931536\,{\it t_5}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_3}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{16}}\,{\it t_{19}}-0.0310907\,\left(0.1274696188700087\,{\it t_{15}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.01530901310039024\,{\it t_{18}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{20}}\,{\it t_{21}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{20}}\,{\it t_{21}}\right)-0.0621814\,{\it t_{16}}\,{\it t_{19}}\right)}\over{{\it t_8}}}}}}-1.0\\\\ 
C>   {\it t_{23}} &=& {{0.1712109500228822\,{\it t_{10}}\,{\it t_{11}}\,{\it t_{13}}}\over{{\it t_{22}}}}\\\\ 
C>   {\it t_{24}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{25}} &=& \rho_s+{\it t_2}\\\\ 
C>   {\it t_{26}} &=& {{{\it t_{25}}}\over{{\it t_{24}}}}+1.0\\\\ 
C>   {\it t_{27}} &=& \left| {\it t_{26}}\right| ^{2.0}\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{24}}^{1.166666666666667}\,{\it t_{26}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{29}} &=& {\it t_{28}}^{2.0}\\\\ 
C>   {\it t_{30}} &=& \sigma_{ss}+\sigma_{\beta\beta}+{\it t_{12}}\\\\ 
C>   {\it t_{31}} &=& {\it t_{24}}^{0.3333333333333333}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}}}\\\\ 
C>   {\it t_{33}} &=& 0.1325688999052018\,{\it t_{32}}+1.0\\\\ 
C>   {\it t_{34}} &=& \sqrt{{\it t_{31}}}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{34}}}}\\\\ 
C>   {\it t_{36}} &=& \log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.02414199311453321\,{\it t_{35}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{37}} &=& 0.06901399211255826\,{\it t_{32}}+1.0\\\\ 
C>   {\it t_{38}} &=& \log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.01321299881039884\,{\it t_{35}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{39}} &=& {{1}\over{e^{{{323.4209209405097\,\left(0.5848223622634648\,\left(1.923661050931536\,{\it t_{26}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{25}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{33}}\,{\it t_{36}}-0.0310907\,\left(0.1274696188700087\,{\it t_{32}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.01530901310039024\,{\it t_{35}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{37}}\,{\it t_{38}}\right)}\over{{\it t_{24}}^4}}+0.0337738\,{\it t_{37}}\,{\it t_{38}}\right)-0.0621814\,{\it t_{33}}\,{\it t_{36}}\right)}\over{{\it t_{27}}}}}}}-1.0\\\\ 
C>   {\it t_{40}} &=& {{0.6848438000915288\,{\it t_{29}}\,{\it t_{30}}}\over{{\it t_{39}}}}\\\\ 
C>   f &=& 0.02473556743557578\,{\it t_1}\,{\it t_8}\,\log \left({{0.1712109500228822\,{\it t_{10}}\,{\it t_{11}}\,{\it t_{13}}\,\left({\it t_{23}}+1.0\right)}\over{{{0.02931318940773786\,{\it t_{13}}^{2.0}}\over{{\it t_9}^{4.0}\,{\it t_7}^{4.0}\,{\it t_{22}}^{2.0}}}+{\it t_{23}}+1.0}}+1.0\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.003091945929446973\,{\it t_{24}}\,{\it t_{27}}\,\log \left({{0.6848438000915288\,{\it t_{29}}\,{\it t_{30}}\,\left({\it t_{40}}+1.0\right)}\over{{{0.4690110305238058\,{\it t_{28}}^{4.0}\,{\it t_{30}}^{2.0}}\over{{\it t_{39}}^{2.0}}}+{\it t_{40}}+1.0}}+1.0\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] JP Perdew, JA Chevary, SH Vosko, KA Jackson, MR Pederson, DJ Singh, C. Fiolhais, Phys.Rev. B 46, 6671 (1992)  , DOI: 
C> <a href="http://dx.doi.org/10.1021/jp050536c "> 
C> 10.1021/jp050536c </a> 
C> 
      subroutine nwxcm_c_p91_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,fnc,Amat,Amat2,Cmat,Cmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision rgamma(nq,*) !< [Input] The norm of the density 
                                    !< gradients 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,*)   !< [Output] The derivative wrt rgamma 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,*)  !< [Output] The 2nd derivative wrt rgamma 
                                    !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_p91 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& -\rho_\beta\\\\ 
C>   {\it t_3} &=& {\it t_2}+\rho_\alpha\\\\ 
C>   {\it t_4} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_5} &=& 1.0-{\it t_3}\,{\it t_4}\\\\ 
C>   {\it t_6} &=& {\it t_3}\,{\it t_4}+1.0\\\\ 
C>   {\it t_7} &=& 0.5\,{\it t_6}^{{{2}\over{3}}}+0.5\,{\it t_5}^{{{2}\over{3}}}\\\\ 
C>   {\it t_8} &=& {\it t_7}^{3.0}\\\\ 
C>   {\it t_9} &=& {\it t_1}^{1.166666666666667}\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}^{2.0}}}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_7}^{2.0}}}\\\\ 
C>   {\it t_{12}} &=& 2.0\,\sigma_{\alpha\beta}\\\\ 
C>   {\it t_{13}} &=& \sigma_{\beta\beta}+{\it t_{12}}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{14}} &=& {\it t_1}^{0.3333333333333333}\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_{14}}}}\\\\ 
C>   {\it t_{16}} &=& 0.1325688999052018\,{\it t_{15}}+1.0\\\\ 
C>   {\it t_{17}} &=& \sqrt{{\it t_{14}}}\\\\ 
C>   {\it t_{18}} &=& {{1}\over{{\it t_{17}}}}\\\\ 
C>   {\it t_{19}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.02414199311453321\,{\it t_{18}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{20}} &=& 0.06901399211255826\,{\it t_{15}}+1.0\\\\ 
C>   {\it t_{21}} &=& \log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.01321299881039884\,{\it t_{18}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{22}} &=& {{1}\over{e^{{{40.42761511756372\,\left(0.5848223622634648\,\left(1.923661050931536\,{\it t_6}^{{{4}\over{3}}}+1.923661050931536\,{\it t_5}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_3}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{16}}\,{\it t_{19}}-0.0310907\,\left(0.1274696188700087\,{\it t_{15}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{17}}}\over{0.7876233178997433\,{\it t_{18}}\,\left(0.7876233178997433\,{\it t_{18}}\,\left(0.01530901310039024\,{\it t_{18}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{20}}\,{\it t_{21}}\right)}\over{{\it t_1}^4}}+0.0337738\,{\it t_{20}}\,{\it t_{21}}\right)-0.0621814\,{\it t_{16}}\,{\it t_{19}}\right)}\over{{\it t_8}}}}}}-1.0\\\\ 
C>   {\it t_{23}} &=& {{0.1712109500228822\,{\it t_{10}}\,{\it t_{11}}\,{\it t_{13}}}\over{{\it t_{22}}}}\\\\ 
C>   {\it t_{24}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{25}} &=& \rho_s+{\it t_2}\\\\ 
C>   {\it t_{26}} &=& {{{\it t_{25}}}\over{{\it t_{24}}}}+1.0\\\\ 
C>   {\it t_{27}} &=& \left| {\it t_{26}}\right| ^{2.0}\\\\ 
C>   {\it t_{28}} &=& {{1}\over{{\it t_{24}}^{1.166666666666667}\,{\it t_{26}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{29}} &=& {\it t_{28}}^{2.0}\\\\ 
C>   {\it t_{30}} &=& \sigma_{ss}+\sigma_{\beta\beta}+{\it t_{12}}\\\\ 
C>   {\it t_{31}} &=& {\it t_{24}}^{0.3333333333333333}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{{\it t_{31}}}}\\\\ 
C>   {\it t_{33}} &=& 0.1325688999052018\,{\it t_{32}}+1.0\\\\ 
C>   {\it t_{34}} &=& \sqrt{{\it t_{31}}}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{34}}}}\\\\ 
C>   {\it t_{36}} &=& \log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.02414199311453321\,{\it t_{35}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{37}} &=& 0.06901399211255826\,{\it t_{32}}+1.0\\\\ 
C>   {\it t_{38}} &=& \log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.01321299881039884\,{\it t_{35}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{39}} &=& {{1}\over{e^{{{323.4209209405097\,\left(0.5848223622634648\,\left(1.923661050931536\,{\it t_{26}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{25}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{33}}\,{\it t_{36}}-0.0310907\,\left(0.1274696188700087\,{\it t_{32}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{34}}}\over{0.7876233178997433\,{\it t_{35}}\,\left(0.7876233178997433\,{\it t_{35}}\,\left(0.01530901310039024\,{\it t_{35}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{37}}\,{\it t_{38}}\right)}\over{{\it t_{24}}^4}}+0.0337738\,{\it t_{37}}\,{\it t_{38}}\right)-0.0621814\,{\it t_{33}}\,{\it t_{36}}\right)}\over{{\it t_{27}}}}}}}-1.0\\\\ 
C>   {\it t_{40}} &=& {{0.6848438000915288\,{\it t_{29}}\,{\it t_{30}}}\over{{\it t_{39}}}}\\\\ 
C>   f &=& 0.02473556743557578\,{\it t_1}\,{\it t_8}\,\log \left({{0.1712109500228822\,{\it t_{10}}\,{\it t_{11}}\,{\it t_{13}}\,\left({\it t_{23}}+1.0\right)}\over{{{0.02931318940773786\,{\it t_{13}}^{2.0}}\over{{\it t_9}^{4.0}\,{\it t_7}^{4.0}\,{\it t_{22}}^{2.0}}}+{\it t_{23}}+1.0}}+1.0\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.003091945929446973\,{\it t_{24}}\,{\it t_{27}}\,\log \left({{0.6848438000915288\,{\it t_{29}}\,{\it t_{30}}\,\left({\it t_{40}}+1.0\right)}\over{{{0.4690110305238058\,{\it t_{28}}^{4.0}\,{\it t_{30}}^{2.0}}\over{{\it t_{39}}^{2.0}}}+{\it t_{40}}+1.0}}+1.0\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] JP Perdew, JA Chevary, SH Vosko, KA Jackson, MR Pederson, DJ Singh, C. Fiolhais, Phys.Rev. B 46, 6671 (1992)  , DOI: 
C> <a href="http://dx.doi.org/10.1021/jp050536c "> 
C> 10.1021/jp050536c </a> 
C> 
      subroutine nwxcm_c_p91_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision rgamma(nq,*) !< [Input] The norm of the density 
                                    !< gradients 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,*)   !< [Output] The derivative wrt rgamma 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,*)  !< [Output] The 2nd derivative wrt rgamma 
                                    !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,*)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,*)  !< [Output] The 3rd derivative wrt rgamma 
                                    !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
