C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_opt.F 
C> The nwxcm_c_opt functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_opt functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_2} &=& \sqrt{{\it t_1}}\\\\ 
C>   {\it t_3} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_5} &=& \log \left({{1.269642451250142\,{\it t_2}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_3}+0.10186556948\right)\,{\it t_3}+0.22308199064\right)\,{\it t_3}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_6} &=& 0.1325688999052018\,{\it t_4}+1.0\\\\ 
C>   {\it t_7} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_5}\,{\it t_6}-0.0310907\,\log \left({{1.269642451250142\,{\it t_2}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_3}+0.10465751434\right)\,{\it t_3}+0.19269083139\right)\,{\it t_3}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_4}+1.0\right)\right)-0.0621814\,{\it t_5}\,{\it t_6}\\\\ 
C>   {\it t_8} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_9} &=& \sqrt{{\it t_8}}\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}}}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_8}}}\\\\ 
C>   {\it t_{12}} &=& \log \left({{1.269642451250142\,{\it t_9}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{10}}+0.10186556948\right)\,{\it t_{10}}+0.22308199064\right)\,{\it t_{10}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{13}} &=& 0.1325688999052018\,{\it t_{11}}+1.0\\\\ 
C>   {\it t_{14}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{12}}\,{\it t_{13}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_9}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{10}}+0.10465751434\right)\,{\it t_{10}}+0.19269083139\right)\,{\it t_{10}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{11}}+1.0\right)\right)-0.0621814\,{\it t_{12}}\,{\it t_{13}}\\\\ 
C>   {\it t_{15}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{16}} &=& {\it t_{15}}^{0.3333333333333333}\\\\ 
C>   {\it t_{17}} &=& {{1}\over{{\it t_{16}}}}\\\\ 
C>   {\it t_{18}} &=& 0.1325688999052018\,{\it t_{17}}+1.0\\\\ 
C>   {\it t_{19}} &=& \sqrt{{\it t_{16}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{{\it t_{19}}}}\\\\ 
C>   {\it t_{21}} &=& \log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.02414199311453321\,{\it t_{20}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{22}} &=& -\rho_\beta\\\\ 
C>   {\it t_{23}} &=& {\it t_{22}}+\rho_\alpha\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{15}}}}\\\\ 
C>   {\it t_{25}} &=& 1.0-{\it t_{23}}\,{\it t_{24}}\\\\ 
C>   {\it t_{26}} &=& {\it t_{23}}\,{\it t_{24}}+1.0\\\\ 
C>   {\it t_{27}} &=& 0.06901399211255826\,{\it t_{17}}+1.0\\\\ 
C>   {\it t_{28}} &=& \log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.01321299881039884\,{\it t_{20}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{29}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{26}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{25}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{23}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{18}}\,{\it t_{21}}-0.0310907\,\left(0.1274696188700087\,{\it t_{17}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.01530901310039024\,{\it t_{20}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{27}}\,{\it t_{28}}\right)}\over{{\it t_{15}}^4}}+0.0337738\,{\it t_{27}}\,{\it t_{28}}\right)-0.0621814\,{\it t_{18}}\,{\it t_{21}}\\\\ 
C>   {\it t_{30}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{31}} &=& {{1}\over{{\it t_{30}}^{2.0}}}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{e^{80.85523023512745\,{\it t_7}}}}-1.0\\\\ 
C>   {\it t_{33}} &=& {{0.2717804421747982\,{\it t_{31}}\,\sigma_{\alpha\alpha}}\over{{\it t_{32}}}}\\\\ 
C>   {\it t_{34}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{34}}^{2.0}}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{e^{80.85523023512745\,{\it t_{14}}}}}-1.0\\\\ 
C>   {\it t_{37}} &=& {{0.2717804421747982\,{\it t_{35}}\,\sigma_{\beta\beta}}\over{{\it t_{36}}}}\\\\ 
C>   {\it t_{38}} &=& 0.5\,{\it t_{26}}^{{{2}\over{3}}}+0.5\,{\it t_{25}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{39}} &=& {\it t_{38}}^{3.0}\\\\ 
C>   {\it t_{40}} &=& {\it t_{15}}^{1.166666666666667}\\\\ 
C>   {\it t_{41}} &=& {{1}\over{{\it t_{40}}^{2.0}}}\\\\ 
C>   {\it t_{42}} &=& {{1}\over{{\it t_{38}}^{2.0}}}\\\\ 
C>   {\it t_{43}} &=& 2.0\,\sigma_{\alpha\beta}\\\\ 
C>   {\it t_{44}} &=& \sigma_{\beta\beta}+{\it t_{43}}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{e^{{{40.42761511756372\,{\it t_{29}}}\over{{\it t_{39}}}}}}}-1.0\\\\ 
C>   {\it t_{46}} &=& {{0.1712109500228822\,{\it t_{41}}\,{\it t_{42}}\,{\it t_{44}}}\over{{\it t_{45}}}}\\\\ 
C>   {\it t_{47}} &=& \rho_s^{0.3333333333333333}\\\\ 
C>   {\it t_{48}} &=& \sqrt{{\it t_{47}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{{\it t_{48}}}}\\\\ 
C>   {\it t_{50}} &=& {{1}\over{{\it t_{47}}}}\\\\ 
C>   {\it t_{51}} &=& \log \left({{1.269642451250142\,{\it t_{48}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{49}}+0.10186556948\right)\,{\it t_{49}}+0.22308199064\right)\,{\it t_{49}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{52}} &=& 0.1325688999052018\,{\it t_{50}}+1.0\\\\ 
C>   {\it t_{53}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{51}}\,{\it t_{52}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{48}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{49}}+0.10465751434\right)\,{\it t_{49}}+0.19269083139\right)\,{\it t_{49}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{50}}+1.0\right)\right)-0.0621814\,{\it t_{51}}\,{\it t_{52}}\\\\ 
C>   {\it t_{54}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{55}} &=& {\it t_{54}}^{0.3333333333333333}\\\\ 
C>   {\it t_{56}} &=& {{1}\over{{\it t_{55}}}}\\\\ 
C>   {\it t_{57}} &=& 0.1325688999052018\,{\it t_{56}}+1.0\\\\ 
C>   {\it t_{58}} &=& \sqrt{{\it t_{55}}}\\\\ 
C>   {\it t_{59}} &=& {{1}\over{{\it t_{58}}}}\\\\ 
C>   {\it t_{60}} &=& \log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.02414199311453321\,{\it t_{59}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{61}} &=& \rho_s+{\it t_{22}}\\\\ 
C>   {\it t_{62}} &=& {{{\it t_{61}}}\over{{\it t_{54}}}}+1.0\\\\ 
C>   {\it t_{63}} &=& 0.06901399211255826\,{\it t_{56}}+1.0\\\\ 
C>   {\it t_{64}} &=& \log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.01321299881039884\,{\it t_{59}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{65}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{62}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{61}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{57}}\,{\it t_{60}}-0.0310907\,\left(0.1274696188700087\,{\it t_{56}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.01530901310039024\,{\it t_{59}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{63}}\,{\it t_{64}}\right)}\over{{\it t_{54}}^4}}+0.0337738\,{\it t_{63}}\,{\it t_{64}}\right)-0.0621814\,{\it t_{57}}\,{\it t_{60}}\\\\ 
C>   {\it t_{66}} &=& \rho_s^{1.166666666666667}\\\\ 
C>   {\it t_{67}} &=& {{1}\over{{\it t_{66}}^{2.0}}}\\\\ 
C>   {\it t_{68}} &=& {{1}\over{e^{80.85523023512745\,{\it t_{53}}}}}-1.0\\\\ 
C>   {\it t_{69}} &=& {{0.2717804421747982\,{\it t_{67}}\,\sigma_{ss}}\over{{\it t_{68}}}}\\\\ 
C>   {\it t_{70}} &=& \left| {\it t_{62}}\right| ^{2.0}\\\\ 
C>   {\it t_{71}} &=& {{1}\over{{\it t_{54}}^{1.166666666666667}\,{\it t_{62}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{72}} &=& {\it t_{71}}^{2.0}\\\\ 
C>   {\it t_{73}} &=& \sigma_{ss}+\sigma_{\beta\beta}+{\it t_{43}}\\\\ 
C>   {\it t_{74}} &=& {{1}\over{e^{{{323.4209209405097\,{\it t_{65}}}\over{{\it t_{70}}}}}}}-1.0\\\\ 
C>   {\it t_{75}} &=& {{0.6848438000915288\,{\it t_{72}}\,{\it t_{73}}}\over{{\it t_{74}}}}\\\\ 
C>   f &=& 0.02473556743557577\,{\it t_{15}}\,{\it t_{39}}\,\log \left({{0.1712109500228822\,{\it t_{41}}\,{\it t_{42}}\,{\it t_{44}}\,\left({\it t_{46}}+1.0\right)}\over{{{0.02931318940773786\,{\it t_{44}}^{2.0}}\over{{\it t_{40}}^{4.0}\,{\it t_{38}}^{4.0}\,{\it t_{45}}^{2.0}}}+{\it t_{46}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_\beta\,\log \left({{0.2717804421747982\,{\it t_{35}}\,\sigma_{\beta\beta}\,\left({\it t_{37}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{34}}^{4.0}\,{\it t_{36}}^{2.0}}}+{\it t_{37}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_\alpha\,\log \left({{0.2717804421747982\,{\it t_{31}}\,\sigma_{\alpha\alpha}\,\left({\it t_{33}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{30}}^{4.0}\,{\it t_{32}}^{2.0}}}+{\it t_{33}}+1.0}}+1.0\right)+1.0\,{\it t_{15}}\,{\it t_{29}}-1.0\,{\it t_{14}}\,\rho_\beta-1.0\,{\it t_7}\,\rho_\alpha\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.003091945929446971\,{\it t_{54}}\,{\it t_{70}}\,\log \left({{0.6848438000915288\,{\it t_{72}}\,{\it t_{73}}\,\left({\it t_{75}}+1.0\right)}\over{{{0.4690110305238058\,{\it t_{71}}^{4.0}\,{\it t_{73}}^{2.0}}\over{{\it t_{74}}^{2.0}}}+{\it t_{75}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_s\,\log \left({{0.2717804421747982\,{\it t_{67}}\,\sigma_{ss}\,\left({\it t_{69}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{ss}^{2.0}}\over{{\it t_{66}}^{4.0}\,{\it t_{68}}^{2.0}}}+{\it t_{69}}+1.0}}+1.0\right)+1.0\,{\it t_{54}}\,{\it t_{65}}-1.0\,{\it t_{53}}\,\rho_s\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] NC Handy, AJ Cohen, Mol.Phys. 99, 607 (2001)  , DOI: 
C> <a href="http://dx.doi.org/10.1080/00268970010023435 "> 
C> 10.1080/00268970010023435 </a> 
C> 
      subroutine nwxcm_c_opt(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,fnc,Amat,Cmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision rgamma(nq,*) !< [Input] The norm of the density 
                                    !< gradients 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,*)   !< [Output] The derivative wrt rgamma 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          if (rhoa.gt.tol_rho) then 
            t1 = rhoa**3.333333333333333d-1
            t2 = t1**5.0d-1
            t3 = 1/t2
            t4 = 1.530901310039024d-2*t3+1.0465751434d-1
            t5 = 7.876233178997433d-1*t3*t4+1.9269083139d-1
            t6 = 7.876233178997433d-1*t3*t5+4.3896648423d-1
            t7 = 1/t6
            t8 = 1.269642451250142d+0*t2*t7+1.0d+0
            t9 = log(t8)
            t10 = 1/t1
            t11 = 1.2746961887000874d-1*t10+1.0d+0
            t12 = 2.4141993114533214d-2*t3+1.0186556948d-1
            t13 = 7.876233178997433d-1*t12*t3+2.2308199064d-1
            t14 = 7.876233178997433d-1*t13*t3+4.7231125998d-1
            t15 = 1/t14
            t16 = 1.269642451250142d+0*t15*t2+1.0d+0
            t17 = log(t16)
            t18 = 1.325688999052018d-1*t10+1.0d+0
            t19 = 9.999999999999991d-1*(6.21814d-2*t17*t18-3.10907d-2*t1
     1         1*t9)-6.21814d-2*t17*t18
            t20 = 2.150807071909054d-2*t3+1.0186556948d-1
            t21 = 7.016926042943223d-1*t20*t3+2.2308199064d-1
            t22 = 7.016926042943223d-1*t21*t3+4.7231125998d-1
            t23 = 1/t22
            t24 = 1.4251254664507676d+0*t2*t23+1.0d+0
            t25 = log(t24)
            t26 = 1.0522000558389215d-1*t10+1.0d+0
            t27 = rhoa**1.1666666666666667d+0
            t28 = 1/t27**2.0d+0
            t29 = exp(-8.085523023512745d+1*t19)
            t30 = t29-1.0d+0
            t31 = 1/t30
            t32 = 2.717804421747982d-1*gammaaa*t28*t31
            t33 = t32+1.0d+0
            t34 = gammaaa**2.0d+0
            t35 = 1/t27**4.0d+0
            t36 = 1/t30**2.0d+0
            t37 = 7.386460874872881d-2*t34*t35*t36+t32+1.0d+0
            t38 = 1/t37
            t39 = 2.717804421747982d-1*gammaaa*t28*t33*t38+1.0d+0
            t40 = log(t39)
            t41 = exp(2.5138457066712766d+0*t25*t26)
            t42 = t41-1.0d+0
            t43 = 1/t42
            t44 = 1.35890221087399d-1*gammaaa*t28*t43
            t45 = t44+1.0d+0
            t46 = 1/t42**2.0d+0
            t47 = 1.8466152187182178d-2*t34*t35*t46+t44+1.0d+0
            t48 = 1/t47
            t49 = 1.35890221087399d-1*gammaaa*t28*t45*t48+1.0d+0
            t50 = log(t49)
            t51 = 1/rhoa**1.3333333333333333d+0
            t52 = 1/rhoa**1.3333333333333336d+0
            t53 = 1/t2**3
            t54 = 1/rhoa**6.666666666666667d-1
            t55 = 1/t16
            t56 = 2.11607075208357d-1*t15*t3*t54-1.269642451250142d+0*t2
     1         *(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t12*t53
     2         *t54-3.169132786263567d-3*t52)-1.3127055298329054d-1*t13*
     3         t53*t54)/t14**2
            t57 = 9.999999999999991d-1*(1.3210398931339265d-3*t51*t9-3.1
     1         0907d-2*t11*(2.11607075208357d-1*t3*t54*t7-1.269642451250
     2         142d+0*t2*(7.876233178997433d-1*t3*(-1.3127055298329054d-
     3         1*t4*t53*t54-2.0096226153166658d-3*t52)-1.312705529832905
     4         4d-1*t5*t53*t54)/t6**2)/t8+6.21814d-2*t18*t55*t56-2.74777
     5         3264188438d-3*t17*t51)-6.21814d-2*t18*t55*t56+2.747773264
     6         188438d-3*t17*t51
            t58 = 1/t24
            t59 = 2.375209110751279d-1*t23*t3*t54-1.4251254664507676d+0*
     1         t2*(7.016926042943223d-1*t3*(-1.1694876738238705d-1*t20*t
     2         53*t54-2.51534235937085d-3*t52)-1.1694876738238705d-1*t21
     3         *t53*t54)/t22**2
            t60 = 1/t39
            t61 = rhoa**1.6666666666666674d-1
            t62 = 1/t27**3.0d+0
            t63 = -6.341543650745292d-1*gammaaa*t31*t61*t62
            t64 = 2.197487022544805d+1*gammaaa*t28*t29*t57/t30**2
            t65 = 1/t37**2
            t66 = 1/t27**5.0d+0
            t67 = 1/t49
            t68 = -3.1707718253726436d-1*gammaaa*t43*t61*t62
            t69 = 2.5138457066712766d+0*t26*t58*t59-8.816895309766499d-2
     1         *t25*t51
            t70 = -1.35890221087399d-1*gammaaa*t28*t41*t69/t42**2
            t71 = 1/t47**2
            t72 = (4.947113487115154d-2*rhoa*t67*(-1.35890221087399d-1*g
     1         ammaaa*t28*t45*(3.6932304374364355d-2*gammaaa*t35*t46+1.3
     2         5890221087399d-1*t28*t43)*t71+1.35890221087399d-1*t28*t45
     3         *t48+1.8466152187182183d-2*gammaaa*t35*t43*t48)-2.4735567
     4         435575762d-2*rhoa*t60*(-2.717804421747982d-1*gammaaa*t28*
     5         t33*(1.4772921749745763d-1*gammaaa*t35*t36+2.717804421747
     6         982d-1*t28*t31)*t65+7.386460874872882d-2*gammaaa*t31*t35*
     7         t38+2.717804421747982d-1*t28*t33*t38))*wght
            fnc(iq) = (4.947113487115154d-2*rhoa*t50-2.4735567435575762d
     1         -2*rhoa*t40-1.243628d-1*rhoa*t25*t26-2.0d+0*rhoa*t19)*wgh
     2         t+fnc(iq)
            Amat(iq,D1_RA) = (4.947113487115154d-2*rhoa*t67*(-1.35890221
     1         087399d-1*gammaaa*t28*t45*(t70-3.6932304374364355d-2*t34*
     2         t35*t41*t69/t42**3.0d+0+t68-8.617537687351684d-2*t34*t46*
     3         t61*t66)*t71+1.35890221087399d-1*gammaaa*t28*t48*(t70+t68
     4         )-3.1707718253726436d-1*gammaaa*t45*t48*t61*t62)-2.473556
     5         7435575762d-2*rhoa*t60*(-2.717804421747982d-1*gammaaa*t28
     6         *t33*t65*(-3.447015074940678d-1*t34*t36*t61*t66+t64+t63+1
     7         .1944679893212155d+1*t29*t34*t35*t57/t30**3.0d+0)+2.71780
     8         4421747982d-1*gammaaa*t28*t38*(t64+t63)-6.341543650745292
     9         d-1*gammaaa*t33*t38*t61*t62)-1.243628d-1*rhoa*t26*t58*t59
     :         -2.0d+0*rhoa*t57+4.947113487115154d-2*t50-2.4735567435575
     ;         762d-2*t40-1.243628d-1*t25*t26+4.36181817014282d-3*t25/rh
     <         oa**3.3333333333333326d-1-2.0d+0*t19)*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = t72+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t72+Cmat(iq,D1_GAB)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhoa**3.333333333333333d-1
            t2 = t1**5.0d-1
            t3 = 1/t2
            t4 = 1.530901310039024d-2*t3+1.0465751434d-1
            t5 = 7.876233178997433d-1*t3*t4+1.9269083139d-1
            t6 = 7.876233178997433d-1*t3*t5+4.3896648423d-1
            t7 = 1/t6
            t8 = 1.269642451250142d+0*t2*t7+1.0d+0
            t9 = log(t8)
            t10 = 1/t1
            t11 = 1.2746961887000874d-1*t10+1.0d+0
            t12 = 2.4141993114533214d-2*t3+1.0186556948d-1
            t13 = 7.876233178997433d-1*t12*t3+2.2308199064d-1
            t14 = 7.876233178997433d-1*t13*t3+4.7231125998d-1
            t15 = 1/t14
            t16 = 1.269642451250142d+0*t15*t2+1.0d+0
            t17 = log(t16)
            t18 = 1.325688999052018d-1*t10+1.0d+0
            t19 = 9.999999999999991d-1*(6.21814d-2*t17*t18-3.10907d-2*t1
     1         1*t9)-6.21814d-2*t17*t18
            t20 = rhoa**1.1666666666666667d+0
            t21 = 1/t20**2.0d+0
            t22 = exp(-8.085523023512745d+1*t19)
            t23 = t22-1.0d+0
            t24 = 1/t23
            t25 = 2.717804421747982d-1*gammaaa*t21*t24
            t26 = t25+1.0d+0
            t27 = gammaaa**2.0d+0
            t28 = 1/t20**4.0d+0
            t29 = 1/t23**2.0d+0
            t30 = 7.386460874872881d-2*t27*t28*t29+t25+1.0d+0
            t31 = 1/t30
            t32 = 2.717804421747982d-1*gammaaa*t21*t26*t31+1.0d+0
            t33 = log(t32)
            t34 = rhob**3.333333333333333d-1
            t35 = t34**5.0d-1
            t36 = 1/t35
            t37 = 1.530901310039024d-2*t36+1.0465751434d-1
            t38 = 7.876233178997433d-1*t36*t37+1.9269083139d-1
            t39 = 7.876233178997433d-1*t36*t38+4.3896648423d-1
            t40 = 1/t39
            t41 = 1.269642451250142d+0*t35*t40+1.0d+0
            t42 = log(t41)
            t43 = 1/t34
            t44 = 1.2746961887000874d-1*t43+1.0d+0
            t45 = 2.4141993114533214d-2*t36+1.0186556948d-1
            t46 = 7.876233178997433d-1*t36*t45+2.2308199064d-1
            t47 = 7.876233178997433d-1*t36*t46+4.7231125998d-1
            t48 = 1/t47
            t49 = 1.269642451250142d+0*t35*t48+1.0d+0
            t50 = log(t49)
            t51 = 1.325688999052018d-1*t43+1.0d+0
            t52 = 9.999999999999991d-1*(6.21814d-2*t50*t51-3.10907d-2*t4
     1         2*t44)-6.21814d-2*t50*t51
            t53 = rhob+rhoa
            t54 = t53**3.333333333333333d-1
            t55 = 1/t54
            t56 = 1.325688999052018d-1*t55+1.0d+0
            t57 = t54**5.0d-1
            t58 = 1/t57
            t59 = 2.4141993114533214d-2*t58+1.0186556948d-1
            t60 = 7.876233178997433d-1*t58*t59+2.2308199064d-1
            t61 = 7.876233178997433d-1*t58*t60+4.7231125998d-1
            t62 = 1/t61
            t63 = 1.269642451250142d+0*t57*t62+1.0d+0
            t64 = log(t63)
            t65 = rhoa-rhob
            t66 = 1/t53
            t67 = 1.0d+0-t65*t66
            t68 = t65*t66+1.0d+0
            t69 = 1.923661050931536d+0*t68**1.3333333333333333d+0+1.9236
     1         61050931536d+0*t67**1.3333333333333333d+0-3.8473221018630
     2         72d+0
            t70 = 6.901399211255826d-2*t55+1.0d+0
            t71 = 1.3212998810398843d-2*t58+2.9729725188d-2
            t72 = 7.876233178997433d-1*t58*t71+1.2236585478d-1
            t73 = 7.876233178997433d-1*t58*t72+3.497952466d-1
            t74 = 1/t73
            t75 = 1.269642451250142d+0*t57*t74+1.0d+0
            t76 = log(t75)
            t77 = t65**4
            t78 = 1/t53**4
            t79 = 1.2746961887000874d-1*t55+1.0d+0
            t80 = 1.530901310039024d-2*t58+1.0465751434d-1
            t81 = 7.876233178997433d-1*t58*t80+1.9269083139d-1
            t82 = 7.876233178997433d-1*t58*t81+4.3896648423d-1
            t83 = 1/t82
            t84 = 1.269642451250142d+0*t57*t83+1.0d+0
            t85 = log(t84)
            t86 = 1.709920934161365d+0*(6.21814d-2*t56*t64-3.10907d-2*t7
     1         9*t85)-3.37738d-2*t70*t76
            t87 = t77*t78*t86+3.37738d-2*t70*t76
            t88 = 5.848223622634648d-1*t69*t87-6.21814d-2*t56*t64
            t89 = rhob**1.1666666666666667d+0
            t90 = 1/t89**2.0d+0
            t91 = exp(-8.085523023512745d+1*t52)
            t92 = t91-1.0d+0
            t93 = 1/t92
            t94 = 2.717804421747982d-1*gammabb*t90*t93
            t95 = t94+1.0d+0
            t96 = gammabb**2.0d+0
            t97 = 1/t89**4.0d+0
            t98 = 1/t92**2.0d+0
            t99 = 7.386460874872881d-2*t96*t97*t98+t94+1.0d+0
            t100 = 1/t99
            t101 = 2.717804421747982d-1*gammabb*t100*t90*t95+1.0d+0
            t102 = log(t101)
            t103 = 5.0d-1*t68**6.666666666666666d-1+5.0d-1*t67**6.666666
     1         666666666d-1
            t104 = t103**3.0d+0
            t105 = gammabb+2.0d+0*gammaab+gammaaa
            t106 = t53**1.1666666666666667d+0
            t107 = 1/t106**2.0d+0
            t108 = t103**2.0d+0
            t109 = 1/t108
            t110 = 1/t104
            t111 = exp(-4.042761511756372d+1*t110*t88)
            t112 = t111-1.0d+0
            t113 = 1/t112
            t114 = 1.712109500228822d-1*t105*t107*t109*t113
            t115 = t114+1.0d+0
            t116 = t105**2.0d+0
            t117 = 1/t106**4.0d+0
            t118 = 1/t103**4.0d+0
            t119 = 1/t112**2.0d+0
            t120 = 2.931318940773786d-2*t116*t117*t118*t119+t114+1.0d+0
            t121 = 1/t120
            t122 = 1.712109500228822d-1*t105*t107*t109*t115*t121+1.0d+0
            t123 = log(t122)
            t124 = 1/rhoa**1.3333333333333333d+0
            t125 = 1/rhoa**1.3333333333333336d+0
            t126 = 1/t2**3
            t127 = 1/rhoa**6.666666666666667d-1
            t128 = 1/t16
            t129 = 2.11607075208357d-1*t127*t15*t3-1.269642451250142d+0*
     1         t2*(7.876233178997433d-1*(-1.3127055298329054d-1*t12*t126
     2         *t127-3.169132786263567d-3*t125)*t3-1.3127055298329054d-1
     3         *t126*t127*t13)/t14**2
            t130 = 9.999999999999991d-1*(1.3210398931339265d-3*t124*t9-3
     1         .10907d-2*t11*(2.11607075208357d-1*t127*t3*t7-1.269642451
     2         250142d+0*t2*(7.876233178997433d-1*t3*(-1.312705529832905
     3         4d-1*t126*t127*t4-2.0096226153166658d-3*t125)-1.312705529
     4         8329054d-1*t126*t127*t5)/t6**2)/t8+6.21814d-2*t128*t129*t
     5         18-2.747773264188438d-3*t124*t17)-6.21814d-2*t128*t129*t1
     6         8+2.747773264188438d-3*t124*t17
            t131 = 1/t32
            t132 = rhoa**1.6666666666666674d-1
            t133 = 1/t20**3.0d+0
            t134 = -6.341543650745292d-1*gammaaa*t132*t133*t24
            t135 = 2.197487022544805d+1*gammaaa*t130*t21*t22/t23**2
            t136 = 1/t30**2
            t137 = 1/t53**1.3333333333333336d+0
            t138 = 1/t53**6.666666666666667d-1
            t139 = 1/t57**3
            t140 = 2.11607075208357d-1*t138*t58*t62-1.269642451250142d+0
     1         *t57*(7.876233178997433d-1*t58*(-1.3127055298329054d-1*t1
     2         38*t139*t59-3.169132786263567d-3*t137)-1.3127055298329054
     3         d-1*t138*t139*t60)/t61**2
            t141 = 1/t63
            t142 = -6.21814d-2*t140*t141*t56
            t143 = 1/t53**1.3333333333333333d+0
            t144 = 2.747773264188438d-3*t143*t64
            t145 = 2.11607075208357d-1*t138*t58*t74-1.269642451250142d+0
     1         *t57*(7.876233178997433d-1*t58*(-1.3127055298329054d-1*t1
     2         38*t139*t71-1.7344776604086162d-3*t137)-1.312705529832905
     3         4d-1*t138*t139*t72)/t73**2
            t146 = 1/t75
            t147 = 3.37738d-2*t145*t146*t70
            t148 = -7.769549222703733d-4*t143*t76
            t149 = t77*t78*(1.709920934161365d+0*(1.3210398931339265d-3*
     1         t143*t85-3.10907d-2*t79*(2.11607075208357d-1*t138*t58*t83
     2         -1.269642451250142d+0*t57*(7.876233178997433d-1*t58*(-1.3
     3         127055298329054d-1*t138*t139*t80-2.0096226153166658d-3*t1
     4         37)-1.3127055298329054d-1*t138*t139*t81)/t82**2)/t84-2.74
     5         7773264188438d-3*t143*t64+6.21814d-2*t140*t141*t56)+7.769
     6         549222703733d-4*t143*t76-3.37738d-2*t145*t146*t70)
            t150 = -4*t77*t86/t53**5
            t151 = t65**3
            t152 = 1/t53**2
            t153 = t152*t65
            t154 = -t66
            t155 = t154+t153
            t156 = t67**3.333333333333333d-1
            t157 = -t152*t65
            t158 = t66+t157
            t159 = t68**3.333333333333333d-1
            t160 = 5.848223622634648d-1*(2.564881401242048d+0*t158*t159+
     1         2.564881401242048d+0*t155*t156)*t87+5.848223622634648d-1*
     2         t69*(4*t151*t78*t86+t150+t149+t148+t147)+t144+t142
            t161 = 1.0d+0*t88
            t162 = 1/t122
            t163 = 1/t156
            t164 = 1/t159
            t165 = 3.333333333333333d-1*t158*t164+3.333333333333333d-1*t
     1         155*t163
            t166 = t53**1.6666666666666674d-1
            t167 = 1/t106**3.0d+0
            t168 = -3.9949221672005847d-1*t105*t109*t115*t121*t166*t167
            t169 = -3.424219000457644d-1*t105*t107*t110*t113*t165
            t170 = -3.9949221672005847d-1*t105*t109*t113*t166*t167
            t171 = 1/t112**2
            t172 = 1.2128284535269115d+2*t118*t165*t88-4.042761511756372
     1         d+1*t110*t160
            t173 = -1.712109500228822d-1*t105*t107*t109*t111*t171*t172
            t174 = 1/t120**2
            t175 = 1/t103**5.0d+0
            t176 = -1.367948839027767d-1*t116*t118*t119*t166/t106**5.0d+
     1         0
            t177 = 1/t112**3.0d+0
            t178 = 2.473556743557577d-2*t104*t123
            t179 = 1/rhob**1.3333333333333333d+0
            t180 = 1/rhob**1.3333333333333336d+0
            t181 = 1/t35**3
            t182 = 1/rhob**6.666666666666667d-1
            t183 = 1/t49
            t184 = 2.11607075208357d-1*t182*t36*t48-1.269642451250142d+0
     1         *t35*(7.876233178997433d-1*t36*(-1.3127055298329054d-1*t1
     2         81*t182*t45-3.169132786263567d-3*t180)-1.3127055298329054
     3         d-1*t181*t182*t46)/t47**2
            t185 = 9.999999999999991d-1*(6.21814d-2*t183*t184*t51-2.7477
     1         73264188438d-3*t179*t50-3.10907d-2*(2.11607075208357d-1*t
     2         182*t36*t40-1.269642451250142d+0*t35*(7.876233178997433d-
     3         1*t36*(-1.3127055298329054d-1*t181*t182*t37-2.00962261531
     4         66658d-3*t180)-1.3127055298329054d-1*t181*t182*t38)/t39**
     5         2)*t44/t41+1.3210398931339265d-3*t179*t42)-6.21814d-2*t18
     6         3*t184*t51+2.747773264188438d-3*t179*t50
            t186 = 1/t101
            t187 = rhob**1.6666666666666674d-1
            t188 = 1/t89**3.0d+0
            t189 = -6.341543650745292d-1*gammabb*t187*t188*t93
            t190 = 2.197487022544805d+1*gammabb*t185*t90*t91/t92**2
            t191 = 1/t99**2
            t192 = t66+t153
            t193 = t157+t154
            t194 = 5.848223622634648d-1*(2.564881401242048d+0*t159*t193+
     1         2.564881401242048d+0*t156*t192)*t87+5.848223622634648d-1*
     2         t69*(-4*t151*t78*t86+t150+t149+t148+t147)+t144+t142
            t195 = 3.333333333333333d-1*t164*t193+3.333333333333333d-1*t
     1         163*t192
            t196 = -3.424219000457644d-1*t105*t107*t110*t113*t195
            t197 = 1.2128284535269115d+2*t118*t195*t88-4.042761511756372
     1         d+1*t110*t194
            t198 = -1.712109500228822d-1*t105*t107*t109*t111*t171*t197
            t199 = 2.473556743557577d-2*t104*t162*(-1.712109500228822d-1
     1         *t105*t107*t109*t115*(5.862637881547572d-2*t105*t117*t118
     2         *t119+1.712109500228822d-1*t107*t109*t113)*t174+2.9313189
     3         407737866d-2*t105*t113*t117*t118*t121+1.712109500228822d-
     4         1*t107*t109*t115*t121)*t53
            fnc(iq) = (1.0d+0*t53*t88+2.473556743557577d-2*t104*t123*t53
     1         -1.0d+0*rhob*t52-1.2367783717787881d-2*rhoa*t33-1.0d+0*rh
     2         oa*t19-1.2367783717787881d-2*rhob*t102)*wght+fnc(iq)
            Amat(iq,D1_RA) = (2.473556743557577d-2*t104*t162*(-1.7121095
     1         00228822d-1*t105*t107*t109*t115*t174*(-5.862637881547572d
     2         -2*t111*t116*t117*t118*t172*t177+t176-1.1725275763095144d
     3         -1*t116*t117*t119*t165*t175+t173+t170+t169)+1.71210950022
     4         8822d-1*t105*t107*t109*t121*(t173+t170+t169)+t168-3.42421
     5         9000457644d-1*t105*t107*t110*t115*t121*t165)*t53+7.420670
     6         230672731d-2*t108*t123*t165*t53+1.0d+0*t160*t53-1.2367783
     7         717787881d-2*t33-1.2367783717787881d-2*rhoa*t131*(-6.3415
     8         43650745292d-1*gammaaa*t132*t133*t26*t31+2.71780442174798
     9         2d-1*gammaaa*(t135+t134)*t21*t31-2.717804421747982d-1*gam
     :         maaa*t136*t21*t26*(-3.447015074940678d-1*t132*t27*t29/t20
     ;         **5.0d+0+1.1944679893212155d+1*t130*t22*t27*t28/t23**3.0d
     <         +0+t135+t134))-1.0d+0*t19+t178+t161-1.0d+0*rhoa*t130)*wgh
     =         t+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = (-1.2367783717787881d-2*rhob*t186*(-2.71780
     1         4421747982d-1*gammabb*t191*t90*t95*(-3.447015074940678d-1
     2         *t187*t96*t98/t89**5.0d+0+1.1944679893212155d+1*t185*t91*
     3         t96*t97/t92**3.0d+0+t190+t189)-6.341543650745292d-1*gamma
     4         bb*t100*t187*t188*t95+2.717804421747982d-1*gammabb*t100*(
     5         t190+t189)*t90)+2.473556743557577d-2*t104*t162*(-1.712109
     6         500228822d-1*t105*t107*t109*t115*t174*(t198-5.86263788154
     7         7572d-2*t111*t116*t117*t118*t177*t197+t196-1.172527576309
     8         5144d-1*t116*t117*t119*t175*t195+t176+t170)+1.71210950022
     9         8822d-1*t105*t107*t109*t121*(t198+t196+t170)-3.4242190004
     :         57644d-1*t105*t107*t110*t115*t121*t195+t168)*t53+7.420670
     ;         230672731d-2*t108*t123*t195*t53+1.0d+0*t194*t53-1.0d+0*t5
     <         2-1.0d+0*rhob*t185+t178+t161-1.2367783717787881d-2*t102)*
     =         wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = (t199-1.2367783717787881d-2*rhoa*t131*(7.3
     1         86460874872882d-2*gammaaa*t24*t28*t31+2.717804421747982d-
     2         1*t21*t26*t31-2.717804421747982d-1*gammaaa*t136*t21*t26*(
     3         1.4772921749745763d-1*gammaaa*t28*t29+2.717804421747982d-
     4         1*t21*t24)))*wght+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = 2.473556743557577d-2*t104*t162*(-1.7121095
     1         00228822d-1*t105*t107*t109*t115*(1.1725275763095144d-1*t1
     2         05*t117*t118*t119+3.424219000457644d-1*t107*t109*t113)*t1
     3         74+5.862637881547573d-2*t105*t113*t117*t118*t121+3.424219
     4         000457644d-1*t107*t109*t115*t121)*t53*wght+Cmat(iq,D1_GAB
     5         )
            Cmat(iq,D1_GBB) = (t199-1.2367783717787881d-2*rhob*t186*(-2.
     1         717804421747982d-1*gammabb*t191*t90*t95*(1.47729217497457
     2         63d-1*gammabb*t97*t98+2.717804421747982d-1*t90*t93)+7.386
     3         460874872882d-2*gammabb*t100*t93*t97+2.717804421747982d-1
     4         *t100*t90*t95))*wght+Cmat(iq,D1_GBB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = rhoa**3.333333333333333d-1
            t2 = t1**5.0d-1
            t3 = 1/t2
            t4 = 1.530901310039024d-2*t3+1.0465751434d-1
            t5 = 7.876233178997433d-1*t3*t4+1.9269083139d-1
            t6 = 7.876233178997433d-1*t3*t5+4.3896648423d-1
            t7 = 1/t6
            t8 = 1.269642451250142d+0*t2*t7+1.0d+0
            t9 = log(t8)
            t10 = 1/t1
            t11 = 1.2746961887000874d-1*t10+1.0d+0
            t12 = 2.4141993114533214d-2*t3+1.0186556948d-1
            t13 = 7.876233178997433d-1*t12*t3+2.2308199064d-1
            t14 = 7.876233178997433d-1*t13*t3+4.7231125998d-1
            t15 = 1/t14
            t16 = 1.269642451250142d+0*t15*t2+1.0d+0
            t17 = log(t16)
            t18 = 1.325688999052018d-1*t10+1.0d+0
            t19 = 9.999999999999991d-1*(6.21814d-2*t17*t18-3.10907d-2*t1
     1         1*t9)-6.21814d-2*t17*t18
            t20 = rhoa**1.1666666666666667d+0
            t21 = 1/t20**2.0d+0
            t22 = exp(-8.085523023512745d+1*t19)
            t23 = t22-1.0d+0
            t24 = 1/t23
            t25 = 2.717804421747982d-1*gammaaa*t21*t24
            t26 = t25+1.0d+0
            t27 = gammaaa**2.0d+0
            t28 = 1/t20**4.0d+0
            t29 = 1/t23**2.0d+0
            t30 = 7.386460874872881d-2*t27*t28*t29+t25+1.0d+0
            t31 = 1/t30
            t32 = 2.717804421747982d-1*gammaaa*t21*t26*t31+1.0d+0
            t33 = log(t32)
            t34 = rhob+rhoa
            t35 = t34**3.333333333333333d-1
            t36 = 1/t35
            t37 = 1.325688999052018d-1*t36+1.0d+0
            t38 = t35**5.0d-1
            t39 = 1/t38
            t40 = 2.4141993114533214d-2*t39+1.0186556948d-1
            t41 = 7.876233178997433d-1*t39*t40+2.2308199064d-1
            t42 = 7.876233178997433d-1*t39*t41+4.7231125998d-1
            t43 = 1/t42
            t44 = 1.269642451250142d+0*t38*t43+1.0d+0
            t45 = log(t44)
            t46 = rhoa-rhob
            t47 = 1/t34
            t48 = t46*t47+1.0d+0
            t49 = 1.923661050931536d+0*t48**1.3333333333333333d+0-3.8473
     1         22101863072d+0
            t50 = 6.901399211255826d-2*t36+1.0d+0
            t51 = 1.3212998810398843d-2*t39+2.9729725188d-2
            t52 = 7.876233178997433d-1*t39*t51+1.2236585478d-1
            t53 = 7.876233178997433d-1*t39*t52+3.497952466d-1
            t54 = 1/t53
            t55 = 1.269642451250142d+0*t38*t54+1.0d+0
            t56 = log(t55)
            t57 = t46**4
            t58 = 1/t34**4
            t59 = 1.2746961887000874d-1*t36+1.0d+0
            t60 = 1.530901310039024d-2*t39+1.0465751434d-1
            t61 = 7.876233178997433d-1*t39*t60+1.9269083139d-1
            t62 = 7.876233178997433d-1*t39*t61+4.3896648423d-1
            t63 = 1/t62
            t64 = 1.269642451250142d+0*t38*t63+1.0d+0
            t65 = log(t64)
            t66 = 1.709920934161365d+0*(6.21814d-2*t37*t45-3.10907d-2*t5
     1         9*t65)-3.37738d-2*t50*t56
            t67 = t57*t58*t66+3.37738d-2*t50*t56
            t68 = 5.848223622634648d-1*t49*t67-6.21814d-2*t37*t45
            t69 = abs(t48)
            t70 = t69**2.0d+0
            t71 = 1/t34**1.1666666666666667d+0
            t72 = 1/t48**6.666666666666666d-1
            t73 = t71*t72
            t74 = t73**2.0d+0
            t75 = sigmabb+2.0d+0*sigmaab+gammaaa
            t76 = 1/t70
            t77 = exp(-3.234209209405097d+2*t68*t76)
            t78 = t77-1.0d+0
            t79 = 1/t78
            t80 = 6.848438000915288d-1*t74*t75*t79
            t81 = t80+1.0d+0
            t82 = t73**4.0d+0
            t83 = 1/t78**2.0d+0
            t84 = t75**2.0d+0
            t85 = 4.6901103052380577d-1*t82*t83*t84+t80+1.0d+0
            t86 = 1/t85
            t87 = 6.848438000915288d-1*t74*t75*t81*t86+1.0d+0
            t88 = log(t87)
            t89 = 1/rhoa**1.3333333333333333d+0
            t90 = 1/rhoa**1.3333333333333336d+0
            t91 = 1/t2**3
            t92 = 1/rhoa**6.666666666666667d-1
            t93 = 1/t16
            t94 = 2.11607075208357d-1*t15*t3*t92-1.269642451250142d+0*t2
     1         *(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t12*t91
     2         *t92-3.169132786263567d-3*t90)-1.3127055298329054d-1*t13*
     3         t91*t92)/t14**2
            t95 = 9.999999999999991d-1*(6.21814d-2*t18*t93*t94-3.10907d-
     1         2*t11*(2.11607075208357d-1*t3*t7*t92-1.269642451250142d+0
     2         *t2*(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t4*t
     3         91*t92-2.0096226153166658d-3*t90)-1.3127055298329054d-1*t
     4         5*t91*t92)/t6**2)/t8+1.3210398931339265d-3*t89*t9-2.74777
     5         3264188438d-3*t17*t89)-6.21814d-2*t18*t93*t94+2.747773264
     6         188438d-3*t17*t89
            t96 = 1/t32
            t97 = rhoa**1.6666666666666674d-1
            t98 = 1/t20**3.0d+0
            t99 = -6.341543650745292d-1*gammaaa*t24*t97*t98
            t100 = 2.197487022544805d+1*gammaaa*t21*t22*t95/t23**2
            t101 = 1/t30**2
            t102 = 1/t34**1.3333333333333336d+0
            t103 = 1/t34**6.666666666666667d-1
            t104 = 1/t38**3
            t105 = 2.11607075208357d-1*t103*t39*t43-1.269642451250142d+0
     1         *t38*(7.876233178997433d-1*t39*(-1.3127055298329054d-1*t1
     2         03*t104*t40-3.169132786263567d-3*t102)-1.3127055298329054
     3         d-1*t103*t104*t41)/t42**2
            t106 = 1/t44
            t107 = 1/t34**1.3333333333333333d+0
            t108 = 2.11607075208357d-1*t103*t39*t54-1.269642451250142d+0
     1         *t38*(7.876233178997433d-1*t39*(-1.3127055298329054d-1*t1
     2         03*t104*t51-1.7344776604086162d-3*t102)-1.312705529832905
     3         4d-1*t103*t104*t52)/t53**2
            t109 = 1/t55
            t110 = t47-t46/t34**2
            t111 = 1.5000000000000002d+0*t110*t48**3.333333333333333d-1*
     1         t67+5.848223622634648d-1*t49*(4*t46**3*t58*t66-4*t57*t66/
     2         t34**5+t57*t58*(1.709920934161365d+0*(1.3210398931339265d
     3         -3*t107*t65-3.10907d-2*t59*(2.11607075208357d-1*t103*t39*
     4         t63-1.269642451250142d+0*t38*(7.876233178997433d-1*t39*(-
     5         1.3127055298329054d-1*t103*t104*t60-2.0096226153166658d-3
     6         *t102)-1.3127055298329054d-1*t103*t104*t61)/t62**2)/t64-2
     7         .747773264188438d-3*t107*t45+6.21814d-2*t105*t106*t37)+7.
     8         769549222703733d-4*t107*t56-3.37738d-2*t108*t109*t50)-7.7
     9         69549222703733d-4*t107*t56+3.37738d-2*t108*t109*t50)+2.74
     :         7773264188438d-3*t107*t45-6.21814d-2*t105*t106*t37
            t112 = 1/t87
            t113 = 1/t85**2
            t114 = -1.1666666666666667d+0*t72/t34**2.166666666666667d+0-
     1         6.666666666666666d-1*t110*t71/t48**1.6666666666666669d+0
            t115 = 1.3696876001830577d+0*t114*t71*t72*t75*t79
            t116 = 6.468418418810195d+2*t110*t48*t68/t69**4.0d+0-3.23420
     1         9209405097d+2*t111*t76
            t117 = -6.848438000915288d-1*t116*t74*t75*t77/t78**2
            fnc(iq) = (3.0919459294469714d-3*t34*t70*t88+1.0d+0*t34*t68-
     1         1.2367783717787881d-2*rhoa*t33-1.0d+0*rhoa*t19)*wght+fnc(
     2         iq)
            Amat(iq,D1_RA) = (-1.2367783717787881d-2*rhoa*t96*(-2.717804
     1         421747982d-1*gammaaa*t101*t21*t26*(t99-3.447015074940678d
     2         -1*t27*t29*t97/t20**5.0d+0+1.1944679893212155d+1*t22*t27*
     3         t28*t95/t23**3.0d+0+t100)+2.717804421747982d-1*gammaaa*t2
     4         1*t31*(t99+t100)-6.341543650745292d-1*gammaaa*t26*t31*t97
     5         *t98)-1.0d+0*rhoa*t95+3.0919459294469714d-3*t70*t88+6.183
     6         891858893943d-3*t110*t34*t48*t88+3.0919459294469714d-3*t1
     7         12*t34*t70*(1.3696876001830577d+0*t114*t71*t72*t75*t81*t8
     8         6+6.848438000915288d-1*(t117+t115)*t74*t75*t86-6.84843800
     9         0915288d-1*t113*t74*t75*t81*(1.8760441220952231d+0*t114*t
     :         73**3.0d+0*t83*t84-9.380220610476115d-1*t116*t77*t82*t84/
     ;         t78**3.0d+0+t117+t115))+1.0d+0*t68+1.0d+0*t111*t34-1.2367
     <         783717787881d-2*t33-1.0d+0*t19)*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = (3.0919459294469714d-3*t112*t34*t70*(4.690
     1         110305238058d-1*t75*t79*t82*t86+6.848438000915288d-1*t74*
     2         t81*t86-6.848438000915288d-1*t113*t74*t75*t81*(9.38022061
     3         0476115d-1*t75*t82*t83+6.848438000915288d-1*t74*t79))-1.2
     4         367783717787881d-2*rhoa*(7.386460874872882d-2*gammaaa*t24
     5         *t28*t31+2.717804421747982d-1*t21*t26*t31-2.7178044217479
     6         82d-1*gammaaa*t101*t21*t26*(1.4772921749745763d-1*gammaaa
     7         *t28*t29+2.717804421747982d-1*t21*t24))*t96)*wght+Cmat(iq
     8         ,D1_GAA)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob**3.333333333333333d-1
            t2 = t1**5.0d-1
            t3 = 1/t2
            t4 = 1.1771443702974159d-2*t3+2.9729725188d-2
            t5 = 7.016926042943223d-1*t3*t4+1.2236585478d-1
            t6 = 7.016926042943223d-1*t3*t5+3.497952466d-1
            t7 = 1/t6
            t8 = 1.4251254664507676d+0*t2*t7+1.0d+0
            t9 = log(t8)
            t10 = 1/t1
            t11 = 5.477644184000001d-2*t10+1.0d+0
            t12 = 2.150807071909054d-2*t3+1.0186556948d-1
            t13 = 7.016926042943223d-1*t12*t3+2.2308199064d-1
            t14 = 7.016926042943223d-1*t13*t3+4.7231125998d-1
            t15 = 1/t14
            t16 = 1.4251254664507676d+0*t15*t2+1.0d+0
            t17 = log(t16)
            t18 = 1.0522000558389215d-1*t10+1.0d+0
            t19 = -3.799552500000001d-2*t11*t9-6.21814d-2*t17*t18
            t20 = 1.530901310039024d-2*t3+1.0465751434d-1
            t21 = 7.876233178997433d-1*t20*t3+1.9269083139d-1
            t22 = 7.876233178997433d-1*t21*t3+4.3896648423d-1
            t23 = 1/t22
            t24 = 1.269642451250142d+0*t2*t23+1.0d+0
            t25 = log(t24)
            t26 = 1.2746961887000874d-1*t10+1.0d+0
            t27 = 2.4141993114533214d-2*t3+1.0186556948d-1
            t28 = 7.876233178997433d-1*t27*t3+2.2308199064d-1
            t29 = 7.876233178997433d-1*t28*t3+4.7231125998d-1
            t30 = 1/t29
            t31 = 1.269642451250142d+0*t2*t30+1.0d+0
            t32 = log(t31)
            t33 = 1.325688999052018d-1*t10+1.0d+0
            t34 = 9.999999999999991d-1*(6.21814d-2*t32*t33-3.10907d-2*t2
     1         5*t26)-6.21814d-2*t32*t33
            t35 = rhob**1.1666666666666667d+0
            t36 = 1/t35**2.0d+0
            t37 = exp(-8.085523023512745d+1*t34)
            t38 = t37-1.0d+0
            t39 = 1/t38
            t40 = 2.717804421747982d-1*gammabb*t36*t39
            t41 = t40+1.0d+0
            t42 = gammabb**2.0d+0
            t43 = 1/t35**4.0d+0
            t44 = 1/t38**2.0d+0
            t45 = 7.386460874872881d-2*t42*t43*t44+t40+1.0d+0
            t46 = 1/t45
            t47 = 2.717804421747982d-1*gammabb*t36*t41*t46+1.0d+0
            t48 = log(t47)
            t49 = sigmabb+2.0d+0*sigmaab+gammabb
            t50 = exp(-3.234209209405097d+2*t19)
            t51 = t50-1.0d+0
            t52 = 1/t51
            t53 = 1.35890221087399d-1*t36*t49*t52
            t54 = t53+1.0d+0
            t55 = 1/t51**2.0d+0
            t56 = t49**2.0d+0
            t57 = 1.8466152187182178d-2*t43*t55*t56+t53+1.0d+0
            t58 = 1/t57
            t59 = 1.35890221087399d-1*t36*t49*t54*t58+1.0d+0
            t60 = log(t59)
            t61 = 1/rhob**1.3333333333333333d+0
            t62 = 1/rhob**1.3333333333333336d+0
            t63 = 1/t2**3
            t64 = 1/rhob**6.666666666666667d-1
            t65 = 6.937532217809221d-4*t61*t9-3.799552500000001d-2*t11*(
     1         2.375209110751279d-1*t3*t64*t7-1.4251254664507676d+0*t2*(
     2         7.016926042943223d-1*t3*(-1.1694876738238705d-1*t4*t63*t6
     3         4-1.3766558313739896d-3*t62)-1.1694876738238705d-1*t5*t63
     4         *t64)/t6**2)/t8-6.21814d-2*t18*(2.375209110751279d-1*t15*
     5         t3*t64-1.4251254664507676d+0*t2*(7.016926042943223d-1*t3*
     6         (-1.1694876738238705d-1*t12*t63*t64-2.51534235937085d-3*t
     7         62)-1.1694876738238705d-1*t13*t63*t64)/t14**2)/t16+2.1809
     8         0908507141d-3*t17*t61
            t66 = 1/t31
            t67 = 2.11607075208357d-1*t3*t30*t64-1.269642451250142d+0*t2
     1         *(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t27*t63
     2         *t64-3.169132786263567d-3*t62)-1.3127055298329054d-1*t28*
     3         t63*t64)/t29**2
            t68 = 9.999999999999991d-1*(6.21814d-2*t33*t66*t67-3.10907d-
     1         2*t26*(2.11607075208357d-1*t23*t3*t64-1.269642451250142d+
     2         0*t2*(7.876233178997433d-1*t3*(-1.3127055298329054d-1*t20
     3         *t63*t64-2.0096226153166658d-3*t62)-1.3127055298329054d-1
     4         *t21*t63*t64)/t22**2)/t24-2.747773264188438d-3*t32*t61+1.
     5         3210398931339265d-3*t25*t61)-6.21814d-2*t33*t66*t67+2.747
     6         773264188438d-3*t32*t61
            t69 = 1/t47
            t70 = rhob**1.6666666666666674d-1
            t71 = 1/t35**3.0d+0
            t72 = -6.341543650745292d-1*gammabb*t39*t70*t71
            t73 = 2.197487022544805d+1*gammabb*t36*t37*t68/t38**2
            t74 = 1/t45**2
            t75 = 1/t35**5.0d+0
            t76 = 1/t59
            t77 = 1/t57**2
            t78 = -3.1707718253726436d-1*t49*t52*t70*t71
            t79 = 4.3949740450896063d+1*t36*t49*t50*t65/t51**2
            fnc(iq) = (6.183891858893943d-3*rhob*t60-1.2367783717787881d
     1         -2*rhob*t48-1.0d+0*rhob*t34+2.0d+0*rhob*t19)*wght+fnc(iq)
            Amat(iq,D1_RB) = (6.183891858893943d-3*rhob*t76*(-1.35890221
     1         087399d-1*t36*t49*t54*t77*(t79+t78-8.617537687351684d-2*t
     2         55*t56*t70*t75+1.1944679893212137d+1*t43*t50*t56*t65/t51*
     3         *3.0d+0)+1.35890221087399d-1*t36*t49*t58*(t79+t78)-3.1707
     4         718253726436d-1*t49*t54*t58*t70*t71)-1.2367783717787881d-
     5         2*rhob*t69*(-2.717804421747982d-1*gammabb*t36*t41*t74*(-3
     6         .447015074940678d-1*t42*t44*t70*t75+t73+t72+1.19446798932
     7         12155d+1*t37*t42*t43*t68/t38**3.0d+0)+2.717804421747982d-
     8         1*gammabb*t36*t46*(t73+t72)-6.341543650745292d-1*gammabb*
     9         t41*t46*t70*t71)-1.0d+0*rhob*t68+2.0d+0*rhob*t65+6.183891
     :         858893943d-3*t60-1.2367783717787881d-2*t48-1.0d+0*t34+2.0
     ;         d+0*t19)*wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GBB) = (6.183891858893943d-3*rhob*t76*(-1.3589022
     1         1087399d-1*t36*t49*t54*(3.6932304374364355d-2*t43*t49*t55
     2         +1.35890221087399d-1*t36*t52)*t77+1.35890221087399d-1*t36
     3         *t54*t58+1.8466152187182183d-2*t43*t49*t52*t58)-1.2367783
     4         717787881d-2*rhob*t69*(-2.717804421747982d-1*gammabb*t36*
     5         t41*(1.4772921749745763d-1*gammabb*t43*t44+2.717804421747
     6         982d-1*t36*t39)*t74+7.386460874872882d-2*gammabb*t39*t43*
     7         t46+2.717804421747982d-1*t36*t41*t46))*wght+Cmat(iq,D1_GB
     8         B)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_opt functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_2} &=& \sqrt{{\it t_1}}\\\\ 
C>   {\it t_3} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_5} &=& \log \left({{1.269642451250142\,{\it t_2}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_3}+0.10186556948\right)\,{\it t_3}+0.22308199064\right)\,{\it t_3}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_6} &=& 0.1325688999052018\,{\it t_4}+1.0\\\\ 
C>   {\it t_7} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_5}\,{\it t_6}-0.0310907\,\log \left({{1.269642451250142\,{\it t_2}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_3}+0.10465751434\right)\,{\it t_3}+0.19269083139\right)\,{\it t_3}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_4}+1.0\right)\right)-0.0621814\,{\it t_5}\,{\it t_6}\\\\ 
C>   {\it t_8} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_9} &=& \sqrt{{\it t_8}}\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}}}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_8}}}\\\\ 
C>   {\it t_{12}} &=& \log \left({{1.269642451250142\,{\it t_9}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{10}}+0.10186556948\right)\,{\it t_{10}}+0.22308199064\right)\,{\it t_{10}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{13}} &=& 0.1325688999052018\,{\it t_{11}}+1.0\\\\ 
C>   {\it t_{14}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{12}}\,{\it t_{13}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_9}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{10}}+0.10465751434\right)\,{\it t_{10}}+0.19269083139\right)\,{\it t_{10}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{11}}+1.0\right)\right)-0.0621814\,{\it t_{12}}\,{\it t_{13}}\\\\ 
C>   {\it t_{15}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{16}} &=& {\it t_{15}}^{0.3333333333333333}\\\\ 
C>   {\it t_{17}} &=& {{1}\over{{\it t_{16}}}}\\\\ 
C>   {\it t_{18}} &=& 0.1325688999052018\,{\it t_{17}}+1.0\\\\ 
C>   {\it t_{19}} &=& \sqrt{{\it t_{16}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{{\it t_{19}}}}\\\\ 
C>   {\it t_{21}} &=& \log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.02414199311453321\,{\it t_{20}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{22}} &=& -\rho_\beta\\\\ 
C>   {\it t_{23}} &=& {\it t_{22}}+\rho_\alpha\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{15}}}}\\\\ 
C>   {\it t_{25}} &=& 1.0-{\it t_{23}}\,{\it t_{24}}\\\\ 
C>   {\it t_{26}} &=& {\it t_{23}}\,{\it t_{24}}+1.0\\\\ 
C>   {\it t_{27}} &=& 0.06901399211255826\,{\it t_{17}}+1.0\\\\ 
C>   {\it t_{28}} &=& \log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.01321299881039884\,{\it t_{20}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{29}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{26}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{25}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{23}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{18}}\,{\it t_{21}}-0.0310907\,\left(0.1274696188700087\,{\it t_{17}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.01530901310039024\,{\it t_{20}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{27}}\,{\it t_{28}}\right)}\over{{\it t_{15}}^4}}+0.0337738\,{\it t_{27}}\,{\it t_{28}}\right)-0.0621814\,{\it t_{18}}\,{\it t_{21}}\\\\ 
C>   {\it t_{30}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{31}} &=& {{1}\over{{\it t_{30}}^{2.0}}}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{e^{80.85523023512745\,{\it t_7}}}}-1.0\\\\ 
C>   {\it t_{33}} &=& {{0.2717804421747982\,{\it t_{31}}\,\sigma_{\alpha\alpha}}\over{{\it t_{32}}}}\\\\ 
C>   {\it t_{34}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{34}}^{2.0}}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{e^{80.85523023512745\,{\it t_{14}}}}}-1.0\\\\ 
C>   {\it t_{37}} &=& {{0.2717804421747982\,{\it t_{35}}\,\sigma_{\beta\beta}}\over{{\it t_{36}}}}\\\\ 
C>   {\it t_{38}} &=& 0.5\,{\it t_{26}}^{{{2}\over{3}}}+0.5\,{\it t_{25}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{39}} &=& {\it t_{38}}^{3.0}\\\\ 
C>   {\it t_{40}} &=& {\it t_{15}}^{1.166666666666667}\\\\ 
C>   {\it t_{41}} &=& {{1}\over{{\it t_{40}}^{2.0}}}\\\\ 
C>   {\it t_{42}} &=& {{1}\over{{\it t_{38}}^{2.0}}}\\\\ 
C>   {\it t_{43}} &=& 2.0\,\sigma_{\alpha\beta}\\\\ 
C>   {\it t_{44}} &=& \sigma_{\beta\beta}+{\it t_{43}}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{e^{{{40.42761511756372\,{\it t_{29}}}\over{{\it t_{39}}}}}}}-1.0\\\\ 
C>   {\it t_{46}} &=& {{0.1712109500228822\,{\it t_{41}}\,{\it t_{42}}\,{\it t_{44}}}\over{{\it t_{45}}}}\\\\ 
C>   {\it t_{47}} &=& \rho_s^{0.3333333333333333}\\\\ 
C>   {\it t_{48}} &=& \sqrt{{\it t_{47}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{{\it t_{48}}}}\\\\ 
C>   {\it t_{50}} &=& {{1}\over{{\it t_{47}}}}\\\\ 
C>   {\it t_{51}} &=& \log \left({{1.269642451250142\,{\it t_{48}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{49}}+0.10186556948\right)\,{\it t_{49}}+0.22308199064\right)\,{\it t_{49}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{52}} &=& 0.1325688999052018\,{\it t_{50}}+1.0\\\\ 
C>   {\it t_{53}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{51}}\,{\it t_{52}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{48}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{49}}+0.10465751434\right)\,{\it t_{49}}+0.19269083139\right)\,{\it t_{49}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{50}}+1.0\right)\right)-0.0621814\,{\it t_{51}}\,{\it t_{52}}\\\\ 
C>   {\it t_{54}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{55}} &=& {\it t_{54}}^{0.3333333333333333}\\\\ 
C>   {\it t_{56}} &=& {{1}\over{{\it t_{55}}}}\\\\ 
C>   {\it t_{57}} &=& 0.1325688999052018\,{\it t_{56}}+1.0\\\\ 
C>   {\it t_{58}} &=& \sqrt{{\it t_{55}}}\\\\ 
C>   {\it t_{59}} &=& {{1}\over{{\it t_{58}}}}\\\\ 
C>   {\it t_{60}} &=& \log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.02414199311453321\,{\it t_{59}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{61}} &=& \rho_s+{\it t_{22}}\\\\ 
C>   {\it t_{62}} &=& {{{\it t_{61}}}\over{{\it t_{54}}}}+1.0\\\\ 
C>   {\it t_{63}} &=& 0.06901399211255826\,{\it t_{56}}+1.0\\\\ 
C>   {\it t_{64}} &=& \log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.01321299881039884\,{\it t_{59}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{65}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{62}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{61}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{57}}\,{\it t_{60}}-0.0310907\,\left(0.1274696188700087\,{\it t_{56}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.01530901310039024\,{\it t_{59}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{63}}\,{\it t_{64}}\right)}\over{{\it t_{54}}^4}}+0.0337738\,{\it t_{63}}\,{\it t_{64}}\right)-0.0621814\,{\it t_{57}}\,{\it t_{60}}\\\\ 
C>   {\it t_{66}} &=& \rho_s^{1.166666666666667}\\\\ 
C>   {\it t_{67}} &=& {{1}\over{{\it t_{66}}^{2.0}}}\\\\ 
C>   {\it t_{68}} &=& {{1}\over{e^{80.85523023512745\,{\it t_{53}}}}}-1.0\\\\ 
C>   {\it t_{69}} &=& {{0.2717804421747982\,{\it t_{67}}\,\sigma_{ss}}\over{{\it t_{68}}}}\\\\ 
C>   {\it t_{70}} &=& \left| {\it t_{62}}\right| ^{2.0}\\\\ 
C>   {\it t_{71}} &=& {{1}\over{{\it t_{54}}^{1.166666666666667}\,{\it t_{62}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{72}} &=& {\it t_{71}}^{2.0}\\\\ 
C>   {\it t_{73}} &=& \sigma_{ss}+\sigma_{\beta\beta}+{\it t_{43}}\\\\ 
C>   {\it t_{74}} &=& {{1}\over{e^{{{323.4209209405097\,{\it t_{65}}}\over{{\it t_{70}}}}}}}-1.0\\\\ 
C>   {\it t_{75}} &=& {{0.6848438000915288\,{\it t_{72}}\,{\it t_{73}}}\over{{\it t_{74}}}}\\\\ 
C>   f &=& 0.02473556743557577\,{\it t_{15}}\,{\it t_{39}}\,\log \left({{0.1712109500228822\,{\it t_{41}}\,{\it t_{42}}\,{\it t_{44}}\,\left({\it t_{46}}+1.0\right)}\over{{{0.02931318940773786\,{\it t_{44}}^{2.0}}\over{{\it t_{40}}^{4.0}\,{\it t_{38}}^{4.0}\,{\it t_{45}}^{2.0}}}+{\it t_{46}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_\beta\,\log \left({{0.2717804421747982\,{\it t_{35}}\,\sigma_{\beta\beta}\,\left({\it t_{37}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{34}}^{4.0}\,{\it t_{36}}^{2.0}}}+{\it t_{37}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_\alpha\,\log \left({{0.2717804421747982\,{\it t_{31}}\,\sigma_{\alpha\alpha}\,\left({\it t_{33}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{30}}^{4.0}\,{\it t_{32}}^{2.0}}}+{\it t_{33}}+1.0}}+1.0\right)+1.0\,{\it t_{15}}\,{\it t_{29}}-1.0\,{\it t_{14}}\,\rho_\beta-1.0\,{\it t_7}\,\rho_\alpha\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.003091945929446971\,{\it t_{54}}\,{\it t_{70}}\,\log \left({{0.6848438000915288\,{\it t_{72}}\,{\it t_{73}}\,\left({\it t_{75}}+1.0\right)}\over{{{0.4690110305238058\,{\it t_{71}}^{4.0}\,{\it t_{73}}^{2.0}}\over{{\it t_{74}}^{2.0}}}+{\it t_{75}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_s\,\log \left({{0.2717804421747982\,{\it t_{67}}\,\sigma_{ss}\,\left({\it t_{69}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{ss}^{2.0}}\over{{\it t_{66}}^{4.0}\,{\it t_{68}}^{2.0}}}+{\it t_{69}}+1.0}}+1.0\right)+1.0\,{\it t_{54}}\,{\it t_{65}}-1.0\,{\it t_{53}}\,\rho_s\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] NC Handy, AJ Cohen, Mol.Phys. 99, 607 (2001)  , DOI: 
C> <a href="http://dx.doi.org/10.1080/00268970010023435 "> 
C> 10.1080/00268970010023435 </a> 
C> 
      subroutine nwxcm_c_opt_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,fnc,Amat,Amat2,Cmat,Cmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision rgamma(nq,*) !< [Input] The norm of the density 
                                    !< gradients 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,*)   !< [Output] The derivative wrt rgamma 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,*)  !< [Output] The 2nd derivative wrt rgamma 
                                    !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_opt functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\alpha^{0.3333333333333333}\\\\ 
C>   {\it t_2} &=& \sqrt{{\it t_1}}\\\\ 
C>   {\it t_3} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_5} &=& \log \left({{1.269642451250142\,{\it t_2}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_3}+0.10186556948\right)\,{\it t_3}+0.22308199064\right)\,{\it t_3}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_6} &=& 0.1325688999052018\,{\it t_4}+1.0\\\\ 
C>   {\it t_7} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_5}\,{\it t_6}-0.0310907\,\log \left({{1.269642451250142\,{\it t_2}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_3}+0.10465751434\right)\,{\it t_3}+0.19269083139\right)\,{\it t_3}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_4}+1.0\right)\right)-0.0621814\,{\it t_5}\,{\it t_6}\\\\ 
C>   {\it t_8} &=& \rho_\beta^{0.3333333333333333}\\\\ 
C>   {\it t_9} &=& \sqrt{{\it t_8}}\\\\ 
C>   {\it t_{10}} &=& {{1}\over{{\it t_9}}}\\\\ 
C>   {\it t_{11}} &=& {{1}\over{{\it t_8}}}\\\\ 
C>   {\it t_{12}} &=& \log \left({{1.269642451250142\,{\it t_9}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{10}}+0.10186556948\right)\,{\it t_{10}}+0.22308199064\right)\,{\it t_{10}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{13}} &=& 0.1325688999052018\,{\it t_{11}}+1.0\\\\ 
C>   {\it t_{14}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{12}}\,{\it t_{13}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_9}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{10}}+0.10465751434\right)\,{\it t_{10}}+0.19269083139\right)\,{\it t_{10}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{11}}+1.0\right)\right)-0.0621814\,{\it t_{12}}\,{\it t_{13}}\\\\ 
C>   {\it t_{15}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{16}} &=& {\it t_{15}}^{0.3333333333333333}\\\\ 
C>   {\it t_{17}} &=& {{1}\over{{\it t_{16}}}}\\\\ 
C>   {\it t_{18}} &=& 0.1325688999052018\,{\it t_{17}}+1.0\\\\ 
C>   {\it t_{19}} &=& \sqrt{{\it t_{16}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{{\it t_{19}}}}\\\\ 
C>   {\it t_{21}} &=& \log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.02414199311453321\,{\it t_{20}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{22}} &=& -\rho_\beta\\\\ 
C>   {\it t_{23}} &=& {\it t_{22}}+\rho_\alpha\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{15}}}}\\\\ 
C>   {\it t_{25}} &=& 1.0-{\it t_{23}}\,{\it t_{24}}\\\\ 
C>   {\it t_{26}} &=& {\it t_{23}}\,{\it t_{24}}+1.0\\\\ 
C>   {\it t_{27}} &=& 0.06901399211255826\,{\it t_{17}}+1.0\\\\ 
C>   {\it t_{28}} &=& \log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.01321299881039884\,{\it t_{20}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{29}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{26}}^{{{4}\over{3}}}+1.923661050931536\,{\it t_{25}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{23}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{18}}\,{\it t_{21}}-0.0310907\,\left(0.1274696188700087\,{\it t_{17}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{19}}}\over{0.7876233178997433\,{\it t_{20}}\,\left(0.7876233178997433\,{\it t_{20}}\,\left(0.01530901310039024\,{\it t_{20}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{27}}\,{\it t_{28}}\right)}\over{{\it t_{15}}^4}}+0.0337738\,{\it t_{27}}\,{\it t_{28}}\right)-0.0621814\,{\it t_{18}}\,{\it t_{21}}\\\\ 
C>   {\it t_{30}} &=& \rho_\alpha^{1.166666666666667}\\\\ 
C>   {\it t_{31}} &=& {{1}\over{{\it t_{30}}^{2.0}}}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{e^{80.85523023512745\,{\it t_7}}}}-1.0\\\\ 
C>   {\it t_{33}} &=& {{0.2717804421747982\,{\it t_{31}}\,\sigma_{\alpha\alpha}}\over{{\it t_{32}}}}\\\\ 
C>   {\it t_{34}} &=& \rho_\beta^{1.166666666666667}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{{\it t_{34}}^{2.0}}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{e^{80.85523023512745\,{\it t_{14}}}}}-1.0\\\\ 
C>   {\it t_{37}} &=& {{0.2717804421747982\,{\it t_{35}}\,\sigma_{\beta\beta}}\over{{\it t_{36}}}}\\\\ 
C>   {\it t_{38}} &=& 0.5\,{\it t_{26}}^{{{2}\over{3}}}+0.5\,{\it t_{25}}^{{{2}\over{3}}}\\\\ 
C>   {\it t_{39}} &=& {\it t_{38}}^{3.0}\\\\ 
C>   {\it t_{40}} &=& {\it t_{15}}^{1.166666666666667}\\\\ 
C>   {\it t_{41}} &=& {{1}\over{{\it t_{40}}^{2.0}}}\\\\ 
C>   {\it t_{42}} &=& {{1}\over{{\it t_{38}}^{2.0}}}\\\\ 
C>   {\it t_{43}} &=& 2.0\,\sigma_{\alpha\beta}\\\\ 
C>   {\it t_{44}} &=& \sigma_{\beta\beta}+{\it t_{43}}+\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{45}} &=& {{1}\over{e^{{{40.42761511756372\,{\it t_{29}}}\over{{\it t_{39}}}}}}}-1.0\\\\ 
C>   {\it t_{46}} &=& {{0.1712109500228822\,{\it t_{41}}\,{\it t_{42}}\,{\it t_{44}}}\over{{\it t_{45}}}}\\\\ 
C>   {\it t_{47}} &=& \rho_s^{0.3333333333333333}\\\\ 
C>   {\it t_{48}} &=& \sqrt{{\it t_{47}}}\\\\ 
C>   {\it t_{49}} &=& {{1}\over{{\it t_{48}}}}\\\\ 
C>   {\it t_{50}} &=& {{1}\over{{\it t_{47}}}}\\\\ 
C>   {\it t_{51}} &=& \log \left({{1.269642451250142\,{\it t_{48}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.02414199311453321\,{\it t_{49}}+0.10186556948\right)\,{\it t_{49}}+0.22308199064\right)\,{\it t_{49}}+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{52}} &=& 0.1325688999052018\,{\it t_{50}}+1.0\\\\ 
C>   {\it t_{53}} &=& 0.9999999999999991\,\left(0.0621814\,{\it t_{51}}\,{\it t_{52}}-0.0310907\,\log \left({{1.269642451250142\,{\it t_{48}}}\over{0.7876233178997433\,\left(0.7876233178997433\,\left(0.01530901310039024\,{\it t_{49}}+0.10465751434\right)\,{\it t_{49}}+0.19269083139\right)\,{\it t_{49}}+0.43896648423}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{50}}+1.0\right)\right)-0.0621814\,{\it t_{51}}\,{\it t_{52}}\\\\ 
C>   {\it t_{54}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{55}} &=& {\it t_{54}}^{0.3333333333333333}\\\\ 
C>   {\it t_{56}} &=& {{1}\over{{\it t_{55}}}}\\\\ 
C>   {\it t_{57}} &=& 0.1325688999052018\,{\it t_{56}}+1.0\\\\ 
C>   {\it t_{58}} &=& \sqrt{{\it t_{55}}}\\\\ 
C>   {\it t_{59}} &=& {{1}\over{{\it t_{58}}}}\\\\ 
C>   {\it t_{60}} &=& \log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.02414199311453321\,{\it t_{59}}+0.10186556948\right)+0.22308199064\right)+0.47231125998}}+1.0\right)\\\\ 
C>   {\it t_{61}} &=& \rho_s+{\it t_{22}}\\\\ 
C>   {\it t_{62}} &=& {{{\it t_{61}}}\over{{\it t_{54}}}}+1.0\\\\ 
C>   {\it t_{63}} &=& 0.06901399211255826\,{\it t_{56}}+1.0\\\\ 
C>   {\it t_{64}} &=& \log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.01321299881039884\,{\it t_{59}}+0.029729725188\right)+0.12236585478\right)+0.3497952466}}+1.0\right)\\\\ 
C>   {\it t_{65}} &=& 0.5848223622634648\,\left(1.923661050931536\,{\it t_{62}}^{{{4}\over{3}}}-3.847322101863072\right)\,\left({{{\it t_{61}}^4\,\left(1.709920934161365\,\left(0.0621814\,{\it t_{57}}\,{\it t_{60}}-0.0310907\,\left(0.1274696188700087\,{\it t_{56}}+1.0\right)\,\log \left({{1.269642451250142\,{\it t_{58}}}\over{0.7876233178997433\,{\it t_{59}}\,\left(0.7876233178997433\,{\it t_{59}}\,\left(0.01530901310039024\,{\it t_{59}}+0.10465751434\right)+0.19269083139\right)+0.43896648423}}+1.0\right)\right)-0.0337738\,{\it t_{63}}\,{\it t_{64}}\right)}\over{{\it t_{54}}^4}}+0.0337738\,{\it t_{63}}\,{\it t_{64}}\right)-0.0621814\,{\it t_{57}}\,{\it t_{60}}\\\\ 
C>   {\it t_{66}} &=& \rho_s^{1.166666666666667}\\\\ 
C>   {\it t_{67}} &=& {{1}\over{{\it t_{66}}^{2.0}}}\\\\ 
C>   {\it t_{68}} &=& {{1}\over{e^{80.85523023512745\,{\it t_{53}}}}}-1.0\\\\ 
C>   {\it t_{69}} &=& {{0.2717804421747982\,{\it t_{67}}\,\sigma_{ss}}\over{{\it t_{68}}}}\\\\ 
C>   {\it t_{70}} &=& \left| {\it t_{62}}\right| ^{2.0}\\\\ 
C>   {\it t_{71}} &=& {{1}\over{{\it t_{54}}^{1.166666666666667}\,{\it t_{62}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{72}} &=& {\it t_{71}}^{2.0}\\\\ 
C>   {\it t_{73}} &=& \sigma_{ss}+\sigma_{\beta\beta}+{\it t_{43}}\\\\ 
C>   {\it t_{74}} &=& {{1}\over{e^{{{323.4209209405097\,{\it t_{65}}}\over{{\it t_{70}}}}}}}-1.0\\\\ 
C>   {\it t_{75}} &=& {{0.6848438000915288\,{\it t_{72}}\,{\it t_{73}}}\over{{\it t_{74}}}}\\\\ 
C>   f &=& 0.02473556743557577\,{\it t_{15}}\,{\it t_{39}}\,\log \left({{0.1712109500228822\,{\it t_{41}}\,{\it t_{42}}\,{\it t_{44}}\,\left({\it t_{46}}+1.0\right)}\over{{{0.02931318940773786\,{\it t_{44}}^{2.0}}\over{{\it t_{40}}^{4.0}\,{\it t_{38}}^{4.0}\,{\it t_{45}}^{2.0}}}+{\it t_{46}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_\beta\,\log \left({{0.2717804421747982\,{\it t_{35}}\,\sigma_{\beta\beta}\,\left({\it t_{37}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{\beta\beta}^{2.0}}\over{{\it t_{34}}^{4.0}\,{\it t_{36}}^{2.0}}}+{\it t_{37}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_\alpha\,\log \left({{0.2717804421747982\,{\it t_{31}}\,\sigma_{\alpha\alpha}\,\left({\it t_{33}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{\alpha\alpha}^{2.0}}\over{{\it t_{30}}^{4.0}\,{\it t_{32}}^{2.0}}}+{\it t_{33}}+1.0}}+1.0\right)+1.0\,{\it t_{15}}\,{\it t_{29}}-1.0\,{\it t_{14}}\,\rho_\beta-1.0\,{\it t_7}\,\rho_\alpha\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 0.003091945929446971\,{\it t_{54}}\,{\it t_{70}}\,\log \left({{0.6848438000915288\,{\it t_{72}}\,{\it t_{73}}\,\left({\it t_{75}}+1.0\right)}\over{{{0.4690110305238058\,{\it t_{71}}^{4.0}\,{\it t_{73}}^{2.0}}\over{{\it t_{74}}^{2.0}}}+{\it t_{75}}+1.0}}+1.0\right)-0.01236778371778788\,\rho_s\,\log \left({{0.2717804421747982\,{\it t_{67}}\,\sigma_{ss}\,\left({\it t_{69}}+1.0\right)}\over{{{0.07386460874872881\,\sigma_{ss}^{2.0}}\over{{\it t_{66}}^{4.0}\,{\it t_{68}}^{2.0}}}+{\it t_{69}}+1.0}}+1.0\right)+1.0\,{\it t_{54}}\,{\it t_{65}}-1.0\,{\it t_{53}}\,\rho_s\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] NC Handy, AJ Cohen, Mol.Phys. 99, 607 (2001)  , DOI: 
C> <a href="http://dx.doi.org/10.1080/00268970010023435 "> 
C> 10.1080/00268970010023435 </a> 
C> 
      subroutine nwxcm_c_opt_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision rgamma(nq,*) !< [Input] The norm of the density 
                                    !< gradients 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,*)   !< [Output] The derivative wrt rgamma 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,*)  !< [Output] The 2nd derivative wrt rgamma 
                                    !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,*)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,*)  !< [Output] The 3rd derivative wrt rgamma 
                                    !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
