C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_vwn3.F 
C> The nwxcm_c_vwn3 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_vwn3 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {\it t_1}^{.3333333333333333}\\\\ 
C>   {\it t_3} &=& {{1}\over{\sqrt{{\it t_2}}}}\\\\ 
C>   {\it t_4} &=& 1.575246635799487\,{\it t_3}\\\\ 
C>   {\it t_5} &=& \arctan \left({{6.15199081975908}\over{{\it t_4}+3.72744}}\right)\\\\ 
C>   {\it t_6} &=& .7876233178997433\,{\it t_3}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_8} &=& .6203504908994001\,{\it t_7}\\\\ 
C>   {\it t_9} &=& {{1}\over{\left| 2.935818660072219\,{\it t_3}+{\it t_8}+12.9352\right| }}\\\\ 
C>   {\it t_{10}} &=& \log \left(1.0\,\left({\it t_6}+0.10498\right)^2\,{\it t_9}\right)\\\\ 
C>   {\it t_{11}} &=& \left| {\it t_7}\right| \\\\ 
C>   {\it t_{12}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_9}\right)\\\\ 
C>   {\it t_{13}} &=& -\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}+\rho_\alpha\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_3}+{\it t_8}+18.0578\right| }}\\\\ 
C>   {\it t_{17}} &=& \arctan \left({{6.692072046645942}\over{{\it t_4}+1.06835}}\right)\\\\ 
C>   {\it t_{18}} &=& {{1}\over{\left| .8414573716781907\,{\it t_3}+{\it t_8}+11.4813\right| }}\\\\ 
C>   {\it t_{19}} &=& \log \left(1.0\,\left({\it t_6}+0.228344\right)^2\,{\it t_{18}}\right)\\\\ 
C>   {\it t_{20}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{18}}\right)\\\\ 
C>   {\it t_{21}} &=& {{1}\over{\left| 10.29581201158544\,{\it t_3}+{\it t_8}+42.7198\right| }}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\left| 15.84942278842832\,{\it t_3}+{\it t_8}+101.578\right| }}\\\\ 
C>   {\it t_{23}} &=& 0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{22}}\right)+.002667310007273315\,\log \left(1.0\,\left({\it t_6}+0.743294\right)^2\,{\it t_{22}}\right)-0.0310907\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{21}}\right)-.004431373767749538\,\log \left(1.0\,\left({\it t_6}+0.409286\right)^2\,{\it t_{21}}\right)+.6188180297906176\,\arctan \left({{1.171685277708971}\over{{\it t_4}+20.1231}}\right)-20.52197293770518\,\arctan \left({{0.0448998886415768}\over{{\it t_4}+13.072}}\right)\\\\ 
C>   {\it t_{24}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{25}} &=& {\it t_{24}}^{.3333333333333333}\\\\ 
C>   {\it t_{26}} &=& {{1}\over{\sqrt{{\it t_{25}}}}}\\\\ 
C>   {\it t_{27}} &=& 1.575246635799487\,{\it t_{26}}\\\\ 
C>   {\it t_{28}} &=& \arctan \left({{6.15199081975908}\over{{\it t_{27}}+3.72744}}\right)\\\\ 
C>   {\it t_{29}} &=& .7876233178997433\,{\it t_{26}}\\\\ 
C>   {\it t_{30}} &=& {{1}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{31}} &=& .6203504908994001\,{\it t_{30}}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{\left| 2.935818660072219\,{\it t_{26}}+{\it t_{31}}+12.9352\right| }}\\\\ 
C>   {\it t_{33}} &=& \log \left(1.0\,\left({\it t_{29}}+0.10498\right)^2\,{\it t_{32}}\right)\\\\ 
C>   {\it t_{34}} &=& \left| {\it t_{30}}\right| \\\\ 
C>   {\it t_{35}} &=& \log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{32}}\right)\\\\ 
C>   {\it t_{36}} &=& \rho_s+{\it t_{13}}\\\\ 
C>   {\it t_{37}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_{26}}+{\it t_{31}}+18.0578\right| }}\\\\ 
C>   {\it t_{38}} &=& \arctan \left({{6.692072046645942}\over{{\it t_{27}}+1.06835}}\right)\\\\ 
C>   {\it t_{39}} &=& {{1}\over{\left| .8414573716781907\,{\it t_{26}}+{\it t_{31}}+11.4813\right| }}\\\\ 
C>   {\it t_{40}} &=& \log \left(1.0\,\left({\it t_{29}}+0.228344\right)^2\,{\it t_{39}}\right)\\\\ 
C>   {\it t_{41}} &=& \log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{39}}\right)\\\\ 
C>   {\it t_{42}} &=& {{1}\over{\left| 10.29581201158544\,{\it t_{26}}+{\it t_{31}}+42.7198\right| }}\\\\ 
C>   {\it t_{43}} &=& {{1}\over{\left| 15.84942278842832\,{\it t_{26}}+{\it t_{31}}+101.578\right| }}\\\\ 
C>   {\it t_{44}} &=& 0.01554535\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{43}}\right)+.002667310007273315\,\log \left(1.0\,\left({\it t_{29}}+0.743294\right)^2\,{\it t_{43}}\right)-0.0310907\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{42}}\right)-.004431373767749538\,\log \left(1.0\,\left({\it t_{29}}+0.409286\right)^2\,{\it t_{42}}\right)+.6188180297906176\,\arctan \left({{1.171685277708971}\over{{\it t_{27}}+20.1231}}\right)-20.52197293770518\,\arctan \left({{0.0448998886415768}\over{{\it t_{27}}+13.072}}\right)\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left({{1.125\,\left(\left({\it t_{14}}\,{\it t_{15}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{14}}\,{\it t_{15}}\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{16}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_6}+0.325\right)^2\,{\it t_{16}}\right)-0.0310907\,{\it t_{12}}-9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_4}+7.06042}}\right)-.03878329487811301\,{\it t_5}\right)\,\left({{{\it t_{14}}^4\,\left(1.709920934161365\,{\it t_{23}}+.01688686394038963\,{\it t_{20}}+3.6490335179177674 \times 10^{-4}\,{\it t_{19}}+.005458482358638966\,{\it t_{17}}\right)}\over{{\it t_1}^4}}-.01688686394038963\,{\it t_{20}}-3.6490335179177674 \times 10^{-4}\,{\it t_{19}}-.005458482358638966\,{\it t_{17}}\right)}\over{{\it t_{23}}}}+0.0310907\,{\it t_{12}}+9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.03878329487811301\,{\it t_5}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{24}}\,\left({{1.125\,\left(\left({{{\it t_{36}}}\over{{\it t_{24}}}}+1.0\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{37}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_{29}}+0.325\right)^2\,{\it t_{37}}\right)-0.0310907\,{\it t_{35}}-9.690227711544375 \times 10^{-4}\,{\it t_{33}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_{27}}+7.06042}}\right)-.03878329487811301\,{\it t_{28}}\right)\,\left({{{\it t_{36}}^4\,\left(1.709920934161365\,{\it t_{44}}+.01688686394038963\,{\it t_{41}}+3.6490335179177674 \times 10^{-4}\,{\it t_{40}}+.005458482358638966\,{\it t_{38}}\right)}\over{{\it t_{24}}^4}}-.01688686394038963\,{\it t_{41}}-3.6490335179177674 \times 10^{-4}\,{\it t_{40}}-.005458482358638966\,{\it t_{38}}\right)}\over{{\it t_{44}}}}+0.0310907\,{\it t_{35}}+9.690227711544375 \times 10^{-4}\,{\it t_{33}}+.03878329487811301\,{\it t_{28}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] SH Vosko, L Wilk, M Nusair, Can.J.Phys. 58, 1200 (1980)  , DOI: 
C> <a href="http://dx.doi.org/10.1139/p80-159 "> 
C> 10.1139/p80-159 </a> 
C> 
      subroutine nwxcm_c_vwn3(param,tol_rho,ipol,nq,wght, 
     +rho,fnc,Amat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = 1/rhoa**1.6666666666666666d-1
            t2 = 1.4033852085886447d+0*t1+3.72744d+0
            t3 = 7.016926042943223d-1*t1+1.0498d-1
            t4 = t3**2
            t5 = rhoa**3.333333333333333d-1
            t6 = 1/t5
            t7 = 4.9237251092134837d-1*t6
            t8 = t7+2.615517080950829d+0*t1+1.29352d+1
            t9 = 1/t8
            t10 = t7+2.615517080950829d+0/t5**5.0d-1+1.29352d+1
            t11 = 1/t10
            t12 = 9.690227711544375d-4*log(1.0d+0*t4*t9)+3.10907d-2*log(
     1         4.9237251092134837d-1*t11*t6)+3.8783294878113006d-2*atan(
     2         6.15199081975908d+0/t2)
            t13 = 1/t2**2
            t14 = 1/rhoa**1.1666666666666667d+0
            t15 = 1/rhoa**1.3333333333333333d+0
            t16 = -1.6412417030711612d-1*t15-4.359195134918048d-1*t14
            fnc(iq) = 2.0d+0*rhoa*t12*wght+fnc(iq)
            Amat(iq,D1_RA) = 2.0d+0*rhoa*(9.690227711544375d-4*t8*(-2.33
     1         8975347647741d-1*t14*t3*t9-1.0d+0*t16*t4/t8**2)/t4+6.3144
     2         67057030003d-2*t10*t5*(-4.9237251092134837d-1*t16*t6/t10*
     3         *2-1.6412417030711612d-1*t11*t15)+5.580665928883042d-2*t1
     4         3*t14/(3.784699104639999d+1*t13+1))*wght+2.0d+0*t12*wght+
     5         Amat(iq,D1_RA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = rhob+rhoa
            t2 = t1**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.5752466357994865d+0*t4
            t6 = t5+3.72744d+0
            t7 = atan(6.15199081975908d+0/t6)
            t8 = 7.876233178997433d-1*t4
            t9 = t8+1.0498d-1
            t10 = t9**2
            t11 = 1/t2
            t12 = 6.203504908994001d-1*t11
            t13 = 2.935818660072219d+0*t4+t12+1.29352d+1
            t14 = abs(t13)
            t15 = 1/t14
            t16 = log(1.0d+0*t10*t15)
            t17 = abs(t11)
            t18 = log(6.203504908994001d-1*t15*t17)
            t19 = rhoa-rhob
            t20 = 1/t1
            t21 = 1.0d+0-t19*t20
            t22 = t19*t20+1.0d+0
            t23 = t22**1.3333333333333333d+0+t21**1.3333333333333333d+0-
     1         2.0d+0
            t24 = t5+7.06042d+0
            t25 = t8+3.25d-1
            t26 = t25**2
            t27 = 5.560951426165704d+0*t4+t12+1.8057800000000002d+1
            t28 = abs(t27)
            t29 = 1/t28
            t30 = -3.8783294878113006d-2*t7+2.2478670955426108d-3*log(1.
     1         0d+0*t26*t29)+1.554535d-2*log(6.203504908994001d-1*t17*t2
     2         9)+5.249139316978092d-2*atan(4.7309269095601136d+0/t24)-3
     3         .10907d-2*t18-9.690227711544375d-4*t16
            t31 = t5+1.0683499999999999d+0
            t32 = atan(6.692072046645942d+0/t31)
            t33 = t8+2.28344d-1
            t34 = t33**2
            t35 = 8.414573716781907d-1*t4+t12+1.14813d+1
            t36 = abs(t35)
            t37 = 1/t36
            t38 = log(1.0d+0*t34*t37)
            t39 = log(6.203504908994001d-1*t17*t37)
            t40 = t19**4
            t41 = 1/t1**4
            t42 = t5+1.3072d+1
            t43 = t5+2.0123100000000002d+1
            t44 = t8+4.09286d-1
            t45 = t44**2
            t46 = 1.0295812011585444d+1*t4+t12+4.2719799999999997d+1
            t47 = abs(t46)
            t48 = 1/t47
            t49 = t8+7.43294d-1
            t50 = t49**2
            t51 = 1.5849422788428325d+1*t4+t12+1.01578d+2
            t52 = abs(t51)
            t53 = 1/t52
            t54 = 2.667310007273315d-3*log(1.0d+0*t50*t53)+1.554535d-2*l
     1         og(6.203504908994001d-1*t17*t53)-4.431373767749538d-3*log
     2         (1.0d+0*t45*t48)-3.10907d-2*log(6.203504908994001d-1*t17*
     3         t48)+6.188180297906176d-1*atan(1.171685277708971d+0/t43)-
     4         2.052197293770518d+1*atan(4.4899888641576796d-2/t42)
            t55 = 1.709920934161365d+0*t54+1.688686394038963d-2*t39+3.64
     1         90335179177674d-4*t38+5.458482358638966d-3*t32
            t56 = t40*t41*t55-1.688686394038963d-2*t39-3.649033517917767
     1         4d-4*t38-5.458482358638966d-3*t32
            t57 = 1/t54
            t58 = 3.8783294878113006d-2*t7+1.1250000000000002d+0*t23*t30
     1         *t56*t57+3.10907d-2*t18+9.690227711544375d-4*t16
            t59 = 1/t1**6.666666666666667d-1
            t60 = 1/t3**3
            t61 = 1/t6**2
            t62 = 1/(3.784699104639999d+1*t61+1)
            t63 = 6.264085709464389d-2*t59*t60*t61*t62
            t64 = 1/t10
            t65 = -2.067834969664667d-1/t1**1.3333333333333333d+0
            t66 = t65-4.8930311001203647d-1*t59*t60
            t67 = 1/t13
            t68 = -2.625411059665811d-1*t15*t59*t60*t9-1.0d+0*t10*t15*t6
     1         6*t67
            t69 = 9.690227711544375d-4*t14*t64*t68
            t70 = 1/t17
            t71 = 1/t1**1.6666666666666666d+0
            t72 = -2.067834969664667d-1*t15*t70*t71-6.203504908994001d-1
     1         *t15*t17*t66*t67
            t73 = 5.011795824473985d-2*t14*t70*t72
            t74 = 1/t42**2
            t75 = 1/t43**2
            t76 = t65-1.715968668597574d+0*t59*t60
            t77 = 1/t46
            t78 = t65-2.641570464738054d+0*t59*t60
            t79 = 1/t51
            t80 = 2.667310007273315d-3*t52*(-1.0d+0*t50*t53*t78*t79-2.62
     1         5411059665811d-1*t49*t53*t59*t60)/t50+2.5058979122369923d
     2         -2*t52*t70*(-6.203504908994001d-1*t17*t53*t78*t79-2.06783
     3         4969664667d-1*t53*t70*t71)-4.431373767749538d-3*t47*(-1.0
     4         d+0*t45*t48*t76*t77-2.625411059665811d-1*t44*t48*t59*t60)
     5         /t45-5.011795824473985d-2*t47*t70*(-6.203504908994001d-1*
     6         t17*t48*t76*t77-2.067834969664667d-1*t48*t70*t71)+1.90358
     7         04775132142d-1*t59*t60*t75/(1.3728463899999485d+0*t75+1)-
     8         2.4191438009473537d-1*t59*t60*t74/(2.016000000025997d-3*t
     9         74+1)
            t81 = -1.1250000000000002d+0*t23*t30*t56*t80/t54**2
            t82 = 1/t31**2
            t83 = 1/(4.4783828277500004d+1*t82+1)
            t84 = -9.590247809108334d-3*t59*t60*t82*t83
            t85 = 1/t34
            t86 = t65-1.4024289527969844d-1*t59*t60
            t87 = 1/t35
            t88 = -1.0d+0*t34*t37*t86*t87-2.625411059665811d-1*t33*t37*t
     1         59*t60
            t89 = -3.6490335179177674d-4*t36*t85*t88
            t90 = -6.203504908994001d-1*t17*t37*t86*t87-2.06783496966466
     1         7d-1*t37*t70*t71
            t91 = -2.722148880047894d-2*t36*t70*t90
            t92 = t40*t41*(2.722148880047894d-2*t36*t70*t90+3.6490335179
     1         177674d-4*t36*t85*t88+9.590247809108334d-3*t59*t60*t82*t8
     2         3+1.709920934161365d+0*t80)
            t93 = -4*t40*t55/t1**5
            t94 = t19**3
            t95 = 1/t24**2
            t96 = t65-9.26825237694284d-1*t59*t60
            t97 = 1/t27
            t98 = 1.1250000000000002d+0*t23*t56*t57*(2.2478670955426108d
     1         -3*t28*(-1.0d+0*t26*t29*t96*t97-2.625411059665811d-1*t25*
     2         t29*t59*t60)/t26+2.5058979122369923d-2*t28*t70*(-6.203504
     3         908994001d-1*t17*t29*t96*t97-2.067834969664667d-1*t29*t70
     4         *t71)+6.519760588836059d-2*t59*t60*t95/(2.238166942360001
     5         d+1*t95+1)-5.011795824473985d-2*t14*t70*t72-9.69022771154
     6         4375d-4*t14*t64*t68-6.264085709464389d-2*t59*t60*t61*t62)
            t99 = 1/t1**2
            t100 = t19*t99
            t101 = -t20
            t102 = t21**3.333333333333333d-1
            t103 = -t19*t99
            t104 = t22**3.333333333333333d-1
            t105 = 1.0d+0*t58*wght
            fnc(iq) = 1.0d+0*t1*t58*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*(t98+1.1250000000000002d+0*t23*t3
     1         0*t57*(4*t41*t55*t94+t93+t92+t91+t89+t84)+t81+t73+t69+t63
     2         +1.1250000000000002d+0*(1.3333333333333333d+0*t104*(t20+t
     3         103)+1.3333333333333333d+0*(t101+t100)*t102)*t30*t56*t57)
     4         *wght+t105+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = 1.0d+0*t1*(t98+1.1250000000000002d+0*t23*t3
     1         0*t57*(-4*t41*t55*t94+t93+t92+t91+t89+t84)+t81+t73+t69+t6
     2         3+1.1250000000000002d+0*(1.3333333333333333d+0*t102*(t20+
     3         t100)+1.3333333333333333d+0*(t103+t101)*t104)*t30*t56*t57
     4         )*wght+t105+Amat(iq,D1_RB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = rhob+rhoa
            t2 = t1**3.333333333333333d-1
            t3 = t2**5.0d-1
            t4 = 1/t3
            t5 = 1.5752466357994865d+0*t4
            t6 = t5+3.72744d+0
            t7 = atan(6.15199081975908d+0/t6)
            t8 = 7.876233178997433d-1*t4
            t9 = t8+1.0498d-1
            t10 = t9**2
            t11 = 1/t2
            t12 = 6.203504908994001d-1*t11
            t13 = 2.935818660072219d+0*t4+t12+1.29352d+1
            t14 = abs(t13)
            t15 = 1/t14
            t16 = log(1.0d+0*t10*t15)
            t17 = abs(t11)
            t18 = log(6.203504908994001d-1*t15*t17)
            t19 = rhoa-rhob
            t20 = 1/t1
            t21 = t19*t20+1.0d+0
            t22 = t21**1.3333333333333333d+0-2.0d+0
            t23 = t5+7.06042d+0
            t24 = t8+3.25d-1
            t25 = t24**2
            t26 = 5.560951426165704d+0*t4+t12+1.8057800000000002d+1
            t27 = abs(t26)
            t28 = 1/t27
            t29 = -3.8783294878113006d-2*t7+2.2478670955426108d-3*log(1.
     1         0d+0*t25*t28)+1.554535d-2*log(6.203504908994001d-1*t17*t2
     2         8)+5.249139316978092d-2*atan(4.7309269095601136d+0/t23)-3
     3         .10907d-2*t18-9.690227711544375d-4*t16
            t30 = t5+1.0683499999999999d+0
            t31 = atan(6.692072046645942d+0/t30)
            t32 = t8+2.28344d-1
            t33 = t32**2
            t34 = 8.414573716781907d-1*t4+t12+1.14813d+1
            t35 = abs(t34)
            t36 = 1/t35
            t37 = log(1.0d+0*t33*t36)
            t38 = log(6.203504908994001d-1*t17*t36)
            t39 = t19**4
            t40 = 1/t1**4
            t41 = t5+1.3072d+1
            t42 = t5+2.0123100000000002d+1
            t43 = t8+4.09286d-1
            t44 = t43**2
            t45 = 1.0295812011585444d+1*t4+t12+4.2719799999999997d+1
            t46 = abs(t45)
            t47 = 1/t46
            t48 = t8+7.43294d-1
            t49 = t48**2
            t50 = 1.5849422788428325d+1*t4+t12+1.01578d+2
            t51 = abs(t50)
            t52 = 1/t51
            t53 = 2.667310007273315d-3*log(1.0d+0*t49*t52)+1.554535d-2*l
     1         og(6.203504908994001d-1*t17*t52)-4.431373767749538d-3*log
     2         (1.0d+0*t44*t47)-3.10907d-2*log(6.203504908994001d-1*t17*
     3         t47)+6.188180297906176d-1*atan(1.171685277708971d+0/t42)-
     4         2.052197293770518d+1*atan(4.4899888641576796d-2/t41)
            t54 = 1.709920934161365d+0*t53+1.688686394038963d-2*t38+3.64
     1         90335179177674d-4*t37+5.458482358638966d-3*t31
            t55 = t39*t40*t54-1.688686394038963d-2*t38-3.649033517917767
     1         4d-4*t37-5.458482358638966d-3*t31
            t56 = 1/t53
            t57 = 3.8783294878113006d-2*t7+1.1250000000000002d+0*t22*t29
     1         *t55*t56+3.10907d-2*t18+9.690227711544375d-4*t16
            t58 = 1/t1**6.666666666666667d-1
            t59 = 1/t3**3
            t60 = 1/t6**2
            t61 = 1/(3.784699104639999d+1*t60+1)
            t62 = 1/t10
            t63 = -2.067834969664667d-1/t1**1.3333333333333333d+0
            t64 = t63-4.8930311001203647d-1*t58*t59
            t65 = 1/t13
            t66 = -2.625411059665811d-1*t15*t58*t59*t9-1.0d+0*t10*t15*t6
     1         4*t65
            t67 = 1/t17
            t68 = 1/t1**1.6666666666666666d+0
            t69 = -2.067834969664667d-1*t15*t67*t68-6.203504908994001d-1
     1         *t15*t17*t64*t65
            t70 = 1/t41**2
            t71 = 1/t42**2
            t72 = t63-1.715968668597574d+0*t58*t59
            t73 = 1/t45
            t74 = t63-2.641570464738054d+0*t58*t59
            t75 = 1/t50
            t76 = 2.667310007273315d-3*t51*(-1.0d+0*t49*t52*t74*t75-2.62
     1         5411059665811d-1*t48*t52*t58*t59)/t49+2.5058979122369923d
     2         -2*t51*t67*(-6.203504908994001d-1*t17*t52*t74*t75-2.06783
     3         4969664667d-1*t52*t67*t68)-4.431373767749538d-3*t46*(-1.0
     4         d+0*t44*t47*t72*t73-2.625411059665811d-1*t43*t47*t58*t59)
     5         /t44-5.011795824473985d-2*t46*t67*(-6.203504908994001d-1*
     6         t17*t47*t72*t73-2.067834969664667d-1*t47*t67*t68)+1.90358
     7         04775132142d-1*t58*t59*t71/(1.3728463899999485d+0*t71+1)-
     8         2.4191438009473537d-1*t58*t59*t70/(2.016000000025997d-3*t
     9         70+1)
            t77 = 1/t30**2
            t78 = 1/(4.4783828277500004d+1*t77+1)
            t79 = 1/t33
            t80 = t63-1.4024289527969844d-1*t58*t59
            t81 = 1/t34
            t82 = -1.0d+0*t33*t36*t80*t81-2.625411059665811d-1*t32*t36*t
     1         58*t59
            t83 = -6.203504908994001d-1*t17*t36*t80*t81-2.06783496966466
     1         7d-1*t36*t67*t68
            t84 = 1/t23**2
            t85 = t63-9.26825237694284d-1*t58*t59
            t86 = 1/t26
            fnc(iq) = 1.0d+0*t1*t57*wght+fnc(iq)
            Amat(iq,D1_RA) = 1.0d+0*t1*(1.1250000000000002d+0*t22*t55*t5
     1         6*(2.2478670955426108d-3*t27*(-1.0d+0*t25*t28*t85*t86-2.6
     2         25411059665811d-1*t24*t28*t58*t59)/t25+2.5058979122369923
     3         d-2*t27*t67*(-6.203504908994001d-1*t17*t28*t85*t86-2.0678
     4         34969664667d-1*t28*t67*t68)+6.519760588836059d-2*t58*t59*
     5         t84/(2.238166942360001d+1*t84+1)-5.011795824473985d-2*t14
     6         *t67*t69-9.690227711544375d-4*t14*t62*t66-6.2640857094643
     7         89d-2*t58*t59*t60*t61)+1.1250000000000002d+0*t22*t29*t56*
     8         (t39*t40*(2.722148880047894d-2*t35*t67*t83+3.649033517917
     9         7674d-4*t35*t79*t82+9.590247809108334d-3*t58*t59*t77*t78+
     :         1.709920934161365d+0*t76)-2.722148880047894d-2*t35*t67*t8
     ;         3-3.6490335179177674d-4*t35*t79*t82-9.590247809108334d-3*
     <         t58*t59*t77*t78+4*t19**3*t40*t54-4*t39*t54/t1**5)-1.12500
     =         00000000002d+0*t22*t29*t55*t76/t53**2+5.011795824473985d-
     >         2*t14*t67*t69+9.690227711544375d-4*t14*t62*t66+6.26408570
     ?         9464389d-2*t58*t59*t60*t61+1.5000000000000002d+0*(t20-t19
     @         /t1**2)*t21**3.333333333333333d-1*t29*t55*t56)*wght+1.0d+
     1         0*t57*wght+Amat(iq,D1_RA)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhob**1.6666666666666666d-1
            t2 = 1.4033852085886447d+0*t1
            t3 = t2+3.72744d+0
            t4 = atan(6.15199081975908d+0/t3)
            t5 = 7.016926042943223d-1*t1
            t6 = t5+1.0498d-1
            t7 = t6**2
            t8 = rhob**3.333333333333333d-1
            t9 = 1/t8
            t10 = 4.9237251092134837d-1*t9
            t11 = t10+2.615517080950829d+0*t1+1.29352d+1
            t12 = 1/t11
            t13 = log(1.0d+0*t12*t7)
            t14 = 2.615517080950829d+0/t8**5.0d-1+t10+1.29352d+1
            t15 = 1/t14
            t16 = t5+2.28344d-1
            t17 = t16**2
            t18 = t10+7.496532937978392d-1*t1+1.14813d+1
            t19 = 1/t18
            t20 = t2+1.0683499999999999d+0
            t21 = -1.688686394038963d-2*log(4.9237251092134837d-1*t19*t9
     1         )-5.458482358638966d-3*atan(6.692072046645942d+0/t20)-3.6
     2         490335179177674d-4*log(1.0d+0*t17*t19)
            t22 = t2+7.06042d+0
            t23 = t5+3.25d-1
            t24 = t23**2
            t25 = t10+4.954244497211719d+0*t1+1.8057800000000002d+1
            t26 = 1/t25
            t27 = 1.554535d-2*log(4.9237251092134837d-1*t26*t9)-3.10907d
     1         -2*log(4.9237251092134837d-1*t12*t9)-3.8783294878113006d-
     2         2*t4+2.2478670955426108d-3*log(1.0d+0*t24*t26)+5.24913931
     3         6978092d-2*atan(4.7309269095601136d+0/t22)-9.690227711544
     4         375d-4*t13
            t28 = t2+1.3072d+1
            t29 = t2+2.0123100000000002d+1
            t30 = t5+4.09286d-1
            t31 = t30**2
            t32 = t10+9.172525723335381d+0*t1+4.2719799999999997d+1
            t33 = 1/t32
            t34 = t5+7.43294d-1
            t35 = t34**2
            t36 = t10+1.412023044547508d+1*t1+1.01578d+2
            t37 = 1/t36
            t38 = 1.554535d-2*log(4.9237251092134837d-1*t37*t9)-3.10907d
     1         -2*log(4.9237251092134837d-1*t33*t9)+2.667310007273315d-3
     2         *log(1.0d+0*t35*t37)-4.431373767749538d-3*log(1.0d+0*t31*
     3         t33)+6.188180297906176d-1*atan(1.171685277708971d+0/t29)-
     4         2.052197293770518d+1*atan(4.4899888641576796d-2/t28)
            t39 = 1/t38
            t40 = 3.10907d-2*log(4.9237251092134837d-1*t15*t9)+3.8783294
     1         878113006d-2*t4-1.1250000000000002d+0*t21*t27*t39+9.69022
     2         7711544375d-4*t13
            t41 = 1/t3**2
            t42 = 1/(3.784699104639999d+1*t41+1)
            t43 = 1/rhob**1.1666666666666667d+0
            t44 = 1/rhob**1.3333333333333333d+0
            t45 = -1.6412417030711612d-1*t44
            t46 = t45-4.359195134918048d-1*t43
            t47 = 1/t11**2
            t48 = -1.0d+0*t46*t47*t7-2.338975347647741d-1*t12*t43*t6
            t49 = 1/t7
            t50 = 1/t20**2
            t51 = t45-1.249422156329732d-1*t43
            t52 = 1/t18**2
            t53 = 1/t22**2
            t54 = t45-8.257074162019531d-1*t43
            t55 = 1/t25**2
            t56 = 1/t28**2
            t57 = 1/t29**2
            t58 = t45-1.5287542872225635d+0*t43
            t59 = 1/t32**2
            t60 = t45-2.3533717409125127d+0*t43
            t61 = 1/t36**2
            fnc(iq) = 2.0d+0*rhob*t40*wght+fnc(iq)
            Amat(iq,D1_RB) = 2.0d+0*rhob*(1.1250000000000002d+0*t21*t27*
     1         (3.1572335285150016d-2*t36*t8*(-4.9237251092134837d-1*t60
     2         *t61*t9-1.6412417030711612d-1*t37*t44)-6.314467057030003d
     3         -2*t32*t8*(-4.9237251092134837d-1*t58*t59*t9-1.6412417030
     4         711612d-1*t33*t44)+2.667310007273315d-3*t36*(-1.0d+0*t35*
     5         t60*t61-2.338975347647741d-1*t34*t37*t43)/t35-4.431373767
     6         749538d-3*t32*(-1.0d+0*t31*t58*t59-2.338975347647741d-1*t
     7         30*t33*t43)/t31+1.695897407293498d-1*t43*t57/(1.372846389
     8         9999485d+0*t57+1)-2.1552121112611455d-1*t43*t56/(2.016000
     9         000025997d-3*t56+1))/t38**2-1.1250000000000002d+0*t21*t39
     :         *(3.1572335285150016d-2*t25*t8*(-4.9237251092134837d-1*t5
     ;         4*t55*t9-1.6412417030711612d-1*t26*t44)-6.314467057030003
     <         d-2*t11*t8*(-4.9237251092134837d-1*t46*t47*t9-1.641241703
     =         0711612d-1*t12*t44)+2.2478670955426108d-3*t25*(-1.0d+0*t2
     >         4*t54*t55-2.338975347647741d-1*t23*t26*t43)/t24+5.8084463
     ?         51175949d-2*t43*t53/(2.238166942360001d+1*t53+1)-9.690227
     @         711544375d-4*t11*t48*t49-5.580665928883042d-2*t41*t42*t43
     1         )-1.1250000000000002d+0*t27*t39*(-3.429692674920095d-2*t1
     2         8*t8*(-4.9237251092134837d-1*t51*t52*t9-1.641241703071161
     3         2d-1*t19*t44)-3.6490335179177674d-4*t18*(-1.0d+0*t17*t51*
     4         t52-2.338975347647741d-1*t16*t19*t43)/t17-8.5439394797828
     5         15d-3*t43*t50/(4.4783828277500004d+1*t50+1))+6.3144670570
     6         30003d-2*t14*t8*(-4.9237251092134837d-1*t46*t9/t14**2-1.6
     7         412417030711612d-1*t15*t44)+9.690227711544375d-4*t11*t48*
     8         t49+5.580665928883042d-2*t41*t42*t43)*wght+2.0d+0*t40*wgh
     9         t+Amat(iq,D1_RB)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_vwn3 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {\it t_1}^{.3333333333333333}\\\\ 
C>   {\it t_3} &=& {{1}\over{\sqrt{{\it t_2}}}}\\\\ 
C>   {\it t_4} &=& 1.575246635799487\,{\it t_3}\\\\ 
C>   {\it t_5} &=& \arctan \left({{6.15199081975908}\over{{\it t_4}+3.72744}}\right)\\\\ 
C>   {\it t_6} &=& .7876233178997433\,{\it t_3}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_8} &=& .6203504908994001\,{\it t_7}\\\\ 
C>   {\it t_9} &=& {{1}\over{\left| 2.935818660072219\,{\it t_3}+{\it t_8}+12.9352\right| }}\\\\ 
C>   {\it t_{10}} &=& \log \left(1.0\,\left({\it t_6}+0.10498\right)^2\,{\it t_9}\right)\\\\ 
C>   {\it t_{11}} &=& \left| {\it t_7}\right| \\\\ 
C>   {\it t_{12}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_9}\right)\\\\ 
C>   {\it t_{13}} &=& -\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}+\rho_\alpha\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_3}+{\it t_8}+18.0578\right| }}\\\\ 
C>   {\it t_{17}} &=& \arctan \left({{6.692072046645942}\over{{\it t_4}+1.06835}}\right)\\\\ 
C>   {\it t_{18}} &=& {{1}\over{\left| .8414573716781907\,{\it t_3}+{\it t_8}+11.4813\right| }}\\\\ 
C>   {\it t_{19}} &=& \log \left(1.0\,\left({\it t_6}+0.228344\right)^2\,{\it t_{18}}\right)\\\\ 
C>   {\it t_{20}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{18}}\right)\\\\ 
C>   {\it t_{21}} &=& {{1}\over{\left| 10.29581201158544\,{\it t_3}+{\it t_8}+42.7198\right| }}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\left| 15.84942278842832\,{\it t_3}+{\it t_8}+101.578\right| }}\\\\ 
C>   {\it t_{23}} &=& 0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{22}}\right)+.002667310007273315\,\log \left(1.0\,\left({\it t_6}+0.743294\right)^2\,{\it t_{22}}\right)-0.0310907\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{21}}\right)-.004431373767749538\,\log \left(1.0\,\left({\it t_6}+0.409286\right)^2\,{\it t_{21}}\right)+.6188180297906176\,\arctan \left({{1.171685277708971}\over{{\it t_4}+20.1231}}\right)-20.52197293770518\,\arctan \left({{0.0448998886415768}\over{{\it t_4}+13.072}}\right)\\\\ 
C>   {\it t_{24}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{25}} &=& {\it t_{24}}^{.3333333333333333}\\\\ 
C>   {\it t_{26}} &=& {{1}\over{\sqrt{{\it t_{25}}}}}\\\\ 
C>   {\it t_{27}} &=& 1.575246635799487\,{\it t_{26}}\\\\ 
C>   {\it t_{28}} &=& \arctan \left({{6.15199081975908}\over{{\it t_{27}}+3.72744}}\right)\\\\ 
C>   {\it t_{29}} &=& .7876233178997433\,{\it t_{26}}\\\\ 
C>   {\it t_{30}} &=& {{1}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{31}} &=& .6203504908994001\,{\it t_{30}}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{\left| 2.935818660072219\,{\it t_{26}}+{\it t_{31}}+12.9352\right| }}\\\\ 
C>   {\it t_{33}} &=& \log \left(1.0\,\left({\it t_{29}}+0.10498\right)^2\,{\it t_{32}}\right)\\\\ 
C>   {\it t_{34}} &=& \left| {\it t_{30}}\right| \\\\ 
C>   {\it t_{35}} &=& \log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{32}}\right)\\\\ 
C>   {\it t_{36}} &=& \rho_s+{\it t_{13}}\\\\ 
C>   {\it t_{37}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_{26}}+{\it t_{31}}+18.0578\right| }}\\\\ 
C>   {\it t_{38}} &=& \arctan \left({{6.692072046645942}\over{{\it t_{27}}+1.06835}}\right)\\\\ 
C>   {\it t_{39}} &=& {{1}\over{\left| .8414573716781907\,{\it t_{26}}+{\it t_{31}}+11.4813\right| }}\\\\ 
C>   {\it t_{40}} &=& \log \left(1.0\,\left({\it t_{29}}+0.228344\right)^2\,{\it t_{39}}\right)\\\\ 
C>   {\it t_{41}} &=& \log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{39}}\right)\\\\ 
C>   {\it t_{42}} &=& {{1}\over{\left| 10.29581201158544\,{\it t_{26}}+{\it t_{31}}+42.7198\right| }}\\\\ 
C>   {\it t_{43}} &=& {{1}\over{\left| 15.84942278842832\,{\it t_{26}}+{\it t_{31}}+101.578\right| }}\\\\ 
C>   {\it t_{44}} &=& 0.01554535\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{43}}\right)+.002667310007273315\,\log \left(1.0\,\left({\it t_{29}}+0.743294\right)^2\,{\it t_{43}}\right)-0.0310907\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{42}}\right)-.004431373767749538\,\log \left(1.0\,\left({\it t_{29}}+0.409286\right)^2\,{\it t_{42}}\right)+.6188180297906176\,\arctan \left({{1.171685277708971}\over{{\it t_{27}}+20.1231}}\right)-20.52197293770518\,\arctan \left({{0.0448998886415768}\over{{\it t_{27}}+13.072}}\right)\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left({{1.125\,\left(\left({\it t_{14}}\,{\it t_{15}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{14}}\,{\it t_{15}}\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{16}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_6}+0.325\right)^2\,{\it t_{16}}\right)-0.0310907\,{\it t_{12}}-9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_4}+7.06042}}\right)-.03878329487811301\,{\it t_5}\right)\,\left({{{\it t_{14}}^4\,\left(1.709920934161365\,{\it t_{23}}+.01688686394038963\,{\it t_{20}}+3.6490335179177674 \times 10^{-4}\,{\it t_{19}}+.005458482358638966\,{\it t_{17}}\right)}\over{{\it t_1}^4}}-.01688686394038963\,{\it t_{20}}-3.6490335179177674 \times 10^{-4}\,{\it t_{19}}-.005458482358638966\,{\it t_{17}}\right)}\over{{\it t_{23}}}}+0.0310907\,{\it t_{12}}+9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.03878329487811301\,{\it t_5}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{24}}\,\left({{1.125\,\left(\left({{{\it t_{36}}}\over{{\it t_{24}}}}+1.0\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{37}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_{29}}+0.325\right)^2\,{\it t_{37}}\right)-0.0310907\,{\it t_{35}}-9.690227711544375 \times 10^{-4}\,{\it t_{33}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_{27}}+7.06042}}\right)-.03878329487811301\,{\it t_{28}}\right)\,\left({{{\it t_{36}}^4\,\left(1.709920934161365\,{\it t_{44}}+.01688686394038963\,{\it t_{41}}+3.6490335179177674 \times 10^{-4}\,{\it t_{40}}+.005458482358638966\,{\it t_{38}}\right)}\over{{\it t_{24}}^4}}-.01688686394038963\,{\it t_{41}}-3.6490335179177674 \times 10^{-4}\,{\it t_{40}}-.005458482358638966\,{\it t_{38}}\right)}\over{{\it t_{44}}}}+0.0310907\,{\it t_{35}}+9.690227711544375 \times 10^{-4}\,{\it t_{33}}+.03878329487811301\,{\it t_{28}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] SH Vosko, L Wilk, M Nusair, Can.J.Phys. 58, 1200 (1980)  , DOI: 
C> <a href="http://dx.doi.org/10.1139/p80-159 "> 
C> 10.1139/p80-159 </a> 
C> 
      subroutine nwxcm_c_vwn3_d2(param,tol_rho,ipol,nq,wght, 
     +rho,fnc,Amat,Amat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
c 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_vwn3 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_2} &=& {\it t_1}^{.3333333333333333}\\\\ 
C>   {\it t_3} &=& {{1}\over{\sqrt{{\it t_2}}}}\\\\ 
C>   {\it t_4} &=& 1.575246635799487\,{\it t_3}\\\\ 
C>   {\it t_5} &=& \arctan \left({{6.15199081975908}\over{{\it t_4}+3.72744}}\right)\\\\ 
C>   {\it t_6} &=& .7876233178997433\,{\it t_3}\\\\ 
C>   {\it t_7} &=& {{1}\over{{\it t_2}}}\\\\ 
C>   {\it t_8} &=& .6203504908994001\,{\it t_7}\\\\ 
C>   {\it t_9} &=& {{1}\over{\left| 2.935818660072219\,{\it t_3}+{\it t_8}+12.9352\right| }}\\\\ 
C>   {\it t_{10}} &=& \log \left(1.0\,\left({\it t_6}+0.10498\right)^2\,{\it t_9}\right)\\\\ 
C>   {\it t_{11}} &=& \left| {\it t_7}\right| \\\\ 
C>   {\it t_{12}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_9}\right)\\\\ 
C>   {\it t_{13}} &=& -\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}+\rho_\alpha\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_1}}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_3}+{\it t_8}+18.0578\right| }}\\\\ 
C>   {\it t_{17}} &=& \arctan \left({{6.692072046645942}\over{{\it t_4}+1.06835}}\right)\\\\ 
C>   {\it t_{18}} &=& {{1}\over{\left| .8414573716781907\,{\it t_3}+{\it t_8}+11.4813\right| }}\\\\ 
C>   {\it t_{19}} &=& \log \left(1.0\,\left({\it t_6}+0.228344\right)^2\,{\it t_{18}}\right)\\\\ 
C>   {\it t_{20}} &=& \log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{18}}\right)\\\\ 
C>   {\it t_{21}} &=& {{1}\over{\left| 10.29581201158544\,{\it t_3}+{\it t_8}+42.7198\right| }}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\left| 15.84942278842832\,{\it t_3}+{\it t_8}+101.578\right| }}\\\\ 
C>   {\it t_{23}} &=& 0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{22}}\right)+.002667310007273315\,\log \left(1.0\,\left({\it t_6}+0.743294\right)^2\,{\it t_{22}}\right)-0.0310907\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{21}}\right)-.004431373767749538\,\log \left(1.0\,\left({\it t_6}+0.409286\right)^2\,{\it t_{21}}\right)+.6188180297906176\,\arctan \left({{1.171685277708971}\over{{\it t_4}+20.1231}}\right)-20.52197293770518\,\arctan \left({{0.0448998886415768}\over{{\it t_4}+13.072}}\right)\\\\ 
C>   {\it t_{24}} &=& \rho_s+\rho_\beta\\\\ 
C>   {\it t_{25}} &=& {\it t_{24}}^{.3333333333333333}\\\\ 
C>   {\it t_{26}} &=& {{1}\over{\sqrt{{\it t_{25}}}}}\\\\ 
C>   {\it t_{27}} &=& 1.575246635799487\,{\it t_{26}}\\\\ 
C>   {\it t_{28}} &=& \arctan \left({{6.15199081975908}\over{{\it t_{27}}+3.72744}}\right)\\\\ 
C>   {\it t_{29}} &=& .7876233178997433\,{\it t_{26}}\\\\ 
C>   {\it t_{30}} &=& {{1}\over{{\it t_{25}}}}\\\\ 
C>   {\it t_{31}} &=& .6203504908994001\,{\it t_{30}}\\\\ 
C>   {\it t_{32}} &=& {{1}\over{\left| 2.935818660072219\,{\it t_{26}}+{\it t_{31}}+12.9352\right| }}\\\\ 
C>   {\it t_{33}} &=& \log \left(1.0\,\left({\it t_{29}}+0.10498\right)^2\,{\it t_{32}}\right)\\\\ 
C>   {\it t_{34}} &=& \left| {\it t_{30}}\right| \\\\ 
C>   {\it t_{35}} &=& \log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{32}}\right)\\\\ 
C>   {\it t_{36}} &=& \rho_s+{\it t_{13}}\\\\ 
C>   {\it t_{37}} &=& {{1}\over{\left| 5.560951426165705\,{\it t_{26}}+{\it t_{31}}+18.0578\right| }}\\\\ 
C>   {\it t_{38}} &=& \arctan \left({{6.692072046645942}\over{{\it t_{27}}+1.06835}}\right)\\\\ 
C>   {\it t_{39}} &=& {{1}\over{\left| .8414573716781907\,{\it t_{26}}+{\it t_{31}}+11.4813\right| }}\\\\ 
C>   {\it t_{40}} &=& \log \left(1.0\,\left({\it t_{29}}+0.228344\right)^2\,{\it t_{39}}\right)\\\\ 
C>   {\it t_{41}} &=& \log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{39}}\right)\\\\ 
C>   {\it t_{42}} &=& {{1}\over{\left| 10.29581201158544\,{\it t_{26}}+{\it t_{31}}+42.7198\right| }}\\\\ 
C>   {\it t_{43}} &=& {{1}\over{\left| 15.84942278842832\,{\it t_{26}}+{\it t_{31}}+101.578\right| }}\\\\ 
C>   {\it t_{44}} &=& 0.01554535\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{43}}\right)+.002667310007273315\,\log \left(1.0\,\left({\it t_{29}}+0.743294\right)^2\,{\it t_{43}}\right)-0.0310907\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{42}}\right)-.004431373767749538\,\log \left(1.0\,\left({\it t_{29}}+0.409286\right)^2\,{\it t_{42}}\right)+.6188180297906176\,\arctan \left({{1.171685277708971}\over{{\it t_{27}}+20.1231}}\right)-20.52197293770518\,\arctan \left({{0.0448998886415768}\over{{\it t_{27}}+13.072}}\right)\\\\ 
C>   f &=& 1.0\,{\it t_1}\,\left({{1.125\,\left(\left({\it t_{14}}\,{\it t_{15}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{14}}\,{\it t_{15}}\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{11}}\,{\it t_{16}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_6}+0.325\right)^2\,{\it t_{16}}\right)-0.0310907\,{\it t_{12}}-9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_4}+7.06042}}\right)-.03878329487811301\,{\it t_5}\right)\,\left({{{\it t_{14}}^4\,\left(1.709920934161365\,{\it t_{23}}+.01688686394038963\,{\it t_{20}}+3.6490335179177674 \times 10^{-4}\,{\it t_{19}}+.005458482358638966\,{\it t_{17}}\right)}\over{{\it t_1}^4}}-.01688686394038963\,{\it t_{20}}-3.6490335179177674 \times 10^{-4}\,{\it t_{19}}-.005458482358638966\,{\it t_{17}}\right)}\over{{\it t_{23}}}}+0.0310907\,{\it t_{12}}+9.690227711544375 \times 10^{-4}\,{\it t_{10}}+.03878329487811301\,{\it t_5}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{24}}\,\left({{1.125\,\left(\left({{{\it t_{36}}}\over{{\it t_{24}}}}+1.0\right)^{{{4}\over{3}}}-2.0\right)\,\left(0.01554535\,\log \left(.6203504908994001\,{\it t_{34}}\,{\it t_{37}}\right)+.002247867095542611\,\log \left(1.0\,\left({\it t_{29}}+0.325\right)^2\,{\it t_{37}}\right)-0.0310907\,{\it t_{35}}-9.690227711544375 \times 10^{-4}\,{\it t_{33}}+.05249139316978092\,\arctan \left({{4.730926909560114}\over{{\it t_{27}}+7.06042}}\right)-.03878329487811301\,{\it t_{28}}\right)\,\left({{{\it t_{36}}^4\,\left(1.709920934161365\,{\it t_{44}}+.01688686394038963\,{\it t_{41}}+3.6490335179177674 \times 10^{-4}\,{\it t_{40}}+.005458482358638966\,{\it t_{38}}\right)}\over{{\it t_{24}}^4}}-.01688686394038963\,{\it t_{41}}-3.6490335179177674 \times 10^{-4}\,{\it t_{40}}-.005458482358638966\,{\it t_{38}}\right)}\over{{\it t_{44}}}}+0.0310907\,{\it t_{35}}+9.690227711544375 \times 10^{-4}\,{\it t_{33}}+.03878329487811301\,{\it t_{28}}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] SH Vosko, L Wilk, M Nusair, Can.J.Phys. 58, 1200 (1980)  , DOI: 
C> <a href="http://dx.doi.org/10.1139/p80-159 "> 
C> 10.1139/p80-159 </a> 
C> 
      subroutine nwxcm_c_vwn3_d3(param,tol_rho,ipol,nq,wght, 
     +rho,fnc,Amat,Amat2,Amat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,*)    !< [Input] The density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,*)   !< [Output] The derivative wrt rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,*)  !< [Output] The 2nd derivative wrt rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,*)  !< [Output] The 3rd derivative wrt rho 
c 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
