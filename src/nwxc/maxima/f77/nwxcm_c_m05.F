C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_c_m05.F 
C> The nwxcm_c_m05 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_c_m05 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& {{1}\over{\rho_\alpha^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\sqrt{\rho_\alpha}}}\\\\ 
C>   {\it t_3} &=& {{1}\over{\rho_\alpha^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{\rho_\alpha^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_5} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_4}+2.225569421150687\,{\it t_3}+0.8004286349993635\,{\it t_2}+0.1897004325747558\,{\it t_1}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_3}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_4}+3.844746237447211\,{\it t_3}+1.644733775567609\,{\it t_2}+0.2405871291288192\,{\it t_1}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_3}+1.0\right)\\\\ 
C>   {\it t_6} &=& {{1}\over{\rho_\beta^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_7} &=& {{1}\over{\sqrt{\rho_\beta}}}\\\\ 
C>   {\it t_8} &=& {{1}\over{\rho_\beta^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_9} &=& {{1}\over{\rho_\beta^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{10}} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_9}+2.225569421150687\,{\it t_8}+0.8004286349993635\,{\it t_7}+0.1897004325747558\,{\it t_6}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_8}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_9}+3.844746237447211\,{\it t_8}+1.644733775567609\,{\it t_7}+0.2405871291288192\,{\it t_6}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_8}+1.0\right)\\\\ 
C>   {\it t_{11}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{12}} &=& {{1}\over{{\it t_{11}}^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{13}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}^4\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_{11}}^4}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{{\it t_{11}}}}\\\\ 
C>   {\it t_{17}} &=& \left({\it t_{13}}\,{\it t_{16}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{13}}\,{\it t_{16}}\right)^{{{4}\over{3}}}-2.0\\\\ 
C>   {\it t_{18}} &=& -1.923661050931536\,{\it t_{14}}\,{\it t_{15}}\,{\it t_{17}}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{{\it t_{11}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{\sqrt{{\it t_{11}}}}}\\\\ 
C>   {\it t_{21}} &=& {{1}\over{{\it t_{11}}^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{23}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{24}} &=& {\it t_{23}}\,\sigma_{\beta\beta}+{\it t_{22}}\,\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{0.0031\,{\it t_{24}}+1.0}}\\\\ 
C>   {\it t_{26}} &=& {\it param}\left(6\right)\\\\ 
C>   {\it t_{27}} &=& {{1}\over{0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}+1.0}}\\\\ 
C>   {\it t_{28}} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_{29}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{30}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{31}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{32}} &=& {{1}\over{0.06\,{\it t_{23}}\,\sigma_{\beta\beta}+1.0}}\\\\ 
C>   {\it t_{33}} &=& {{1}\over{\rho_s^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{34}} &=& {{1}\over{\sqrt{\rho_s}}}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{\rho_s^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{\rho_s^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{37}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{38}} &=& {{1}\over{0.06\,{\it t_{37}}\,\sigma_{ss}+1.0}}\\\\ 
C>   f &=& {{0.5\,{\it t_{10}}\,\rho_\beta\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{31}}\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_\beta-{{0.25\,\sigma_{\beta\beta}}\over{\rho_\beta}}\right)}\over{\tau_\beta}}+{{0.5\,{\it t_5}\,\rho_\alpha\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{31}}\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_\alpha-{{0.25\,\sigma_{\alpha\alpha}}\over{\rho_\alpha}}\right)}\over{\tau_\alpha}}+1.0\,\left({\it t_{11}}\,\left(-0.0598079686361971\,{\it t_{14}}\,{\it t_{15}}\,\left(0.1274696188700087\,{\it t_{12}}+1.0\right)\,{\it t_{17}}\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{21}}+3.844746237447211\,{\it t_{12}}+1.644733775567609\,{\it t_{20}}+0.2405871291288192\,{\it t_{19}}}}+1.0\right)+0.01975163132168077\,\left(0.06901399211255825\,{\it t_{12}}+1.0\right)\,\left({\it t_{18}}+1.923661050931536\,{\it t_{17}}\right)\,\log \left({{29.60881320326807}\over{8.15741470348764\,{\it t_{21}}+2.247591863577616\,{\it t_{12}}+0.4300972471276643\,{\it t_{20}}+0.1911512595127337\,{\it t_{19}}}}+1.0\right)-0.0621814\,\left(0.1325688999052018\,{\it t_{12}}+1.0\right)\,\left({\it t_{18}}+1.0\right)\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{21}}+2.225569421150687\,{\it t_{12}}+0.8004286349993635\,{\it t_{20}}+0.1897004325747558\,{\it t_{19}}}}+1.0\right)\right)-{\it t_{10}}\,\rho_\beta-{\it t_5}\,\rho_\alpha\right)\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it param}\left(5\right)\,{\it t_{24}}\,{\it t_{25}}+{\it param}\left(4\right)\right)+{\it param}\left(3\right)\right)+{\it param}\left(2\right)\right)+{\it param}\left(1\right)\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& {{0.5\,\left(-6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{36}}+2.225569421150687\,{\it t_{35}}+0.8004286349993635\,{\it t_{34}}+0.1897004325747558\,{\it t_{33}}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_{35}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{36}}+3.844746237447211\,{\it t_{35}}+1.644733775567609\,{\it t_{34}}+0.2405871291288192\,{\it t_{33}}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{35}}+1.0\right)\right)\,\rho_s\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{31}}\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_s-{{0.25\,\sigma_{ss}}\over{\rho_s}}\right)}\over{\tau_s}}\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] Y Zhao, NE Schultz, DG Truhlar, J.Chem.Phys. 123, 161103 (2005)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.2126975 "> 
C> 10.1063/1.2126975 </a> 
C> 
      subroutine nwxcm_c_m05(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Cmat,Mmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = 1/rhoa**2.6666666666666666d+0
            t2 = 6.2d-3*gammaaa*t1+1.0d+0
            t3 = 1/t2
            t4 = param(5)
            t5 = 6.2d-3*gammaaa*t1*t3*t4+param(4)
            t6 = 6.2d-3*gammaaa*t1*t3*t5+param(3)
            t7 = 6.2d-3*gammaaa*t1*t3*t6+param(2)
            t8 = 6.2d-3*gammaaa*t1*t3*t7+param(1)
            t9 = 1/rhoa**6.666666666666666d-1
            t10 = rhoa**5.0d-1
            t11 = 1/t10
            t12 = 1/rhoa**3.333333333333333d-1
            t13 = 1/rhoa**1.6666666666666666d-1
            t14 = 2.4058712912881916d-1*t9+1.1120374863094686d+1*t13+3.8
     1         447462374472113d+0*t12+1.644733775567609d+0*t11
            t15 = 3.216395899738507d+1/t14+1.0d+0
            t16 = log(t15)
            t17 = 1.274696188700087d-1*t12+1.0d+0
            t18 = 1.8970043257475583d-1*t9+5.982550435771079d+0*t13+2.22
     1         55694211506874d+0*t12+8.004286349993635d-1*t11
            t19 = 1.6081979498692536d+1/t18+1.0d+0
            t20 = log(t19)
            t21 = 1.3256889990520176d-1*t12+1.0d+0
            t22 = -6.903522198342671d-18*t20*t21-3.1090699999999993d-2*t
     1         16*t17
            t23 = 1.19503784087549d-1*t9+5.329846514438383d+0*t13+1.7664
     1         35620181429d+0*t12+5.659885156639418d-1*t11
            t24 = 1.6081979498692536d+1/t23+1.0d+0
            t25 = log(t24)
            t26 = 1.0522000558389212d-1*t12+1.0d+0
            t27 = -1.243628d-1*rhoa*t25*t26-2*rhoa*t22
            t28 = 6.0d-2*gammaaa*t1+1.0d+0
            t29 = 1/t28
            t30 = param(10)
            t31 = 6.0d-2*gammaaa*t1*t29*t30+param(9)
            t32 = 6.0d-2*gammaaa*t1*t29*t31+param(8)
            t33 = 6.0d-2*gammaaa*t1*t29*t32+param(7)
            t34 = 6.0d-2*gammaaa*t1*t29*t33+param(6)
            t35 = 1/taua
            t36 = 1/rhoa
            t37 = 2.0d+0*taua-2.5d-1*gammaaa*t36
            t38 = 1/rhoa**1.6666666666666669d+0
            t39 = 1/t10**3
            t40 = 1/rhoa**1.3333333333333333d+0
            t41 = 1/rhoa**1.1666666666666667d+0
            t42 = 1.1102230246251565d-16*t21*(-9.970917392951799d-1*t41-
     1         7.418564737168958d-1*t40-4.002143174996817d-1*t39-1.26466
     2         9550498372d-1*t38)/(t18**2*t19)+1.0d+0*t17*(-1.8533958105
     3         157808d+0*t41-1.2815820791490704d+0*t40-8.223668877838045
     4         d-1*t39-1.6039141941921276d-1*t38)/(t14**2*t15)+3.0506411
     5         443514264d-19*t20*t40+1.3210398931339265d-3*t16*t40
            t43 = gammaaa**2
            t44 = 1/t2**2
            t45 = 1/rhoa**6.333333333333333d+0
            t46 = 1/rhoa**3.6666666666666664d+0
            t47 = 1/t28**2
            t48 = 1/rhoa**5.333333333333333d+0
            t49 = (1.0d+0*t27*(-3.8439999999999996d-5*gammaaa*t44*t48*t7
     1         +6.2d-3*t1*t3*t7+6.2d-3*gammaaa*t1*t3*(-3.843999999999999
     2         6d-5*gammaaa*t44*t48*t6+6.2d-3*t1*t3*t6+6.2d-3*gammaaa*t1
     3         *t3*(-3.8439999999999996d-5*gammaaa*t44*t48*t5+6.2d-3*t1*
     4         t3*t5+6.2d-3*gammaaa*t1*t3*(6.2d-3*t1*t3*t4-3.84399999999
     5         99996d-5*gammaaa*t4*t44*t48))))+t35*(1.0d+0*rhoa*t22*t37*
     6         (6.0d-2*gammaaa*t1*t29*(6.0d-2*gammaaa*t1*t29*(6.0d-2*gam
     7         maaa*t1*t29*(6.0d-2*t1*t29*t30-3.6d-3*gammaaa*t30*t47*t48
     8         )-3.6d-3*gammaaa*t31*t47*t48+6.0d-2*t1*t29*t31)-3.6d-3*ga
     9         mmaaa*t32*t47*t48+6.0d-2*t1*t29*t32)-3.6d-3*gammaaa*t33*t
     :         47*t48+6.0d-2*t1*t29*t33)-2.5d-1*t22*t34))*wght
            fnc(iq) = (1.0d+0*t27*t8+1.0d+0*rhoa*t22*t34*t35*t37)*wght+f
     1         nc(iq)
            Amat(iq,D1_RA) = (1.0d+0*(-2*rhoa*t42+2.0d+0*rhoa*t26*(-8.88
     1         3077524063971d-1*t41-5.888118733938097d-1*t40-2.829942578
     2         319709d-1*t39-7.966918939169932d-2*t38)/(t23**2*t24)-1.24
     3         3628d-1*t25*t26+4.361818170142819d-3*t12*t25-2*t22)*t8+1.
     4         0d+0*t27*(-1.653333333333333d-2*gammaaa*t3*t46*t7+1.02506
     5         66666666663d-4*t43*t44*t45*t7+6.2d-3*gammaaa*t1*t3*(-1.65
     6         3333333333333d-2*gammaaa*t3*t46*t6+1.0250666666666663d-4*
     7         t43*t44*t45*t6+6.2d-3*gammaaa*t1*t3*(-1.653333333333333d-
     8         2*gammaaa*t3*t46*t5+1.0250666666666663d-4*t43*t44*t45*t5+
     9         6.2d-3*gammaaa*t1*t3*(1.0250666666666663d-4*t4*t43*t44*t4
     :         5-1.653333333333333d-2*gammaaa*t3*t4*t46))))+t35*(1.0d+0*
     ;         rhoa*t22*t37*(6.0d-2*gammaaa*t1*t29*(6.0d-2*gammaaa*t1*t2
     <         9*(6.0d-2*gammaaa*t1*t29*(9.599999999999997d-3*t30*t43*t4
     =         5*t47-1.5999999999999998d-1*gammaaa*t29*t30*t46)+9.599999
     >         999999997d-3*t31*t43*t45*t47-1.5999999999999998d-1*gammaa
     ?         a*t29*t31*t46)+9.599999999999997d-3*t32*t43*t45*t47-1.599
     @         9999999999998d-1*gammaaa*t29*t32*t46)+9.599999999999997d-
     1         3*t33*t43*t45*t47-1.5999999999999998d-1*gammaaa*t29*t33*t
     2         46)+1.0d+0*rhoa*t34*t37*t42+1.0d+0*t22*t34*t37)+2.5d-1*ga
     3         mmaaa*t22*t34*t35*t36)*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = t49+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t49+Cmat(iq,D1_GAB)
            Amat(iq,D1_TA) = (2.0d+0*rhoa*t22*t34*t35-1.0d+0*rhoa*t22*t3
     1         4*t37/taua**2)*wght+Amat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = param(5)
            t2 = 1/rhoa**2.6666666666666666d+0
            t3 = 1/rhob**2.6666666666666666d+0
            t4 = gammabb*t3+gammaaa*t2
            t5 = 3.1d-3*t4+1.0d+0
            t6 = 1/t5
            t7 = 3.1d-3*t1*t4*t6+param(4)
            t8 = 3.1d-3*t4*t6*t7+param(3)
            t9 = 3.1d-3*t4*t6*t8+param(2)
            t10 = 3.1d-3*t4*t6*t9+param(1)
            t11 = 1/rhoa**6.666666666666666d-1
            t12 = rhoa**5.0d-1
            t13 = 1/t12
            t14 = 1/rhoa**3.333333333333333d-1
            t15 = 1/rhoa**1.6666666666666666d-1
            t16 = 1.1120374863094686d+1*t15+3.8447462374472113d+0*t14+1.
     1         644733775567609d+0*t13+2.4058712912881916d-1*t11
            t17 = 3.216395899738507d+1/t16+1.0d+0
            t18 = log(t17)
            t19 = 1.274696188700087d-1*t14+1.0d+0
            t20 = 5.982550435771079d+0*t15+2.2255694211506874d+0*t14+8.0
     1         04286349993635d-1*t13+1.8970043257475583d-1*t11
            t21 = 1.6081979498692536d+1/t20+1.0d+0
            t22 = log(t21)
            t23 = 1.3256889990520176d-1*t14+1.0d+0
            t24 = -6.903522198342671d-18*t22*t23-3.1090699999999993d-2*t
     1         18*t19
            t25 = 1/rhob**6.666666666666666d-1
            t26 = rhob**5.0d-1
            t27 = 1/t26
            t28 = 1/rhob**3.333333333333333d-1
            t29 = 1/rhob**1.6666666666666666d-1
            t30 = 1.1120374863094686d+1*t29+3.8447462374472113d+0*t28+1.
     1         644733775567609d+0*t27+2.4058712912881916d-1*t25
            t31 = 3.216395899738507d+1/t30+1.0d+0
            t32 = log(t31)
            t33 = 1.274696188700087d-1*t28+1.0d+0
            t34 = 5.982550435771079d+0*t29+2.2255694211506874d+0*t28+8.0
     1         04286349993635d-1*t27+1.8970043257475583d-1*t25
            t35 = 1.6081979498692536d+1/t34+1.0d+0
            t36 = log(t35)
            t37 = 1.3256889990520176d-1*t28+1.0d+0
            t38 = -6.903522198342671d-18*t36*t37-3.1090699999999993d-2*t
     1         32*t33
            t39 = rhob+rhoa
            t40 = 1/t39**3.333333333333333d-1
            t41 = 1.3256889990520176d-1*t40+1.0d+0
            t42 = rhoa-rhob
            t43 = t42**4
            t44 = 1/t39**4
            t45 = 1/t39
            t46 = 1.0d+0-t42*t45
            t47 = t42*t45+1.0d+0
            t48 = t47**1.3333333333333333d+0+t46**1.3333333333333333d+0-
     1         2.0d+0
            t49 = -1.923661050931536d+0*t43*t44*t48
            t50 = t49+1.0d+0
            t51 = 1/t39**6.666666666666666d-1
            t52 = t39**5.0d-1
            t53 = 1/t52
            t54 = 1/t39**1.6666666666666666d-1
            t55 = 5.982550435771079d+0*t54+8.004286349993635d-1*t53+1.89
     1         70043257475583d-1*t51+2.2255694211506874d+0*t40
            t56 = 1.6081979498692536d+1/t55+1.0d+0
            t57 = log(t56)
            t58 = -6.21814d-2*t41*t50*t57
            t59 = 6.901399211255825d-2*t40+1.0d+0
            t60 = t49+1.923661050931536d+0*t48
            t61 = 8.157414703487641d+0*t54+4.3009724712766434d-1*t53+1.9
     1         115125951273373d-1*t51+2.247591863577616d+0*t40
            t62 = 2.9608813203268075d+1/t61+1.0d+0
            t63 = log(t62)
            t64 = 1.9751631321680768d-2*t59*t60*t63
            t65 = 1.274696188700087d-1*t40+1.0d+0
            t66 = 1.1120374863094686d+1*t54+1.644733775567609d+0*t53+2.4
     1         058712912881916d-1*t51+3.8447462374472113d+0*t40
            t67 = 3.216395899738507d+1/t66+1.0d+0
            t68 = log(t67)
            t69 = -5.980796863619711d-2*t43*t44*t48*t65*t68
            t70 = t39*(t69+t64+t58)-rhob*t38-rhoa*t24
            t71 = param(6)
            t72 = 6.0d-2*gammaaa*t2+1.0d+0
            t73 = 1/t72
            t74 = param(7)
            t75 = param(8)
            t76 = param(9)
            t77 = param(10)
            t78 = 6.0d-2*gammaaa*t2*t73*t77+t76
            t79 = 6.0d-2*gammaaa*t2*t73*t78+t75
            t80 = 6.0d-2*gammaaa*t2*t73*t79+t74
            t81 = 6.0d-2*gammaaa*t2*t73*t80+t71
            t82 = 1/taua
            t83 = 1/rhoa
            t84 = 2.0d+0*taua-2.5d-1*gammaaa*t83
            t85 = 6.0d-2*gammabb*t3+1.0d+0
            t86 = 1/t85
            t87 = 6.0d-2*gammabb*t3*t77*t86+t76
            t88 = 6.0d-2*gammabb*t3*t86*t87+t75
            t89 = 6.0d-2*gammabb*t3*t86*t88+t74
            t90 = 6.0d-2*gammabb*t3*t86*t89+t71
            t91 = 1/taub
            t92 = 1/rhob
            t93 = 2.0d+0*taub-2.5d-1*gammabb*t92
            t94 = 1/rhoa**1.6666666666666669d+0
            t95 = 1/t12**3
            t96 = 1/rhoa**1.3333333333333333d+0
            t97 = 1/rhoa**1.1666666666666667d+0
            t98 = 1.1102230246251565d-16*t23*(-9.970917392951799d-1*t97-
     1         7.418564737168958d-1*t96-4.002143174996817d-1*t95-1.26466
     2         9550498372d-1*t94)/(t20**2*t21)+1.0d+0*t19*(-1.8533958105
     3         157808d+0*t97-1.2815820791490704d+0*t96-8.223668877838045
     4         d-1*t95-1.6039141941921276d-1*t94)/(t16**2*t17)+3.0506411
     5         443514264d-19*t22*t96+1.3210398931339265d-3*t18*t96
            t99 = 1/t39**1.6666666666666669d+0
            t100 = 1/t52**3
            t101 = 1/t39**1.3333333333333333d+0
            t102 = 1/t39**1.1666666666666667d+0
            t103 = 1.0d+0*t41*t50*(-1.264669550498372d-1*t99-9.970917392
     1         951799d-1*t102-7.418564737168958d-1*t101-4.00214317499681
     2         7d-1*t100)/(t55**2*t56)
            t104 = -5.848223622634647d-1*t59*t60*(-1.2743417300848914d-1
     1         *t99-1.3595691172479402d+0*t102-7.491972878592053d-1*t101
     2         -2.1504862356383217d-1*t100)/(t61**2*t62)
            t105 = 1.923661050931536d+0*t43*t44*t48*t65*(-1.603914194192
     1         1276d-1*t99-1.8533958105157808d+0*t102-1.2815820791490704
     2         d+0*t101-8.223668877838045d-1*t100)/(t66**2*t67)
            t106 = 1/t39**2
            t107 = t106*t42
            t108 = -t45
            t109 = t46**3.333333333333333d-1
            t110 = -t106*t42
            t111 = t47**3.333333333333333d-1
            t112 = 1.3333333333333333d+0*t111*(t45+t110)+1.3333333333333
     1         333d+0*(t108+t107)*t109
            t113 = -1.923661050931536d+0*t112*t43*t44
            t114 = 1/t39**5
            t115 = 7.694644203726144d+0*t114*t43*t48
            t116 = t42**3
            t117 = -7.694644203726144d+0*t116*t44*t48
            t118 = 2.747773264188437d-3*t101*t50*t57
            t119 = -4.5437964274821163d-4*t101*t60*t63
            t120 = 2.541232989148493d-3*t43*t48*t68/t39**5.3333333333333
     1         33d+0
            t121 = 2.3923187454478842d-1*t114*t43*t48*t65*t68
            t122 = 1/rhoa**3.6666666666666664d+0
            t123 = 1/t5**2
            t124 = gammaaa**2
            t125 = 1/t72**2
            t126 = 1/rhoa**6.333333333333333d+0
            t127 = 1/rhob**1.6666666666666669d+0
            t128 = 1/t26**3
            t129 = 1/rhob**1.3333333333333333d+0
            t130 = 1/rhob**1.1666666666666667d+0
            t131 = 1.1102230246251565d-16*(-9.970917392951799d-1*t130-7.
     1         418564737168958d-1*t129-4.002143174996817d-1*t128-1.26466
     2         9550498372d-1*t127)*t37/(t34**2*t35)+3.0506411443514264d-
     3         19*t129*t36+1.0d+0*(-1.8533958105157808d+0*t130-1.2815820
     4         791490704d+0*t129-8.223668877838045d-1*t128-1.60391419419
     5         21276d-1*t127)*t33/(t30**2*t31)+1.3210398931339265d-3*t12
     6         9*t32
            t132 = 1.3333333333333333d+0*t109*(t45+t107)+1.3333333333333
     1         333d+0*(t110+t108)*t111
            t133 = -1.923661050931536d+0*t132*t43*t44
            t134 = 7.694644203726144d+0*t116*t44*t48
            t135 = 1/rhob**3.6666666666666664d+0
            t136 = gammabb**2
            t137 = 1/t85**2
            t138 = 1/rhob**6.333333333333333d+0
            t139 = 1/rhoa**5.333333333333333d+0
            t140 = 1/rhob**5.333333333333333d+0
            fnc(iq) = (5.0d-1*rhob*t38*t90*t91*t93+5.0d-1*rhoa*t24*t81*t
     1         82*t84+1.0d+0*t10*t70)*wght+fnc(iq)
            Amat(iq,D1_RA) = (t82*(5.0d-1*rhoa*t81*t84*t98+5.0d-1*t24*t8
     1         1*t84+5.0d-1*rhoa*t24*(-1.5999999999999998d-1*gammaaa*t12
     2         2*t73*t80+9.599999999999997d-3*t124*t125*t126*t80+6.0d-2*
     3         gammaaa*t2*t73*(-1.5999999999999998d-1*gammaaa*t122*t73*t
     4         79+9.599999999999997d-3*t124*t125*t126*t79+6.0d-2*gammaaa
     5         *t2*t73*(-1.5999999999999998d-1*gammaaa*t122*t73*t78+9.59
     6         9999999999997d-3*t124*t125*t126*t78+6.0d-2*gammaaa*t2*t73
     7         *(9.599999999999997d-3*t124*t125*t126*t77-1.5999999999999
     8         998d-1*gammaaa*t122*t73*t77))))*t84)+1.0d+0*t10*(-rhoa*t9
     9         8+t69+t39*(-2.3923187454478842d-1*t116*t44*t48*t65*t68-5.
     :         980796863619711d-2*t112*t43*t44*t65*t68+1.975163132168076
     ;         8d-2*(t117+t115+t113+1.923661050931536d+0*t112)*t59*t63-6
     <         .21814d-2*(t117+t115+t113)*t41*t57+t121+t120+t119+t118+t1
     =         05+t104+t103)+t64+t58+6.903522198342671d-18*t22*t23+3.109
     >         0699999999993d-2*t18*t19)+1.0d+0*t70*(-8.266666666666665d
     ?         -3*gammaaa*t122*t6*t9+2.562666666666666d-5*gammaaa*t122*t
     @         123*t4*t9+3.1d-3*t4*t6*(-8.266666666666665d-3*gammaaa*t12
     1         2*t6*t8+2.562666666666666d-5*gammaaa*t122*t123*t4*t8+3.1d
     2         -3*t4*t6*(-8.266666666666665d-3*gammaaa*t122*t6*t7+2.5626
     3         66666666666d-5*gammaaa*t122*t123*t4*t7+3.1d-3*t4*t6*(2.56
     4         2666666666666d-5*gammaaa*t1*t122*t123*t4-8.26666666666666
     5         5d-3*gammaaa*t1*t122*t6))))+1.25d-1*gammaaa*t24*t81*t82*t
     6         83)*wght+Amat(iq,D1_RA)
            Amat(iq,D1_RB) = (t91*(5.0d-1*t38*t90*t93+5.0d-1*rhob*t131*t
     1         90*t93+5.0d-1*rhob*t38*(-1.5999999999999998d-1*gammabb*t1
     2         35*t86*t89+9.599999999999997d-3*t136*t137*t138*t89+6.0d-2
     3         *gammabb*t3*t86*(-1.5999999999999998d-1*gammabb*t135*t86*
     4         t88+9.599999999999997d-3*t136*t137*t138*t88+6.0d-2*gammab
     5         b*t3*t86*(-1.5999999999999998d-1*gammabb*t135*t86*t87+9.5
     6         99999999999997d-3*t136*t137*t138*t87+6.0d-2*gammabb*t3*t8
     7         6*(9.599999999999997d-3*t136*t137*t138*t77-1.599999999999
     8         9998d-1*gammabb*t135*t77*t86))))*t93)+1.25d-1*gammabb*t38
     9         *t90*t91*t92+1.0d+0*t70*(-8.266666666666665d-3*gammabb*t1
     :         35*t6*t9+2.562666666666666d-5*gammabb*t123*t135*t4*t9+3.1
     ;         d-3*t4*t6*(-8.266666666666665d-3*gammabb*t135*t6*t8+2.562
     <         666666666666d-5*gammabb*t123*t135*t4*t8+3.1d-3*t4*t6*(-8.
     =         266666666666665d-3*gammabb*t135*t6*t7+2.562666666666666d-
     >         5*gammabb*t123*t135*t4*t7+3.1d-3*t4*t6*(2.562666666666666
     ?         d-5*gammabb*t1*t123*t135*t4-8.266666666666665d-3*gammabb*
     @         t1*t135*t6))))+1.0d+0*t10*(t69+t39*(2.3923187454478842d-1
     1         *t116*t44*t48*t65*t68-5.980796863619711d-2*t132*t43*t44*t
     2         65*t68+1.9751631321680768d-2*(t134+t133+1.923661050931536
     3         d+0*t132+t115)*t59*t63-6.21814d-2*(t134+t133+t115)*t41*t5
     4         7+t121+t120+t119+t118+t105+t104+t103)+t64+t58+6.903522198
     5         342671d-18*t36*t37+3.1090699999999993d-2*t32*t33-rhob*t13
     6         1))*wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = (1.0d+0*t70*(3.1d-3*t2*t6*t9-9.61d-6*t123*
     1         t2*t4*t9+3.1d-3*t4*t6*(3.1d-3*t2*t6*t8-9.61d-6*t123*t2*t4
     2         *t8+3.1d-3*t4*t6*(3.1d-3*t2*t6*t7-9.61d-6*t123*t2*t4*t7+3
     3         .1d-3*t4*t6*(3.1d-3*t1*t2*t6-9.61d-6*t1*t123*t2*t4))))+t8
     4         2*(5.0d-1*rhoa*t24*(6.0d-2*t2*t73*t80-3.6d-3*gammaaa*t125
     5         *t139*t80+6.0d-2*gammaaa*t2*t73*(6.0d-2*t2*t73*t79-3.6d-3
     6         *gammaaa*t125*t139*t79+6.0d-2*gammaaa*t2*t73*(6.0d-2*t2*t
     7         73*t78-3.6d-3*gammaaa*t125*t139*t78+6.0d-2*gammaaa*t2*t73
     8         *(6.0d-2*t2*t73*t77-3.6d-3*gammaaa*t125*t139*t77))))*t84-
     9         1.25d-1*t24*t81))*wght+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = Cmat(iq,D1_GAB)
            Cmat(iq,D1_GBB) = (t91*(5.0d-1*rhob*t38*(6.0d-2*t3*t86*t89-3
     1         .6d-3*gammabb*t137*t140*t89+6.0d-2*gammabb*t3*t86*(6.0d-2
     2         *t3*t86*t88-3.6d-3*gammabb*t137*t140*t88+6.0d-2*gammabb*t
     3         3*t86*(6.0d-2*t3*t86*t87-3.6d-3*gammabb*t137*t140*t87+6.0
     4         d-2*gammabb*t3*t86*(6.0d-2*t3*t77*t86-3.6d-3*gammabb*t137
     5         *t140*t77))))*t93-1.25d-1*t38*t90)+1.0d+0*t70*(3.1d-3*t3*
     6         t6*t9-9.61d-6*t123*t3*t4*t9+3.1d-3*t4*t6*(3.1d-3*t3*t6*t8
     7         -9.61d-6*t123*t3*t4*t8+3.1d-3*t4*t6*(3.1d-3*t3*t6*t7-9.61
     8         d-6*t123*t3*t4*t7+3.1d-3*t4*t6*(3.1d-3*t1*t3*t6-9.61d-6*t
     9         1*t123*t3*t4)))))*wght+Cmat(iq,D1_GBB)
            Mmat(iq,D1_TA) = (1.0d+0*rhoa*t24*t81*t82-5.0d-1*rhoa*t24*t8
     1         1*t84/taua**2)*wght+Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = (1.0d+0*rhob*t38*t90*t91-5.0d-1*rhob*t38*t9
     1         0*t93/taub**2)*wght+Mmat(iq,D1_TB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = 1/rhoa**2.6666666666666666d+0
            t2 = 6.0d-2*gammaaa*t1+1.0d+0
            t3 = 1/t2
            t4 = param(10)
            t5 = 6.0d-2*gammaaa*t1*t3*t4+param(9)
            t6 = 6.0d-2*gammaaa*t1*t3*t5+param(8)
            t7 = 6.0d-2*gammaaa*t1*t3*t6+param(7)
            t8 = 6.0d-2*gammaaa*t1*t3*t7+param(6)
            t9 = 1/rhoa**6.666666666666666d-1
            t10 = rhoa**5.0d-1
            t11 = 1/t10
            t12 = 1/rhoa**3.333333333333333d-1
            t13 = 1/rhoa**1.6666666666666666d-1
            t14 = 2.4058712912881916d-1*t9+1.1120374863094686d+1*t13+3.8
     1         447462374472113d+0*t12+1.644733775567609d+0*t11
            t15 = 3.216395899738507d+1/t14+1.0d+0
            t16 = log(t15)
            t17 = 1.274696188700087d-1*t12+1.0d+0
            t18 = 1.8970043257475583d-1*t9+5.982550435771079d+0*t13+2.22
     1         55694211506874d+0*t12+8.004286349993635d-1*t11
            t19 = 1.6081979498692536d+1/t18+1.0d+0
            t20 = log(t19)
            t21 = 1.3256889990520176d-1*t12+1.0d+0
            t22 = -6.903522198342671d-18*t20*t21-3.1090699999999993d-2*t
     1         16*t17
            t23 = 1/taua
            t24 = 1/rhoa
            t25 = 2.0d+0*taua-2.5d-1*gammaaa*t24
            t26 = 1/rhoa**1.6666666666666669d+0
            t27 = 1/t10**3
            t28 = 1/rhoa**1.3333333333333333d+0
            t29 = 1/rhoa**1.1666666666666667d+0
            t30 = gammaaa**2
            t31 = 1/t2**2
            t32 = 1/rhoa**6.333333333333333d+0
            t33 = 1/rhoa**3.6666666666666664d+0
            t34 = 1/rhoa**5.333333333333333d+0
            fnc(iq) = 5.0d-1*rhoa*t22*t23*t25*t8*wght+fnc(iq)
            Amat(iq,D1_RA) = t23*(5.0d-1*rhoa*t25*(1.1102230246251565d-1
     1         6*t21*(-9.970917392951799d-1*t29-7.418564737168958d-1*t28
     2         -4.002143174996817d-1*t27-1.264669550498372d-1*t26)/(t18*
     3         *2*t19)+1.0d+0*t17*(-1.8533958105157808d+0*t29-1.28158207
     4         91490704d+0*t28-8.223668877838045d-1*t27-1.60391419419212
     5         76d-1*t26)/(t14**2*t15)+3.0506411443514264d-19*t20*t28+1.
     6         3210398931339265d-3*t16*t28)*t8*wght+5.0d-1*t22*t25*t8*wg
     7         ht+5.0d-1*rhoa*t22*t25*(-1.5999999999999998d-1*gammaaa*t3
     8         *t33*t7+9.599999999999997d-3*t30*t31*t32*t7+6.0d-2*gammaa
     9         a*t1*t3*(-1.5999999999999998d-1*gammaaa*t3*t33*t6+9.59999
     :         9999999997d-3*t30*t31*t32*t6+6.0d-2*gammaaa*t1*t3*(-1.599
     ;         9999999999998d-1*gammaaa*t3*t33*t5+9.599999999999997d-3*t
     <         30*t31*t32*t5+6.0d-2*gammaaa*t1*t3*(9.599999999999997d-3*
     =         t30*t31*t32*t4-1.5999999999999998d-1*gammaaa*t3*t33*t4)))
     >         )*wght)+1.25d-1*gammaaa*t22*t23*t24*t8*wght+Amat(iq,D1_RA
     ?         )
            Cmat(iq,D1_GAA) = t23*(5.0d-1*rhoa*t22*t25*(-3.6d-3*gammaaa*
     1         t31*t34*t7+6.0d-2*t1*t3*t7+6.0d-2*gammaaa*t1*t3*(-3.6d-3*
     2         gammaaa*t31*t34*t6+6.0d-2*t1*t3*t6+6.0d-2*gammaaa*t1*t3*(
     3         -3.6d-3*gammaaa*t31*t34*t5+6.0d-2*t1*t3*t5+6.0d-2*gammaaa
     4         *t1*t3*(6.0d-2*t1*t3*t4-3.6d-3*gammaaa*t31*t34*t4))))*wgh
     5         t-1.25d-1*t22*t8*wght)+Cmat(iq,D1_GAA)
            Mmat(iq,D1_TA) = -5.0d-1*rhoa*t22*t25*t8*wght/taua**2+1.0d+0
     1         *rhoa*t22*t23*t8*wght+Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhob**2.6666666666666666d+0
            t2 = 6.0d-2*gammabb*t1+1.0d+0
            t3 = 1/t2
            t4 = param(10)
            t5 = 6.0d-2*gammabb*t1*t3*t4+param(9)
            t6 = 6.0d-2*gammabb*t1*t3*t5+param(8)
            t7 = 6.0d-2*gammabb*t1*t3*t6+param(7)
            t8 = 6.0d-2*gammabb*t1*t3*t7+param(6)
            t9 = 1/rhob**6.666666666666666d-1
            t10 = rhob**5.0d-1
            t11 = 1/t10
            t12 = 1/rhob**3.333333333333333d-1
            t13 = 1/rhob**1.6666666666666666d-1
            t14 = 2.4058712912881916d-1*t9+1.1120374863094686d+1*t13+3.8
     1         447462374472113d+0*t12+1.644733775567609d+0*t11
            t15 = 3.216395899738507d+1/t14+1.0d+0
            t16 = log(t15)
            t17 = 1.274696188700087d-1*t12+1.0d+0
            t18 = 1.8970043257475583d-1*t9+5.982550435771079d+0*t13+2.22
     1         55694211506874d+0*t12+8.004286349993635d-1*t11
            t19 = 1.6081979498692536d+1/t18+1.0d+0
            t20 = log(t19)
            t21 = 1.3256889990520176d-1*t12+1.0d+0
            t22 = -6.903522198342671d-18*t20*t21-3.1090699999999993d-2*t
     1         16*t17
            t23 = 1/taub
            t24 = 1/rhob
            t25 = 2.0d+0*taub-2.5d-1*gammabb*t24
            t26 = 1/rhob**1.6666666666666669d+0
            t27 = 1/t10**3
            t28 = 1/rhob**1.3333333333333333d+0
            t29 = 1/rhob**1.1666666666666667d+0
            t30 = gammabb**2
            t31 = 1/t2**2
            t32 = 1/rhob**6.333333333333333d+0
            t33 = 1/rhob**3.6666666666666664d+0
            t34 = 1/rhob**5.333333333333333d+0
            fnc(iq) = 5.0d-1*rhob*t22*t23*t25*t8*wght+fnc(iq)
            Amat(iq,D1_RB) = t23*(5.0d-1*rhob*t25*(1.1102230246251565d-1
     1         6*t21*(-9.970917392951799d-1*t29-7.418564737168958d-1*t28
     2         -4.002143174996817d-1*t27-1.264669550498372d-1*t26)/(t18*
     3         *2*t19)+1.0d+0*t17*(-1.8533958105157808d+0*t29-1.28158207
     4         91490704d+0*t28-8.223668877838045d-1*t27-1.60391419419212
     5         76d-1*t26)/(t14**2*t15)+3.0506411443514264d-19*t20*t28+1.
     6         3210398931339265d-3*t16*t28)*t8*wght+5.0d-1*t22*t25*t8*wg
     7         ht+5.0d-1*rhob*t22*t25*(-1.5999999999999998d-1*gammabb*t3
     8         *t33*t7+9.599999999999997d-3*t30*t31*t32*t7+6.0d-2*gammab
     9         b*t1*t3*(-1.5999999999999998d-1*gammabb*t3*t33*t6+9.59999
     :         9999999997d-3*t30*t31*t32*t6+6.0d-2*gammabb*t1*t3*(-1.599
     ;         9999999999998d-1*gammabb*t3*t33*t5+9.599999999999997d-3*t
     <         30*t31*t32*t5+6.0d-2*gammabb*t1*t3*(9.599999999999997d-3*
     =         t30*t31*t32*t4-1.5999999999999998d-1*gammabb*t3*t33*t4)))
     >         )*wght)+1.25d-1*gammabb*t22*t23*t24*t8*wght+Amat(iq,D1_RB
     ?         )
            Cmat(iq,D1_GBB) = t23*(5.0d-1*rhob*t22*t25*(-3.6d-3*gammabb*
     1         t31*t34*t7+6.0d-2*t1*t3*t7+6.0d-2*gammabb*t1*t3*(-3.6d-3*
     2         gammabb*t31*t34*t6+6.0d-2*t1*t3*t6+6.0d-2*gammabb*t1*t3*(
     3         -3.6d-3*gammabb*t31*t34*t5+6.0d-2*t1*t3*t5+6.0d-2*gammabb
     4         *t1*t3*(6.0d-2*t1*t3*t4-3.6d-3*gammabb*t31*t34*t4))))*wgh
     5         t-1.25d-1*t22*t8*wght)+Cmat(iq,D1_GBB)
            Mmat(iq,D1_TB) = -5.0d-1*rhob*t22*t25*t8*wght/taub**2+1.0d+0
     1         *rhob*t22*t23*t8*wght+Mmat(iq,D1_TB)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_m05 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& {{1}\over{\rho_\alpha^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\sqrt{\rho_\alpha}}}\\\\ 
C>   {\it t_3} &=& {{1}\over{\rho_\alpha^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{\rho_\alpha^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_5} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_4}+2.225569421150687\,{\it t_3}+0.8004286349993635\,{\it t_2}+0.1897004325747558\,{\it t_1}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_3}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_4}+3.844746237447211\,{\it t_3}+1.644733775567609\,{\it t_2}+0.2405871291288192\,{\it t_1}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_3}+1.0\right)\\\\ 
C>   {\it t_6} &=& {{1}\over{\rho_\beta^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_7} &=& {{1}\over{\sqrt{\rho_\beta}}}\\\\ 
C>   {\it t_8} &=& {{1}\over{\rho_\beta^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_9} &=& {{1}\over{\rho_\beta^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{10}} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_9}+2.225569421150687\,{\it t_8}+0.8004286349993635\,{\it t_7}+0.1897004325747558\,{\it t_6}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_8}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_9}+3.844746237447211\,{\it t_8}+1.644733775567609\,{\it t_7}+0.2405871291288192\,{\it t_6}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_8}+1.0\right)\\\\ 
C>   {\it t_{11}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{12}} &=& {{1}\over{{\it t_{11}}^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{13}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}^4\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_{11}}^4}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{{\it t_{11}}}}\\\\ 
C>   {\it t_{17}} &=& \left({\it t_{13}}\,{\it t_{16}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{13}}\,{\it t_{16}}\right)^{{{4}\over{3}}}-2.0\\\\ 
C>   {\it t_{18}} &=& -1.923661050931536\,{\it t_{14}}\,{\it t_{15}}\,{\it t_{17}}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{{\it t_{11}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{\sqrt{{\it t_{11}}}}}\\\\ 
C>   {\it t_{21}} &=& {{1}\over{{\it t_{11}}^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{23}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{24}} &=& {\it t_{23}}\,\sigma_{\beta\beta}+{\it t_{22}}\,\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{0.0031\,{\it t_{24}}+1.0}}\\\\ 
C>   {\it t_{26}} &=& {\it param}\left(6\right)\\\\ 
C>   {\it t_{27}} &=& {{1}\over{0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}+1.0}}\\\\ 
C>   {\it t_{28}} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_{29}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{30}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{31}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{32}} &=& {{1}\over{0.06\,{\it t_{23}}\,\sigma_{\beta\beta}+1.0}}\\\\ 
C>   {\it t_{33}} &=& {{1}\over{\rho_s^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{34}} &=& {{1}\over{\sqrt{\rho_s}}}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{\rho_s^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{\rho_s^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{37}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{38}} &=& {{1}\over{0.06\,{\it t_{37}}\,\sigma_{ss}+1.0}}\\\\ 
C>   f &=& {{0.5\,{\it t_{10}}\,\rho_\beta\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{31}}\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_\beta-{{0.25\,\sigma_{\beta\beta}}\over{\rho_\beta}}\right)}\over{\tau_\beta}}+{{0.5\,{\it t_5}\,\rho_\alpha\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{31}}\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_\alpha-{{0.25\,\sigma_{\alpha\alpha}}\over{\rho_\alpha}}\right)}\over{\tau_\alpha}}+1.0\,\left({\it t_{11}}\,\left(-0.0598079686361971\,{\it t_{14}}\,{\it t_{15}}\,\left(0.1274696188700087\,{\it t_{12}}+1.0\right)\,{\it t_{17}}\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{21}}+3.844746237447211\,{\it t_{12}}+1.644733775567609\,{\it t_{20}}+0.2405871291288192\,{\it t_{19}}}}+1.0\right)+0.01975163132168077\,\left(0.06901399211255825\,{\it t_{12}}+1.0\right)\,\left({\it t_{18}}+1.923661050931536\,{\it t_{17}}\right)\,\log \left({{29.60881320326807}\over{8.15741470348764\,{\it t_{21}}+2.247591863577616\,{\it t_{12}}+0.4300972471276643\,{\it t_{20}}+0.1911512595127337\,{\it t_{19}}}}+1.0\right)-0.0621814\,\left(0.1325688999052018\,{\it t_{12}}+1.0\right)\,\left({\it t_{18}}+1.0\right)\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{21}}+2.225569421150687\,{\it t_{12}}+0.8004286349993635\,{\it t_{20}}+0.1897004325747558\,{\it t_{19}}}}+1.0\right)\right)-{\it t_{10}}\,\rho_\beta-{\it t_5}\,\rho_\alpha\right)\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it param}\left(5\right)\,{\it t_{24}}\,{\it t_{25}}+{\it param}\left(4\right)\right)+{\it param}\left(3\right)\right)+{\it param}\left(2\right)\right)+{\it param}\left(1\right)\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& {{0.5\,\left(-6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{36}}+2.225569421150687\,{\it t_{35}}+0.8004286349993635\,{\it t_{34}}+0.1897004325747558\,{\it t_{33}}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_{35}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{36}}+3.844746237447211\,{\it t_{35}}+1.644733775567609\,{\it t_{34}}+0.2405871291288192\,{\it t_{33}}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{35}}+1.0\right)\right)\,\rho_s\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{31}}\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_s-{{0.25\,\sigma_{ss}}\over{\rho_s}}\right)}\over{\tau_s}}\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] Y Zhao, NE Schultz, DG Truhlar, J.Chem.Phys. 123, 161103 (2005)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.2126975 "> 
C> 10.1063/1.2126975 </a> 
C> 
      subroutine nwxcm_c_m05_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Cmat,Cmat2,Mmat,Mmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_c_m05 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& {{1}\over{\rho_\alpha^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\sqrt{\rho_\alpha}}}\\\\ 
C>   {\it t_3} &=& {{1}\over{\rho_\alpha^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_4} &=& {{1}\over{\rho_\alpha^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_5} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_4}+2.225569421150687\,{\it t_3}+0.8004286349993635\,{\it t_2}+0.1897004325747558\,{\it t_1}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_3}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_4}+3.844746237447211\,{\it t_3}+1.644733775567609\,{\it t_2}+0.2405871291288192\,{\it t_1}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_3}+1.0\right)\\\\ 
C>   {\it t_6} &=& {{1}\over{\rho_\beta^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_7} &=& {{1}\over{\sqrt{\rho_\beta}}}\\\\ 
C>   {\it t_8} &=& {{1}\over{\rho_\beta^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_9} &=& {{1}\over{\rho_\beta^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{10}} &=& -6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_9}+2.225569421150687\,{\it t_8}+0.8004286349993635\,{\it t_7}+0.1897004325747558\,{\it t_6}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_8}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_9}+3.844746237447211\,{\it t_8}+1.644733775567609\,{\it t_7}+0.2405871291288192\,{\it t_6}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_8}+1.0\right)\\\\ 
C>   {\it t_{11}} &=& \rho_\beta+\rho_\alpha\\\\ 
C>   {\it t_{12}} &=& {{1}\over{{\it t_{11}}^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{13}} &=& \rho_\alpha-\rho_\beta\\\\ 
C>   {\it t_{14}} &=& {\it t_{13}}^4\\\\ 
C>   {\it t_{15}} &=& {{1}\over{{\it t_{11}}^4}}\\\\ 
C>   {\it t_{16}} &=& {{1}\over{{\it t_{11}}}}\\\\ 
C>   {\it t_{17}} &=& \left({\it t_{13}}\,{\it t_{16}}+1.0\right)^{{{4}\over{3}}}+\left(1.0-{\it t_{13}}\,{\it t_{16}}\right)^{{{4}\over{3}}}-2.0\\\\ 
C>   {\it t_{18}} &=& -1.923661050931536\,{\it t_{14}}\,{\it t_{15}}\,{\it t_{17}}\\\\ 
C>   {\it t_{19}} &=& {{1}\over{{\it t_{11}}^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{20}} &=& {{1}\over{\sqrt{{\it t_{11}}}}}\\\\ 
C>   {\it t_{21}} &=& {{1}\over{{\it t_{11}}^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{22}} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{23}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{24}} &=& {\it t_{23}}\,\sigma_{\beta\beta}+{\it t_{22}}\,\sigma_{\alpha\alpha}\\\\ 
C>   {\it t_{25}} &=& {{1}\over{0.0031\,{\it t_{24}}+1.0}}\\\\ 
C>   {\it t_{26}} &=& {\it param}\left(6\right)\\\\ 
C>   {\it t_{27}} &=& {{1}\over{0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}+1.0}}\\\\ 
C>   {\it t_{28}} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_{29}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{30}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{31}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{32}} &=& {{1}\over{0.06\,{\it t_{23}}\,\sigma_{\beta\beta}+1.0}}\\\\ 
C>   {\it t_{33}} &=& {{1}\over{\rho_s^{{{2}\over{3}}}}}\\\\ 
C>   {\it t_{34}} &=& {{1}\over{\sqrt{\rho_s}}}\\\\ 
C>   {\it t_{35}} &=& {{1}\over{\rho_s^{{{1}\over{3}}}}}\\\\ 
C>   {\it t_{36}} &=& {{1}\over{\rho_s^{{{1}\over{6}}}}}\\\\ 
C>   {\it t_{37}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{38}} &=& {{1}\over{0.06\,{\it t_{37}}\,\sigma_{ss}+1.0}}\\\\ 
C>   f &=& {{0.5\,{\it t_{10}}\,\rho_\beta\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}\,\left(0.06\,{\it t_{31}}\,{\it t_{23}}\,\sigma_{\beta\beta}\,{\it t_{32}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_\beta-{{0.25\,\sigma_{\beta\beta}}\over{\rho_\beta}}\right)}\over{\tau_\beta}}+{{0.5\,{\it t_5}\,\rho_\alpha\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}\,\left(0.06\,{\it t_{31}}\,{\it t_{22}}\,\sigma_{\alpha\alpha}\,{\it t_{27}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_\alpha-{{0.25\,\sigma_{\alpha\alpha}}\over{\rho_\alpha}}\right)}\over{\tau_\alpha}}+1.0\,\left({\it t_{11}}\,\left(-0.0598079686361971\,{\it t_{14}}\,{\it t_{15}}\,\left(0.1274696188700087\,{\it t_{12}}+1.0\right)\,{\it t_{17}}\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{21}}+3.844746237447211\,{\it t_{12}}+1.644733775567609\,{\it t_{20}}+0.2405871291288192\,{\it t_{19}}}}+1.0\right)+0.01975163132168077\,\left(0.06901399211255825\,{\it t_{12}}+1.0\right)\,\left({\it t_{18}}+1.923661050931536\,{\it t_{17}}\right)\,\log \left({{29.60881320326807}\over{8.15741470348764\,{\it t_{21}}+2.247591863577616\,{\it t_{12}}+0.4300972471276643\,{\it t_{20}}+0.1911512595127337\,{\it t_{19}}}}+1.0\right)-0.0621814\,\left(0.1325688999052018\,{\it t_{12}}+1.0\right)\,\left({\it t_{18}}+1.0\right)\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{21}}+2.225569421150687\,{\it t_{12}}+0.8004286349993635\,{\it t_{20}}+0.1897004325747558\,{\it t_{19}}}}+1.0\right)\right)-{\it t_{10}}\,\rho_\beta-{\it t_5}\,\rho_\alpha\right)\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it t_{24}}\,{\it t_{25}}\,\left(0.0031\,{\it param}\left(5\right)\,{\it t_{24}}\,{\it t_{25}}+{\it param}\left(4\right)\right)+{\it param}\left(3\right)\right)+{\it param}\left(2\right)\right)+{\it param}\left(1\right)\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& {{0.5\,\left(-6.903522198342671 \times 10^{-18}\,\log \left({{16.08197949869254}\over{5.98255043577108\,{\it t_{36}}+2.225569421150687\,{\it t_{35}}+0.8004286349993635\,{\it t_{34}}+0.1897004325747558\,{\it t_{33}}}}+1.0\right)\,\left(0.1325688999052018\,{\it t_{35}}+1.0\right)-0.0310907\,\log \left({{32.16395899738507}\over{11.12037486309469\,{\it t_{36}}+3.844746237447211\,{\it t_{35}}+1.644733775567609\,{\it t_{34}}+0.2405871291288192\,{\it t_{33}}}}+1.0\right)\,\left(0.1274696188700087\,{\it t_{35}}+1.0\right)\right)\,\rho_s\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}\,\left(0.06\,{\it t_{31}}\,{\it t_{37}}\,\sigma_{ss}\,{\it t_{38}}+{\it t_{30}}\right)+{\it t_{29}}\right)+{\it t_{28}}\right)+{\it t_{26}}\right)\,\left(2.0\,\tau_s-{{0.25\,\sigma_{ss}}\over{\rho_s}}\right)}\over{\tau_s}}\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] Y Zhao, NE Schultz, DG Truhlar, J.Chem.Phys. 123, 161103 (2005)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.2126975 "> 
C> 10.1063/1.2126975 </a> 
C> 
      subroutine nwxcm_c_m05_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3,Mmat,Mmat2,Mmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,NCOL_AMAT3)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,NCOL_CMAT3)  !< [Output] The 3rd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat3(nq,NCOL_MMAT3)  !< [Output] The 3rd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
