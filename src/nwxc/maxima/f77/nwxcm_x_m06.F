C> \ingroup nwxc 
C> @{ 
C> 
C> \file nwxcm_x_m06.F 
C> The nwxcm_x_m06 functional 
C> 
C> @} 
C> 
C> \ingroup nwxc_priv 
C> @{ 
C> 
C> \brief Evaluate the nwxcm_x_m06 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\alpha^{{{4}\over{3}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_3} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_4} &=& {\it param}\left(18\right)\\\\ 
C>   {\it t_5} &=& \rho_\alpha^{{{5}\over{3}}}\\\\ 
C>   {\it t_6} &=& {{4.557799872345596\,{\it t_5}}\over{\tau_\alpha}}\\\\ 
C>   {\it t_7} &=& {\it t_6}-1.0\\\\ 
C>   {\it t_8} &=& {\it t_6}+1.0\\\\ 
C>   {\it t_9} &=& {\it param}\left(17\right)\\\\ 
C>   {\it t_{10}} &=& {\it param}\left(16\right)\\\\ 
C>   {\it t_{11}} &=& {\it param}\left(15\right)\\\\ 
C>   {\it t_{12}} &=& {\it param}\left(14\right)\\\\ 
C>   {\it t_{13}} &=& {\it param}\left(13\right)\\\\ 
C>   {\it t_{14}} &=& {\it param}\left(12\right)\\\\ 
C>   {\it t_{15}} &=& {\it param}\left(11\right)\\\\ 
C>   {\it t_{16}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{17}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{18}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{19}} &=& {{2.0\,\tau_\alpha}\over{{\it t_5}}}-9.11559972\\\\ 
C>   {\it t_{20}} &=& 0.00186726\,{\it t_{19}}+0.00186726\,{\it t_2}\,\sigma_{\alpha\alpha}+1.0\\\\ 
C>   {\it t_{21}} &=& {{1}\over{{\it t_{20}}}}\\\\ 
C>   {\it t_{22}} &=& {\it param}\left(1\right)\\\\ 
C>   {\it t_{23}} &=& {\it param}\left(4\right)\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{20}}^2}}\\\\ 
C>   {\it t_{25}} &=& {\it param}\left(5\right)\\\\ 
C>   {\it t_{26}} &=& {\it param}\left(6\right)\\\\ 
C>   {\it t_{27}} &=& {\it param}\left(2\right)\\\\ 
C>   {\it t_{28}} &=& {\it param}\left(3\right)\\\\ 
C>   {\it t_{29}} &=& \rho_\beta^{{{4}\over{3}}}\\\\ 
C>   {\it t_{30}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{31}} &=& \rho_\beta^{{{5}\over{3}}}\\\\ 
C>   {\it t_{32}} &=& {{4.557799872345596\,{\it t_{31}}}\over{\tau_\beta}}\\\\ 
C>   {\it t_{33}} &=& {\it t_{32}}-1.0\\\\ 
C>   {\it t_{34}} &=& {\it t_{32}}+1.0\\\\ 
C>   {\it t_{35}} &=& {{2.0\,\tau_\beta}\over{{\it t_{31}}}}-9.11559972\\\\ 
C>   {\it t_{36}} &=& 0.00186726\,{\it t_{35}}+0.00186726\,{\it t_{30}}\,\sigma_{\beta\beta}+1.0\\\\ 
C>   {\it t_{37}} &=& {{1}\over{{\it t_{36}}}}\\\\ 
C>   {\it t_{38}} &=& {{1}\over{{\it t_{36}}^2}}\\\\ 
C>   {\it t_{39}} &=& \rho_s^{{{4}\over{3}}}\\\\ 
C>   {\it t_{40}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{41}} &=& \rho_s^{{{5}\over{3}}}\\\\ 
C>   {\it t_{42}} &=& {{4.557799872345596\,{\it t_{41}}}\over{\tau_s}}\\\\ 
C>   {\it t_{43}} &=& {\it t_{42}}-1.0\\\\ 
C>   {\it t_{44}} &=& {\it t_{42}}+1.0\\\\ 
C>   {\it t_{45}} &=& {{2.0\,\tau_s}\over{{\it t_{41}}}}-9.11559972\\\\ 
C>   {\it t_{46}} &=& 0.00186726\,{\it t_{45}}+0.00186726\,{\it t_{40}}\,\sigma_{ss}+1.0\\\\ 
C>   {\it t_{47}} &=& {{1}\over{{\it t_{46}}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{{\it t_{46}}^2}}\\\\ 
C>   f &=& 1.0\,{\it t_{29}}\,{\it t_{37}}\,\left({\it t_{28}}\,{\it t_{35}}\,{\it t_{37}}+{\it t_{27}}\,{\it t_{30}}\,\sigma_{\beta\beta}\,{\it t_{37}}+{\it t_{26}}\,{\it t_{35}}^2\,{\it t_{38}}+{\it t_{25}}\,{\it t_{30}}\,\sigma_{\beta\beta}\,{\it t_{35}}\,{\it t_{38}}+{{{\it t_{23}}\,\sigma_{\beta\beta}^2\,{\it t_{38}}}\over{\rho_\beta^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_{29}}\,\left({{0.00361218645365095\,{\it t_{30}}\,\sigma_{\beta\beta}}\over{.004492769220958891\,{\it t_{30}}\,\sigma_{\beta\beta}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_{33}}}\over{{\it t_{34}}}}+{{{\it t_{17}}\,{\it t_{33}}^2}\over{{\it t_{34}}^2}}+{{{\it t_{16}}\,{\it t_{33}}^3}\over{{\it t_{34}}^3}}+{{{\it t_{15}}\,{\it t_{33}}^4}\over{{\it t_{34}}^4}}+{{{\it t_{14}}\,{\it t_{33}}^5}\over{{\it t_{34}}^5}}+{{{\it t_{13}}\,{\it t_{33}}^6}\over{{\it t_{34}}^6}}+{{{\it t_{12}}\,{\it t_{33}}^7}\over{{\it t_{34}}^7}}+{{{\it t_{11}}\,{\it t_{33}}^8}\over{{\it t_{34}}^8}}+{{{\it t_{10}}\,{\it t_{33}}^9}\over{{\it t_{34}}^9}}+{{{\it t_9}\,{\it t_{33}}^{10}}\over{{\it t_{34}}^{10}}}+{{{\it t_4}\,{\it t_{33}}^{11}}\over{{\it t_{34}}^{11}}}+{\it t_3}\right)+1.0\,{\it t_1}\,{\it t_{21}}\,\left({\it t_{28}}\,{\it t_{19}}\,{\it t_{21}}+{\it t_{27}}\,{\it t_2}\,\sigma_{\alpha\alpha}\,{\it t_{21}}+{\it t_{26}}\,{\it t_{19}}^2\,{\it t_{24}}+{\it t_{25}}\,{\it t_2}\,\sigma_{\alpha\alpha}\,{\it t_{19}}\,{\it t_{24}}+{{{\it t_{23}}\,\sigma_{\alpha\alpha}^2\,{\it t_{24}}}\over{\rho_\alpha^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_1}\,\left({{0.00361218645365095\,{\it t_2}\,\sigma_{\alpha\alpha}}\over{.004492769220958891\,{\it t_2}\,\sigma_{\alpha\alpha}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_7}}\over{{\it t_8}}}+{{{\it t_{17}}\,{\it t_7}^2}\over{{\it t_8}^2}}+{{{\it t_{16}}\,{\it t_7}^3}\over{{\it t_8}^3}}+{{{\it t_{15}}\,{\it t_7}^4}\over{{\it t_8}^4}}+{{{\it t_{14}}\,{\it t_7}^5}\over{{\it t_8}^5}}+{{{\it t_{13}}\,{\it t_7}^6}\over{{\it t_8}^6}}+{{{\it t_{12}}\,{\it t_7}^7}\over{{\it t_8}^7}}+{{{\it t_{11}}\,{\it t_7}^8}\over{{\it t_8}^8}}+{{{\it t_{10}}\,{\it t_7}^9}\over{{\it t_8}^9}}+{{{\it t_9}\,{\it t_7}^{10}}\over{{\it t_8}^{10}}}+{{{\it t_4}\,{\it t_7}^{11}}\over{{\it t_8}^{11}}}+{\it t_3}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{39}}\,{\it t_{47}}\,\left({\it t_{28}}\,{\it t_{45}}\,{\it t_{47}}+{\it t_{27}}\,{\it t_{40}}\,\sigma_{ss}\,{\it t_{47}}+{\it t_{26}}\,{\it t_{45}}^2\,{\it t_{48}}+{\it t_{25}}\,{\it t_{40}}\,\sigma_{ss}\,{\it t_{45}}\,{\it t_{48}}+{{{\it t_{23}}\,\sigma_{ss}^2\,{\it t_{48}}}\over{\rho_s^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_{39}}\,\left({{0.00361218645365095\,{\it t_{40}}\,\sigma_{ss}}\over{.004492769220958891\,{\it t_{40}}\,\sigma_{ss}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_{43}}}\over{{\it t_{44}}}}+{{{\it t_{17}}\,{\it t_{43}}^2}\over{{\it t_{44}}^2}}+{{{\it t_{16}}\,{\it t_{43}}^3}\over{{\it t_{44}}^3}}+{{{\it t_{15}}\,{\it t_{43}}^4}\over{{\it t_{44}}^4}}+{{{\it t_{14}}\,{\it t_{43}}^5}\over{{\it t_{44}}^5}}+{{{\it t_{13}}\,{\it t_{43}}^6}\over{{\it t_{44}}^6}}+{{{\it t_{12}}\,{\it t_{43}}^7}\over{{\it t_{44}}^7}}+{{{\it t_{11}}\,{\it t_{43}}^8}\over{{\it t_{44}}^8}}+{{{\it t_{10}}\,{\it t_{43}}^9}\over{{\it t_{44}}^9}}+{{{\it t_9}\,{\it t_{43}}^{10}}\over{{\it t_{44}}^{10}}}+{{{\it t_4}\,{\it t_{43}}^{11}}\over{{\it t_{44}}^{11}}}+{\it t_3}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] Y Zhao, DG Truhlar, J.Chem.Phys. 123, 194101 (2006)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.2370993 "> 
C> 10.1063/1.2370993 </a> 
C> 
      subroutine nwxcm_x_m06(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Cmat,Mmat) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
            t1 = 1/rhoa**2.6666666666666666d+0
            t2 = 4.492769220958891d-3*gammaaa*t1+1.0d+0
            t3 = 1/t2
            t4 = 3.6121864536509496d-3*gammaaa*t1*t3+1.0d+0
            t5 = rhoa**1.3333333333333333d+0
            t6 = param(18)
            t7 = rhoa**1.6666666666666669d+0
            t8 = 1/taua
            t9 = 4.557799872345596d+0*t7*t8
            t10 = t9-1.0d+0
            t11 = t10**11
            t12 = t9+1.0d+0
            t13 = 1/t12**11
            t14 = param(17)
            t15 = t10**10
            t16 = 1/t12**10
            t17 = param(16)
            t18 = t10**9
            t19 = 1/t12**9
            t20 = param(15)
            t21 = t10**8
            t22 = 1/t12**8
            t23 = param(14)
            t24 = t10**7
            t25 = 1/t12**7
            t26 = param(13)
            t27 = t10**6
            t28 = 1/t12**6
            t29 = param(12)
            t30 = t10**5
            t31 = 1/t12**5
            t32 = param(11)
            t33 = t10**4
            t34 = 1/t12**4
            t35 = param(10)
            t36 = t10**3
            t37 = 1/t12**3
            t38 = param(9)
            t39 = t10**2
            t40 = 1/t12**2
            t41 = param(8)
            t42 = 1/t12
            t43 = t11*t13*t6+t10*t41*t42+t38*t39*t40+t35*t36*t37+t32*t33
     1         *t34+t29*t30*t31+t26*t27*t28+t23*t24*t25+t20*t21*t22+t17*
     2         t18*t19+t14*t15*t16+param(7)
            t44 = 1/t7
            t45 = 2.0d+0*t44*taua-9.11559972d+0
            t46 = 1.86726d-3*t45+1.86726d-3*gammaaa*t1+1.0d+0
            t47 = 1/t46
            t48 = param(4)
            t49 = gammaaa**2
            t50 = 1/rhoa**5.333333333333333d+0
            t51 = 1/t46**2
            t52 = param(5)
            t53 = param(6)
            t54 = t45**2
            t55 = param(2)
            t56 = param(3)
            t57 = t45*t47*t56+gammaaa*t1*t47*t55+t51*t53*t54+gammaaa*t1*
     1         t45*t51*t52+t48*t49*t50*t51+param(1)
            t58 = rhoa**3.333333333333333d-1
            t59 = 1/t2**2
            t60 = 1/rhoa**6.333333333333333d+0
            t61 = 1/rhoa**3.6666666666666664d+0
            t62 = rhoa**6.666666666666666d-1
            t63 = 1/t12**12
            t64 = -6.2242d-3*t1*taua-4.9793599999999993d-3*gammaaa*t61
            t65 = 1/t46**3
            t66 = (2.0d+0*t47*t5*(-3.73452d-3*t1*t53*t54*t65-3.73452d-3*
     1         gammaaa*t45*t50*t52*t65-3.73452d-3*t48*t49*t65/rhoa**8-1.
     2         86726d-3*t1*t45*t51*t56-1.86726d-3*gammaaa*t50*t51*t55+t1
     3         *t47*t55+t1*t45*t51*t52+2*gammaaa*t48*t50*t51)-1.86105147
     4         26981994d+0*t43*t5*(3.6121864536509496d-3*t1*t3-1.6228720
     5         119327633d-5*gammaaa*t50*t59)-3.73452d-3*t51*t57/t5)*wght
            t67 = 1/taua**2
            t68 = 1/rhoa**4.333333333333333d+0
            fnc(iq) = (2.0d+0*t47*t5*t57-1.8610514726981994d+0*t4*t43*t5
     1         )*wght+fnc(iq)
            Amat(iq,D1_RA) = (t47*(2.0d+0*t5*(-3.3333333333333337d+0*t1*
     1         t47*t56*taua-6.666666666666667d+0*t1*t45*t51*t53*taua-3.3
     2         333333333333337d+0*gammaaa*t50*t51*t52*taua-2*t53*t54*t64
     3         *t65-2*gammaaa*t1*t45*t52*t64*t65-2*t48*t49*t50*t64*t65-t
     4         45*t51*t56*t64-gammaaa*t1*t51*t55*t64-2.6666666666666666d
     5         +0*gammaaa*t47*t55*t61-2.6666666666666666d+0*gammaaa*t45*
     6         t51*t52*t61-5.333333333333333d+0*t48*t49*t51*t60)+2.66666
     7         66666666666d+0*t57*t58)-1.8610514726981994d+0*t4*t5*(-8.3
     8         55966432633593d+1*t11*t6*t62*t63*t8+8.355966432633593d+1*
     9         t13*t15*t6*t62*t8+7.596333120575993d+0*t41*t42*t62*t8-7.5
     :         96333120575993d+0*t10*t40*t41*t62*t8+1.5192666241151986d+
     ;         1*t10*t38*t40*t62*t8-1.5192666241151986d+1*t37*t38*t39*t6
     <         2*t8+2.2788999361727982d+1*t35*t37*t39*t62*t8-2.278899936
     =         1727982d+1*t34*t35*t36*t62*t8+3.038533248230397d+1*t32*t3
     >         4*t36*t62*t8-3.038533248230397d+1*t31*t32*t33*t62*t8+3.79
     ?         81665602879966d+1*t29*t31*t33*t62*t8-3.7981665602879966d+
     @         1*t28*t29*t30*t62*t8+4.5577998723455965d+1*t26*t28*t30*t6
     1         2*t8-4.5577998723455965d+1*t25*t26*t27*t62*t8+5.317433184
     2         403195d+1*t23*t25*t27*t62*t8-5.317433184403195d+1*t22*t23
     3         *t24*t62*t8+6.077066496460795d+1*t20*t22*t24*t62*t8-6.077
     4         066496460795d+1*t19*t20*t21*t62*t8+6.836699808518394d+1*t
     5         17*t19*t21*t62*t8-6.836699808518394d+1*t16*t17*t18*t62*t8
     6         +7.596333120575993d+1*t14*t16*t18*t62*t8-7.59633312057599
     7         3d+1*t13*t14*t15*t62*t8)-2.0d+0*t5*t51*t57*t64-1.86105147
     8         26981994d+0*t43*t5*(4.327658698487369d-5*t49*t59*t60-9.63
     9         2497209735864d-3*gammaaa*t3*t61)-2.481401963597599d+0*t4*
     :         t43*t58)*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = t66+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = t66+Cmat(iq,D1_GAB)
            Amat(iq,D1_TA) = (-1.8610514726981994d+0*t4*t5*(5.0135798595
     1         80155d+1*t11*t6*t63*t67*t7-5.013579859580155d+1*t13*t15*t
     2         6*t67*t7-4.557799872345596d+0*t41*t42*t67*t7+4.5577998723
     3         45596d+0*t10*t40*t41*t67*t7-9.115599744691192d+0*t10*t38*
     4         t40*t67*t7+9.115599744691192d+0*t37*t38*t39*t67*t7-1.3673
     5         399617036788d+1*t35*t37*t39*t67*t7+1.3673399617036788d+1*
     6         t34*t35*t36*t67*t7-1.8231199489382383d+1*t32*t34*t36*t67*
     7         t7+1.8231199489382383d+1*t31*t32*t33*t67*t7-2.27889993617
     8         27982d+1*t29*t31*t33*t67*t7+2.2788999361727982d+1*t28*t29
     9         *t30*t67*t7-2.7346799234073577d+1*t26*t28*t30*t67*t7+2.73
     :         46799234073577d+1*t25*t26*t27*t67*t7-3.190459910641917d+1
     ;         *t23*t25*t27*t67*t7+3.190459910641917d+1*t22*t23*t24*t67*
     <         t7-3.6462398978764765d+1*t20*t22*t24*t67*t7+3.64623989787
     =         64765d+1*t19*t20*t21*t67*t7-4.102019885111037d+1*t17*t19*
     >         t21*t67*t7+4.102019885111037d+1*t16*t17*t18*t67*t7-4.5577
     ?         998723455965d+1*t14*t16*t18*t67*t7+4.5577998723455965d+1*
     @         t13*t14*t15*t67*t7)+2.0d+0*t47*t5*(-7.46904d-3*gammaaa*t4
     1         5*t52*t65*t68-3.73452d-3*gammaaa*t51*t55*t68+2.0d+0*gamma
     2         aa*t51*t52*t68-7.46904d-3*t44*t53*t54*t65-7.46904d-3*t48*
     3         t49*t65/rhoa**7-3.73452d-3*t44*t45*t51*t56+2.0d+0*t44*t47
     4         *t56+4.0d+0*t44*t45*t51*t53)-7.46904d-3*t51*t57/t58)*wght
     5         +Amat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhoa**2.6666666666666666d+0
            t2 = 4.492769220958891d-3*gammaaa*t1+1.0d+0
            t3 = 1/t2
            t4 = 3.6121864536509496d-3*gammaaa*t1*t3+1.0d+0
            t5 = rhoa**1.3333333333333333d+0
            t6 = param(7)
            t7 = param(18)
            t8 = rhoa**1.6666666666666669d+0
            t9 = 1/taua
            t10 = 4.557799872345596d+0*t8*t9
            t11 = t10-1.0d+0
            t12 = t11**11
            t13 = t10+1.0d+0
            t14 = 1/t13**11
            t15 = param(17)
            t16 = t11**10
            t17 = 1/t13**10
            t18 = param(16)
            t19 = t11**9
            t20 = 1/t13**9
            t21 = param(15)
            t22 = t11**8
            t23 = 1/t13**8
            t24 = param(14)
            t25 = t11**7
            t26 = 1/t13**7
            t27 = param(13)
            t28 = t11**6
            t29 = 1/t13**6
            t30 = param(12)
            t31 = t11**5
            t32 = 1/t13**5
            t33 = param(11)
            t34 = t11**4
            t35 = 1/t13**4
            t36 = param(10)
            t37 = t11**3
            t38 = 1/t13**3
            t39 = param(9)
            t40 = t11**2
            t41 = 1/t13**2
            t42 = param(8)
            t43 = 1/t13
            t44 = t12*t14*t7+t6+t11*t42*t43+t39*t40*t41+t36*t37*t38+t33*
     1         t34*t35+t30*t31*t32+t27*t28*t29+t24*t25*t26+t21*t22*t23+t
     2         18*t19*t20+t15*t16*t17
            t45 = 1/t8
            t46 = 2.0d+0*t45*taua-9.11559972d+0
            t47 = 1.86726d-3*t46+1.86726d-3*gammaaa*t1+1.0d+0
            t48 = 1/t47
            t49 = param(1)
            t50 = param(4)
            t51 = gammaaa**2
            t52 = 1/rhoa**5.333333333333333d+0
            t53 = 1/t47**2
            t54 = param(5)
            t55 = param(6)
            t56 = t46**2
            t57 = param(2)
            t58 = param(3)
            t59 = t46*t48*t58+gammaaa*t1*t48*t57+t53*t55*t56+gammaaa*t1*
     1         t46*t53*t54+t50*t51*t52*t53+t49
            t60 = 1/rhob**2.6666666666666666d+0
            t61 = 4.492769220958891d-3*gammabb*t60+1.0d+0
            t62 = 1/t61
            t63 = 3.6121864536509496d-3*gammabb*t60*t62+1.0d+0
            t64 = rhob**1.3333333333333333d+0
            t65 = rhob**1.6666666666666669d+0
            t66 = 1/taub
            t67 = 4.557799872345596d+0*t65*t66
            t68 = t67-1.0d+0
            t69 = t68**11
            t70 = t67+1.0d+0
            t71 = 1/t70**11
            t72 = t68**10
            t73 = 1/t70**10
            t74 = t68**9
            t75 = 1/t70**9
            t76 = t68**8
            t77 = 1/t70**8
            t78 = t68**7
            t79 = 1/t70**7
            t80 = t68**6
            t81 = 1/t70**6
            t82 = t68**5
            t83 = 1/t70**5
            t84 = t68**4
            t85 = 1/t70**4
            t86 = t68**3
            t87 = 1/t70**3
            t88 = t68**2
            t89 = 1/t70**2
            t90 = 1/t70
            t91 = t42*t68*t90+t39*t88*t89+t36*t86*t87+t33*t84*t85+t30*t8
     1         2*t83+t27*t80*t81+t24*t78*t79+t21*t76*t77+t18*t74*t75+t15
     2         *t72*t73+t69*t7*t71+t6
            t92 = 1/t65
            t93 = 2.0d+0*t92*taub-9.11559972d+0
            t94 = 1.86726d-3*t93+1.86726d-3*gammabb*t60+1.0d+0
            t95 = 1/t94
            t96 = gammabb**2
            t97 = 1/rhob**5.333333333333333d+0
            t98 = 1/t94**2
            t99 = t93**2
            t100 = t55*t98*t99+t50*t96*t97*t98+gammabb*t54*t60*t93*t98+t
     1         58*t93*t95+gammabb*t57*t60*t95+t49
            t101 = rhoa**3.333333333333333d-1
            t102 = 1/t2**2
            t103 = 1/rhoa**6.333333333333333d+0
            t104 = 1/rhoa**3.6666666666666664d+0
            t105 = rhoa**6.666666666666666d-1
            t106 = 1/t13**12
            t107 = -6.2242d-3*t1*taua-4.9793599999999993d-3*gammaaa*t104
            t108 = 1/t47**3
            t109 = rhob**3.333333333333333d-1
            t110 = 1/t61**2
            t111 = 1/rhob**6.333333333333333d+0
            t112 = 1/rhob**3.6666666666666664d+0
            t113 = rhob**6.666666666666666d-1
            t114 = 1/t70**12
            t115 = -6.2242d-3*t60*taub-4.9793599999999993d-3*gammabb*t11
     1         2
            t116 = 1/t94**3
            t117 = 1/taua**2
            t118 = 1/rhoa**4.333333333333333d+0
            t119 = 1/taub**2
            t120 = 1/rhob**4.333333333333333d+0
            fnc(iq) = (1.0d+0*t100*t64*t95-9.305257363490997d-1*t63*t64*
     1         t91+1.0d+0*t48*t5*t59-9.305257363490997d-1*t4*t44*t5)*wgh
     2         t+fnc(iq)
            Amat(iq,D1_RA) = (t48*(1.0d+0*t5*(-3.3333333333333337d+0*t1*
     1         t48*t58*taua-6.666666666666667d+0*t1*t46*t53*t55*taua-3.3
     2         333333333333337d+0*gammaaa*t52*t53*t54*taua-t107*t46*t53*
     3         t58-gammaaa*t1*t107*t53*t57-2.6666666666666666d+0*gammaaa
     4         *t104*t48*t57-2*t107*t108*t55*t56-2.6666666666666666d+0*g
     5         ammaaa*t104*t46*t53*t54-2*gammaaa*t1*t107*t108*t46*t54-5.
     6         333333333333333d+0*t103*t50*t51*t53-2*t107*t108*t50*t51*t
     7         52)+1.3333333333333333d+0*t101*t59)-9.305257363490997d-1*
     8         t4*t5*(8.355966432633593d+1*t105*t14*t16*t7*t9-8.35596643
     9         2633593d+1*t105*t106*t12*t7*t9+7.596333120575993d+0*t105*
     :         t42*t43*t9-7.596333120575993d+0*t105*t11*t41*t42*t9+1.519
     ;         2666241151986d+1*t105*t11*t39*t41*t9-1.5192666241151986d+
     <         1*t105*t38*t39*t40*t9+2.2788999361727982d+1*t105*t36*t38*
     =         t40*t9-2.2788999361727982d+1*t105*t35*t36*t37*t9+3.038533
     >         248230397d+1*t105*t33*t35*t37*t9-3.038533248230397d+1*t10
     ?         5*t32*t33*t34*t9+3.7981665602879966d+1*t105*t30*t32*t34*t
     @         9-3.7981665602879966d+1*t105*t29*t30*t31*t9+4.55779987234
     1         55965d+1*t105*t27*t29*t31*t9-4.5577998723455965d+1*t105*t
     2         26*t27*t28*t9+5.317433184403195d+1*t105*t24*t26*t28*t9-5.
     3         317433184403195d+1*t105*t23*t24*t25*t9+6.077066496460795d
     4         +1*t105*t21*t23*t25*t9-6.077066496460795d+1*t105*t20*t21*
     5         t22*t9+6.836699808518394d+1*t105*t18*t20*t22*t9-6.8366998
     6         08518394d+1*t105*t17*t18*t19*t9+7.596333120575993d+1*t105
     7         *t15*t17*t19*t9-7.596333120575993d+1*t105*t14*t15*t16*t9)
     8         -1.0d+0*t107*t5*t53*t59-9.305257363490997d-1*t44*t5*(4.32
     9         7658698487369d-5*t102*t103*t51-9.632497209735864d-3*gamma
     :         aa*t104*t3)-1.2407009817987995d+0*t101*t4*t44)*wght+Amat(
     ;         iq,D1_RA)
            Amat(iq,D1_RB) = (t95*(1.0d+0*t64*(-3.3333333333333337d+0*ga
     1         mmabb*t54*t97*t98*taub-6.666666666666667d+0*t55*t60*t93*t
     2         98*taub-3.3333333333333337d+0*t58*t60*t95*taub-2*t115*t11
     3         6*t55*t99-5.333333333333333d+0*t111*t50*t96*t98-t115*t58*
     4         t93*t98-2.6666666666666666d+0*gammabb*t112*t54*t93*t98-ga
     5         mmabb*t115*t57*t60*t98-2*t115*t116*t50*t96*t97-2.66666666
     6         66666666d+0*gammabb*t112*t57*t95-2*gammabb*t115*t116*t54*
     7         t60*t93)+1.3333333333333333d+0*t100*t109)-1.0d+0*t100*t11
     8         5*t64*t98-9.305257363490997d-1*t64*t91*(4.327658698487369
     9         d-5*t110*t111*t96-9.632497209735864d-3*gammabb*t112*t62)-
     :         1.2407009817987995d+0*t109*t63*t91-9.305257363490997d-1*t
     ;         63*t64*(7.596333120575993d+0*t113*t42*t66*t90-7.596333120
     <         575993d+0*t113*t42*t66*t68*t89+1.5192666241151986d+1*t113
     =         *t39*t66*t68*t89-1.5192666241151986d+1*t113*t39*t66*t87*t
     >         88+2.2788999361727982d+1*t113*t36*t66*t87*t88-2.278899936
     ?         1727982d+1*t113*t36*t66*t85*t86+3.038533248230397d+1*t113
     @         *t33*t66*t85*t86-3.038533248230397d+1*t113*t33*t66*t83*t8
     1         4+3.7981665602879966d+1*t113*t30*t66*t83*t84-3.7981665602
     2         879966d+1*t113*t30*t66*t81*t82+4.5577998723455965d+1*t113
     3         *t27*t66*t81*t82-4.5577998723455965d+1*t113*t27*t66*t79*t
     4         80+5.317433184403195d+1*t113*t24*t66*t79*t80-5.3174331844
     5         03195d+1*t113*t24*t66*t77*t78+6.077066496460795d+1*t113*t
     6         21*t66*t77*t78-6.077066496460795d+1*t113*t21*t66*t75*t76+
     7         6.836699808518394d+1*t113*t18*t66*t75*t76-6.8366998085183
     8         94d+1*t113*t18*t66*t73*t74+7.596333120575993d+1*t113*t15*
     9         t66*t73*t74+8.355966432633593d+1*t113*t66*t7*t71*t72-7.59
     :         6333120575993d+1*t113*t15*t66*t71*t72-8.355966432633593d+
     ;         1*t113*t114*t66*t69*t7))*wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GAA) = (-1.86726d-3*t53*t59/t5+1.0d+0*t48*t5*(-1.
     1         86726d-3*t1*t46*t53*t58-1.86726d-3*gammaaa*t52*t53*t57+t1
     2         *t48*t57-3.73452d-3*t1*t108*t55*t56+t1*t46*t53*t54-3.7345
     3         2d-3*gammaaa*t108*t46*t52*t54+2*gammaaa*t50*t52*t53-3.734
     4         52d-3*t108*t50*t51/rhoa**8)-9.305257363490997d-1*t44*t5*(
     5         3.6121864536509496d-3*t1*t3-1.6228720119327633d-5*gammaaa
     6         *t102*t52))*wght+Cmat(iq,D1_GAA)
            Cmat(iq,D1_GAB) = Cmat(iq,D1_GAB)
            Cmat(iq,D1_GBB) = (1.0d+0*t64*t95*(-3.73452d-3*t116*t55*t60*
     1         t99-1.86726d-3*gammabb*t57*t97*t98+2*gammabb*t50*t97*t98-
     2         1.86726d-3*t58*t60*t93*t98+t54*t60*t93*t98-3.73452d-3*gam
     3         mabb*t116*t54*t93*t97-3.73452d-3*t116*t50*t96/rhob**8+t57
     4         *t60*t95)-1.86726d-3*t100*t98/t64-9.305257363490997d-1*t6
     5         4*t91*(3.6121864536509496d-3*t60*t62-1.6228720119327633d-
     6         5*gammabb*t110*t97))*wght+Cmat(iq,D1_GBB)
            Mmat(iq,D1_TA) = (-9.305257363490997d-1*t4*t5*(-5.0135798595
     1         80155d+1*t117*t14*t16*t7*t8+5.013579859580155d+1*t106*t11
     2         7*t12*t7*t8-4.557799872345596d+0*t117*t42*t43*t8+4.557799
     3         872345596d+0*t11*t117*t41*t42*t8-9.115599744691192d+0*t11
     4         *t117*t39*t41*t8+9.115599744691192d+0*t117*t38*t39*t40*t8
     5         -1.3673399617036788d+1*t117*t36*t38*t40*t8+1.367339961703
     6         6788d+1*t117*t35*t36*t37*t8-1.8231199489382383d+1*t117*t3
     7         3*t35*t37*t8+1.8231199489382383d+1*t117*t32*t33*t34*t8-2.
     8         2788999361727982d+1*t117*t30*t32*t34*t8+2.278899936172798
     9         2d+1*t117*t29*t30*t31*t8-2.7346799234073577d+1*t117*t27*t
     :         29*t31*t8+2.7346799234073577d+1*t117*t26*t27*t28*t8-3.190
     ;         459910641917d+1*t117*t24*t26*t28*t8+3.190459910641917d+1*
     <         t117*t23*t24*t25*t8-3.6462398978764765d+1*t117*t21*t23*t2
     =         5*t8+3.6462398978764765d+1*t117*t20*t21*t22*t8-4.10201988
     >         5111037d+1*t117*t18*t20*t22*t8+4.102019885111037d+1*t117*
     ?         t17*t18*t19*t8-4.5577998723455965d+1*t117*t15*t17*t19*t8+
     @         4.5577998723455965d+1*t117*t14*t15*t16*t8)-3.73452d-3*t53
     1         *t59/t101+1.0d+0*t48*t5*(-3.73452d-3*t45*t46*t53*t58+2.0d
     2         +0*t45*t48*t58-3.73452d-3*gammaaa*t118*t53*t57-7.46904d-3
     3         *t108*t45*t55*t56+4.0d+0*t45*t46*t53*t55+2.0d+0*gammaaa*t
     4         118*t53*t54-7.46904d-3*gammaaa*t108*t118*t46*t54-7.46904d
     5         -3*t108*t50*t51/rhoa**7))*wght+Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = (1.0d+0*t64*t95*(-7.46904d-3*t116*t55*t92*t
     1         99-3.73452d-3*t58*t92*t93*t98+4.0d+0*t55*t92*t93*t98-3.73
     2         452d-3*gammabb*t120*t57*t98+2.0d+0*gammabb*t120*t54*t98-7
     3         .46904d-3*t116*t50*t96/rhob**7+2.0d+0*t58*t92*t95-7.46904
     4         d-3*gammabb*t116*t120*t54*t93)-3.73452d-3*t100*t98/t109-9
     5         .305257363490997d-1*t63*t64*(-4.557799872345596d+0*t119*t
     6         42*t65*t90+4.557799872345596d+0*t119*t42*t65*t68*t89-9.11
     7         5599744691192d+0*t119*t39*t65*t68*t89+9.115599744691192d+
     8         0*t119*t39*t65*t87*t88-1.3673399617036788d+1*t119*t36*t65
     9         *t87*t88+1.3673399617036788d+1*t119*t36*t65*t85*t86-1.823
     :         1199489382383d+1*t119*t33*t65*t85*t86+1.8231199489382383d
     ;         +1*t119*t33*t65*t83*t84-2.2788999361727982d+1*t119*t30*t6
     <         5*t83*t84+2.2788999361727982d+1*t119*t30*t65*t81*t82-2.73
     =         46799234073577d+1*t119*t27*t65*t81*t82+2.7346799234073577
     >         d+1*t119*t27*t65*t79*t80-3.190459910641917d+1*t119*t24*t6
     ?         5*t79*t80+3.190459910641917d+1*t119*t24*t65*t77*t78-3.646
     @         2398978764765d+1*t119*t21*t65*t77*t78+3.6462398978764765d
     1         +1*t119*t21*t65*t75*t76-4.102019885111037d+1*t119*t18*t65
     2         *t75*t76+4.102019885111037d+1*t119*t18*t65*t73*t74-4.5577
     3         998723455965d+1*t119*t15*t65*t73*t74-5.013579859580155d+1
     4         *t119*t65*t7*t71*t72+4.5577998723455965d+1*t119*t15*t65*t
     5         71*t72+5.013579859580155d+1*t114*t119*t65*t69*t7))*wght+M
     6         mat(iq,D1_TB)
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
            t1 = 1/rhoa**2.6666666666666666d+0
            t2 = 4.492769220958891d-3*gammaaa*t1+1.0d+0
            t3 = 1/t2
            t4 = 3.6121864536509496d-3*gammaaa*t1*t3+1.0d+0
            t5 = rhoa**1.3333333333333333d+0
            t6 = param(18)
            t7 = rhoa**1.6666666666666669d+0
            t8 = 1/taua
            t9 = 4.557799872345596d+0*t7*t8
            t10 = t9-1.0d+0
            t11 = t10**11
            t12 = t9+1.0d+0
            t13 = 1/t12**11
            t14 = param(17)
            t15 = t10**10
            t16 = 1/t12**10
            t17 = param(16)
            t18 = t10**9
            t19 = 1/t12**9
            t20 = param(15)
            t21 = t10**8
            t22 = 1/t12**8
            t23 = param(14)
            t24 = t10**7
            t25 = 1/t12**7
            t26 = param(13)
            t27 = t10**6
            t28 = 1/t12**6
            t29 = param(12)
            t30 = t10**5
            t31 = 1/t12**5
            t32 = param(11)
            t33 = t10**4
            t34 = 1/t12**4
            t35 = param(10)
            t36 = t10**3
            t37 = 1/t12**3
            t38 = param(9)
            t39 = t10**2
            t40 = 1/t12**2
            t41 = param(8)
            t42 = 1/t12
            t43 = t11*t13*t6+t10*t41*t42+t38*t39*t40+t35*t36*t37+t32*t33
     1         *t34+t29*t30*t31+t26*t27*t28+t23*t24*t25+t20*t21*t22+t17*
     2         t18*t19+t14*t15*t16+param(7)
            t44 = 1/t7
            t45 = 2.0d+0*t44*taua-9.11559972d+0
            t46 = 1.86726d-3*t45+1.86726d-3*gammaaa*t1+1.0d+0
            t47 = 1/t46
            t48 = param(4)
            t49 = gammaaa**2
            t50 = 1/rhoa**5.333333333333333d+0
            t51 = 1/t46**2
            t52 = param(5)
            t53 = param(6)
            t54 = t45**2
            t55 = param(2)
            t56 = param(3)
            t57 = t45*t47*t56+gammaaa*t1*t47*t55+t51*t53*t54+gammaaa*t1*
     1         t45*t51*t52+t48*t49*t50*t51+param(1)
            t58 = rhoa**3.333333333333333d-1
            t59 = 1/t2**2
            t60 = 1/rhoa**6.333333333333333d+0
            t61 = 1/rhoa**3.6666666666666664d+0
            t62 = rhoa**6.666666666666666d-1
            t63 = 1/t12**12
            t64 = -6.2242d-3*t1*taua-4.9793599999999993d-3*gammaaa*t61
            t65 = 1/t46**3
            t66 = 1/taua**2
            t67 = 1/rhoa**4.333333333333333d+0
            fnc(iq) = (1.0d+0*t47*t5*t57-9.305257363490997d-1*t4*t43*t5)
     1         *wght+fnc(iq)
            Amat(iq,D1_RA) = (t47*(1.0d+0*t5*(-3.3333333333333337d+0*t1*
     1         t47*t56*taua-6.666666666666667d+0*t1*t45*t51*t53*taua-3.3
     2         333333333333337d+0*gammaaa*t50*t51*t52*taua-2*t53*t54*t64
     3         *t65-2*gammaaa*t1*t45*t52*t64*t65-2*t48*t49*t50*t64*t65-t
     4         45*t51*t56*t64-gammaaa*t1*t51*t55*t64-2.6666666666666666d
     5         +0*gammaaa*t47*t55*t61-2.6666666666666666d+0*gammaaa*t45*
     6         t51*t52*t61-5.333333333333333d+0*t48*t49*t51*t60)+1.33333
     7         33333333333d+0*t57*t58)-9.305257363490997d-1*t4*t5*(-8.35
     8         5966432633593d+1*t11*t6*t62*t63*t8+8.355966432633593d+1*t
     9         13*t15*t6*t62*t8+7.596333120575993d+0*t41*t42*t62*t8-7.59
     :         6333120575993d+0*t10*t40*t41*t62*t8+1.5192666241151986d+1
     ;         *t10*t38*t40*t62*t8-1.5192666241151986d+1*t37*t38*t39*t62
     <         *t8+2.2788999361727982d+1*t35*t37*t39*t62*t8-2.2788999361
     =         727982d+1*t34*t35*t36*t62*t8+3.038533248230397d+1*t32*t34
     >         *t36*t62*t8-3.038533248230397d+1*t31*t32*t33*t62*t8+3.798
     ?         1665602879966d+1*t29*t31*t33*t62*t8-3.7981665602879966d+1
     @         *t28*t29*t30*t62*t8+4.5577998723455965d+1*t26*t28*t30*t62
     1         *t8-4.5577998723455965d+1*t25*t26*t27*t62*t8+5.3174331844
     2         03195d+1*t23*t25*t27*t62*t8-5.317433184403195d+1*t22*t23*
     3         t24*t62*t8+6.077066496460795d+1*t20*t22*t24*t62*t8-6.0770
     4         66496460795d+1*t19*t20*t21*t62*t8+6.836699808518394d+1*t1
     5         7*t19*t21*t62*t8-6.836699808518394d+1*t16*t17*t18*t62*t8+
     6         7.596333120575993d+1*t14*t16*t18*t62*t8-7.596333120575993
     7         d+1*t13*t14*t15*t62*t8)-1.0d+0*t5*t51*t57*t64-9.305257363
     8         490997d-1*t43*t5*(4.327658698487369d-5*t49*t59*t60-9.6324
     9         97209735864d-3*gammaaa*t3*t61)-1.2407009817987995d+0*t4*t
     :         43*t58)*wght+Amat(iq,D1_RA)
            Cmat(iq,D1_GAA) = (1.0d+0*t47*t5*(-3.73452d-3*t1*t53*t54*t65
     1         -3.73452d-3*gammaaa*t45*t50*t52*t65-3.73452d-3*t48*t49*t6
     2         5/rhoa**8-1.86726d-3*t1*t45*t51*t56-1.86726d-3*gammaaa*t5
     3         0*t51*t55+t1*t47*t55+t1*t45*t51*t52+2*gammaaa*t48*t50*t51
     4         )-9.305257363490997d-1*t43*t5*(3.6121864536509496d-3*t1*t
     5         3-1.6228720119327633d-5*gammaaa*t50*t59)-1.86726d-3*t51*t
     6         57/t5)*wght+Cmat(iq,D1_GAA)
            Mmat(iq,D1_TA) = (-9.305257363490997d-1*t4*t5*(5.01357985958
     1         0155d+1*t11*t6*t63*t66*t7-5.013579859580155d+1*t13*t15*t6
     2         *t66*t7-4.557799872345596d+0*t41*t42*t66*t7+4.55779987234
     3         5596d+0*t10*t40*t41*t66*t7-9.115599744691192d+0*t10*t38*t
     4         40*t66*t7+9.115599744691192d+0*t37*t38*t39*t66*t7-1.36733
     5         99617036788d+1*t35*t37*t39*t66*t7+1.3673399617036788d+1*t
     6         34*t35*t36*t66*t7-1.8231199489382383d+1*t32*t34*t36*t66*t
     7         7+1.8231199489382383d+1*t31*t32*t33*t66*t7-2.278899936172
     8         7982d+1*t29*t31*t33*t66*t7+2.2788999361727982d+1*t28*t29*
     9         t30*t66*t7-2.7346799234073577d+1*t26*t28*t30*t66*t7+2.734
     :         6799234073577d+1*t25*t26*t27*t66*t7-3.190459910641917d+1*
     ;         t23*t25*t27*t66*t7+3.190459910641917d+1*t22*t23*t24*t66*t
     <         7-3.6462398978764765d+1*t20*t22*t24*t66*t7+3.646239897876
     =         4765d+1*t19*t20*t21*t66*t7-4.102019885111037d+1*t17*t19*t
     >         21*t66*t7+4.102019885111037d+1*t16*t17*t18*t66*t7-4.55779
     ?         98723455965d+1*t14*t16*t18*t66*t7+4.5577998723455965d+1*t
     @         13*t14*t15*t66*t7)+1.0d+0*t47*t5*(-7.46904d-3*gammaaa*t45
     1         *t52*t65*t67-3.73452d-3*gammaaa*t51*t55*t67+2.0d+0*gammaa
     2         a*t51*t52*t67-7.46904d-3*t44*t53*t54*t65-7.46904d-3*t48*t
     3         49*t65/rhoa**7-3.73452d-3*t44*t45*t51*t56+2.0d+0*t44*t47*
     4         t56+4.0d+0*t44*t45*t51*t53)-3.73452d-3*t51*t57/t58)*wght+
     5         Mmat(iq,D1_TA)
            Mmat(iq,D1_TB) = Mmat(iq,D1_TB)
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
            t1 = 1/rhob**2.6666666666666666d+0
            t2 = 4.492769220958891d-3*gammabb*t1+1.0d+0
            t3 = 1/t2
            t4 = 3.6121864536509496d-3*gammabb*t1*t3+1.0d+0
            t5 = rhob**1.3333333333333333d+0
            t6 = param(18)
            t7 = rhob**1.6666666666666669d+0
            t8 = 1/taub
            t9 = 4.557799872345596d+0*t7*t8
            t10 = t9-1.0d+0
            t11 = t10**11
            t12 = t9+1.0d+0
            t13 = 1/t12**11
            t14 = param(17)
            t15 = t10**10
            t16 = 1/t12**10
            t17 = param(16)
            t18 = t10**9
            t19 = 1/t12**9
            t20 = param(15)
            t21 = t10**8
            t22 = 1/t12**8
            t23 = param(14)
            t24 = t10**7
            t25 = 1/t12**7
            t26 = param(13)
            t27 = t10**6
            t28 = 1/t12**6
            t29 = param(12)
            t30 = t10**5
            t31 = 1/t12**5
            t32 = param(11)
            t33 = t10**4
            t34 = 1/t12**4
            t35 = param(10)
            t36 = t10**3
            t37 = 1/t12**3
            t38 = param(9)
            t39 = t10**2
            t40 = 1/t12**2
            t41 = param(8)
            t42 = 1/t12
            t43 = t11*t13*t6+t10*t41*t42+t38*t39*t40+t35*t36*t37+t32*t33
     1         *t34+t29*t30*t31+t26*t27*t28+t23*t24*t25+t20*t21*t22+t17*
     2         t18*t19+t14*t15*t16+param(7)
            t44 = 1/t7
            t45 = 2.0d+0*t44*taub-9.11559972d+0
            t46 = 1.86726d-3*t45+1.86726d-3*gammabb*t1+1.0d+0
            t47 = 1/t46
            t48 = param(4)
            t49 = gammabb**2
            t50 = 1/rhob**5.333333333333333d+0
            t51 = 1/t46**2
            t52 = param(5)
            t53 = param(6)
            t54 = t45**2
            t55 = param(2)
            t56 = param(3)
            t57 = t45*t47*t56+gammabb*t1*t47*t55+t51*t53*t54+gammabb*t1*
     1         t45*t51*t52+t48*t49*t50*t51+param(1)
            t58 = rhob**3.333333333333333d-1
            t59 = 1/t2**2
            t60 = 1/rhob**6.333333333333333d+0
            t61 = 1/rhob**3.6666666666666664d+0
            t62 = rhob**6.666666666666666d-1
            t63 = 1/t12**12
            t64 = -6.2242d-3*t1*taub-4.9793599999999993d-3*gammabb*t61
            t65 = 1/t46**3
            t66 = 1/taub**2
            t67 = 1/rhob**4.333333333333333d+0
            fnc(iq) = (1.0d+0*t47*t5*t57-9.305257363490997d-1*t4*t43*t5)
     1         *wght+fnc(iq)
            Amat(iq,D1_RB) = (t47*(1.0d+0*t5*(-3.3333333333333337d+0*t1*
     1         t47*t56*taub-6.666666666666667d+0*t1*t45*t51*t53*taub-3.3
     2         333333333333337d+0*gammabb*t50*t51*t52*taub-2*t53*t54*t64
     3         *t65-2*gammabb*t1*t45*t52*t64*t65-2*t48*t49*t50*t64*t65-t
     4         45*t51*t56*t64-gammabb*t1*t51*t55*t64-2.6666666666666666d
     5         +0*gammabb*t47*t55*t61-2.6666666666666666d+0*gammabb*t45*
     6         t51*t52*t61-5.333333333333333d+0*t48*t49*t51*t60)+1.33333
     7         33333333333d+0*t57*t58)-9.305257363490997d-1*t4*t5*(-8.35
     8         5966432633593d+1*t11*t6*t62*t63*t8+8.355966432633593d+1*t
     9         13*t15*t6*t62*t8+7.596333120575993d+0*t41*t42*t62*t8-7.59
     :         6333120575993d+0*t10*t40*t41*t62*t8+1.5192666241151986d+1
     ;         *t10*t38*t40*t62*t8-1.5192666241151986d+1*t37*t38*t39*t62
     <         *t8+2.2788999361727982d+1*t35*t37*t39*t62*t8-2.2788999361
     =         727982d+1*t34*t35*t36*t62*t8+3.038533248230397d+1*t32*t34
     >         *t36*t62*t8-3.038533248230397d+1*t31*t32*t33*t62*t8+3.798
     ?         1665602879966d+1*t29*t31*t33*t62*t8-3.7981665602879966d+1
     @         *t28*t29*t30*t62*t8+4.5577998723455965d+1*t26*t28*t30*t62
     1         *t8-4.5577998723455965d+1*t25*t26*t27*t62*t8+5.3174331844
     2         03195d+1*t23*t25*t27*t62*t8-5.317433184403195d+1*t22*t23*
     3         t24*t62*t8+6.077066496460795d+1*t20*t22*t24*t62*t8-6.0770
     4         66496460795d+1*t19*t20*t21*t62*t8+6.836699808518394d+1*t1
     5         7*t19*t21*t62*t8-6.836699808518394d+1*t16*t17*t18*t62*t8+
     6         7.596333120575993d+1*t14*t16*t18*t62*t8-7.596333120575993
     7         d+1*t13*t14*t15*t62*t8)-1.0d+0*t5*t51*t57*t64-9.305257363
     8         490997d-1*t43*t5*(4.327658698487369d-5*t49*t59*t60-9.6324
     9         97209735864d-3*gammabb*t3*t61)-1.2407009817987995d+0*t4*t
     :         43*t58)*wght+Amat(iq,D1_RB)
            Cmat(iq,D1_GBB) = (1.0d+0*t47*t5*(-3.73452d-3*t1*t53*t54*t65
     1         -3.73452d-3*gammabb*t45*t50*t52*t65-3.73452d-3*t48*t49*t6
     2         5/rhob**8-1.86726d-3*t1*t45*t51*t56-1.86726d-3*gammabb*t5
     3         0*t51*t55+t1*t47*t55+t1*t45*t51*t52+2*gammabb*t48*t50*t51
     4         )-9.305257363490997d-1*t43*t5*(3.6121864536509496d-3*t1*t
     5         3-1.6228720119327633d-5*gammabb*t50*t59)-1.86726d-3*t51*t
     6         57/t5)*wght+Cmat(iq,D1_GBB)
            Mmat(iq,D1_TB) = (-9.305257363490997d-1*t4*t5*(5.01357985958
     1         0155d+1*t11*t6*t63*t66*t7-5.013579859580155d+1*t13*t15*t6
     2         *t66*t7-4.557799872345596d+0*t41*t42*t66*t7+4.55779987234
     3         5596d+0*t10*t40*t41*t66*t7-9.115599744691192d+0*t10*t38*t
     4         40*t66*t7+9.115599744691192d+0*t37*t38*t39*t66*t7-1.36733
     5         99617036788d+1*t35*t37*t39*t66*t7+1.3673399617036788d+1*t
     6         34*t35*t36*t66*t7-1.8231199489382383d+1*t32*t34*t36*t66*t
     7         7+1.8231199489382383d+1*t31*t32*t33*t66*t7-2.278899936172
     8         7982d+1*t29*t31*t33*t66*t7+2.2788999361727982d+1*t28*t29*
     9         t30*t66*t7-2.7346799234073577d+1*t26*t28*t30*t66*t7+2.734
     :         6799234073577d+1*t25*t26*t27*t66*t7-3.190459910641917d+1*
     ;         t23*t25*t27*t66*t7+3.190459910641917d+1*t22*t23*t24*t66*t
     <         7-3.6462398978764765d+1*t20*t22*t24*t66*t7+3.646239897876
     =         4765d+1*t19*t20*t21*t66*t7-4.102019885111037d+1*t17*t19*t
     >         21*t66*t7+4.102019885111037d+1*t16*t17*t18*t66*t7-4.55779
     ?         98723455965d+1*t14*t16*t18*t66*t7+4.5577998723455965d+1*t
     @         13*t14*t15*t66*t7)+1.0d+0*t47*t5*(-7.46904d-3*gammabb*t45
     1         *t52*t65*t67-3.73452d-3*gammabb*t51*t55*t67+2.0d+0*gammab
     2         b*t51*t52*t67-7.46904d-3*t44*t53*t54*t65-7.46904d-3*t48*t
     3         49*t65/rhob**7-3.73452d-3*t44*t45*t51*t56+2.0d+0*t44*t47*
     4         t56+4.0d+0*t44*t45*t51*t53)-3.73452d-3*t51*t57/t58)*wght+
     5         Mmat(iq,D1_TB)
            Mmat(iq,D1_TA) = Mmat(iq,D1_TA)
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_x_m06 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\alpha^{{{4}\over{3}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_3} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_4} &=& {\it param}\left(18\right)\\\\ 
C>   {\it t_5} &=& \rho_\alpha^{{{5}\over{3}}}\\\\ 
C>   {\it t_6} &=& {{4.557799872345596\,{\it t_5}}\over{\tau_\alpha}}\\\\ 
C>   {\it t_7} &=& {\it t_6}-1.0\\\\ 
C>   {\it t_8} &=& {\it t_6}+1.0\\\\ 
C>   {\it t_9} &=& {\it param}\left(17\right)\\\\ 
C>   {\it t_{10}} &=& {\it param}\left(16\right)\\\\ 
C>   {\it t_{11}} &=& {\it param}\left(15\right)\\\\ 
C>   {\it t_{12}} &=& {\it param}\left(14\right)\\\\ 
C>   {\it t_{13}} &=& {\it param}\left(13\right)\\\\ 
C>   {\it t_{14}} &=& {\it param}\left(12\right)\\\\ 
C>   {\it t_{15}} &=& {\it param}\left(11\right)\\\\ 
C>   {\it t_{16}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{17}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{18}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{19}} &=& {{2.0\,\tau_\alpha}\over{{\it t_5}}}-9.11559972\\\\ 
C>   {\it t_{20}} &=& 0.00186726\,{\it t_{19}}+0.00186726\,{\it t_2}\,\sigma_{\alpha\alpha}+1.0\\\\ 
C>   {\it t_{21}} &=& {{1}\over{{\it t_{20}}}}\\\\ 
C>   {\it t_{22}} &=& {\it param}\left(1\right)\\\\ 
C>   {\it t_{23}} &=& {\it param}\left(4\right)\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{20}}^2}}\\\\ 
C>   {\it t_{25}} &=& {\it param}\left(5\right)\\\\ 
C>   {\it t_{26}} &=& {\it param}\left(6\right)\\\\ 
C>   {\it t_{27}} &=& {\it param}\left(2\right)\\\\ 
C>   {\it t_{28}} &=& {\it param}\left(3\right)\\\\ 
C>   {\it t_{29}} &=& \rho_\beta^{{{4}\over{3}}}\\\\ 
C>   {\it t_{30}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{31}} &=& \rho_\beta^{{{5}\over{3}}}\\\\ 
C>   {\it t_{32}} &=& {{4.557799872345596\,{\it t_{31}}}\over{\tau_\beta}}\\\\ 
C>   {\it t_{33}} &=& {\it t_{32}}-1.0\\\\ 
C>   {\it t_{34}} &=& {\it t_{32}}+1.0\\\\ 
C>   {\it t_{35}} &=& {{2.0\,\tau_\beta}\over{{\it t_{31}}}}-9.11559972\\\\ 
C>   {\it t_{36}} &=& 0.00186726\,{\it t_{35}}+0.00186726\,{\it t_{30}}\,\sigma_{\beta\beta}+1.0\\\\ 
C>   {\it t_{37}} &=& {{1}\over{{\it t_{36}}}}\\\\ 
C>   {\it t_{38}} &=& {{1}\over{{\it t_{36}}^2}}\\\\ 
C>   {\it t_{39}} &=& \rho_s^{{{4}\over{3}}}\\\\ 
C>   {\it t_{40}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{41}} &=& \rho_s^{{{5}\over{3}}}\\\\ 
C>   {\it t_{42}} &=& {{4.557799872345596\,{\it t_{41}}}\over{\tau_s}}\\\\ 
C>   {\it t_{43}} &=& {\it t_{42}}-1.0\\\\ 
C>   {\it t_{44}} &=& {\it t_{42}}+1.0\\\\ 
C>   {\it t_{45}} &=& {{2.0\,\tau_s}\over{{\it t_{41}}}}-9.11559972\\\\ 
C>   {\it t_{46}} &=& 0.00186726\,{\it t_{45}}+0.00186726\,{\it t_{40}}\,\sigma_{ss}+1.0\\\\ 
C>   {\it t_{47}} &=& {{1}\over{{\it t_{46}}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{{\it t_{46}}^2}}\\\\ 
C>   f &=& 1.0\,{\it t_{29}}\,{\it t_{37}}\,\left({\it t_{28}}\,{\it t_{35}}\,{\it t_{37}}+{\it t_{27}}\,{\it t_{30}}\,\sigma_{\beta\beta}\,{\it t_{37}}+{\it t_{26}}\,{\it t_{35}}^2\,{\it t_{38}}+{\it t_{25}}\,{\it t_{30}}\,\sigma_{\beta\beta}\,{\it t_{35}}\,{\it t_{38}}+{{{\it t_{23}}\,\sigma_{\beta\beta}^2\,{\it t_{38}}}\over{\rho_\beta^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_{29}}\,\left({{0.00361218645365095\,{\it t_{30}}\,\sigma_{\beta\beta}}\over{.004492769220958891\,{\it t_{30}}\,\sigma_{\beta\beta}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_{33}}}\over{{\it t_{34}}}}+{{{\it t_{17}}\,{\it t_{33}}^2}\over{{\it t_{34}}^2}}+{{{\it t_{16}}\,{\it t_{33}}^3}\over{{\it t_{34}}^3}}+{{{\it t_{15}}\,{\it t_{33}}^4}\over{{\it t_{34}}^4}}+{{{\it t_{14}}\,{\it t_{33}}^5}\over{{\it t_{34}}^5}}+{{{\it t_{13}}\,{\it t_{33}}^6}\over{{\it t_{34}}^6}}+{{{\it t_{12}}\,{\it t_{33}}^7}\over{{\it t_{34}}^7}}+{{{\it t_{11}}\,{\it t_{33}}^8}\over{{\it t_{34}}^8}}+{{{\it t_{10}}\,{\it t_{33}}^9}\over{{\it t_{34}}^9}}+{{{\it t_9}\,{\it t_{33}}^{10}}\over{{\it t_{34}}^{10}}}+{{{\it t_4}\,{\it t_{33}}^{11}}\over{{\it t_{34}}^{11}}}+{\it t_3}\right)+1.0\,{\it t_1}\,{\it t_{21}}\,\left({\it t_{28}}\,{\it t_{19}}\,{\it t_{21}}+{\it t_{27}}\,{\it t_2}\,\sigma_{\alpha\alpha}\,{\it t_{21}}+{\it t_{26}}\,{\it t_{19}}^2\,{\it t_{24}}+{\it t_{25}}\,{\it t_2}\,\sigma_{\alpha\alpha}\,{\it t_{19}}\,{\it t_{24}}+{{{\it t_{23}}\,\sigma_{\alpha\alpha}^2\,{\it t_{24}}}\over{\rho_\alpha^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_1}\,\left({{0.00361218645365095\,{\it t_2}\,\sigma_{\alpha\alpha}}\over{.004492769220958891\,{\it t_2}\,\sigma_{\alpha\alpha}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_7}}\over{{\it t_8}}}+{{{\it t_{17}}\,{\it t_7}^2}\over{{\it t_8}^2}}+{{{\it t_{16}}\,{\it t_7}^3}\over{{\it t_8}^3}}+{{{\it t_{15}}\,{\it t_7}^4}\over{{\it t_8}^4}}+{{{\it t_{14}}\,{\it t_7}^5}\over{{\it t_8}^5}}+{{{\it t_{13}}\,{\it t_7}^6}\over{{\it t_8}^6}}+{{{\it t_{12}}\,{\it t_7}^7}\over{{\it t_8}^7}}+{{{\it t_{11}}\,{\it t_7}^8}\over{{\it t_8}^8}}+{{{\it t_{10}}\,{\it t_7}^9}\over{{\it t_8}^9}}+{{{\it t_9}\,{\it t_7}^{10}}\over{{\it t_8}^{10}}}+{{{\it t_4}\,{\it t_7}^{11}}\over{{\it t_8}^{11}}}+{\it t_3}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{39}}\,{\it t_{47}}\,\left({\it t_{28}}\,{\it t_{45}}\,{\it t_{47}}+{\it t_{27}}\,{\it t_{40}}\,\sigma_{ss}\,{\it t_{47}}+{\it t_{26}}\,{\it t_{45}}^2\,{\it t_{48}}+{\it t_{25}}\,{\it t_{40}}\,\sigma_{ss}\,{\it t_{45}}\,{\it t_{48}}+{{{\it t_{23}}\,\sigma_{ss}^2\,{\it t_{48}}}\over{\rho_s^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_{39}}\,\left({{0.00361218645365095\,{\it t_{40}}\,\sigma_{ss}}\over{.004492769220958891\,{\it t_{40}}\,\sigma_{ss}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_{43}}}\over{{\it t_{44}}}}+{{{\it t_{17}}\,{\it t_{43}}^2}\over{{\it t_{44}}^2}}+{{{\it t_{16}}\,{\it t_{43}}^3}\over{{\it t_{44}}^3}}+{{{\it t_{15}}\,{\it t_{43}}^4}\over{{\it t_{44}}^4}}+{{{\it t_{14}}\,{\it t_{43}}^5}\over{{\it t_{44}}^5}}+{{{\it t_{13}}\,{\it t_{43}}^6}\over{{\it t_{44}}^6}}+{{{\it t_{12}}\,{\it t_{43}}^7}\over{{\it t_{44}}^7}}+{{{\it t_{11}}\,{\it t_{43}}^8}\over{{\it t_{44}}^8}}+{{{\it t_{10}}\,{\it t_{43}}^9}\over{{\it t_{44}}^9}}+{{{\it t_9}\,{\it t_{43}}^{10}}\over{{\it t_{44}}^{10}}}+{{{\it t_4}\,{\it t_{43}}^{11}}\over{{\it t_{44}}^{11}}}+{\it t_3}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] Y Zhao, DG Truhlar, J.Chem.Phys. 123, 194101 (2006)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.2370993 "> 
C> 10.1063/1.2370993 </a> 
C> 
      subroutine nwxcm_x_m06_d2(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Cmat,Cmat2,Mmat,Mmat2) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> 
C> \brief Evaluate the nwxcm_x_m06 functional [1] 
C> 
C> \f{eqnarray*}{ 
C>   {\it t_1} &=& \rho_\alpha^{{{4}\over{3}}}\\\\ 
C>   {\it t_2} &=& {{1}\over{\rho_\alpha^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_3} &=& {\it param}\left(7\right)\\\\ 
C>   {\it t_4} &=& {\it param}\left(18\right)\\\\ 
C>   {\it t_5} &=& \rho_\alpha^{{{5}\over{3}}}\\\\ 
C>   {\it t_6} &=& {{4.557799872345596\,{\it t_5}}\over{\tau_\alpha}}\\\\ 
C>   {\it t_7} &=& {\it t_6}-1.0\\\\ 
C>   {\it t_8} &=& {\it t_6}+1.0\\\\ 
C>   {\it t_9} &=& {\it param}\left(17\right)\\\\ 
C>   {\it t_{10}} &=& {\it param}\left(16\right)\\\\ 
C>   {\it t_{11}} &=& {\it param}\left(15\right)\\\\ 
C>   {\it t_{12}} &=& {\it param}\left(14\right)\\\\ 
C>   {\it t_{13}} &=& {\it param}\left(13\right)\\\\ 
C>   {\it t_{14}} &=& {\it param}\left(12\right)\\\\ 
C>   {\it t_{15}} &=& {\it param}\left(11\right)\\\\ 
C>   {\it t_{16}} &=& {\it param}\left(10\right)\\\\ 
C>   {\it t_{17}} &=& {\it param}\left(9\right)\\\\ 
C>   {\it t_{18}} &=& {\it param}\left(8\right)\\\\ 
C>   {\it t_{19}} &=& {{2.0\,\tau_\alpha}\over{{\it t_5}}}-9.11559972\\\\ 
C>   {\it t_{20}} &=& 0.00186726\,{\it t_{19}}+0.00186726\,{\it t_2}\,\sigma_{\alpha\alpha}+1.0\\\\ 
C>   {\it t_{21}} &=& {{1}\over{{\it t_{20}}}}\\\\ 
C>   {\it t_{22}} &=& {\it param}\left(1\right)\\\\ 
C>   {\it t_{23}} &=& {\it param}\left(4\right)\\\\ 
C>   {\it t_{24}} &=& {{1}\over{{\it t_{20}}^2}}\\\\ 
C>   {\it t_{25}} &=& {\it param}\left(5\right)\\\\ 
C>   {\it t_{26}} &=& {\it param}\left(6\right)\\\\ 
C>   {\it t_{27}} &=& {\it param}\left(2\right)\\\\ 
C>   {\it t_{28}} &=& {\it param}\left(3\right)\\\\ 
C>   {\it t_{29}} &=& \rho_\beta^{{{4}\over{3}}}\\\\ 
C>   {\it t_{30}} &=& {{1}\over{\rho_\beta^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{31}} &=& \rho_\beta^{{{5}\over{3}}}\\\\ 
C>   {\it t_{32}} &=& {{4.557799872345596\,{\it t_{31}}}\over{\tau_\beta}}\\\\ 
C>   {\it t_{33}} &=& {\it t_{32}}-1.0\\\\ 
C>   {\it t_{34}} &=& {\it t_{32}}+1.0\\\\ 
C>   {\it t_{35}} &=& {{2.0\,\tau_\beta}\over{{\it t_{31}}}}-9.11559972\\\\ 
C>   {\it t_{36}} &=& 0.00186726\,{\it t_{35}}+0.00186726\,{\it t_{30}}\,\sigma_{\beta\beta}+1.0\\\\ 
C>   {\it t_{37}} &=& {{1}\over{{\it t_{36}}}}\\\\ 
C>   {\it t_{38}} &=& {{1}\over{{\it t_{36}}^2}}\\\\ 
C>   {\it t_{39}} &=& \rho_s^{{{4}\over{3}}}\\\\ 
C>   {\it t_{40}} &=& {{1}\over{\rho_s^{{{8}\over{3}}}}}\\\\ 
C>   {\it t_{41}} &=& \rho_s^{{{5}\over{3}}}\\\\ 
C>   {\it t_{42}} &=& {{4.557799872345596\,{\it t_{41}}}\over{\tau_s}}\\\\ 
C>   {\it t_{43}} &=& {\it t_{42}}-1.0\\\\ 
C>   {\it t_{44}} &=& {\it t_{42}}+1.0\\\\ 
C>   {\it t_{45}} &=& {{2.0\,\tau_s}\over{{\it t_{41}}}}-9.11559972\\\\ 
C>   {\it t_{46}} &=& 0.00186726\,{\it t_{45}}+0.00186726\,{\it t_{40}}\,\sigma_{ss}+1.0\\\\ 
C>   {\it t_{47}} &=& {{1}\over{{\it t_{46}}}}\\\\ 
C>   {\it t_{48}} &=& {{1}\over{{\it t_{46}}^2}}\\\\ 
C>   f &=& 1.0\,{\it t_{29}}\,{\it t_{37}}\,\left({\it t_{28}}\,{\it t_{35}}\,{\it t_{37}}+{\it t_{27}}\,{\it t_{30}}\,\sigma_{\beta\beta}\,{\it t_{37}}+{\it t_{26}}\,{\it t_{35}}^2\,{\it t_{38}}+{\it t_{25}}\,{\it t_{30}}\,\sigma_{\beta\beta}\,{\it t_{35}}\,{\it t_{38}}+{{{\it t_{23}}\,\sigma_{\beta\beta}^2\,{\it t_{38}}}\over{\rho_\beta^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_{29}}\,\left({{0.00361218645365095\,{\it t_{30}}\,\sigma_{\beta\beta}}\over{.004492769220958891\,{\it t_{30}}\,\sigma_{\beta\beta}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_{33}}}\over{{\it t_{34}}}}+{{{\it t_{17}}\,{\it t_{33}}^2}\over{{\it t_{34}}^2}}+{{{\it t_{16}}\,{\it t_{33}}^3}\over{{\it t_{34}}^3}}+{{{\it t_{15}}\,{\it t_{33}}^4}\over{{\it t_{34}}^4}}+{{{\it t_{14}}\,{\it t_{33}}^5}\over{{\it t_{34}}^5}}+{{{\it t_{13}}\,{\it t_{33}}^6}\over{{\it t_{34}}^6}}+{{{\it t_{12}}\,{\it t_{33}}^7}\over{{\it t_{34}}^7}}+{{{\it t_{11}}\,{\it t_{33}}^8}\over{{\it t_{34}}^8}}+{{{\it t_{10}}\,{\it t_{33}}^9}\over{{\it t_{34}}^9}}+{{{\it t_9}\,{\it t_{33}}^{10}}\over{{\it t_{34}}^{10}}}+{{{\it t_4}\,{\it t_{33}}^{11}}\over{{\it t_{34}}^{11}}}+{\it t_3}\right)+1.0\,{\it t_1}\,{\it t_{21}}\,\left({\it t_{28}}\,{\it t_{19}}\,{\it t_{21}}+{\it t_{27}}\,{\it t_2}\,\sigma_{\alpha\alpha}\,{\it t_{21}}+{\it t_{26}}\,{\it t_{19}}^2\,{\it t_{24}}+{\it t_{25}}\,{\it t_2}\,\sigma_{\alpha\alpha}\,{\it t_{19}}\,{\it t_{24}}+{{{\it t_{23}}\,\sigma_{\alpha\alpha}^2\,{\it t_{24}}}\over{\rho_\alpha^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_1}\,\left({{0.00361218645365095\,{\it t_2}\,\sigma_{\alpha\alpha}}\over{.004492769220958891\,{\it t_2}\,\sigma_{\alpha\alpha}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_7}}\over{{\it t_8}}}+{{{\it t_{17}}\,{\it t_7}^2}\over{{\it t_8}^2}}+{{{\it t_{16}}\,{\it t_7}^3}\over{{\it t_8}^3}}+{{{\it t_{15}}\,{\it t_7}^4}\over{{\it t_8}^4}}+{{{\it t_{14}}\,{\it t_7}^5}\over{{\it t_8}^5}}+{{{\it t_{13}}\,{\it t_7}^6}\over{{\it t_8}^6}}+{{{\it t_{12}}\,{\it t_7}^7}\over{{\it t_8}^7}}+{{{\it t_{11}}\,{\it t_7}^8}\over{{\it t_8}^8}}+{{{\it t_{10}}\,{\it t_7}^9}\over{{\it t_8}^9}}+{{{\it t_9}\,{\it t_7}^{10}}\over{{\it t_8}^{10}}}+{{{\it t_4}\,{\it t_7}^{11}}\over{{\it t_8}^{11}}}+{\it t_3}\right)\\\\ 
C>   g &=& 0\\\\ 
C>   G &=& 1.0\,{\it t_{39}}\,{\it t_{47}}\,\left({\it t_{28}}\,{\it t_{45}}\,{\it t_{47}}+{\it t_{27}}\,{\it t_{40}}\,\sigma_{ss}\,{\it t_{47}}+{\it t_{26}}\,{\it t_{45}}^2\,{\it t_{48}}+{\it t_{25}}\,{\it t_{40}}\,\sigma_{ss}\,{\it t_{45}}\,{\it t_{48}}+{{{\it t_{23}}\,\sigma_{ss}^2\,{\it t_{48}}}\over{\rho_s^{{{16}\over{3}}}}}+{\it t_{22}}\right)-.9305257363490997\,{\it t_{39}}\,\left({{0.00361218645365095\,{\it t_{40}}\,\sigma_{ss}}\over{.004492769220958891\,{\it t_{40}}\,\sigma_{ss}+1.0}}+1.0\right)\,\left({{{\it t_{18}}\,{\it t_{43}}}\over{{\it t_{44}}}}+{{{\it t_{17}}\,{\it t_{43}}^2}\over{{\it t_{44}}^2}}+{{{\it t_{16}}\,{\it t_{43}}^3}\over{{\it t_{44}}^3}}+{{{\it t_{15}}\,{\it t_{43}}^4}\over{{\it t_{44}}^4}}+{{{\it t_{14}}\,{\it t_{43}}^5}\over{{\it t_{44}}^5}}+{{{\it t_{13}}\,{\it t_{43}}^6}\over{{\it t_{44}}^6}}+{{{\it t_{12}}\,{\it t_{43}}^7}\over{{\it t_{44}}^7}}+{{{\it t_{11}}\,{\it t_{43}}^8}\over{{\it t_{44}}^8}}+{{{\it t_{10}}\,{\it t_{43}}^9}\over{{\it t_{44}}^9}}+{{{\it t_9}\,{\it t_{43}}^{10}}\over{{\it t_{44}}^{10}}}+{{{\it t_4}\,{\it t_{43}}^{11}}\over{{\it t_{44}}^{11}}}+{\it t_3}\right)\\\\ 
C> \f} 
C> 
C> ### References ### 
C> 
C> [1] Y Zhao, DG Truhlar, J.Chem.Phys. 123, 194101 (2006)  , DOI: 
C> <a href="http://dx.doi.org/10.1063/1.2370993 "> 
C> 10.1063/1.2370993 </a> 
C> 
      subroutine nwxcm_x_m06_d3(param,tol_rho,ipol,nq,wght, 
     +rho,rgamma,tau,fnc,Amat,Amat2,Amat3, 
     +Cmat,Cmat2,Cmat3,Mmat,Mmat2,Mmat3) 
c $Id: $ 
      implicit double precision (a-h,o-z), integer (i-n) 
#include "nwxc_param.fh" 
      double precision param(*)     !< [Input] Parameters of functional 
      double precision tol_rho      !< [Input] The lower limit on the density 
      integer ipol                  !< [Input] The number of spin channels 
      integer nq                    !< [Input] The number of points 
      double precision wght         !< [Input] The weight of the functional 
      double precision rho(nq,NCOL_RHO)      !< [Input] The density 
      double precision rgamma(nq,NCOL_GAMMA) !< [Input] The norm of the density 
                                             !< gradients 
      double precision tau(nq,NCOL_TAU)      !< [Input] The kinetic energy density 
      double precision fnc(nq)      !< [Output] The value of the functional 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat(nq,NCOL_AMAT)   !< [Output] The derivative wrt rho 
      double precision Cmat(nq,NCOL_CMAT)   !< [Output] The derivative wrt rgamma 
      double precision Mmat(nq,NCOL_MMAT)   !< [Output] The derivative wrt tau 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat2(nq,NCOL_AMAT2)  !< [Output] The 2nd derivative wrt rho 
      double precision Cmat2(nq,NCOL_CMAT2)  !< [Output] The 2nd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat2(nq,NCOL_MMAT2)  !< [Output] The 2nd derivative wrt tau 
                                             !< and possibly rho 
c 
c     Sampling Matrices for the XC Kernel 
c 
      double precision Amat3(nq,NCOL_AMAT3)  !< [Output] The 3rd derivative wrt rho 
      double precision Cmat3(nq,NCOL_CMAT3)  !< [Output] The 3rd derivative wrt rgamma 
                                             !< and possibly rho 
      double precision Mmat3(nq,NCOL_MMAT3)  !< [Output] The 3rd derivative wrt tau 
                                             !< and possibly rho 
      integer iq 
      double precision tmp 
      double precision rhoa,rhob 
      double precision gammaaa,gammaab,gammabb 
      double precision taua,taub 
      do iq = 1, nq 
        if (ipol.eq.1) then 
          rhoa    = 0.5d0*rho(iq,R_T) 
          gammaaa = 0.25d0*rgamma(iq,G_TT) 
          taua    = 0.5d0*tau(iq,T_T) 
          if (rhoa.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho 
        else  ! ipol.eq.1 
          rhoa    = rho(iq,R_A) 
          rhob    = rho(iq,R_B) 
          gammaaa = rgamma(iq,G_AA) 
          gammaab = rgamma(iq,G_AB) 
          gammabb = rgamma(iq,G_BB) 
          taua    = tau(iq,T_A) 
          taub    = tau(iq,T_B) 
          if (rhoa.gt.tol_rho.and.rhob.gt.tol_rho) then 
          elseif (rhoa.gt.tol_rho.and.rhob.le.tol_rho) then 
          elseif (rhoa.le.tol_rho.and.rhob.gt.tol_rho) then 
          endif ! rhoa.gt.tol_rho.and.rhob.gt.tol_rho 
        endif ! ipol.eq.1 
      enddo ! iq 
      end 
C> @} 
