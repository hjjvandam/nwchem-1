language: c
matrix:
  include:
  - os: osx
    env:
        NWCHEM_TARGET=MACX64
        PATH=/usr/local/opt/open-mpi/bin/:$PATH
        DYLD_LIBRARY_PATH=$TRAVIS_BUILD_DIR/lib:$DYLD_LIBRARY_PATH
  - os: linux
    dist: trusty
    sudo: required
    env:
        NWCHEM_TARGET=LINUX64
        LD_LIBRARY_PATH=$TRAVIS_BUILD_DIR/lib:$LD_LIBRARY_PATH
compiler:
  - gcc
git:
  depth: 3
before_script:
        - printenv TRAVIS_BUILD_DIR
        - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew uninstall oclint || true  ; fi
        - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install gcc open-mpi || true  ; fi
        - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -y install gfortran gcc python-dev  cmake libopenmpi-dev openmpi-bin tcsh make  perl ;fi
        - gfortran -v
        - ./travis/config_nwchem.sh
        - ./travis/build_openblas.sh
        - ./travis/build_scalapack.sh
        - sleep 1
script:
        - ./travis/compile_nwchem.sh
        - ./travis/run_qas.sh


after_failure:
        - tail -20 $NWCHEM_TOP/src/tools/build/config.log
        - tail -10 $NWCHEM_TOP/src/tools/build/comex/config.log
        - grep -A 2 -B 2 -i error $NWCHEM_TOP/src/make.log 
        - head -200 $NWCHEM_TOP/src/make.log
        - tail -200 $NWCHEM_TOP/src/make.log
        - grep d= $NWCHEM_TOP/QA/testoutputs/dft_he2+.out
        - grep @ $NWCHEM_TOP/QA/testoutputs/h2o_opt.out
              
