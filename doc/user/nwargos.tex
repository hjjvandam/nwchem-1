\newcommand{\mc}[3]{\multicolumn{#1}{#2}{#3}}
\newcommand{\vb}[1]{\mbox{\verb.#1.}}
\newcommand{\none}{\multicolumn{2}{|c|}{ }}
\renewcommand{\thetable}{\Roman{table}}
\newcommand{\mcc}[1]{\multicolumn{2}{c}{#1}}
\def\bmu{\mbox{\boldmath $\mu$}}
\def\bE{\mbox{\bf E}}
\def\br{\mbox{\bf r}}
\def\tT{\tilde{T}}
\def\t{\tilde{1}}
\def\ip{i\prime}
\def\jp{j\prime}
\def\ipp{i\prime\prime}
\def\jpp{j\prime\prime}
\def\etal{{\sl et al.}}
\def\nwchem{{\bf NWChem}}
\def\nwargos{{\bf $^{nw}$ARGOS}}
\def\nwtop{{\bf $^{nw}$TOP}}
\def\nwrst{{\bf $^{nw}$RST}}
\def\nwsgm{{\bf $^{nw}$SGM}}
\def\argos{{\bf ARGOS}}
\subsection{General description}
\subsubsection{Spacial decomposition}
\nwargos\  is the \nwchem\  module for molecular dynamics
simulations of macromolecules and solutions. The code is a parallel
implementation of \argos, a vectorized molecular dynamics
package developed by T.P.Straatsma at the University of Houston.
\par
The parallel implementation is based on the spacial decomposition of 
the molecular system.
The distribution of data based on a spacial decomposition of a
chemical system offers the most
efficient implementation in terms of both memory requirement and
communication cost. This is especially important for simulations
of large molecular systems on massively parallel computing systems.
\par
The \nwchem\  suite of computer codes for high performance computational 
chemistry includes a parallel implementation of a computational
module for classical molecular dynamics simulation of pure liquids,
solutions and macromolecular systems.
Inter-processor communication using the global array tools and the
design of a data structure allowing distribution based on spacial
decomposition are the key elements in taking advantage of
the distribution of memory requirements and computational work with
minimal communication.
\par
In the spacial decomposition approach, the physical simulation
volume is divided into rectangular domains, each of which is
assigned to a processor.
Depending on the conditions of the calculation and the
number of available processors, each processor contains one or a
number of spacially grouped domains.
The most important aspects of this decomposition
are the dependence of the domain sizes and communication cost on
the number of processors and the shape of the domains, the
frequent reassigment of atoms to domains leading to a fluctuating
number of atoms per domain, and the locality of communication
which is the main reason for the efficiency of this approach for
very large molecular systems.
\par
To improve efficiency, solvent and solute are treated separately.
Solvent molecules are assigned to the domains according to their
center of geometry. This avoids bonded interactions crossing node
boundaries. Solute molecules are broken up into segments, with each 
segment assigned to a processor based on its center of geometry. 
This limits the number
of solute bonded interactions that cross node boundaries.
The processor to which a domain is assigned is responsible for
the calculation of interactions of atoms within the domain.
For the  calculation of forces and energies in which atoms in
domains assigned to different processors are involved, information
from these domains need to be exchanged between processors. The
number of neighboring domains is determined by the size and shape
of the domains and the range of interaction. It is this exchange
of information that takes place every simulation time step
that represents the main communication requirements.
Consequently, one of the main efforts is to design algorithms and
data structures that minimize the cost of this
communication. However, for very large molecular systems, memory
requirements also need to be taken into account. A compromise between
these requirements is found by performing the communication in
successive point to point communications rather than using the
shift algorithm which reduces the number of communication calls
for the same amount of communicated data.
\par
For inhomogeneous systems, computational resources needed to evaluate 
interactions for a domain may differ between the domains. 
This will generally lead to load imbalance between the processors.
In \nwargos\ two algorithms have been implemented that allow for 
dynamically balancing the workload of each processor. 
A coarse but effective method is the dynamic redistribution of 
intra-node domain-domain interactions. The
second implemented method is the dynamic resizing of each domain.
\subsubsection{Topology}
\label{topology}
The static information about a molecular system that is needed for
a molecular simulation is provided to the simulation module in a
topology file ({\bf top}). 
Items in this file include, among many other things, 
a list of atoms, their non-bonded parameters for van der Waals and
electrostatic interactions, and a complete connectivity in terms
of bonds, angles and dihedrals.
\par
In \nwargos, molecular systems are composed of {\it solvent} and 
{\it solute}, which are treated separately. A solvent molecule is 
defined only once in the topology file. In the
current implementation only one solvent can be defined. Everything
else in the molecular system is solute. Each solute atom in the
system is explicitly defined in the topology. 
\par
Molecular systems are defined in terms of {\it segment}s. Molecules
can be defined as a single segment, or as a collection of segments.
Typically, repetitive parts of a molecule are each defined as a single
segment. Segment files ({\bf sgm}) can be quite complicated to define 
and are, therefore, collected in a set of database libraries. 
The list of segments and their connectivity that make a molecular system 
is defined in a sequence file ({\bf seq}). 
A utility \nwtop\ reads the sequence from this file, retrieves all 
needed segments from the available segment databases, and generates the
topology file.
\par
Segments may not always be available in one of the existing databases.
A utility \nwsgm\ reads a rudimentary, force-field independent
definition of a segment from a {\it fragment} file ({\bf frg}), and 
constructs a template for a force-field dependent segment. 
Just like segments, fragments can be collected into a set of database files.
\subsubsection{File names}
\label{filenames}
\par
File names used by \nwargos\  need to have the form
{\bf project\_id.ext}, with exception of the
topology file (\ref{topology}), which should be named {\bf project.top}.
Anything that refers to the definition of the chemical system can be used
for {\bf project}, as long as no periods or underlines are used.
The identifier {\bf id} can be anything that refers to the type of 
calculation to be performed for the system.
This file naming convention allows for the creation of a single topology file
{\bf project.top} that can be used for a number of 
different calculations, each identified with a different {\bf id}.
For example, if {\bf crown.top} is the name of the topology file for
a crown ether, {\bf crown\_em}, {\bf crown\_md}, {\bf crown\_mcti} could
be used with appropriate extensions for the filenames for energy
minimization, molecular dynamics simulation and multiconfiguration
thermodynamic integration respectively. All of these calculation
would use the same topology file.
\subsubsection{File name extensions}
\label{extensions}
\par
The extensions {\bf ext} 
identify the kind of information on the file, and are determined by the 
programs. Examples of extensions are {\bf top} for the topology file and 
{\bf rst} for the restart file.
The complete list of extensions used is
\begin{tabbing}
xxxxx\=\kill
{\bf coo} \> coordinate trajectory file\\
{\bf day} \> dayfile\\
{\bf frg} \> fragment file\\
{\bf gib} \> free energy data file\\
{\bf inp} \> input file (obsolete)\\
{\bf out} \> output file\\
{\bf prp} \> property file\\
{\bf rst} \> restart file, used to start, restart or continue a simulation \\
{\bf seq} \> sequence file, describing the system in segments\\
{\bf sco} \> solute coordinate trajectory file\\
{\bf sgm} \> segment file, describing segments\\
{\bf svl} \> solute velocity trajectory file\\
{\bf syn} \> synchronization time file\\
{\bf tim} \> timing analysis file\\
{\bf top} \> topology file, contains the static description of a system\\
{\bf vel} \> velocity trajectory file\\
\end{tabbing}
\subsubsection{Database names}
\par
A similar convention is used to identify databases used by the setup programs
\nwtop\ (\ref{nwtop}), \nwrst\ (\ref{nwrst}) and \nwsgm\ (\ref{nwsgm}).
Force field database names have the form
{\bf forcefield\_level.ext}, where {\bf forcefield} stands for any of the
supported force fields (\ref{forcefields}). The source
of the data is identified by {\bf level}, and can be 
\begin{center}
\begin{tabular}{lll}
\hline
level   & Description                 & Availability \\
{\bf s} & original published data     & public       \\
{\bf x} & additional published data   & public       \\
{\bf u} & user preferred data         & private      \\
{\bf r} & user defined temporary data & private    \\
\hline
\end{tabular}
\end{center}
\par
Only the level {\bf s} and {\bf x} databases are publicly available. 
The user is responsible for the private level {\bf u} and {\bf r} databases.
\par
Other database files include the force field independent fragment libraries 
and the solvation restart files.
\par
Paths to databases may be defined in a file {\bf .nwargos} in a user's 
home directory.
\subsubsection{Force fields}
\label{forcefields}
Force fields supported by \nwargos\ are
\begin{center}
\begin{tabular}{lll}
\hline
Keyword      & Force field   & Current status \\
{\tt amber}  & AMBER4.0      & available      \\
{\tt charmm} & CHARMM        & planned        \\
{\tt cvff}   & CVFF          & planned        \\
{\tt gromos} & GROMOS87      & planned        \\
{\tt oplsa}  & OPLS/AMBER3.0 & planned        \\
{\tt oplsg}  & OPLS/GROMOS87 & planned        \\
\hline
\end{tabular}
\end{center}  
\subsection{Creating fragment {\bf frg} files}
Fragment files contain the basic information needed to specify all
interactions that need to be considered in a molecular simulation.
The format of the fragment files is
\begin{center}
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
I-1  & a1     & \$ to identify the start of a fragment \\
I-2  & a10    & name of the fragment, the tenth character\\
     &        & N: identifies beginning of a chain\\
     &        & C: identifies end of a chain\\
     &        & blank: identifies chain fragment\\
     &        & M: identifies a integral molecule\\
II-1 & i5     & number of atoms in the fragment\\ 
\hline
\end{tabular}\\
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
\multicolumn{3}{l}{For each atom a card III} \\
III-1 & i5     & atom sequence number \\
III-2 & a6     & atom name \\
III-3 & a6     & atom type, generic \\
III-4 & i5     & link number\\
III-5 & i5     & environment type\\
      &        & 0: no special identifier\\
      &        & 1: planar, using improper torsion\\
      &        & 2: R-stereomer, using improper torsion\\
      &        & 3: S-stereomer, using improper torsion\\
      &        & 4: atom in aromatic ring\\
III-6 & i5     & charge group\\
III-7 & i5     & polarization group\\
III-8 & f12.6  & atomic partial charge\\
III-9 & f12.6  & atomic polarizability\\
\multicolumn{3}{l}{Any number of cards IV to specify complete 
connectivity} \\
IV-1  & 16i5   & connectivity, duplication allowed\\ 
\hline\hline
\end{tabular}
\end{center}
\subsection{Creating segment {\bf sgm} files}
\label{nwsgm}
Program \nwsgm\ can be used to generate a template for a segment file 
from a corresponding fragment file. The segment file contains all
information for the calculation of bonded and non-bonded interaction
for a given chemical system using a specific force field. If a
fragment is available in a local file or in a database file, the
segment can be generated using
\begin{verbatim}
nwsgm fragment ffield
\end{verbatim}
where \verb+fragment+ is the name of the fragment. Since fragment
names rely on the last character for the type of fragment, spaces
should be replaced by underlines. \verb+ffield+ should be the
name of an available force field.
\par
The program \nwsgm\ only provides a template for a segment. It is
often needed to make additional changes in this file. The format
of a segment is
\begin{center}
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
I-1  & a1     & \$ to identify the start of a segment \\
I-2  & a10    & name of the segment, the tenth character\\
     &        & N: identifies beginning of a chain\\
     &        & C: identifies end of a chain\\
     &        & blank: identifies chain fragment\\
     &        & M: identifies a integral molecule\\
II-1 & i5     & number of atoms in the segment\\
II-2 & i5     & number of bonds in the segment\\
II-3 & i5     & number of angles in the segment\\
II-4 & i5     & number of proper dihedrals in the segment\\
II-5 & i5     & number of improper dihedrals in the segment\\
\hline
\end{tabular}\\
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
\multicolumn{3}{l}{For each atom a card III and card IV} \\
III-1 & i5     & atom sequence number \\
III-2 & a6     & atom name \\
III-3 & a6     & atom type, generic set 1 \\
III-4 & a6     & atom type, generic set 2 \\
III-5 & a6     & atom type, generic set 3 \\
III-6 & i5     & charge group\\
III-7 & i5     & polarization group\\
III-8 & i5     & link number\\
III-9 & i5     & environment type\\
      &        & 0: no special identifier\\
      &        & 1: planar, using improper torsion\\
      &        & 2: R-stereomer, using improper torsion\\
      &        & 3: S-stereomer, using improper torsion\\
      &        & 4: atom in aromatic ring\\
IV-1  & f12.6  & atomic partial charge, set 1\\
IV-2  & f12.6  & atomic polarizability, set 1\\
IV-3  & f12.6  & atomic partial charge, set 2\\
IV-4  & f12.6  & atomic polarizability, set 2\\
IV-5  & f12.6  & atomic partial charge, set 3\\
IV-6  & f12.6  & atomic polarizability, set 3\\
\hline
\end{tabular}\\
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
\multicolumn{3}{l}{For each bond a card V and card VI} \\
V-1   & i5     & bond sequence number \\
V-2   & i5     & bond atom i \\
V-3   & i5     & bond atom j \\
V-4   & i5     & bond type \\
      &        & 0: harmonic\\
      &        & 1: constrained bond\\
V-5   & i5     & bond parameter origin\\
      &        & 0: from database \\
      &        & 1: from next card\\
VI-1  & f12.6  & bond length in nm, set 1\\
VI-2  & e12.5  & bond force constant in kJ nm$^2$ mol$^{-1}$, set 1 \\
VI-3  & f12.6  & bond length in nm, set 2\\
VI-4  & e12.5  & bond force constant in kJ nm$^2$ mol$^{-1}$, set 2 \\
VI-5  & f12.6  & bond length in nm, set 3\\
VI-6  & e12.5  & bond force constant in kJ nm$^2$ mol$^{-1}$, set 3 \\
\hline
\end{tabular}\\
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
\multicolumn{3}{l}{For each angle a card VII and card VIII} \\
VII-1  & i5     & angle sequence number \\
VII-2  & i5     & angle atom i \\
VII-3  & i5     & angle atom j \\
VII-4  & i5     & angle atom k \\
VII-5  & i5     & angle type \\
       &        & 0: harmonic\\
VII-6  & i5     & angle parameter origin\\
       &        & 0: from database \\
       &        & 1: from next card\\
VIII-1 & f12.6  & angle in radians, set 1\\
VIII-2 & e12.5  & angle force constant in kJ mol$^{-1}$, set 1 \\
VIII-3 & f12.6  & angle in radians, set 2\\
VIII-4 & e12.5  & angle force constant in kJ mol$^{-1}$, set 2 \\
VIII-5 & f12.6  & angle in radians, set 3\\
VIII-6 & e12.5  & angle force constant in kJ mol$^{-1}$, set 3 \\
\hline
\end{tabular}\\
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
\multicolumn{3}{l}{For each proper dihedral a card IX and card X} \\
IX-1  & i5     & proper dihedral sequence number \\
IX-2  & i5     & proper dihedral atom i \\
IX-3  & i5     & proper dihedral atom j \\
IX-4  & i5     & proper dihedral atom k \\
IX-5  & i5     & proper dihedral atom l \\
IX-6  & i5     & proper dihedral type \\
      &        & 0: $C\cos(m\phi-\delta)$\\
IX-7  & i5     & proper dihedral parameter origin\\
      &        & 0: from database \\
      &        & 1: from next card\\
X-1 & i5     & multiplicity, set 1\\
X-2 & f12.6  & proper dihedral in radians, set 1\\
X-3 & e12.5  & proper dihedral force constant in kJ mol$^{-1}$, set 1 \\
X-4 & i5     & multiplicity, set 2\\
X-5 & f12.6  & proper dihedral in radians, set 2\\
X-6 & e12.5  & proper dihedral force constant in kJ mol$^{-1}$, set 2 \\
X-7 & i5     & multiplicity, set 3\\
X-8 & f12.6  & proper dihedral in radians, set 3\\
X-9 & e12.5  & proper dihedral force constant in kJ mol$^{-1}$, set 3 \\
\hline
\end{tabular}\\
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
\multicolumn{3}{l}{For each improper dihedral a card XI and card XII} \\
XI-1  & i5     & improper dihedral sequence number \\
XI-2  & i5     & improper dihedral atom i \\
XI-3  & i5     & improper dihedral atom j \\
XI-4  & i5     & improper dihedral atom k \\
XI-5  & i5     & improper dihedral atom l \\
XI-6  & i5     & improper dihedral type \\
      &        & 0: harmonic\\
XI-7  & i5     & improper dihedral parameter origin\\
      &        & 0: from database \\
      &        & 1: from next card\\
XII-1 & f12.6  & improper dihedral in radians, set 1\\
XII-2 & e12.5  & improper dihedral force constant in kJ mol$^{-1}$, set 1 \\
XII-3 & f12.6  & improper dihedral in radians, set 2\\
XII-4 & e12.5  & improper dihedral force constant in kJ mol$^{-1}$, set 2 \\
XII-5 & f12.6  & improper dihedral in radians, set 3\\
XII-6 & e12.5  & improper dihedral force constant in kJ mol$^{-1}$, set 3 \\
\hline\hline
\end{tabular}
\end{center}
\subsection{Creating sequence {\bf seq} files}
A sequence file describes a molecular system in terms of segments. The
file format is
\begin{center}
\begin{tabular}{lll}
\hline\hline
Card & Format & Description \\ \hline
I-1  & a1     & \$ to identify the start of a sequence \\
I-2  & a10    & name of the sequence\\
\multicolumn{3}{l}{Any number of cards II to specify the system} \\
II-1 & i5     & segment number, except\\
     &        &  0: identifies solvent, has to be last segment\\
     &        & -1: identifies a break in the chain\\
     &        & -2: identifies end of a molecule\\
     &        & -3: identifies end of the sequence file\\
II-2 & a10    & segment name, last character will be determined from chain\\
II-3 & i5     & link segment 1, if blank previous segment in chain\\
II-4 & i3     & link atom, if blank link atom 2\\
II-5 & i5     & link segment 2, if blank next segment in chain\\
II-6 & i3     & link atom, if blank link atom 1\\
\multicolumn{3}{l}{Any number of variables II-7 and II-8, from 3 to 8 } \\
II-7 & i5     & link segment 3\\
II-8 & i3     & link atom in link segment 3\\
\hline\hline
\end{tabular}
\end{center}
\subsection{Creating topology {\bf top} files}
\label{nwtop}
\par
The topology (\ref{topology}) describes all static information
that describes a molecular system. This includes the connectivity, such
as bond-stretching, angle-bending and torsional interactions, as well as
non-bonded interactions, such as van der Waals and Coulombic interactions.
\par
The topology (\ref{topology}) of a molecular system is 
generated by the topology generator \nwtop. The molecular system
is described in terms of segments taken from a database of predefined
segments. Segments that are not available in one of the database files
can be generated bye a utility program \nwsgm\ (\ref{nwsgm}).
\par
The command line to run \nwtop\ is
\begin{verbatim}
nwtop project forcefield
\end{verbatim}
where {\tt project} refers to the name of a sequence in one of the
sequence databases or a local file {\bf project.seq}, and
{\tt forcefield} is the name of one of the 
available force fields (\ref{forcefields}).
Force field parameters are taken from the parameter databases,
or from a local file {\bf project.par} is present. The 
format of the local parameter file is identical to the 
\argos\ parameter file format.
The resulting topology file is {\bf project.top}
\par
The input for \nwtop\ is taken from a sequence database, or
given in a formatted sequence file {\bf project.seq}. A sequence
file may be appended to a sequence database. The 
format of a sequence file is slightly different from the \argos\ 
sequence file format.
\subsection{Creating restart {\bf rst} files}
\label{nwrst}
Restart files are created using preparation utility \nwrst.
\begin{verbatim}
nwrst project
\end{verbatim}
The directives taken from {\tt project}{\bf.rin} can be any of
\begin{itemize}

\item
\begin{verbatim}
title
\end{verbatim}
reading three lines as title immediately following the directive

\item
\begin{verbatim}
read topology <c filtop>
\end{verbatim}
where {\tt filtop} is the topology file name

\item
\begin{verbatim}
read solvent <c filslv>
\end{verbatim}
where {\tt filslv} is the solvent name

\item
\begin{verbatim}
read PDB <c filpdb>
\end{verbatim}
where {\tt filpdb} is the file with coordinates in PDB format

\item
\begin{verbatim}
write PDB <c filpdc>
\end{verbatim}
where {\tt filpdc} is the file with coordinates in PDB format

\item
\begin{verbatim}
read rst <c filrsi>
\end{verbatim}
where {\tt filrsi} is a restart file

\item
\begin{verbatim}
write rst <c filrst>
\end{verbatim}
where {\tt filrst} is a restart file

\item
\begin{verbatim}
solvate [box [<r bx>[<r by>[<r bz>]]]]
\end{verbatim}
solvates the system in a rectangular box with dimensions 
bx $\times$ by $\times$ bz in nm

\item
\begin{verbatim}
center
\end{verbatim}
to put the solute center of geometry in the center of the
simulation box

\item
\begin{verbatim}
expand with <r xx>[<r xy>[<r xz>]]
\end{verbatim}
to expand the simulation box with xx, xy and xz in the
x, y and z direction respectively

\item
\begin{verbatim}
expand to <r xx>[<r xy>[<r xz>]]
\end{verbatim}
to expand the simulation box to xx, xy and xz in the
x, y and z direction respectively

\item
\begin{verbatim}
boxsize
\end{verbatim}
to resize the box to fit all atoms present

\item
\begin{verbatim}
periodic
\end{verbatim}
to specify the use of periodic boundary conditions

\item
\begin{verbatim}
vacuo
\end{verbatim}
to specify a system in vacuo

\item
\begin{verbatim}
set touch <r touch>
\end{verbatim}
to specify the minimum distance between any atom in
the system and a solvent atom to be added during solvation

\item
\begin{verbatim}
velocities {solvent | solute} zero
\end{verbatim}
to initialize velocities

\item
\begin{verbatim}
reference {solvent | solute} zero
\end{verbatim}
to initialize reference coordinates

\item
\begin{verbatim}
{ end | exit | quit | stop }
\end{verbatim}
to stop the restart file generation
\end{itemize}
\subsection{System specification}
The chemical system for a calculation is specified in the topology
and restart files. These files should be created using the utilities
\nwtop\ and \nwrst\ before a simulation can be performed.
\begin{itemize}
\item
The names of these files are determined from the required project directive
\begin{verbatim}
{start | restart | continue} <c project>
\end{verbatim}
There is no default. If the project name is given as {\bf pr\_id},
the topology file used is {\bf pr.top}, while all other files
are named {\bf pr\_id.ext}.
\end{itemize}
\subsection{Single point energy}
\begin{itemize}
\item
The energy of the system as found on the restart file is evaluated with
\begin{verbatim}
sp [set <i iset>]
\end{verbatim}
where {\bf iset} is the parameter set in [1,2,3] found on the
topology file. The default for {\bf iset} is 1.
\end{itemize}
\subsection{Energy minimization}
The energy minimization of the system as found in the restart file 
is performed with the following directives.
\begin{itemize}
\item
To specify the parameter set
\begin{verbatim}
em [set <i iset>] 
\end{verbatim}
where {\bf iset} is the parameter set in [1,2,3] found in the
topology file. The default for {\bf iset} is 1.
\item
To specify the steepest descent steps
\begin{verbatim}
em [[sd] <i msdit> [init <r dx0sd>] [min <r dxsdmx>] [max <r dxmsd>]] 
\end{verbatim}
where {\bf msdit} is the maximum number of steepest descent steps taken,
for which the default is 100, {\bf dx0sd} is the initial step size in nm
for which the default is 0.001, {\bf dxsdmx} is the threshold for the
step size in nm for which the default is 0.0001, and {\bf dxmsd} is the
maximum allowed step size in nm for which the default is 0.05.
\item
To specify the conjugate gradient steps
\begin{verbatim}
em [cg <i mcgit> [init <r dx0cg>] [min <r dxcgmx>] [max <r dxmcg>]
   [cy <i ncgcy>]]
\end{verbatim}
where {\bf mcgit} is the maximum number of conjugate gradient steps taken,
for which the default is 100, {\bf dx0cg} is the initial step size in nm
for which the default is 0.001, {\bf dxcgmx} is the threshold for the
step size in nm for which the default is 0.0001, {\bf dxmcg} is the
maximum allowed step size in nm for which the default is 0.05, and {\bf ncgcy}
is the number of conjugate gradient steps after which the gradient history
is discarded for which the default is 10.
\end{itemize}
The \verb+em+ directives may be combined in a single directive. Steepest
descent energy minimization always preceeds conjugate gradient minimization
if both are specified.
\subsection{Molecular dynamics simulation}
\begin{itemize}
\item
A molecular dynamics simulation is specified by
\begin{verbatim}
md [set <i iset>]
\end{verbatim}
where {\bf iset} is the parameter set in [1,2,3] found on the
topology file. The default for {\bf iset} is 1.
\end{itemize}
\subsection{Multiconfiguration thermodynamic integration}
The following keywords control free energy difference simulations.
Multiconfiguration thermodynamic integrations are always combined
with multiple step thermodynamic perturbations.
\begin{itemize}
\item
To specify the number of ensembles
\begin{verbatim}
mcti [[<i mrun> of] <i maxlam>] 
\end{verbatim}
where {\bf mrun} is the number of ensembles that will be generated in
this calculation, and {\bf maxlam} is the total number of ensembles
for the thermodynamic integration. The default value for {\bf maxlam}
is 21. The default value of {\bf mrun} is the value of {\bf maxlam}.
\item
To specify the direction of the thermodynamic integration
\begin{verbatim}
mcti [forward | reverse] 
\end{verbatim}
with {\bf forward} being the default direction.
\item
To specify the criteria for variable length ensembles
\begin{verbatim}
mcti [error <r edacq>] [drift <r ddacq>] [factor <r fdacq>]
\end{verbatim}
where {\bf edacq} is the maximum error allowed in the ensemble average 
derivative of the Hamiltonian with respect to lambda with a default
of 5.0 kJ~mol$^{-1}$, {\bf ddacq} is the maximum drift allowed in this
ensemble average with a default of 5.0 kJ~mol$^{-1}$ps$^{-1}$, and
{\bf fdacq} is the minimum size of an ensemble relative to the
previous ensemble in the calculation with a default value of 0.75.
\item
To specify that a free energy decomposition has to be carried out
\begin{verbatim}
mcti [decomp]
\end{verbatim}
Since free energy contributions are path dependent, the default is not
to perform this decomposition.
\item
To specify separation-shifted scaling
\begin{verbatim}
mcti [sss [delta <r delta>]]
\end{verbatim}
where {\bf delta} is the separation-shifted scaling factor with a default
of 0.075 nm$^2$.
\item
To specify the starting point
\begin{verbatim}
[new | renew | extend]
\end{verbatim}
where {\bf new} indicates that this is an initial mcti calculation, which
is also the default. {\bf renew} instructs to obtain the initial
conditions for each $\lambda$ from the {\bf mro}-file from a previous 
mcti calculation, which has to be renamed to an {\bf mri}-file. The
keyword {\bf extend} will extend a previous mcti calculation from the
data read from an {\bf mri}-file.
\end{itemize}
The \verb+mcti+ directives may be combined in a single directive.
\subsection{Time and integration algorithm directives}
Following directives control the integration of the equations of motion.
\begin{itemize}
\item
To specify the integration algorithm
\begin{verbatim}
[leapfrog | vverlet]
\end{verbatim}
where {\bf leapfrog} specifies the default leap frog integration, and
{\bf vverlet} specifies the velocity Verlet integrator.
\item
To specify the number of steps
\begin{verbatim}
[equil <i mequi>] [data <i mdacq> [over <i ldacq>]]
\end{verbatim}
where {\bf mequi} is the number of equilibration steps, with a default
of 100, and {\bf mdacq} is the number of data gathering steps with a
default of 500. In multiconfiguration thermodynamic integrations
{\bf mequi} and {\bf mdacq} are for each of the ensembles, and
variable {\bf ldacq} specifies the minimum number of datagathering steps 
in each ensemble. In regular molecular dynamics simulations {\bf ldacq}
is not used. The default value for {\bf ldacq} is the value of {\bf mdacq}.
\item
To specify start time and time step
\begin{verbatim}
[time <r stime>] [step <r tstep>]
\end{verbatim}
where {\bf stime} is the start time of a molecular simulation in ps,
with a default of 0.0, and {\bf tstep} is the time step in ps, with
0.001 as the default value.
\end{itemize}
\subsection{Ensemble selection}
Following directives control the ensemble type.
\begin{itemize}
\item
To specify a constant temperature ensemble using Berendsen's thermostat
\begin{verbatim}
[isotherm [<r tmpext>] [trelax <r tmprlx> [<r tmsrlx>]]]
\end{verbatim}
where {\bf tmpext} is the external temperature with a default of 298.15~K,
and {\bf tmprlx} and {\bf tmsrlx} are temperature relaxation times in ps 
with a default of 0.1. If only {\bf tmprlx} is given the complete system
is coupled to the heat bath with relaxation time {\bf tmprlx}. If both
relaxation times are supplied, solvent and solute are independently coupled
to the heat bath with relaxation times {\bf tmprlx} and {\bf tmsrlx}
respectively.
\item
To specify a constant pressure ensemble using Berendsen's piston
\begin{verbatim}
[isobar [<r prsext>] [trelax <r prsrlx> ] [compress <r compr>]]
\end{verbatim}
where {\bf prsext} is the external temperature with a default of 1.025~10$^5$ Pa,
{\bf prsrlx} is the pressure relaxation time in ps with a default of 0.5, and
{\bf compr} is the system compressibility in xx with a default of yy.
\end{itemize}
\subsection{Velocity reassignments}
Velocities can be periodically reassigned to reflect a certain temperature.
\begin{itemize}
\item
\begin{verbatim}
[vreass <i nfgaus> <r tgauss>]
\end{verbatim}
specifies that velocities will be reassigned every {\bf nfgaus} molecular
dynamics steps, reflecting a temperature of {\bf tgauss}~K. The default
is not to reassign velocities, i.e.\ {\bf nfgaus} is 0.
\end{itemize}
\subsection{Cutoff radii}
Cutoff radii can be specified for short range and long range interactions.
\begin{itemize}
\item
\begin{verbatim}
[cutoff [short] <r rshort> [long <r rlong>]]
\end{verbatim}
where {\bf rshort} is the short range cutoff radius in nm, and {\bf rlong}
is the long range cutoff radius in nm. If the long range cutoff radius
is larger than the short range cutoff radius the twin range method will
be used, in which short range forces and energies are evaluated every
molecular dynamics step, and long range forces and energies with a
frequency of {\bf nflong} molecular dynamics steps. The default value
for both {\bf rshort} and {\bf rlong} is 0.9~nm.
\end{itemize}
\subsection{Polarization}
Polarizable models are currently not implemented. For development only:
\begin{itemize}
\item
The use of polarizable potentials is specified by
\begin{verbatim}
[polar [first | scf [<r ptol>]]]
\end{verbatim}
where the keyword {\bf first} specifies the first order polarization
model, and {\bf scf} specifies the self consistent polarization field
model to within a tolerance of {\bf ptol}. The default is not to
use polarization models.
\end{itemize}
\subsection{Constraints}
Constraints are satisfied using the SHAKE coordinate resetting preocedure.
\begin{itemize}
\item
\begin{verbatim}
[shake [<i mshitw> [<i mshits>]] [<r tlwsha> [<r tlssha>]]]
\end{verbatim}
where {\bf mshitw} is the maximum number of solvent SHAKE iterations,
and {\bf mshits} is the maximum number of solute SHAKE iterations. If
only {\bf mshitw} is specified, the value will also be used for {\bf mshits}.
The default maximum number of iterations is 100 for both.
{\bf tlwsha} is the solvent SHAKE tolerance in nm, and {\bf tlssha} is
the solute SHAKE tolerance in nm. If only {\bf tlwsha} is specified, the
value given will also be used for {\bf tlwsha}. The default tolerance
is 0.001~nm for both.
\end{itemize}
\subsection{Long range interaction corrections}
No method of long range interaction treatment is implemented in the
current release. For development only:
\begin{itemize}
\item
\begin{verbatim}
[ewald]
\end{verbatim}
\end{itemize}
\subsection{Print options}
Keywords that control print to the output file, with extension {\bf out}.
\begin{itemize}
\item
Printing topology information
\begin{verbatim}
[print topol [nonbond] [solvent] [solute]]
\end{verbatim}
where {\bf nonbond} refers to the non-bonded interaction parameters,
{\bf solvent} to the solvent bonded parameters and {\bf solute} to the
solute bonded parameters. If only {\bf topol} is specified, all
topology information will be printed to the output file.
\item
Printing time step information
\begin{verbatim}
[print [step <i nfoutp>] [extra] [energy]]
\end{verbatim}
where {\bf nfoutp} is the frequency of printing molecular dynamics step
information to the output file. If the keyword {\bf extra} is specified
additional energetic data are printed for solvent and solute separately.
If the keyword {\bf energy} is specified, information is printed for
all bonded solute interactions.
The default for {\bf nfoutp} is 0. For molecular dynamics simulations
this frequency is in time steps, and for multiconfiguration thermodynamic
integration in $\lambda$ steps.
\item
Printing statistical information
\begin{verbatim}
[print [stat <i nfstat>]]
\end{verbatim}
where {\bf nfstat} is the frequency of printing statistical information
of properties that are calculated during the simulation. 
For molecular dynamics simulation
this frequency is in time steps, for multiconfiguration thermodynamic
integration in $\lambda$ steps.
\end{itemize}
Print directives may be combined to a single directive.
\subsection{Periodic updates}
Following keywords control periodic events during a molecular
dynamics or thermodynamic integration simulation.
\begin{itemize}
\item
Updating pairlists
\begin{verbatim}
[update [pairs <i nfpair>]]
\end{verbatim}
where {\bf nfpair} is the frequency in molecular dynamics steps of 
updating the pairlists. The default for the frequency is 1.
In addition, pairlists are also updated after each step in which
recording of the restart or trajectory files is performed. Updating
the pairlists includes the redistribution of atoms that changed
domain and load balancing, if specified.
\item
Updating long range forces
\begin{verbatim}
[update [long <i nflong>]]
\end{verbatim}
where {\bf nflong} is the frequency in molecular dynamics steps 
of updating the long range forces. The default frequency is 1.
The distinction of short range and long range forces is only
made if the long range cutoff radius was specified to be larger
than the short range cutof radius. Updating the long range forces
is also done in every molecular dynamics step in which the
pairlists are regenerated.
\item
Updating the simulation volume center
\begin{verbatim}
[update [center <i nfcntr>]]
\end{verbatim}
where {\bf nfcntr} is the frequency in molecular dynamics steps in 
which the center of geometry of the solute(s) is translated to the
center of the simulation volume. This translation is implemented
such that it has no effect on any aspect of the simulation. The
default is 0.
\item
Updating the radial distribution functions
\begin{verbatim}
[update [rdf <i nfrdf>]]
\end{verbatim}
where {\bf nfrdf} is the frequency in molecular dynamics steps in 
which contributions to the radial distribution functions are
evaluated. The default is 1, i.e. at every step.
\end{itemize}
Update directive may be combined to a single directive.
\subsection{Recording}
The following keywords control recording data to file.
\begin{itemize}
\item
The restart file, file extension {\bf rst}
\begin{verbatim}
[record [restart <i nfrest>]]
\end{verbatim}
where {\bf nfrest} is the frequency in molecular dynamics steps
of writing information to this file. For multiconfiguration
thermodynamic integration simulations the frequency is in
steps in $\lambda$. The default is not to record. The restart
file is used to start or restart simulations.
\item
The coordinate trajectory file, file extension {\bf coo}
\begin{verbatim}
[record [coord <i nfcoor>]]
\end{verbatim}
where {\bf nfcoor} is the frequency in molecular dynamics steps
of writing information to this file. For multiconfiguration
thermodynamic integration simulations the frequency is in
steps in $\lambda$. The default is not to record.
\item
The solute coordinate trajectory file, file extension {\bf sco}
\begin{verbatim}
[record [scoor <i nfscoo>]]
\end{verbatim}
where {\bf nfscoo} is the frequency in molecular dynamics steps
of writing information to this file. For multiconfiguration
thermodynamic integration simulations the frequency is in
steps in $\lambda$. The default is not to record.
\item
The velocity trajectory file, file extension {\bf vel}
\begin{verbatim}
[record [veloc <i nfvelo>]]
\end{verbatim}
where {\bf nfvelo} is the frequency in molecular dynamics steps
of writing information to this file. For multiconfiguration
thermodynamic integration simulations the frequency is in
steps in $\lambda$. The default is not to record.
\item
The solute velocity trajectory file, file extension {\bf svl}
\begin{verbatim}
[record [svelo <i nfsvel>]]
\end{verbatim}
where {\bf nfsvel} is the frequency in molecular dynamics steps
of writing information to this file. For multiconfiguration
thermodynamic integration simulations the frequency is in
steps in $\lambda$. The default is not to record.
\item
The property file, file extension {\bf prp}
\begin{verbatim}
[record [prop <i nfprop>]]
\end{verbatim}
where {\bf nfprop} is the frequency in molecular dynamics steps
of writing information to this file. For multiconfiguration
thermodynamic integration simulations the frequency is in
steps in $\lambda$. The default is not to record.
\item
The free energy file, file extension {\bf gib}
\begin{verbatim}
[record [free <i nffree>]]
\end{verbatim}
where {\bf nffree} is the frequency in multiconfiguration
thermodynamic integration simulations to record data to this file.
The default is 1, i.e.\ to record at every $\lambda$.
\item
The free energy convergence file, file extension {\bf cnv}
\begin{verbatim}
[record cnv]
\end{verbatim}
\item
\item
The free energy derivative autocorrelation file, file extension {\bf acf}
\begin{verbatim}
[record acf]
\end{verbatim}
\item
The free energy vs. time file, file extension {\bf fet}
\begin{verbatim}
[record fet]
\end{verbatim}
\item
The synchronization time file, file extension {\bf syn}
\begin{verbatim}
[record [sync <i nfsync>]]
\end{verbatim}
where {\bf nfsync} is the frequency in molecular dynamics steps
of writing information to this file. The default is not to record.
\end{itemize}
Record directive may be combined to a single directive.
\subsection{Program control options}
\begin{itemize}
\item
Load balancing is determined by
\begin{verbatim}
[load [none | size | pairs ]]
\end{verbatim}
where the default is {\bf none}. Load balancing option {\bf size}
is resizing boxes on a node, and {\bf pairs} redistributes the
box-box interactions over nodes.
\item
In rare events the amount of memory set aside per node is insufficient
leading to aborts because {\bf mwm} or {\bf msa} is too small. Jobs
may be restarted with additional space allocated by
\begin{verbatim}
[extra <i madbox>]
\end{verbatim}
where {\bf madbox} is the number of additional boxes that are allocated
on each node. The default for {\bf madbox} is 6. In some case {\bf madbox}
can be reduced to 4 is memory usage is a concern. Values of 2 or less
will almost certainly result in memory shortage.
\end{itemize}
