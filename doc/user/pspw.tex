\label{sec:pspw}

A pseudopotential plane-wave (PSPW) module, which can perform Car-Parrinello
simulations, is being implemented into the NWChem program package.  
This module complements the capabilities of NWChem by including code 
which allows for the calculation of density functional theory total energies 
and forces with the technology based on plane-wave basis sets and 
pseudopotentials.  Consistent with NWChem's philosophy this module is able 
to run on a variety of architectures, including parallel supercomputers.

The advantage of a PSPW method is that it has been shown to have an accuracy 
close to chemical accuracy for many applications, yet is still fast enough 
to treat systems containing hundreds of atoms.  Another significant advantage 
is its ability to simulate dynamics on a ground state potential surface 
directly at run-time.  This method's efficiency and accuracy make it a 
desirable first principles method of simulation in the study of complex 
molecular, liquid, and solid state systems.  Applications for this first 
principles method include the calculation of free energies, search for 
global minima, explicit simulation of solvated molecules, and simulations 
of complex vibrational modes that cannot be described within the harmonic 
approximation.

The next section describes the tasks contained within the PSPW module.
Then the RTDB entries and datafiles used by the PSPW module are described 
in section \ref{sec:pspw_data}.  Examples of how to setup and run
a steepest descent simulation and a Car-Parrinello simulation are presented
in sections \ref{sec:pspw_sd}-\ref{sec:pspw_cp}.  Finally in section
\ref{sec:pspw_limits} the capabilities and limitations of the PSPW
module are discussed.

If you are a first time user of this module it is recommended that you skip
the next two sections and proceed directly to the tutorials in sections 
\ref{sec:pspw_sd}-\ref{sec:pspw_cp}.

\section{PSPW Tasks}
\label{sec:pspw_tasks}

All input to the PSPW Tasks is contained within the compound PSPW  block,
\begin{verbatim}
PSPW
   ...
END
\end{verbatim}

To perform an actual calculation a TASK PSPW directive is used.
The format for the TASK PSPW directive is the TASK directive followed by the 
PSPW string, and after that an $<$operation$>$ string is required.  The 
TASK PSPW directive for PSPW calculations is of the following form:
\begin{verbatim}
TASK PSPW [steepest_descent           ||
           Car-Parrinello             ||
           psp_formatter              ||
           wavefunction_initializer   ||
           v_wavefunction_initializer ||
           wavefunction_expander      ||
           psp_generator              ||
           (no default)]
\end{verbatim}
Currently available tasks are listed.  Note that unlike most 
NWChem modules, the PSPW module does not contain an energy operation.  
This means that there is no default operation and hence an operation must 
always be specified.

PSPW tasks are of two types.  The first type of 
task is used to setup or change needed data files for a 
PSPW simulation.  Tasks of this type are psp\_formatter, 
wavefunction\_initializer, v\_wavefunction\_initializer, 
wavefunction\_expander, and psp\_generator.  The second type 
of task is used to actually run a PSPW simulation.  Tasks 
of this type are steepest\_descent, and Car-Parrinello.
The following subsections describe the input to these tasks.

\subsection{STEEPEST\_DESCENT} 
The steepest\_descent task is used to optimize the one-electron orbitals
with respect to the total energy.  In addition it can also be used to optimize
geometries.
Input to the steepest\_descent simulation is contained
within the steepest\_descent sub-block.
\begin{verbatim}
PSPW
  ...
  STEEPEST_DESCENT
     ...
  END
  ...
END
\end{verbatim}
and to run a steepest\_descent calculation the following directive is used:
\begin{verbatim}
TASK PSPW steepest_descent 
\end{verbatim}
The steepest\_descent sub-block contains a great deal
of input, including pointers to RTDB data, pointers to data, as well as
parameter input.  Listed below is the format of a STEEPEST\_DESCENT sub-block.
\begin{verbatim}
PSPW
...
   STEEPEST_DESCENT
      CELL_NAME: <string cell_name>
      [GEOMETRY_OPTIMIZE]
      (FORMATTED_FILENAME: <string formatted_name>)+
      INPUT_WAVEFUNCTION_FILENAME:  <string input_wavefunctions>
      OUTPUT_WAVEFUNCTION_FILENAME: <string output_wavefunctions>
      FAKE_MASS: <real fake_mass>
      TIME_STEP: <real time_step>
      LOOP: <integer inner_iteration outer_iteration>
      TOLERANCES: <real tole tolc tolr>
      [ENERGY_CUTOFF:       <real ecut>]
      [WAVEFUNCTION_CUTOFF: <real wcut>]
      [EWALD_NCUT: <integer ncut>]
      [EWALD_RCUT: <real rcut>]
   END
...

END
\end{verbatim}
The following list describes the input for the STEEPEST\_DESCENT
sub-block.
\begin{itemize}
	\item $<$cell\_name$>$ - name that points to the
              the simulation\_cell named $<$cell\_name$>$.
	\item GEOMETRY\_OPTIMIZE - optional keyword which if specified
	      turns on geometry optimization. 	
	\item $<$formatted\_name$>$ - name that points
              to a formatted\_pseudopotential file.  A file must
              be specified for each kind of ion in the simulation.
	\item $<$input\_wavefuncitons$>$ - name that points
              to a file containing one-electron orbitals
	\item $<$output\_wavefunctions$>$ - name that will
              point to file containing the one-electron orbitals at the
              end of the run. 
	\item $<$fake\_mass$>$ - value for the electronic
              fake mass.  In the steepest descent code this parameter is
              used to define the steepest descent loop for the one-electron
              orbitals.
	\item $<$time\_step$>$ - value for the time step.
               In the steepest descent code this parameter is used to
               define the steepest descent loop for the one-electron orbitals
               and ion positions (if GEOMETRY\_OPTIMIZE is specified).
	\item $<$inner\_iteration$>$ - number of iterations between the 
              printing out of energies and tolerances
	\item $<$outer\_iteration$>$ - number of outer iterations
 	\item $<$tole$>$ - energy tolerance requested.
	\item $<$tolc$>$ - one-electron orbital tolerance requested.
	\item $<$tolr$>$ - ion position tolerance requested.
	\item $<$ecut$>$ - value for the cutoff energy used
                           to define the density.
	\item $<$wcut$>$ - value for the cutoff energy used
 			   to define the one-electron orbitals.
	\item $<$ncut$>$ - value for the number of unit cells
 			  to sum over (in each direction) for the real space
			  part of the Ewald summation.
	\item $<$rcut$>$ - value for the cutoff radius used
			  in the Ewald summation.
\end{itemize}


\subsection{Car-Parrinello}
The Car-Parrinello task is used to perform ab initio molecular dynamics
using the scheme developed by Car and Parrinello. Input to the Car-Parrinello 
simulation is contained within the Car-Parrinello sub-block.
\begin{verbatim}
PSPW
  ...
  Car-Parrinello
     ...
  END
  ...
END
\end{verbatim}
and to run a Car-Parrinello calculation the following directive is used:
\begin{verbatim}
TASK PSPW Car-Parrinello 
\end{verbatim}
The Car-Parrinello sub-block contains a great deal
of input, including pointers to RTDB data, pointers to data, as well as
parameter input.  Listed below is the format of a Car-Parrinello sub-block.
\begin{verbatim}
PSPW
...
   Car-Parrinello
      CELL_NAME: <string cell_name>
      [GEOMETRY_OPTIMIZE]
      (FORMATTED_FILENAME: <string formatted_name>)+
      INPUT_WAVEFUNCTION_FILENAME:    <string input_wavefunctions>
      OUTPUT_WAVEFUNCTION_FILENAME:   <string output_wavefunctions>
      INPUT_V_WAVEFUNCTION_FILENAME:  <string input_v_wavefunctions>
      OUTPUT_V_WAVEFUNCTION_FILENAME: <string output_v_wavefunctions>
      FAKE_MASS: <real fake_mass>
      TIME_STEP: <real time_step>
      LOOP: <integer inner_iteration outer_iteration>
      SCALING: <real scale_c scale_r>
      [ENERGY_CUTOFF:       <real ecut>]
      [WAVEFUNCTION_CUTOFF: <real wcut>]
      [EWALD_NCUT: <integer ncut>]
      [EWALD_RCUT: <real rcut>]
      [XYZ_FILENAME: <string xyz_filename default XYZ>]
   END
...

END
\end{verbatim}
The following list describes the input for the Car-Parrinello
sub-block.
\begin{itemize}
	\item $<$cell\_name$>$ - name that points to the
              the simulation\_cell named $<$cell\_name$>$.
	\item $<$formatted\_name$>$ - name that points
              to a formatted\_pseudopotential file.  A file must
              be specified for each kind of ion in the simulation.
	\item $<$input\_wavefunctions$>$ - name that points
              to a file containing one-electron orbitals
	\item $<$output\_wavefunctions$>$ - name that will
              point to file containing the one-electron orbitals at the
              end of the run. 
	\item $<$input\_v\_wavefunctions$>$ - name that points
              to a file containing one-electron orbital velocities.
	\item $<$output\_v\_wavefunctions$>$ - name that will
              point to file containing the one-electron orbital velocities
	      at the end of the run. 
	\item $<$fake\_mass$>$ - value for the electronic
              fake mass.  In the steepest descent code this parameter is
              used to define the steepest descent loop for the one-electron
              orbitals.
	\item $<$time\_step$>$ - value for the time step.
               In the steepest descent code this parameter is used to
               define the steepest descent loop for the one-electron orbitals
               and ion positions (if GEOMETRY\_OPTIMIZE is specified).
	\item $<$inner\_iteration$>$ - number of iterations between the
              printing out of energies.
	\item $<$outer\_iteration$>$ - number of outer iterations
 	\item $<$scale\_c$>$ - value for the initial velocity
			      scaling of the one-electron orbital velocities.
	\item $<$scale\_r$>$ - value for the initial velocity
			      scaling of the ion velocities.
	\item $<$ecut$>$ - value for the cutoff energy used
                           to define the density.
	\item $<$wcut$>$ - value for the cutoff energy used
 			   to define the one-electron orbitals.
	\item $<$ncut$>$ - value for the number of unit cells
 			  to sum over (in each direction) for the real space
			  part of the Ewald summation.
	\item $<$rcut$>$ - value for the cutoff radius used
			  in the Ewald summation.
	\item $<$xyz\_filename$>$ - name that points to the XYZ motion file
				generated
\end{itemize}



\subsection{PSP\_FORMATTER}
The psp\_formatter task takes a non-seperable pseudopotential defined in
one-dimension real-space in a one-dimensional psp datafile and does two 
things to it.  First it puts it into the semi-local form suggested by 
Kleinman and Bylander and then it expands in in a periodic Fourier
series defined by the simulation cell RTDB.  

Input to the PSP\_FORMATTER task is contained
within the PSP\_FORMATTER sub-block.
\begin{verbatim}
PSPW
  ...
  PSP_FORMATTER
     ...
  END
  ...
END
\end{verbatim}
and to run a PSP\_FORMATTER calculation the following directive is used:
\begin{verbatim}
TASK PSPW PSP_FORMATTER
\end{verbatim}
Listed below is the format of a PSP\_FORMATTER sub-block.
\begin{verbatim}
PSPW
... 
   PSP_FORMATTER
      CELL_NAME:          <string cell_name> 
      PSP_FILENAME:       <string psp_name>
      FORMATTED_FILENAME: <string formatted_name>
      LOCP: (s||p||d||f)
      LMAX: (s||p||d||f||g)
   end
...
END
\end{verbatim}
The following list describes the input for the PSP\_FORMATTER
sub-block.
\begin{itemize}
	\item $<$cell\_name$>$ - name that points 
		to the simulation\_cell named $<$cell\_name$>$.
	\item $<$psp\_name$>$ - name that points
              to a one-dimensional pseudopotential datafile.
	\item $<$formatted\_name$>$ -  
 	      name that points to a formatted\_pseudopotential datafile.
  	\item LOCP (s$||$p$||$d$||$f) - used to specify which angular potential
	      is to used as the local potential.
        \item LMAX (s$||$p$||$d$||$f$||$g) - used to specify the maximum number
              of angular potentials to use.
\end{itemize}


\subsection{WAVEFUNCTION\_INTITIALIZER}
The wavefunction\_initializer task is used to generate an initial wavefunction
datafile.
Input to the WAVEFUNCTION\_INITIALIZER task is contained
within the WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
  ...
  WAVEFUNCTION_INITIALIZER
     ...
  END
  ...
END
\end{verbatim}
and to run a WAVEFUNCTION\_INITIALIZER calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW WAVEFUNCTION_INITIALIZER
\end{verbatim}
Listed below is the format of a WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
... 
   WAVEFUNCTION_INITIALIZER
     CELL_NAME: <string cell_name>
     WAVEFUNCTION_FILENAME: <string wavefunction_name>
     (RESTRICTED||UNRESTRICTED)
     UP_FILLING: <integer up_filling>
        [0 0 0 0   0]
        {<integer kx ky kz> (-2||-1||1||2)}
     DOWN_FILLING: <integer down_filling>
        [0 0 0 0   0]
        {<integer kx ky kz> (-2||-1||1||2)}
   END
...
END
\end{verbatim}
The following list describes the input for the WAVEFUNCTION\_INITIALIZER
sub-block.
\begin{itemize}
	\item $<$cell\_name$>$ - name that points 
		to the simulation\_cell named $<$cell\_name$>$.
	\item $<$wavefunction\_name$>$ - name that will point
              to a wavefunction file.
	\item (RESTRICTED$||$UNRESTRICTED) - keyword specifying the whether
              the calculation is restricted or unrestricted.
	\item $<$up\_filling$>$ - number of restricted molecular orbitals if
              RESTRICTED and number of spin-up molecular orbitals if 
              UNRESTRICTED.
        \item $<$down\_filling$>$ - number of spin-down moleclar orbitals if
              UNRESTRICTED.  Not used if a RESTRICTED calculations
        \item $<$kx ky kz$>$ - specifies which planewave is to be filled. 
\end{itemize}



\subsection{V\_WAVEFUNCTION\_INITIALIZER}
The v\_wavefunction\_initializer task is used to generate an initial velocity 
wavefunction datafile.
Input to the V\_WAVEFUNCTION\_INITIALIZER task is contained
within the V\_WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
  ...
  V_WAVEFUNCTION_INITIALIZER
     ...
  END
  ...
END
\end{verbatim}
and to run a V\_WAVEFUNCTION\_INITIALIZER calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW WAVEFUNCTION_INITIALIZER
\end{verbatim}
Listed below is the format of a V\_WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
... 
   V_WAVEFUNCTION_INITIALIZER
     V_WAVEFUNCTION_FILENAME: <string v_wavefunction_name>
     CELL_NAME: <string cell_name>
     (RESTRICTED||UNRESTRICTED)
     UP_FILLING: <integer up_filling>
     DOWN_FILLING: <integer down_filling>
   END
...
END
\end{verbatim}
The following list describes the input for the V\_WAVEFUNCTION\_INITIALIZER
sub-block.
\begin{itemize}
	\item $<$cell\_name$>$ - name that points 
		to the simulation\_cell named $<$cell\_name$>$.
	\item $<$wavefunction\_name$>$ - name that will point
              to a velocity wavefunction file.
	\item (RESTRICTED$||$UNRESTRICTED) - keyword specifying the whether
              the calculation is restricted or unrestricted.
	\item $<$up\_filling$>$ - number of restricted velocity molecular 
	      orbitals if RESTRICTED and number of spin-up velocity molecular 
              orbitals if UNRESTRICTED.
        \item $<$down\_filling$>$ - number of spin-down velocity moleclar 
              orbitals if UNRESTRICTED.  Not used if a RESTRICTED calculation.
\end{itemize}



\subsection{WAVEFUNCTION\_EXPANDER}
The v\_wavefunction\_initializer task is used to convert a new wavefunction
file that span a larger grid space from an old wavefunction file.
Input to the WAVEFUNCTION\_EXPANDER task is contained
within the WAVEFUNCTION\_EXPANDER sub-block.
\begin{verbatim}
PSPW
  ...
  WAVEFUNCTION_EXPANDER
     ...
  END
  ...
END
\end{verbatim}
and to run a WAVEFUNCTION\_EXPANDER calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW WAVEFUNCTION_EXPANDER
\end{verbatim}
Listed below is the format of a WAVEFUNCTION\_EXPANDER sub-block.
\begin{verbatim}
PSPW
... 
   WAVEFUNCTION_EXPANDER   
     OLD_WAVEFUNCTION_FILENAME: <string old_wavefunction_name>
     NEW_WAVEFUNCTION_FILENAME: <string new_wavefunction_name>
     NEW_NGRID: <integer na1 na2 na3>
    
   END
...
END
\end{verbatim}
The following list describes the input for the WAVEFUNCTION\_EXPANDER
sub-block.
\begin{itemize}
	\item $<$old\_wavefunction\_name$>$ - name that points
              to a wavefunction file.
	\item $<$new\_wavefunction\_name$>$ - name that will 
              point to a wavefunction file.
	\item $<$na1 na2 na3$>$ - number of grid points in each dimension
              for the new wavefunction file. 
\end{itemize}



\subsection{PSP\_GENERATOR}

A one-dimensional pseudopotential code has been integrated into NWChem.
This code allows the user to modify and develop pseudopotentials.  Currently, 
only the Hamann and Troullier-Martins norm-conserving pseudopotentials can be
generated.  This file can then be used by the pseudopotential\_formatter 
task to generate a formatted pseudopotential file. 
Input to the PSP\_GENERATOR task is contained
within the PSP\_GENERATOR sub-block.
\begin{verbatim}
PSPW
  ...
  PSP_GENERATOR
     ...
  END
  ...
END
\end{verbatim}
and to run a PSP\_GENERATOR calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW PSP_GENERATOR
\end{verbatim}
Listed below is the format of a PSP\_GENERATOR sub-block.
\begin{verbatim}
PSPW
... 
   PSP_GENERATOR
      PSEUDOPOTENTIAL_FILENAME: <string psp_name>
      ELEMENT: <string element>
      CHARGE: <real charge>
      MASS_NUMBER: <real mass_number>
      ATOMIC_FILLING: <integer ncore nvalence>
       {n=(1||2||...) l=(s||p||d||f) <real filling[n,l]> i=1,(ncore+nvalence)}
      
      [CUTOFF: <integer lmax> \
         {l=(s||p||d||f||g) <real rcut[l]> i=1,lmax}
      ]
      [PSEUDOPOTENTIAL_TYPE: (troullier-martins||hamann)]
      [SOLVER_TYPE: (pauli||schrodinger)]
      [EXCHANGE_TYPE: dirac]
      [CORRELATION_TYPE: vosko]
   end
... 
END
\end{verbatim}





\section{PSPW RTDB Entries and DataFiles}
\label{sec:pspw_data}
Input to the PSPW module is contained in both the RTDB and datafiles.
The RTDB is used to store input that the user will need to directly specify.
Input of this kind includes ion positions, ion velocities, and simulation cell
parameters.  The datafiles are used to store input, such the one-electron 
orbitals, one-electron orbital velocities, formatted pseudopotentials, 
and one-dimensional pseudopotentials, that the user will in most cases
run a program to generate.

\subsection{Ion Positions}
The positions of the ions are stored in the default geometry structure
in the RTDB and must be specified in cartesian 
coordinates using the GEOMETRY directive.

\subsection{Ion Velocities}
The velocities of the ions are stored in the default geometry structure
in the RTDB, and must be specified in cartesian 
coordinates using the GEOMETRY directive.

\subsection{Simulation Cell}
Simulation cells are stored in the RTDB.  To enter a  simulation cell
into the RTDB the user defines a simulation\_cell sub-block within the PSPW 
block.  Listed below is the format of a simulation\_cell sub-block.
\begin{verbatim}
PSPW
...
   SIMULATION_CELL
      CELL_NAME: <string name>
      BOUNDRY_CONDITIONS: (periodic || aperiodic)
      LATTICE_VECTORS:
        <real a1.x a1.y a1.z>
        <real a2.x a2.y a2.z>
        <real a3.x a3.y a3.z>
      NGRID: <integer na1 na2 na3>
   END
...
END
\end{verbatim}
Basically, the user needs to enter the dimensions, gridding and boundry
conditions of the simulation cell.  The following list describes the 
input in detail.
\begin{itemize}
	\item $<$name$>$ - user-supplied name for the simulation block.
	\item periodic - keyword specifying that the simulation cell 
	                 has periodic boundary conditions. 	
	\item aperiodic - keyword specifying that the simulation cell
		          has free-space boundary conditions. !!! Currently 
			  this option is not implemented !!!
	\item $<$a1.x a1.y a1.z$>$ - user-supplied values for the first 
				   lattice vector 
	\item $<$a2.x a2.y a2.z$>$ - user-supplied values for the second 
				   lattice vector
	\item $<$a3.x a3.y a3.z$>$ - user-supplied values for the third 
				   lattice vector
	\item $<$na1 na2 na3$>$ - user-supplied values for discretization 
				along lattice vector directions.
\end{itemize}

\subsection{Wavefunction Datafile}
The one-electron orbitals are stored in a wavefunction datafile.  This
is a binary file and cannot be directly edited.  This datafile is used
by steepest\_descent and Car-Parrinello tasks and can be generated
using the wavefunction\_initializer or wavefunction\_expander tasks.

\subsection{Velocity Wavefunction Datafile}
The one-electron orbital velocities are stored in a velocity wavefunction 
datafile.  This is a binary file and cannot be directly edited.  This datafile 
is used by the Car-Parrinello task and can be generated
using the v\_wavefunction\_initializer task.

\subsection{Formatted Pseudopotential Datafile}
The pseudopotentials in Kleinman-Bylander form expanded on a simulation
cell (3d grid) are stored in a formatted pseudopotential datafile.
This is a binary file and cannot be directly edited.
This datafile 
is used by steepest\_descent and Car-Parrinello tasks and can be generated
using the pseudpotential\_formatter task.

\subsection{One-Dimensional Pseudopotential Datafile}
The one-dimensional pseudopotentials are stored in a one-dimensional 
pseudopotential file.  This is an ascii file and can be directly edited with
a text editor.  However, the user will usually use the psp\_generator
task to generate this datafile.

The data stored in the one-dimensional pseudopotential file is
\begin{verbatim}
   character*2 element       :: element name
   integer     charge        :: valence charge of ion
   real        mass          :: mass of ion
   integer     lmax          :: maximum angular component
   real        rcut(lmax)    :: cutoff radii used to define pseudopotentials
   integer     nr            :: number of points in the radial grid
   real        dr            :: linear spacing of the radial grid
   real        r(nr)         :: one-dimensional radial grid
   real        Vpsp(nr,lmax) :: one-dimensional pseudopotentials
   real        psi(nr,lmax)  :: one-dimensional pseudowavefunctions
\end{verbatim}
and the format of it is:
\begin{verbatim}
[line 1:     ] element	
[line 2:     ] charge mass lmax
[line 3:     ] (rcut(l), l=1,lmax)
[line 4:     ] nr dr
[line 5:     ]    r(1)  (Vpsp(1,l),  l=1,lmax)
[line 6:     ] ....
[line nr+4:  ] r(nr) (Vpsp(nr,l), l=1,lmax)
[line nr+5:  ] r(1)  (psi(1,l), l=1,lmax) 
[line nr+6:  ] ....
[line 2*nr+4:] r(nr) (psi(nr,l), l=1,lmax)
\end{verbatim}




\section{Running a Steepest Descent Simulation}
\label{sec:pspw_sd}

In this section we show how to setup and run a steepest descent
simulation to optimize the one-electron orbitals with respect to 
the total energy for a NaCl molecule.  

Before running a steepest\_descent simulation several files and
RTDB structures must be defined or initialized.  Specifically, the user 
is required to have defined:
\begin{enumerate}
  \item {\bf ion positions} 
  \item {\bf simulation cell} in the RTDB 
  \item {\bf formatted pseudopotential file} for each kind of ion 
  \item {\bf file containing the one-electron orbitals} 
  \item {\bf steepest\_descent PSPW sub-block} 
\end{enumerate}

In the following tutorial we show the input needed to find an
energy for an NaCl molecule.  In this example default Hamann pseudopotentials
are used for Na and Cl, the exchange correlation functional is LSDA, and
the cutoff energy is 12 au.  This example input deck can be found in the nwchem
source tree in the file: nwchem/examples/pspw/NaCl.nw
\begin{enumerate}
\item Define the ion positions using the geometry directive.
 \tiny     \begin{verbatim}
         ...
         geometry units au 
         Na    2.23 0.0 0.0
         Cl   -2.23 0.0 0.0
         end
         ...
      \end{verbatim}
\normalsize
\item Generate a pseudopotential for Sodium atoms and store it in a
      one-dimensional pseudopotential datafile called Na.psp.  
      The following input can be used to generate a default
      Hamann pseudopotential.  
 \tiny     \begin{verbatim}
         ...
         PSPW
            PSP_GENERATOR
               pseudopotential_filename: Na.psp
                element: Na
                charge: 11.0
                mass_number: 23.0
                solver_type: pauli
                pseudopotential_type: hamann
                atomic_filling: 3 1
                  1 s 2.0
                  2 s 2.0
                  2 p 6.0
                  3 s 1.0
            END
         END
         task PSPW PSP_GENERATOR
         ...
      \end{verbatim}
\normalsize
\item Use the same proceedure as above generate a pseudopotential 
      for Chlorine. 
 \tiny     \begin{verbatim}
         ...
         PSPW 
            PSP_GENERATOR
               pseudopotential_filename: Cl.psp
               element: Cl
               charge: 17.0
               mass_number: 35.0
               solver_type: pauli
               pseudopotential_type: hamann
               atomic_filling: 3 2
                  1 s 2.0
                  2 s 2.0
                  2 p 6.0
                  3 s 2.0
                  3 p 5.0
            
            END
         END
         task PSPW PSP_GENERATOR
         ...
      \end{verbatim}
\normalsize

\item Define the simulation cell.  
      The following input defines a simulation cell called ``small.'' This
      cell is periodic and cubic with a side length of 20.0 au and has
      32 grid points in each direction.  
\tiny   \begin{verbatim}
         ...
         PSPW
            SIMULATION_CELL
               cell_name: small
               boundry_conditions: periodic
               lattice_vectors:
                  20.0  0.0  0.0 
                   0.0 20.0  0.0 
                   0.0  0.0 20.0 
               ngrid: 32 32 32
            END
         END
         ...
   \end{verbatim}
\normalsize
\item Format the Na pseudopotential onto the ``small'' simulation cell.
\tiny   \begin{verbatim}
         ...
         PSPW
            PSP_FORMATTER
               cell_name: small
               psp_name: Na.psp
               formatted_name: Na.vpp
            END
         END
         task PSPW PSP_FORMATTER
         ...
   \end{verbatim}
\normalsize
\item Format the Cl pseudopotential onto the ``small'' simulation cell.
\tiny   \begin{verbatim}
         ...
         PSPW
            PSP_FORMATTER
               cell_name: small
               psp_name: Cl.psp
               formatted_name: Cl.vpp
            END
         END
         task PSPW PSP_FORMATTER
         ...
   \end{verbatim}
\normalsize
\item Generate an initial guess for the one-electron orbitals.
\tiny   \begin{verbatim}
         ...
         PSPW
            WAVEFUNCTION_INITIALIZER
               cell_name: small
               unrestricted
               up_filling: 4
                  0 0 0   0 
                  1 0 0  -1
                  0 1 0  -1
                  0 0 1  -1
               down_filling: 4
                  0 0 0   0
                  1 0 0  -1
                  0 1 0  -1
                  0 0 1  -1
               wavefunction_filename: NaCl.small.00.elc
            END
         END
         task PSPW WAVEFUNCTION_INTITALIZER
         ...
   \end{verbatim}
\normalsize
\item Optimize the one-electron orbitals with respect to energy using
      steepest descent.
\tiny \begin{verbatim}
         ...
         PSPW
            STEEPEST_DESCENT
               cell_name: small
               formatted_filename: Na.vpp
               formatted_filename: Cl.vpp
               input_wavefunction_filename:  NaCl.small.00.elc
               output_wavefunction_filename: NaCl.small.00.elc
               fake_mass: 400000.0d0
               time_step: 51.8d0
               loop: 100 10
               tolerances: 1.0d-9 1.0d-9 1.0d-4
               energy_cutoff:       21.0d0
               wavefunction_cutoff: 21.0d0
            END 
         END
         task PSPW STEEPEST_DESCENT
         ...
      \end{verbatim}


\end{enumerate}
\normalsize


\normalsize
\section{Running a Car-Parrinello Simulation}
\label{sec:pspw_cp}

In this section we show how to perform a Car-Parrinello
molecular dynamic simulation for an NaCl molecule.  As with the example in 
the steepest descent tutorial,  this example uses default Hamann 
pseudopotentials for Na and Cl, LSDA exchange 
correlation functional, and a cutoff energy of 12 au.

Before running a PSPW Car-Parrinello  simulation the system should be
on the Born-Oppenheimer surface, i.e. the one-electron
orbitals should be minimized with respect to the total energy using steepest
descent(see section~\ref{sec:pspw_sd}).  

Continuning where we left off in section ~\ref{sec:pspw_sd} we now 
continue the simulation to run a MD simulation of an NaCl molecule.  
This example input deck can be found in the nwchem source tree in 
the file: nwchem/examples/pspw/NaCl-md.nw

\begin{enumerate}
\item Optimize wavefunctions - See previous section

\normalsize
\item Generate an initial guess for the one-electron orbitals velocities.
\tiny   \begin{verbatim}
         ...
         PSPW
            V_WAVEFUNCTION_INITIALIZER
               cell_name: small
               unrestricted
               up_filling: 4
               down_filling: 4
               v_wavefunction_filename: NaCl.small.00.velc
            END
         END
         task PSPW WAVEFUNCTION_INTITALIZER
         ...
   \end{verbatim}
\normalsize
\item Run an MD simulation using Car-Parrinello.
\tiny \begin{verbatim}
         PSPW
            Car-Parrinello
               cell_name: small
               formatted_filename: Na.vpp
               formatted_filename: Cl.vpp
               input_wavefunction_filename:    NaCl.small.00.elc
               output_wavefunction_filename:   NaCl.small.01.elc
               v_input_wavefunction_filename:  NaCl.00.velc
               v_output_wavefunction_filename: NaCl.01.velc
               fake_mass: 800.0d0
               time_step: 5.0d0
               loop: 10 100
               scaling: 1.0d0 1.0d0
               energy_cutoff:       21.0d0
               wavefunction_cutoff: 21.0d0
            END 
         END
         task PSPW Car-Parrinello
         ...
      \end{verbatim}


\end{enumerate}
\normalsize


\section{PSPW Capabilities and Limitations}
\label{sec:pspw_limits}



\section{Questions and Difficulties}

Questions and encountered problems should be reported to 
Eric J. Bylaska, eric.bylaska@pnl.gov




