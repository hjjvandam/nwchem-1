%
% $Id: pspw.tex,v 1.42 2006-09-28 19:48:08 bylaska Exp $
%
\label{sec:pspw}

\newcounter{algcounter}[chapter]
\def\thealgcounter{\thechapter.\arabic{algcounter}}
\newenvironment{algorithm}[1]
               { \refstepcounter{algcounter}
                \begin{center}
                  {\bf Algorithm} \thealgcounter: #1
                \end{center}
               \begin{center}\begin{enumerate} \begin{em}}
               {\end{em}\end{enumerate}\end{center}}
 

The NWChem plane-wave (NWPW) module uses pseudopotentials and
plane-wave basis sets to perform Density Functional Theory
calculations.  This module complements the capabilities of the more
traditional Gaussian function based approaches by having an accuracy at least as good 
for many applications, yet is still fast enough to treat systems containing hundreds of
atoms.  Another significant advantage is its ability to simulate
dynamics on a ground state potential surface directly at run-time
using the Car-Parrinello algorithm.  This method's efficiency and
accuracy make it a desirable first principles method of simulation in
the study of complex molecular, liquid, and solid state systems.
Applications for this first principles method include the calculation
of free energies, search for global minima, explicit simulation of
solvated molecules, and simulations of complex vibrational modes that
cannot be described within the harmonic  approximation.

The NWPW module is a collection of three modules.
\begin{itemize}
   \item PSPW - (PSeudopotential Plane-Wave) A gamma point code for
     calculating molecules, liquids, crystals, and  surfaces.  
   \item Band - A band structure code for calculating
     crystals and surfaces with small band gaps (e.g. semi-conductors
     and metals).
   \item PAW - a (gamma point) projector augmented plane-wave code
     for calculating molecules, crystals, and surfaces 
\end{itemize}
The PSPW, Band, and PAW modules can be used to compute the energy and  optimize the
geometry.  Both the PSPW and Band modules can also be used to find saddle points, and 
compute numerical second derivatives.  In addition the PSPW module can also be used 
to perform Car-Parrinello molecular  dynamics.

Section \ref{sec:pspw_tasks} describes the tasks contained within the
PSPW module, section \ref{sec:band_tasks} describes the tasks
contained within the Band module, section \ref{sec:paw_tasks} describes
the tasks contained within the PAW module, and section \ref{sec:psp_library}
describes the pseudopotential library included with NWChem.  The
datafiles used by the PSPW module are described in section
\ref{sec:pspw_data}.  Car-Parrinello output data files are described
in section \ref{sec:pspw_cp_data}, and the minimization and
Car-Parrinello algorithms are described in 
% sections \ref{sec:pspw_Minimize}-\ref{sec:pspw_Car-Parrinello}. 
section \ref{sec:pspw_Car-Parrinello}. 
Examples of how
to setup and run a PSPW geometry optimization, a Car-Parrinello
simulation, a band structure minimization, and a PAW geometry
optimization are presented in sections \ref{sec:pspw_sd}, \ref{sec:pspw_cp}, and
\ref{sec:band_tutorial1}, and \ref{sec:paw_tutorial}.  
Finally in section \ref{sec:pspw_limits} the capabilities and limitations of the NWPW module are  discussed.

If you are a first time user of this module it is recommended that you skip the next five sections and proceed directly to the tutorials in sections 
\ref{sec:pspw_sd}-\ref{sec:paw_tutorial}.

\section{PSPW Tasks}
\label{sec:pspw_tasks}

All input to the PSPW Tasks is contained within the compound PSPW block,
\begin{verbatim}
PSPW
   ...
END
\end{verbatim}

To perform an actual calculation a TASK PSPW directive is used
(Section \ref{sec:task}).  
\begin{verbatim}
  TASK PSPW
\end{verbatim} 
In addition to the directives listed in Section \ref{sec:task}, i.e.
\begin{verbatim}
TASK pspw energy          
TASK pspw gradient         
TASK pspw optimize         
TASK pspw saddle           
TASK pspw freqencies       
TASK pspw vib
\end{verbatim}
there are additional directives that are specific to the PSPW module, which are:
\begin{verbatim}
TASK PSPW [Car-Parrinello             ||
           pspw_dplot                 ||
           wannier                    ||
           psp_generator              ||
           steepest_descent           ||
           psp_formatter              ||
           wavefunction_initializer   ||
           v_wavefunction_initializer ||
           wavefunction_expander       ]
\end{verbatim}


Once a user has specified a geometry, the PSPW module can be invoked
with no input  directives (defaults invoked throughout).  However, the
user will probably always specify the  simulation cell used in the
computation, since the default simulation cell is not well suited for
most systems.  There are sub-directives which allow for customized
application; those currently provided as options for the PSPW module are:
\begin{verbatim}
PSPW
  CELL_NAME <string cell_name default 'cell_default'>
  INPUT_WAVEFUNCTION_FILENAME  <string input_wavefunctions  default input_movecs>
  OUTPUT_WAVEFUNCTION_FILENAME <string output_wavefunctions default input_movecs>
  FAKE_MASS <real fake_mass default 400000.0>
  TIME_STEP <real time_step default 5.8>
  LOOP <integer inner_iteration outer_iteration default 10 100>
  TOLERANCES <real tole tolc default 1.0e-7 1.0e-7>
  ENERGY_CUTOFF       <real ecut default (see input description)>
  WAVEFUNCTION_CUTOFF <real wcut default (see input description)>
  EWALD_NCUT <integer ncut default 1>]
  EWALD_RCUT <real rcut default (see input description)>
  XC (Vosko || LDA || PBE96 || revPBE || HF || PBE0 || revPBE0 || 
     LDA-SIC    || LDA-SIC/2    ||  LDA-0.4SIC    || LDA-SIC/4    || LDA-0.2SIC ||
     PBE96-SIC  || PBE96-SIC/2  ||  PBE96-0.4SIC  || PBE96-SIC/4  || PBE96-0.2SIC ||
     revPBE-SIC || revPBE-SIC/2 ||  revPBE-0.4SIC || revPBE-SIC/4 || revPBE-0.2SIC ||
     default Vosko)
  DFT||ODFT||RESTRICTED||UNRESTRICTED
  MULT <integer mult default 1>
  MULLIKEN
  EFIELD
  ALLOW_TRANSLATION

  SIMULATION_CELL            ... (see input description) END
  DPLOT                      ... (see input description) END
  WANNIER                    ... (see input description) END
  CAR-PARRINELLO             ... (see input description) END
  PSP_GENERATOR              ... (see input description) END
  WAVEFUNCTION_INITIALIZER   ... (see input description) END
  V_WAVEFUNCTION_INITIATIZER ... (see input description) END
  WAVEFUNCTION_EXPANDER      ... (see input description) END
  STEEPEST_DESCENT           ... (see input description) END

  MAPPING <integer mapping default 1>

  ROTATION (ON || OFF)
  TRANSLATION (ON || OFF)

END 
\end{verbatim}

The following list describes the keywords contained in the PSPW input block.
\begin{itemize}
        \item $<$cell\_name$>$ - name of
              the simulation\_cell named $<$cell\_name$>$.  See section \ref{sec:pspw_cell}.
        \item $<$input\_wavefunctions$>$ - name of the
              file containing one-electron orbitals
        \item $<$output\_wavefunctions$>$ - name of the
              file that will contain the one-electron orbitals at the
              end of the run. 
        \item $<$fake\_mass$>$ - value for the electronic
              fake mass ($\mu$). This parameter is not presently used in a 
              conjugate gradient simulation
        \item $<$time\_step$>$ - value for the time step ($\Delta t$).  This
              parameter is not presently used in a conjugate gradient simulation.
        \item $<$inner\_iteration$>$ - number of iterations between the 
              printing out of energies and tolerances
        \item $<$outer\_iteration$>$ - number of outer iterations
        \item $<$tole$>$ - value for the energy tolerance.
        \item $<$tolc$>$ - value for the one-electron orbital tolerance.
        \item $<$edit$>$ - value for the cutoff energy used
                           to define the density. Default is set
                           to be the maximum value that will fit
                           within the simulation\_cell $<$cell\_name$>$.
        \item $<$wcut$>$ - value for the cutoff energy used
                           to define the one-electron orbitals.
                           Default is set to be the maximum value that 
                           will fit within the simulation\_cell $<$cell\_name$>$.
        \item $<$ncut$>$ - value for the number of unit cells
                          to sum over (in each direction) for the real space
                          part of the Ewald summation. Note Ewald summation
                          is only used if the simulation\_cell is periodic.
        \item $<$rcut$>$ - value for the cutoff radius used
                          in the Ewald summation. Note Ewald summation
                          is only used if the simulation\_cell is periodic. \\
                           Default set to be
                          $\frac{MIN(\left| \vec{a_i} \right|)}{\pi}, i=1,2,3$.
        \item (Vosko $||$ PBE96 $||$ revPBE $||$ ...) - Choose between Vosko et al's LDA 
                               parameterization or the orginal and revised Perdew, Burke, 
                               and Ernzerhof GGA functional.  In addition, several hybrid options.
        \item MULT - optional keyword which if specified allows the user to define the spin multiplicity
                     of the system
        \item MULLIKEN - optional keyword which if specified
                         causes a Mulliken analysis to be performed at
                         the end of the simulation.  
        \item ALLOW\_TRANSLATION - By default the the center of mass forces are projected out of the 
                                  computed forces. This optional keyword if specified allows the 
                                  center of mass forces to not be zero.

        \item SIMULATION\_CELL (see section \ref{sec:pspw_cell})
        \item DPLOT (see section \ref{sec:pspw_dplot})
        \item WANNIER (see section \ref{sec:pspw_wannier})
        \item CAR-PARRINELLO(see section \ref{sec:pspw_CP})
        \item PSP\_GENERATOR (see section \ref{sec:pspw_psp_generator})
        \item WAVEFUNCTION\_INITIALIZER (see section \ref{sec:pspw_wavefunction_initializer})
        \item V\_WAVEFUNCTION\_INITIALIZER (see section \ref{sec:pspw_v_wavefunction_initializer})
        \item WAVEFUNCTION\_EXPANDER (see section \ref{sec:pspw_wavefunction_expander}).
        \item STEEPEST\_DESCENT (see section \ref{sec:pspw_steepest_descent})

        \item $<$mapping$>$ - for a value of 1 slab FFT is used, for a value of 2 a 2d-hilbert FFT is used.
\end{itemize}

A prototype limited memory BFGS (LMBFGS) minimizer can be used to minimize the energy.  To
use this new optimizer the following SET directive needs to be specified:
\begin{verbatim}
set nwpw:mimimizer 1  # Default - Grassman conjugate gradient minimizer is used to minimize the energy.
set nwpw:mimimizer 2  # Grassman LMBFGS minimimzer is used to minimize the energy.
set nwpw:minimizer 4  # Stiefel conjugate gradient minimizer is used to minimize the energy. 
set nwpw:minimizer 5  # Band-by-band minimizer is used to minimize the energy.
\end{verbatim}
Limited testing suggests that the Grassman LMBFGS minimizer is about twice as fast as
the conjugate gradient minimizer.  However, there are several known cases
where this optimizer fails, so it is currently not a default option, and
should be used with caution.

In addition the following SET directives can be specified:
\begin{verbatim}
set nwpw:lcao_skip .false. # Default - initial wavefunctions generated using an LCAO guess. 
set nwpw:lcao_skip .true.  # Initial wavefunctions generated using a random plane-wave guess.

set nwpw:lcao_print .false. # Default - Ouput not produced during the generation of the LCAO guess. 
set nwpw:lcao_print .true.  # Output produced during the generation of the LCAO guess.

set nwpw:lcao_iterations 2  #specifies the number of LCAO iterations 
\end{verbatim}


\subsection{Simulation Cell}
\label{sec:pspw_cell}
The  simulation cell parameters
are entered by  defining a simulation\_cell sub-block within the PSPW 
block.  Listed below is the format of a simulation\_cell sub-block.
\begin{verbatim}
PSPW
...
   SIMULATION_CELL
      CELL_NAME <string name default 'cell_default'>
      BOUNDARY_CONDITIONS (periodic || aperiodic default periodic)
      LATTICE_VECTORS
        <real a1.x a1.y a1.z default 20.0  0.0  0.0>
        <real a2.x a2.y a2.z default  0.0 20.0  0.0>
        <real a3.x a3.y a3.z default  0.0  0.0 20.0>
      NGRID <integer na1 na2 na3 default 32 32 32>
   END
...
END
\end{verbatim}
Basically, the user needs to enter the dimensions, gridding and boundary
conditions of the simulation cell.  The following list describes the 
input in detail.
\begin{itemize}
        \item $<$name$>$ - user-supplied name for the simulation block.
        \item periodic - keyword specifying that the simulation cell 
                         has periodic boundary conditions.      
        \item aperiodic - keyword specifying that the simulation cell
                          has free-space boundary conditions. 
        \item $<$a1.x a1.y a1.z$>$ - user-supplied values for the first 
                                   lattice vector 
        \item $<$a2.x a2.y a2.z$>$ - user-supplied values for the second 
                                   lattice vector
        \item $<$a3.x a3.y a3.z$>$ - user-supplied values for the third 
                                   lattice vector
        \item $<$na1 na2 na3$>$ - user-supplied values for discretization 
                                along lattice vector directions.
\end{itemize}

Alternatively, instead of explicitly entering lattice vectors, users can
enter the unit cell using the standard cell parameters, a, b, c, $\alpha$, 
$\beta$, and $\gamma$, by using the LATTICE block.  The format for input
is as follows:
\begin{verbatim}
PSPW
...
   SIMULATION_CELL
      ...
      LATTICE
        [lat_a <real a default 20.0>]
        [lat_b <real b default 20.0>]
        [lat_c <real c default 20.0>]
        [alpha <real alpha default 90.0>]
        [beta  <real beta  default 90.0>]
        [gamma <real gamma default 90.0>]
      END
      ...
   END
...
END
\end{verbatim}


The user can also enter the lattice vectors of standard unit cells using the
keywords SC, FCC, BCC, for simple cubic, face-centered cubic, and body-centered cubic
respectively.  Listed below is an example of the format of this type of input.
\begin{verbatim}
PSPW
...
   SIMULATION_CELL
      SC 20.0
      ....
   END
...
END
\end{verbatim}

Finally, the lattice vectors from the unit cell can also be defined using
the fractional coordinate input in the GEOMETRY input (see section \ref{sec:latticeparam}).   
Listed below is an example of the format of this type of input for an 8 atom silicon carbide unit cell.
\begin{verbatim}
geometry units au 
  system crystal
    lat_a 8.277d0
    lat_b 8.277d0
    lat_c 8.277d0
    alpha 90.0d0
    beta  90.0d0
    gamma 90.0d0
  end
Si    -0.50000d0  -0.50000d0  -0.50000d0
Si     0.00000d0   0.00000d0  -0.50000d0
Si     0.00000d0  -0.50000d0   0.00000d0
Si    -0.50000d0   0.00000d0   0.00000d0
C     -0.25000d0  -0.25000d0  -0.25000d0
C      0.25000d0   0.25000d0  -0.25000d0
C      0.25000d0  -0.25000d0   0.25000d0
C     -0.25000d0   0.25000d0   0.25000d0
end
\end{verbatim}



\subsection{\tt Unit Cell Optimization}
\label{sec:pspw_cell_optimization}

The PSPW module using the DRIVER geometry optimizer can optimize a crystal unit cell.
Currently this type of optimization works only if the geometry is specified in fractional
coordinates.  The following SET directive is used to tell the DRIVER geometry optimizer to
optimize the crystal unit cell in addition to the geometry.
\begin{verbatim}
set includestress .true.
\end{verbatim}

\normalsize
\subsection{\tt DPLOT}
\label{sec:pspw_dplot}
The pspw dplot task is used to generate plots of various types of electron
densities (or orbitals) of a molecule.  The electron density is calculated on the 
specified set of grid points from a PSPW calculation.  The output file
generated is in the Gaussian Cube format.
Input to the DPLOT task is contained
within the DPLOT sub-block.
\begin{verbatim}
PSPW
  ...
  DPLOT
     ...
  END
  ...
END
\end{verbatim}
To run a DPLOT calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW PSPW_DPLOT
\end{verbatim}
Listed below is the format of a DPLOT sub-block.
\begin{verbatim}
PSPW
... 
   DPLOT
     VECTORS <string input_wavefunctions  default input_movecs>
     DENSITY [total||difference||alpha||beta||laplacian||potential default total] <string density_name no default>
     ELF [restricted|alpha|beta] <string elf_name no default>
     ORBITAL <integer orbital_number no default> <string orbital_name no default>


     [LIMITXYZ [units <string Units default angstroms>]
     <real X_From> <real X_To> <integer No_Of_Spacings_X>
     <real Y_From> <real Y_To> <integer No_Of_Spacings_Y>
     <real Z_From> <real Z_To> <integer No_Of_Spacings_Z>]

   END

...
END
\end{verbatim}

The following list describes the input for the DPLOT
sub-block.

\begin{verbatim}
     VECTORS <string input_wavefunctions  default input_movecs>  
\end{verbatim}
 This sub-directive specifies the name of the molecular orbital file. If the second file is optionally given the density is computed as the difference between the corresponding electron densities. The vector files have to match. 

\begin{verbatim}
     DENSITY [total||difference||alpha||beta||laplacian||potential default total] <string density_name no default>
\end{verbatim}
This sub-directive specifies, what kind of density is to be plotted. The known names for total, difference, alpha, beta, laplacian, and potential. 

\begin{verbatim}
     ELF [restricted|alpha|beta] <string elf_name no default>
\end{verbatim}
This sub-directive specifies that an electron localization function (ELF) is to be plotted.

\begin{verbatim}
     ORBITAL <integer orbital_number no default> <string orbital_name no default>
\end{verbatim}
This sub-directive specifies the molecular orbital number that is to be plotted.

\begin{verbatim}
     LIMITXYZ [units <string Units default angstroms>]
     <real X_From> <real X_To> <integer No_Of_Spacings_X>
     <real Y_From> <real Y_To> <integer No_Of_Spacings_Y>
     <real Z_From> <real Z_To> <integer No_Of_Spacings_Z>
\end{verbatim}
By default the grid spacing and the limits of the cell to be plotted are defined by the input wavefunctions.  Alternatively the user can use the LIMITXYZ sub-directive to specify other limits.   The grid is generated using No\_Of\_Spacings + 1 points along each direction. The known names for Units are angstroms, au and bohr. 



\subsection{\tt Wannier}
\label{sec:pspw_wannier}
The pspw wannier task is generate maximally localized (Wannier) molecular orbitals.  The
algorithm proposed by Silvestrelli et al is use to generate the Wannier orbitals.  The
current version of this code works only for cubic cells. 


Input to the Wannier task is contained within the Wannier sub-block.
\begin{verbatim}
PSPW
  ...
  Wannier
     ...
  END
  ...
END
\end{verbatim}
To run a Wannier calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW Wannier
\end{verbatim}
Listed below is the format of a Wannier sub-block.
\begin{verbatim}
PSPW
... 
   Wannier
     OLD_WAVEFUNCTION_FILENAME <string input_wavefunctions  default input_movecs>  
     NEW_WAVEFUNCTION_FILENAME <string output_wavefunctions default input_movecs>
   END
...
END
\end{verbatim}
The following list describes the input for the Wannier
sub-block.
\begin{itemize}
        \item $<$input\_wavefunctions$>$ - name of pspw wavefunction file.
        \item $<$output\_wavefunctions$>$ - name of pspw wavefunction file that
              will contain the Wannier orbitals. 
\end{itemize}



\subsection{\tt Self-Interaction Corrections}
\label{sec:pspw_SIC}

The SET directive is used to specify the molecular orbitals 
contribute to the self-interaction-correction (SIC) term.
\begin{verbatim}
set pspw:SIC_orbitals  <integer list_of_molecular_orbital_numbers>
\end{verbatim}
This defines only the molecular orbitals in the list as SIC active.  All
other molecular orbitals will not contribute to the SIC term.

For example the following directive specifies that the molecular orbitals numbered
1,5,6,7,8, and 15 are SIC active.
\begin{verbatim}
set pspw:SIC_orbitals  1 5:8 15
\end{verbatim}
or equivalently
\begin{verbatim}
set pspw:SIC_orbitals  1 5 6 7 8 15
\end{verbatim}

The following directive turns on self-consistent SIC.
\begin{verbatim}
set pspw:SIC_relax      .false.  # Default - Perturbative SIC calculation
set pspw:SIC_relax      .true.   # Self-consistent SIC calculation
\end{verbatim}

Two types of solvers can be used and they are specified using the following
SET directive
\begin{verbatim}
set pspw:SIC_solver_type 1  # Default - cutoff coulomb kernel
set pspw:SIC_solver_type 2  # Free-space boundary condition kernel
\end{verbatim}
The parameters for the cutoff coulomb kernel are defined by the following
SET directives:
\begin{verbatim}
set pspw:SIC_screening_radius <real rcut>
set pspw:SIC_screening_power  <real rpower>
\end{verbatim}



\subsection{\tt Point Charge Analysis}
\label{sec:pspw_point_charge_analysis}

The MULLIKEN option can be used to generate derived atomic point charges
from a plane-wave density.  This analysis is based on a strategy suggested in the work of
P.E. Blochl, J. Chem. Phys. vol. 103, page 7422 (1995).  In this strategy
the low-frequency components a plane-wave density are fit to a linear
combination of atom centered Gaussian functions.

The following SET directives are used to define the fitting.
\begin{verbatim}
set pspw_APC:Gc <real Gc_cutoff>  # specifies the maximum frequency component of the density to be used in the fitting in units of au.

set pspw_APC:nga <integer number_gauss> # specifies the the number of Gaussian functions per
atom.

set pspw_APC:gamma <real gamma_list> # specifies the decay lengths of each atom centered Gaussian. 
\end{verbatim}

We suggest using the following parameters.
\begin{verbatim}
set pspw_APC:Gc 2.5
set pspw_APC:nga 3
set pspw_APC:gamma 0.6 0.9 1.35 
\end{verbatim}


\subsection{\tt Car-Parrinello}
\label{sec:pspw_CP}
The Car-Parrinello task is used to perform ab initio molecular dynamics
using the scheme developed by Car and Parrinello.  In this unified ab
initio molecular dynamics scheme the motion of the ion cores is coupled to
a fictitious motion for the Kohn-Sham orbitals of density functional
theory.  Constant energy or constant temperature simulations can be
performed.  A detailed description of this method
is described in section \ref{sec:pspw_Car-Parrinello}.

Input to the Car-Parrinello simulation is contained within the
Car-Parrinello sub-block.
\begin{verbatim}
PSPW
  ...
  Car-Parrinello
     ...
  END
  ...
END
\end{verbatim}
To run a Car-Parrinello calculation the following directive is used:
\begin{verbatim}
TASK PSPW Car-Parrinello 
\end{verbatim}
The Car-Parrinello sub-block contains a great deal
of input, including pointers to data, as well as
parameter input.  Listed below is the format of a Car-Parrinello sub-block.
\begin{verbatim}
PSPW
...
   Car-Parrinello
      CELL_NAME <string cell_name default 'cell_default'>
      INPUT_WAVEFUNCTION_FILENAME    <string input_wavefunctions    default input_movecs>
      OUTPUT_WAVEFUNCTION_FILENAME   <string output_wavefunctions   default input_movecs>
      INPUT_V_WAVEFUNCTION_FILENAME  <string input_v_wavefunctions  default input_vmovecs>
      OUTPUT_V_WAVEFUNCTION_FILENAME <string output_v_wavefunctions default input_vmovecs>
      FAKE_MASS <real fake_mass default default 1000.0>
      TIME_STEP <real time_step default 5.0>
      LOOP <integer inner_iteration outer_iteration default 10 1>
      SCALING <real scale_c scale_r default 1.0 1.0>
      ENERGY_CUTOFF       <real ecut default (see input description)>
      WAVEFUNCTION_CUTOFF <real wcut default (see input description)>
      EWALD_NCUT <integer ncut default 1>
      EWALD_RCUT <real rcut    default (see input description)>
      XC (Vosko || LDA || PBE96 || revPBE || HF || PBE0 || revPBE0 || 
          LDA-SIC    || LDA-SIC/2    ||  LDA-0.4SIC    || LDA-SIC/4    || LDA-0.2SIC ||
          PBE96-SIC  || PBE96-SIC/2  ||  PBE96-0.4SIC  || PBE96-SIC/4  || PBE96-0.2SIC ||
          revPBE-SIC || revPBE-SIC/2 ||  revPBE-0.4SIC || revPBE-SIC/4 || revPBE-0.2SIC ||
          default Vosko)
      [Nose-Hoover <real Period_electron Temperature_electrion Period_ion Temperature_ion 
                          default 100.0 298.15 100.0 298.15>]
      [SA_decay <real sa_scale_c sa_scale_r default 1.0 1.0>]
      XYZ_FILENAME <string xyz_filename default XYZ>
      EMOTION_FILENAME <string emotion_filename default EMOTION>
      HMOTION_FILENAME <string hmotion_filename default HMOTION>
      OMOTION_FILENAME <string omotion_filename default OMOTION>
      EIGMOTION_FILENAME <string eigmotion_filename default EIGMOTION>
      ION_MOTION_FILENAME <string ion_motion_filename default MOTION>

   END
...

END
\end{verbatim}
The following list describes the input for the Car-Parrinello
sub-block.
\begin{itemize}
        \item $<$cell\_name$>$ - name of the
              the simulation\_cell named $<$cell\_name$>$.  See section \ref{sec:pspw_cell}.
        \item $<$input\_wavefunctions$>$ - name of the 
              file containing one-electron orbitals
        \item $<$output\_wavefunctions$>$ - name of the
              file that will contain the one-electron orbitals at the
              end of the run. 
        \item $<$input\_v\_wavefunctions$>$ - name of the file
              containing one-electron orbital velocities.
        \item $<$output\_v\_wavefunctions$>$ - name of the
              file that will contain the one-electron orbital velocities
              at the end of the run. 
        \item $<$fake\_mass$>$ - value for the electronic
              fake mass ($\mu$).
        \item $<$time\_step$>$ - value for the Verlet integration 
               time step ($\Delta t$).
        \item $<$inner\_iteration$>$ - number of iterations between the
              printing out of energies.
        \item $<$outer\_iteration$>$ - number of outer iterations
        \item $<$scale\_c$>$ - value for the initial velocity
                              scaling of the one-electron orbital velocities.
        \item $<$scale\_r$>$ - value for the initial velocity
                              scaling of the ion velocities.
        \item $<$ecut$>$ - value for the cutoff energy used
                           to define the density.  Default is set
                           to be the maximum value that will fit
                           within the simulation\_cell $<$cell\_name$>$.
        \item $<$wcut$>$ - value for the cutoff energy used
                           to define the one-electron orbitals.  Default is set
                           to be the maximum value that will fit
                           within the simulation\_cell $<$cell\_name$>$.
        \item $<$ncut$>$ - value for the number of unit cells
                          to sum over (in each direction) for the real space
                          part of the Ewald summation. Note Ewald summation
                          is only used if the simulation\_cell is periodic.
        \item $<$rcut$>$ - value for the cutoff radius used
                          in the Ewald summation.  Note Ewald summation
                          is only used if the simulation\_cell is periodic. \\
                          Default set to be
                          $\frac{MIN(\left| \vec{a_i} \right|)}{\pi}, i=1,2,3$.
        \item (Vosko $||$ PBE96 $||$ revPBE $||$ ...) - Choose between Vosko et al's LDA 
                               parameterization or the orginal and revised Perdew, Burke, 
                               and Ernzerhof GGA functional.  In addition, several hybrid options.
        \item Nose-Hoover - optional subblock which if specified
                         causes the simulation to perform Nose-Hoover dynamics.
                         If this subblock is not specified the 
                         simulation performs constant energy dynamics.
                         See section \ref{sec:pspw_nose} for a description of the parameters.
                         \begin{itemize}
                             \item $<$Period\_electron$>$ $\equiv$ $P_{electron}$ 
                                    - estimated period for fictitious electron thermostat.
                             \item $<$Temperature\_electron$>$ $\equiv$ $T_{electron}$ 
                                    - temperature for fictitious electron motion
                             \item $<$Period\_ion$>$ $\equiv$ $P_{ion}$ 
                                    - estimated period for ionic thermostat
                             \item $<$Temperature\_ion$>$ $\equiv$ $T_{ion}$ 
                                    - temperature for ion motion
                         \end{itemize}
        \item SA\_decay - optional subblock which if specified
                         causes the simulation to run a simulated annealing simulation.
                         For simulated annealing to work the Nose-Hoover subblock needs 
                         to be specified.  The initial temperature are taken from the
                         Nose-Hoover subblock.
                         See section \ref{sec:pspw_nose} for a description of the parameters.
                         \begin{itemize}
                             \item $<$sa\_scale\_c$>$ $\equiv$ $\tau_{electron}$ 
                                    - decay rate in atomic units for electronic temperature.
                             \item $<$sa\_scale\_r$>$ $\equiv$ $\tau_{ionic}$ 
                                    - decay rate in atomic units for the ionic temperature.
                         \end{itemize}

        \item $<$xyz\_filename$>$ - name of the XYZ motion file
                                generated
        \item $<$emotion\_filename$>$ - name of the emotion motion file.
                                See section \ref{sec:pspw_cp_data} for a 
                                description of the datafile.
        \item $<$hmotion\_filename$>$ - name of the hmotion motion file.
                                See section \ref{sec:pspw_cp_data} for a 
                                description of the datafile.
        \item $<$eigmotion\_filename$>$ - name of the eigmotion motion file.
                                See section \ref{sec:pspw_cp_data} for a 
                                description of the datafile.
       \item $<$ion\_motion\_filename$>$ - name of the ion\_motion motion file.
                                See section \ref{sec:pspw_cp_data} for a 
                                description of the datafile.
       \item MULLIKEN - optional keyword which if specified causes an omotion motion file to be created. 
        \item $<$omotion\_filename$>$ - name of the omotion motion file.
                                See section \ref{sec:pspw_cp_data} for a 
                                description of the datafile.
\end{itemize}

When a DPLOT sub-block is specified the following SET directive can be used 
to output dplot data during a Car-Parrinello simulation:
\begin{verbatim}
set pspw_dplot:iteration_list <integer list_of_iteration_numbers>
\end{verbatim}
The Gaussian cube files specified in the DPLOT sub-block are appended
with the specified iteration number. 

For example, the following directive specifies that at the 
3,10,11,12,13,14,15, and 50 iterations Gaussian cube files are to be produced.

\begin{verbatim}
set pspw_dplot:iteration_list 3,10:15,50
\end{verbatim}

\subsection{\tt Adding Geometry Constraints To A Car-Parrinello Simulation}
\label{sec:pspw_CP_constraint}
The Car-Parrinello module allows users to freeze the cartesian coordinates 
in a simulation (Note - the Car-Parrinello code recognizes Cartesian
constraints, but it does not recognize internal coordinate constraints).  
The \verb+SET+ directive (Section \ref{sec:activeatoms}) is used to freeze
atoms, by specifying a directive of the form:
\begin{verbatim}
  set geometry:actlist <integer list_of_center_numbers>
\end{verbatim}
This defines only the centers in the list as active.  All other
centers will have zero force assigned to them, and will remain frozen
at their starting coordinates during a Car-Parrinello simulation.

For example, the following directive specifies that atoms numbered 1,
5, 6, 7, 8, and 15 are active and all other atoms are frozen:
\begin{verbatim}
  set geometry:actlist 1 5:8 15
\end{verbatim}
or equivalently,
\begin{verbatim}
  set geometry:actlist 1 5 6 7 8 15
\end{verbatim}

If this option is not specified by entering a \verb+SET+ directive,
the default behavior in the code is to treat all atoms as active.  To
revert to this default behavior after the option to define frozen
atoms has been invoked, the \verb+UNSET+ directive must be used (since
the database is persistent, see Section \ref{sec:persist}).  The form
of the \verb+UNSET+ directive is as follows:
\begin{verbatim}
  unset geometry:actlist
\end{verbatim}


In addition, the Car-Parrinello module allows users to freeze bond
lengths via a Shake algorithm.  The following \verb+SET+ directive 
shows how to do this.
\begin{verbatim}
  set nwpw:shake_constraint "2 6 L 6.9334"
\end{verbatim}
This input fixes the bond length between atoms 2 and 6 to be
6.9334 bohrs.  Note that this input only recognizes bohrs.  

When using constraints it is usually necessary to turn off
center of mass shifting. This can be done by the following \verb+SET+ directive.
\begin{verbatim}
  set nwpw:com_shift .false.
\end{verbatim}



\subsection{\tt PSP\_GENERATOR}
\label{sec:pspw_psp_generator}
A one-dimensional pseudopotential code has been integrated into NWChem.
This code allows the user to modify and develop pseudopotentials.  Currently, 
only the Hamann and Troullier-Martins norm-conserving pseudopotentials can be
generated.  In future releases, the pseudopotential library (section \ref{sec:psp_library})
will be more complete, so that the user will not have explicitly generate
pseudopotentials using this module.

Input to the PSP\_GENERATOR task is contained within the
PSP\_GENERATOR  sub-block.
\begin{verbatim}
PSPW
  ...
  PSP_GENERATOR
     ...
  END
  ...
END
\end{verbatim}
To run a PSP\_GENERATOR calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW PSP_GENERATOR
\end{verbatim}
Listed below is the format of a PSP\_GENERATOR sub-block.
\begin{verbatim}
PSPW
... 
   PSP_GENERATOR
      PSEUDOPOTENTIAL_FILENAME: <string psp_name>
      ELEMENT: <string element>
      CHARGE: <real charge>
      MASS_NUMBER: <real mass_number>
      ATOMIC_FILLING: <integer ncore nvalence>
      ( (1||2||...) (s||p||d||f||...) <real filling> \
         ...)
      
      [CUTOFF: <integer lmax> 
         ( (s||p||d||f||g) <real rcut>\
         ...)
      ]
      PSEUDOPOTENTIAL_TYPE: (TROULLIER-MARTINS || HAMANN default HAMANN)
      SOLVER_TYPE: (PAULI || SCRHODINGER default PAULI)
      EXCHANGE_TYPE: (dirac || PBE96 default DIRAC)
      CORRELATION_TYPE: (VOSKO || PBE96 default VOSKO)
      [SEMICORE_RADIUS: <real rcore>]
      
   end
... 
END
\end{verbatim}
The following list describes the input for the PSP\_GENERATOR
sub-block.
\begin{itemize}

        \item $<$psp\_name$>$ - name that points to a.
        \item $<$element$>$ - Atomic symbol.
        \item $<$charge$>$ - charge of the atom
        \item $<$mass$>$ - mass number for the atom
        \item $<$ncore$>$ - number of core states
        \item $<$nvalence$>$ - number of valence states.
        \item ATOMIC\_FILLING:.....(see below)
        \item $<$filling$>$ - occupation of atomic state
        \item CUTOFF:....(see below) 
        \item $<$rcore$>$ - value for the semicore radius (see below) 
\end{itemize}


\subsubsection{\tt ATOMIC\_FILLING Block}
This required block is used to define the reference atom which is used
to define the pseudopotential. After the ATOMIC\_FILLING: $<$ncore$>$
$<$nvalence$>$ line, the core states are listed (one per line), and
then the valence states are listed (one per line). 
Each state contains two integer and a value.  The first integer
specifies the radial quantum number, $n$,
The second integer specifies the angular momentum quantum number, $l$,
and the third value specifies the occupation of the state.

For example to define a pseudopotential
for the Neon atom in the $1s^2 2s^2 2p^6$ state
could have the block
\begin{verbatim}
ATOMIC_FILLING: 1 2
        1  s  2.0   #core state    - 1s^2 
        2  s  2.0   #valence state - 2s^2
        2  p  6.0   #valence state - 2p^6
\end{verbatim}
for a pseudopotential with a $2s$ and $2p$ valence electrons
or the block
\begin{verbatim}
ATOMIC_FILLING: 3 0
        1  s  2.0    #core state
        2  s  2.0    #core state
        2  p  6.0    #core state
\end{verbatim}
could be used for a pseudopotential with no valence electrons.


\subsubsection{{\tt CUTOFF} Block}
This optional block specifies the cutoff distances used
to match the all-electron atom to the pseudopotential atom.  For
Hamann pseudopotentials $r_{cut}(l)$ defines the distance
where the all-electron potential is matched to the pseudopotential, and
for Troullier-Martins pseudopotentials $r_{cut}(l)$ defines the distance
where the all-electron orbital is matched to the pseudowavefunctions. 
Thus the definition of the radii depends on the type of pseudopotential.  
The cutoff radii used in Hamann pseudopotentials will be smaller than
the cutoff radii used in Troullier-Martins pseudopotentials.  

For example to define a softened Hamann pseudopotential for
Carbon would be
\begin{verbatim}
ATOMIC_FILLING: 1 2
  1  s  2.0
  2  s  2.0
  2  p  2.0
CUTOFF: 2
  s  0.8
  p  0.85
  d  0.85
\end{verbatim}
while a similarly softened Troullier-Marting pseudopotential
for Carbon would be
\begin{verbatim}
ATOMIC_FILLING: 1 2
  1  s  2.0
  2  s  2.0
  2  p  2.0
CUTOFF: 2
  s  1.200
  p  1.275
  d  1.275
\end{verbatim}


\subsubsection{{\tt SEMICORE\_RADIUS} Option}
Specifying the SEMICORE\_RADIUS option turns on the semicore correction approximation proposed
by Louie et al (S.G. Louie, S. Froyen, and M.L. Cohen, Phys. Rev. B, \textbf{26}, 1738, (1982)).  
This approximation is known to dramatically improve results for systems containing 
alkali and transition metal atoms.  

The implementation in the PSPW module defines the semi-core density, $\rho_{semicore}$ in terms of 
the core density, $\rho_{core}$, by using the sixth-order polynomial
\begin{eqnarray}
\rho_{semicore}(r) = \left\{ \begin{array}{ll}
                              \rho_{core} & \mbox{if $r \geq r_{semicore}$} \\
                              c_0 + c_3 r^3 + c_4 r^4 + c_5 r^5 + c_6 r^6 &  \mbox{if $r < r_{semicore}$}
                            \end{array}
                     \right.
\end{eqnarray}
This expansion was suggested by Fuchs and Scheffler 
(M. Fuchs, and M. Scheffler, Comp. Phys. Comm.,\textbf{119},67 (1999)), 
and is better behaved for taking derivatives (i.e. calculating ionic forces) than the expansion suggested 
by Louie et al.




\subsection{\tt WAVEFUNCTION\_INITIALIZER}
\label{sec:pspw_wavefunction_initializer}
The functionality of this task is now performed automatically. For backward 
compatibility, we provide a description of the input to this task.

The wavefunction\_initializer task is used to generate an initial wavefunction
datafile.
Input to the WAVEFUNCTION\_INITIALIZER task is contained
within the WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
  ...
  WAVEFUNCTION_INITIALIZER
     ...
  END
  ...
END
\end{verbatim}
To run a WAVEFUNCTION\_INITIALIZER calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW WAVEFUNCTION_INITIALIZER
\end{verbatim}
Listed below is the format of a WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
... 
   WAVEFUNCTION_INITIALIZER
     CELL_NAME: <string cell_name>
     WAVEFUNCTION_FILENAME: <string wavefunction_name default input_movecs>
     (RESTRICTED||UNRESTRICTED)
     if (RESTRICTED)   
        RESTRICTED_ELECTRONS: <integer restricted electrons>
     if (UNRESTRICTED) 
        UP_ELECTRONS: <integer up_electrons>
        DOWN_ELECTRONS: <integer down_electrons>
   END
...
END
\end{verbatim}
The following list describes the input for the WAVEFUNCTION\_INITIALIZER
sub-block.
\begin{itemize}
        \item $<$cell\_name$>$ - name of
                the simulation\_cell named $<$cell\_name$>$.  See section \ref{sec:pspw_cell}.
        \item $<$wavefunction\_name$>$ - name that will point
              to a wavefunction file.
        \item RESTRICTED - keyword specifying that the calculation is restricted.
        \item UNRESTRICTED - keyword specifying that the calculation is unrestricted.

        \item $<$restricted\_electrons$>$ - number of restricted electrons.
               Not used if an UNRESTRICTED calculation. 
         \item $<$up\_electrons$>$ - number of spin-up electrons.
               Not used if a RESTRICTED calculation.
        \item $<$down\_electrons$>$ - number of spin-down electrons.
              Not used if a RESTRICTED calculation.
\end{itemize}

\subsubsection{Old Style Input (version 3.3) to {\tt WAVEFUNCTION\_INITIALIZER}}

For backward compatibility, the input to the WAVEFUNCTION\_INITIALIZER 
sub-block can also be of the form
\begin{verbatim}
PSPW
... 
   WAVEFUNCTION_INITIALIZER
     CELL_NAME: <string cell_name>
     WAVEFUNCTION_FILENAME: <string wavefunction_name default input_movecs>
     (RESTRICTED||UNRESTRICTED)
     
     [UP_FILLING: <integer up_filling>
        [0 0 0   0]
        {<integer kx ky kz> (-2||-1||1||2)}]
     [DOWN_FILLING: <integer down_filling>
        [0 0 0   0]
        {<integer kx ky kz> (-2||-1||1||2)}]
   END
...
END
\end{verbatim}
where
\begin{itemize}
        \item $<$cell\_name$>$ - name of the
                simulation\_cell named $<$cell\_name$>$.  See section \ref{sec:pspw_cell}.
        \item $<$wavefunction\_name$>$ - name that will point
              to a wavefunction file.
        \item RESTRICTED - keyword specifying that the calculation is restricted.
        \item UNRESTRICTED - keyword specifying that the calculation is unrestricted.
        \item $<$up\_filling$>$ - number of restricted molecular orbitals if
              RESTRICTED and number of spin-up molecular orbitals if 
              UNRESTRICTED.
        \item $<$down\_filling$>$ - number of spin-down molecular orbitals if
              UNRESTRICTED.  Not used if a RESTRICTED calculation.
        \item $<$kx ky kz$>$ - specifies which planewave is to be filled. 
\end{itemize}

The values for the planewave $(-2||-1||1||2)$ are used to represent whether
the specified planewave is a cosine or a sine function, in addition
random noise can be added to these base functions. That is $+1$ 
represents a cosine function, and $-1$ represents a sine function.
The $+2$ and $-2$ values are used to represent a cosine function with
random components added and a sine function with random components
added respectively.  


\subsection{\tt V\_WAVEFUNCTION\_INITIALIZER}
\label{sec:pspw_v_wavefunction_initializer}
The functionality of this task is now performed automatically. For backward 
compatibility, we provide a description of the input to this task.

The v\_wavefunction\_initializer task is used to generate an initial velocity 
wavefunction datafile.
Input to the V\_WAVEFUNCTION\_INITIALIZER task is contained
within the V\_WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
  ...
  V_WAVEFUNCTION_INITIALIZER
     ...
  END
  ...
END
\end{verbatim}
To run a V\_WAVEFUNCTION\_INITIALIZER calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW WAVEFUNCTION_INITIALIZER
\end{verbatim}
Listed below is the format of a V\_WAVEFUNCTION\_INITIALIZER sub-block.
\begin{verbatim}
PSPW
... 
   V_WAVEFUNCTION_INITIALIZER
     V_WAVEFUNCTION_FILENAME: <string v_wavefunction_name default input_vmovecs>
     CELL_NAME: <string cell_name>
     (RESTRICTED||UNRESTRICTED)
     UP_FILLING: <integer up_filling>
     DOWN_FILLING: <integer down_filling>
   END
...
END
\end{verbatim}
The following list describes the input for the V\_WAVEFUNCTION\_INITIALIZER
sub-block.
\begin{itemize}
        \item $<$cell\_name$>$ - name of the
                simulation\_cell named $<$cell\_name$>$.  See section \ref{sec:pspw_cell}.
        \item $<$wavefunction\_name$>$ - name that will point
              to a velocity wavefunction file.
        \item RESTRICTED - keyword specifying that the calculation is restricted.
        \item UNRESTRICTED - keyword specifying that the calculation is unrestricted.
        \item $<$up\_filling$>$ - number of restricted velocity molecular 
              orbitals if RESTRICTED and number of spin-up velocity molecular 
              orbitals if UNRESTRICTED.
        \item $<$down\_filling$>$ - number of spin-down velocity molecular 
              orbitals if UNRESTRICTED.  Not used if a RESTRICTED calculation.
\end{itemize}



\subsection{\tt WAVEFUNCTION\_EXPANDER}
\label{sec:pspw_wavefunction_expander}
The functionality of this task is now performed automatically. For backward
compatibility, we provide a description of the input to this task.

The wavefunction\_expander task is used to convert a new wavefunction
file that spans a larger grid space from an old wavefunction file.
Input to the WAVEFUNCTION\_EXPANDER task is contained
within the WAVEFUNCTION\_EXPANDER sub-block.
\begin{verbatim}
PSPW
  ...
  WAVEFUNCTION_EXPANDER
     ...
  END
  ...
END
\end{verbatim}
To run a WAVEFUNCTION\_EXPANDER calculation the following directive 
is used:
\begin{verbatim}
TASK PSPW WAVEFUNCTION_EXPANDER
\end{verbatim}
Listed below is the format of a WAVEFUNCTION\_EXPANDER sub-block.
\begin{verbatim}
PSPW
... 
   WAVEFUNCTION_EXPANDER   
     OLD_WAVEFUNCTION_FILENAME: <string old_wavefunction_name default input_movecs>
     NEW_WAVEFUNCTION_FILENAME: <string new_wavefunction_name default input_movecs>
     NEW_NGRID: <integer na1 na2 na3>
    
   END
...
END
\end{verbatim}
The following list describes the input for the WAVEFUNCTION\_EXPANDER
sub-block.
\begin{itemize}
        \item $<$old\_wavefunction\_name$>$ - name of the
              wavefunction file.
        \item $<$new\_wavefunction\_name$>$ - name that will 
              point to a wavefunction file.
        \item $<$na1 na2 na3$>$ - number of grid points in each dimension
              for the new wavefunction file. 
\end{itemize}

\subsection{\tt STEEPEST\_DESCENT} 
\label{sec:pspw_steepest_descent}
The functionality of this task is now performed automatically by the PSPW minimizer. 
For backward compatibility, we provide a description of the input to this task.

The steepest\_descent task is used to optimize the one-electron orbitals
with respect to the total energy.  In addition it can also be used to optimize
geometries.   This method is meant to be used for coarse optimization of
the one-electron orbitals.
% ref does not exist
%  A detailed description of the this method
%is described in section \ref{sec:pspw_sd2}

Input to the steepest\_descent simulation is contained
within the steepest\_descent sub-block.
\begin{verbatim}
PSPW
  ...
  STEEPEST_DESCENT
     ...
  END
  ...
END
\end{verbatim}
To run a steepest\_descent calculation the following directive is used:
\begin{verbatim}
TASK PSPW steepest_descent 
\end{verbatim}
The steepest\_descent sub-block contains a great deal
of input, including pointers to data, as well as
parameter input.  Listed below is the format of a STEEPEST\_DESCENT sub-block.
\begin{verbatim}
PSPW
...
   STEEPEST_DESCENT
      CELL_NAME <string cell_name>
      [GEOMETRY_OPTIMIZE]
      INPUT_WAVEFUNCTION_FILENAME  <string input_wavefunctions  default input_movecs>
      OUTPUT_WAVEFUNCTION_FILENAME <string output_wavefunctions default input_movecs>
      FAKE_MASS <real fake_mass default 400000.0>
      TIME_STEP <real time_step default 5.8>
      LOOP <integer inner_iteration outer_iteration default 10 1>
      TOLERANCES <real tole tolc tolr default 1.0d-9 1.0d-9 1.0d-4>
      ENERGY_CUTOFF       <real ecut default (see input desciption)>
      WAVEFUNCTION_CUTOFF <real wcut default (see input description)>
      EWALD_NCUT <integer ncut default 1>
      EWALD_RCUT <real rcut default (see input description)>
      XC (Vosko || LDA || PBE96 || revPBE || HF || PBE0 || revPBE0 || 
          LDA-SIC    || LDA-SIC/2    ||  LDA-0.4SIC    || LDA-SIC/4    || LDA-0.2SIC ||
          PBE96-SIC  || PBE96-SIC/2  ||  PBE96-0.4SIC  || PBE96-SIC/4  || PBE96-0.2SIC ||
          revPBE-SIC || revPBE-SIC/2 ||  revPBE-0.4SIC || revPBE-SIC/4 || revPBE-0.2SIC ||
          default Vosko)
      [MULLIKEN]

   END
...

END
\end{verbatim}
The following list describes the input for the STEEPEST\_DESCENT
sub-block.
\begin{itemize}
        \item $<$cell\_name$>$ - name of
              the simulation\_cell named $<$cell\_name$>$. See section \ref{sec:pspw_cell}.
        \item GEOMETRY\_OPTIMIZE - optional keyword which if specified
              turns on geometry optimization.   
        \item $<$input\_wavefunctions$>$ - name of the
              file containing one-electron orbitals
        \item $<$output\_wavefunctions$>$ - name of the
              file tha will contain the one-electron orbitals at the
              end of the run. 
        \item $<$fake\_mass$>$ - value for the electronic
              fake mass ($\mu$).
        \item $<$time\_step$>$ - value for the time step ($\Delta t$).
        \item $<$inner\_iteration$>$ - number of iterations between the 
              printing out of energies and tolerances
        \item $<$outer\_iteration$>$ - number of outer iterations
        \item $<$tole$>$ - value for the energy tolerance.
        \item $<$tolc$>$ - value for the one-electron orbital tolerance.
        \item $<$tolr$>$ - value for the ion position tolerance.
        \item $<$ecut$>$ - value for the cutoff energy used
                           to define the density.  Default is set
                           to be the maximum value that will fit
                           within the simulation\_cell $<$cell\_name$>$.
        \item $<$wcut$>$ - value for the cutoff energy used
                           to define the one-electron orbitals. Default is set
                           to be the maximum value that will fit
                           within the simulation\_cell $<$cell\_name$>$.
        \item $<$ncut$>$ - value for the number of unit cells
                          to sum over (in each direction) for the real space
                          part of the Ewald summation.  Note Ewald summation
                          is only used if the simulation\_cell is periodic.
        \item $<$rcut$>$ - value for the cutoff radius used
                          in the Ewald summation.  Note Ewald summation
                          is only used if the simulation\_cell is periodic. \\
                          Default set to be
                          $\frac{MIN(\left| \vec{a_i} \right|)}{\pi}, i=1,2,3$.
        \item (Vosko $||$ PBE96 $||$ revPBE $||$ ...) - Choose between Vosko et al's LDA 
                               parameterization or the orginal and revised Perdew, Burke, 
                               and Ernzerhof GGA functional.  In addition, several hybrid options.
        \item MULLIKEN - optional keyword which if specified
                         causes a Mulliken analysis to be performed at
                         the end of the simulation.  
\end{itemize}





\section{Band Tasks}
\label{sec:band_tasks}

All input to the Band Tasks is contained within the compound NWPW block,
\begin{verbatim}
NWPW
   ...
END
\end{verbatim}

To perform an actual calculation a TASK Band directive is used (Section \ref{sec:task}).  
\begin{verbatim}
  TASK Band
\end{verbatim} 

Once a user has specified a geometry, the Band module can be invoked with no input directives (defaults invoked throughout).  There are sub-directives which allow for customized application; those currently provided as options for the Band module are:
\begin{verbatim}
NWPW
  CELL_NAME <string cell_name default 'cell_default'>
  ZONE_NAME <string zone_name default 'zone_default'>
  INPUT_WAVEFUNCTION_FILENAME  <string input_wavefunctions  default input_movecs>
  OUTPUT_WAVEFUNCTION_FILENAME <string output_wavefunctions default input_movecs>
  FAKE_MASS <real fake_mass default 400000.0>
  TIME_STEP <real time_step default 5.8>
  LOOP <integer inner_iteration outer_iteration default 10 100>
  TOLERANCES <real tole tolc default 1.0e-7 1.0e-7>
  ENERGY_CUTOFF       <real ecut default (see input description)>
  WAVEFUNCTION_CUTOFF <real wcut default (see input description)>
  EWALD_NCUT <integer ncut default 1>]
  EWALD_RCUT <real rcut default (see input description)>
  XC (Vosko || PBE96  || revPBE default Vosko)
  DFT||ODFT||RESTRICTED||UNRESTRICTED
  MULT <integer mult default 1>
  
  SIMULATION_CELL ... (see input description) END
  BRILLOUIN_ZONE  ... (see input description) END
  MONKHORST-PACK <real n1 n2 n3 default 1 1 1>

  BAND_DPLOT    ... (see input description) END

  MAPPING <integer mapping default 1>

END 
\end{verbatim}
The following list describes these keywords.
\begin{itemize}
        \item $<$cell\_name$>$ - name of
              the simulation\_cell named $<$cell\_name$>$.  See section \ref{sec:pspw_cell}.
        \item $<$input\_wavefunctions$>$ - name of the
              file containing one-electron orbitals
        \item $<$output\_wavefunctions$>$ - name that will
              point to file containing the one-electron orbitals at the
              end of the run. 
        \item $<$fake\_mass$>$ - value for the electronic
              fake mass ($\mu$). This parameter is not presently used in a 
              conjugate gradient simulation
        \item $<$time\_step$>$ - value for the time step ($\Delta t$).  This
              parameter is not presently used in a conjugate gradient simulation.
        \item $<$inner\_iteration$>$ - number of iterations between the 
              printing out of energies and tolerances
        \item $<$outer\_iteration$>$ - number of outer iterations
        \item $<$tole$>$ - value for the energy tolerance.
        \item $<$tolc$>$ - value for the one-electron orbital tolerance.
        \item $<$ecut$>$ - value for the cutoff energy used
                           to define the density. Default is set
                           to be the maximum value that will fit
                            within the simulation\_cell $<$cell\_name$>$.
        \item $<$wcut$>$ - value for the cutoff energy used
                           to define the one-electron orbitals.
                           Default is set to be the maximum value that 
                           will fix within the simulation\_cell $<$cell\_name$>$.
        \item $<$ncut$>$ - value for the number of unit cells
                          to sum over (in each direction) for the real space
                          part of the Ewald summation. Note Ewald summation
                          is only used if the simulation\_cell is periodic.
        \item $<$rcut$>$ - value for the cutoff radius used
                          in the Ewald summation. Note Ewald summation
                          is only used if the simulation\_cell is periodic. \\
                           Default set to be
                          $\frac{MIN(\left| \vec{a_i} \right|)}{\pi}, i=1,2,3$.
        \item (Vosko $||$ PBE96 $||$ revPBE) - Choose between Vosko et al's LDA 
                               parameterization or the orginal and revised Perdew, Burke, 
                               and Ernzerhof GGA functional.
        \item SIMULATION\_CELL (see section \ref{sec:pspw_cell})
        \item BRILLOUIN\_ZONE  (see section \ref{sec:band_brillouin_zone})
        \item MONKHORST-PACK - Alternatively, the MONKHORST-PACK keyword can be used 
                               to enter a MONKHORST-PACK sampling of the Brillouin zone.

\end{itemize}


\subsection{Brillouin Zone}
\label{sec:band_brillouin_zone}
To supply the special points of the Brillouin zone,
the user defines a brillouin\_zone sub-block within the NWPW 
block.  Listed below is the format of a brillouin\_zone sub-block.
\begin{verbatim}
NWPW
...
   BRILLOUIN_ZONE
      ZONE_NAME <string name default 'zone_default'>
      (KVECTOR <real k1 k2 k3 no default> <real weight default (see input description)>
       ...)
   END
...
END
\end{verbatim}
The user enters the special points and weights of the
Brillouin zone.  The following list describes the input in detail.
\begin{itemize}
        \item $<$name$>$ - user-supplied name for the simulation block. 
        \item $<$k1 k2 k3$>$ - user-supplied values for a special point in the
                               Brillouin zone.
        \item $<$weight$>$ - user-supplied weight.  Default is to set the weight
                         so that the sum of all the weights for the entered  
                         special points adds up to unity.
\end{itemize}


\normalsize
\subsection{\tt BAND\_DPLOT}
\label{sec:pspw_dplot}
The BAND BAND\_DPLOT task is used to generate plots of various types of electron
densities (or orbitals) of a crystal.  The electron density is calculated on the
specified set of grid points from a Band calculation.  The output file
generated is in the Gaussian Cube format.
Input to the BAND\_DPLOT task is contained
within the BAND\_DPLOT sub-block.
\begin{verbatim}
NWPW
  ...
  BAND_DPLOT
     ...
  END
  ...
END
\end{verbatim}
To run a BAND\_DPLOT calculation the following directive
is used:
\begin{verbatim}
TASK BAND BAND_DPLOT
\end{verbatim}
Listed below is the format of a BAND\_DPLOT sub-block.
\begin{verbatim}
NWPW
...
   BAND_DPLOT
     VECTORS <string input_wavefunctions  default input_movecs>
     DENSITY [total||difference||alpha||beta||laplacian||potential default total] <string density_name no default>
     ELF [restricted|alpha|beta] <string elf_name no default>
     ORBITAL (density || real || complex default density) <integer orbital_number no default> <integer brillion_number default 1> <string orbital_name no default>


     [LIMITXYZ [units <string Units default angstroms>]
     <real X_From> <real X_To> <integer No_Of_Spacings_X>
     <real Y_From> <real Y_To> <integer No_Of_Spacings_Y>
     <real Z_From> <real Z_To> <integer No_Of_Spacings_Z>]

   END

...
END
\end{verbatim}

The following list describes the input for the BAND\_DPLOT
sub-block.

\begin{verbatim}
     VECTORS <string input_wavefunctions  default input_movecs>
\end{verbatim}
 This sub-directive specifies the name of the molecular orbital file. If the second file is optionally given the density is computed as the difference between the corresponding electron densities. The vector files have to match.

\begin{verbatim}
     DENSITY [total||difference||alpha||beta||laplacian||potential default total] <string density_name no default>
\end{verbatim}
This sub-directive specifies, what kind of density is to be plotted. The known names for total, difference, alpha, beta, laplacian, and potential.

\begin{verbatim}
     ELF [restricted|alpha|beta] <string elf_name no default>
\end{verbatim}
This sub-directive specifies that an electron localization function (ELF) is to be plotted.

\begin{verbatim}
     ORBITAL (density || real || complex default density) <integer orbital_number no default> \
             <integer brillion_number default 1> <string orbital_name no default>
\end{verbatim}
This sub-directive specifies the molecular orbital number that is to be plotted.

\begin{verbatim}
     LIMITXYZ [units <string Units default angstroms>]
     <real X_From> <real X_To> <integer No_Of_Spacings_X>
     <real Y_From> <real Y_To> <integer No_Of_Spacings_Y>
     <real Z_From> <real Z_To> <integer No_Of_Spacings_Z>
\end{verbatim}
By default the grid spacing and the limits of the cell to be plotted are defined by the input wavefunctions.  Alternatively the user can use the LIMITXYZ sub-directive to specify other limits.  The grid is generated using No\_Of\_Spacings + 1 points along each direction. The known names for Units are angstroms, au and bohr.




\section{PAW Tasks}
\label{sec:paw_tasks}


All input to the PAW Tasks is contained within the compound NWPW block,
\begin{verbatim}
NWPW
   ...
END
\end{verbatim}


To perform an actual calculation a TASK PAW directive is used
(Section \ref{sec:task}).  
\begin{verbatim}
  TASK PAW
\end{verbatim} 
In addition to the directives listed in Section \ref{sec:task}, i.e.
\begin{verbatim}
TASK paw energy          
TASK paw gradient         
TASK paw optimize         
TASK paw saddle           
TASK paw freqencies       
TASK paw vib
\end{verbatim}
there are additional directives that are specific to the PSPW module, which are:
\begin{verbatim}
TASK PAW [Car-Parrinello             ||
          steepest_descent            ]
\end{verbatim}


Once a user has specified a geometry, the PAW module can be invoked with no input directives (defaults invoked throughout).  There are sub-directives which allow for customized application; those currently provided as options for the PAW module are:
\begin{verbatim}
NWPW
  CELL_NAME <string cell_name default 'cell_default'>  
  [GEOMETRY_OPTIMIZE]
  INPUT_WAVEFUNCTION_FILENAME  <string input_wavefunctions  default input_movecs>
  OUTPUT_WAVEFUNCTION_FILENAME <string output_wavefunctions default input_movecs>
  FAKE_MASS <real fake_mass default 400000.0>
  TIME_STEP <real time_step default 5.8>
  LOOP <integer inner_iteration outer_iteration default 10 100>
  TOLERANCES <real tole tolc default 1.0e-7 1.0e-7>
  ENERGY_CUTOFF       <real ecut default (see input description)>
  WAVEFUNCTION_CUTOFF <real wcut default (see input description)>
  EWALD_NCUT <integer ncut default 1>]
  EWALD_RCUT <real rcut default (see input description)>
  XC (Vosko || PBE96 || revPBE  default Vosko)
  DFT||ODFT||RESTRICTED||UNRESTRICTED
  MULT <integer mult default 1>
  INTEGRATE_MULT_L <integer imult default 1>
  
  SIMULATION_CELL ... (see input description) END
  CAR-PARRINELLO  ... (see input description) END

  MAPPING <integer mapping default 1>
END 


END 
\end{verbatim}
The following list describes these keywords.
\begin{itemize}
        \item $<$cell\_name$>$ - name of the
              the simulation\_cell named $<$cell\_name$>$. The
              current version of PAW only accepts periodic unit cells.  
              See section \ref{sec:pspw_cell}.
        \item GEOMETRY\_OPTIMIZE - optional keyword which if specified
              turns on geometry optimization.   
        \item $<$input\_wavefunctions$>$ - name of the
              file containing one-electron orbitals
        \item $<$output\_wavefunctions$>$ - name of the
              file that will contain the one-electron orbitals at the
              end of the run. 
        \item $<$fake\_mass$>$ - value for the electronic
              fake mass ($\mu$). This parameter is not presently used in a 
              conjugate gradient simulation
        \item $<$time\_step$>$ - value for the time step ($\Delta t$).  This
              parameter is not presently used in a conjugate gradient simulation.
        \item $<$inner\_iteration$>$ - number of iterations between the 
              printing out of energies and tolerances
        \item $<$outer\_iteration$>$ - number of outer iterations
        \item $<$tole$>$ - value for the energy tolerance.
        \item $<$tolc$>$ - value for the one-electron orbital tolerance.
        \item $<$ecut$>$ - value for the cutoff energy used
                           to define the density. Default is set
                           to be the maximum value that will fit
                            within the simulation\_cell $<$cell\_name$>$.
        \item $<$wcut$>$ - value for the cutoff energy used
                           to define the one-electron orbitals.
                           Default is set to be the maximum value that 
                           will fix within the simulation\_cell $<$cell\_name$>$.
        \item $<$ncut$>$ - value for the number of unit cells
                          to sum over (in each direction) for the real space
                          part of the smooth compensation summation. 
        \item $<$rcut$>$ - value for the cutoff radius used
                          in the smooth compensation summation. \\
                           Default set to be
                          $\frac{MIN(\left| \vec{a_i} \right|)}{\pi}, i=1,2,3$.
        \item (Vosko $||$ PBE96 $||$ revPBE) - Choose between Vosko et al's LDA 
                               parameterization or the orginal and revised Perdew, Burke, 
                               and Ernzerhof GGA functional.
        \item MULT - optional keyword which if specified allows the user to define the spin multiplicity
                     of the system
        \item INTEGRATE\_MULT\_L - optional keyword which if specified allows the user to define the 
                                   angular XC integration of the augmented region
        \item SIMULATION\_CELL (see section \ref{sec:pspw_cell})
        \item CAR-PARRINELLO(see section \ref{sec:pspw_CP})


        \item $<$mapping$>$ - for a value of 1 slab FFT is used, for a value of 2 a 2d-hilbert FFT is used.
\end{itemize}


\section{Pseudopotential and PAW basis Libraries}
\label{sec:psp_library}

A library of pseudopotentials used by PSPW and BAND is currently available  in the
directory \\
\verb+ $NWCHEM_TOP/src/nwpw/libraryps/pspw_default+

The elements listed in the following table are present:

\begin{verbatim}
  H                                                  He
 -------                              ------------------
  Li Be                               B  C  N  O  F  Ne
 -------                             -------------------
  Na Mg                               Al Si P  S  Cl Ar
 -------------------------------------------------------
  K  Ca Sc Ti V  Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr         
 -------------------------------------------------------
  Rb Sr Y  Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I  Xe
 -------------------------------------------------------
  Cs Ba La Hf Ta W  Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn
 -------------------------------------------------------
  Fr Ra . 
 -----------------

          ------------------------------------------
           .  .  .  .  .  .  Gd .  .  .  .  .  .  .                      
          ------------------------------------------
           .  .  U  .  Pu .  .  .  .  .  .  .  .  .      
          ------------------------------------------

\end{verbatim}
The pseudopotential libraries are continually being tested
and added.   Also,  the PSPW program can read in pseudopotentials
in CPI and TETER format generated with pseudopotential generation
programs such as the OPIUM package of Rappe et al.
The user can request additional pseudopotentials from 
Eric J. Bylaska at (Eric.Bylaska@pnl.gov).  

Similarly, a library of PAW basis used by PAW is currently available in the
directory \\
\verb+ $NWCHEM_TOP/src/nwpw/libraryps/paw_default+

\begin{verbatim}
  H                                                  He
 -------                              -----------------
  Li Be                               B  C  N  O  F  Ne
 -------                             ------------------
  Na Mg                               Al Si P  S  Cl Ar
 ------------------------------------------------------
  K  Ca Sc Ti V  Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr         
 ------------------------------------------------------
  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
 ------------------------------------------------------
  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
 ------------------------------------------------------
  .  .  . 
 -----------------
                                                      

          ------------------------------------------
           .  .  .  .  .  .  .  .  .  .  .  .  .  .                      
          ------------------------------------------
           .  .  .  .  .  .  .  .  .  .  .  .  .  .      
          ------------------------------------------

\end{verbatim}


Currently there are not very many elements available for PAW.  However,
the user can request additional basis sets from Eric J. Bylaska at (Eric.Bylaska@pnl.gov).

A preliminary implementation of the HGH pseudopotentials (Hartwigsen, Goedecker, and Hutter)
has been implemented into the PSPW module.  To access
the pseudopotentials the pseudopotentials input block is used.  For
example, to redirect the code to use HGH pseudopotentials for carbon
and hydrogen, the following input would be used.
\begin{verbatim}
nwpw
   ...
   pseudopotentials
    C  library  HGH_LDA
    H  library  HGH_LDA
   end
   ...
end
\end{verbatim}
The implementation of HGH pseudopotentials is rather limited in this release.
HGH pseudopotentials cannot be used to optimize unit cells, and they
do not work with the MULLIKEN option.  They also have not yet been implemented 
into the BAND structure code.

To read in pseudopotentials in CPI format the following input would be used.
\begin{verbatim}
nwpw
   ...
   pseudopotentials
    C  CPI  c.cpi
    H  CPI  h.cpi
   end
   ...
end
\end{verbatim}
In order for the program to recognize the CPI format the CPI files, e.g. c.cpi 
have to be prepended with the ``$<$CPI$>$'' keyword.

To read in pseudopotentials in TETER format the following input would be used.
\begin{verbatim}
nwpw
   ...
   pseudopotentials
    C  TETER  c.teter
    H  TETER  h.teter
   end
   ...
end
\end{verbatim}
In order for the program to recognize the TETER format the TETER files, e.g. c.teter 
have to be prepended with the ``$<$TETER$>$'' keyword.


If you wish to redirect the code to a different directory other than
the default one, 
you need to set the environmental variable
{\tt NWCHEM\_NWPW\_LIBRARY}
to the new location of the \verb+libraryps+ directory.



\section{NWPW RTDB Entries and DataFiles}
\label{sec:pspw_data}
Input to the PSPW and Band modules are contained in both the RTDB and datafiles.
The RTDB is used to store input that the user will need to directly specify.
Input of this kind includes ion positions, ion velocities, and simulation cell
parameters.  The datafiles are used to store input, such the one-electron 
orbitals, one-electron orbital velocities, formatted pseudopotentials, 
and one-dimensional pseudopotentials, that the user will in most cases
run a program to generate.

\subsection{Ion Positions}
The positions of the ions are stored in the default geometry structure
in the RTDB and must be specified  using the GEOMETRY directive.

\subsection{Ion Velocities}
The velocities of the ions are stored in the default geometry structure
in the RTDB, and must be specified using the GEOMETRY directive.



\subsection{Wavefunction Datafile}
The one-electron orbitals are stored in a wavefunction datafile.  This
is a binary file and cannot be directly edited.  This datafile is used
by steepest\_descent and Car-Parrinello tasks and can be generated
using the wavefunction\_initializer or wavefunction\_expander tasks.

\subsection{Velocity Wavefunction Datafile}
The one-electron orbital velocities are stored in a velocity wavefunction 
datafile.  This is a binary file and cannot be directly edited.  This datafile 
is used by the Car-Parrinello task and can be generated
using the v\_wavefunction\_initializer task.

\subsection{Formatted Pseudopotential Datafile}
The pseudopotentials in Kleinman-Bylander form expanded on a simulation
cell (3d grid) are stored in a formatted pseudopotential datafile.
This is a binary file and cannot be directly edited.
This datafile 
is used by steepest\_descent and Car-Parrinello tasks and can be generated
using the pseudopotential\_formatter task.

\subsection{One-Dimensional Pseudopotential Datafile}
The one-dimensional pseudopotentials are stored in a one-dimensional 
pseudopotential file.  This is an ASCII file and can be directly edited with
a text editor.  However, the user will usually use the psp\_generator
task to generate this datafile.

The data stored in the one-dimensional pseudopotential file is
\begin{verbatim}
   character*2 element       :: element name
   integer     charge        :: valence charge of ion
   real        mass          :: mass of ion
   integer     lmax          :: maximum angular component
   real        rcut(lmax)    :: cutoff radii used to define pseudopotentials
   integer     nr            :: number of points in the radial grid
   real        dr            :: linear spacing of the radial grid
   real        r(nr)         :: one-dimensional radial grid
   real        Vpsp(nr,lmax) :: one-dimensional pseudopotentials
   real        psi(nr,lmax)  :: one-dimensional pseudowavefunctions
   real        r_semicore        :: semicore radius
   real        rho_semicore(nr)  :: semicore density
\end{verbatim}
and the format of it is:
\begin{verbatim}
[line 1:     ] element  
[line 2:     ] charge mass lmax
[line 3:     ] (rcut(l), l=1,lmax)
[line 4:     ] nr dr
[line 5:     ]    r(1)  (Vpsp(1,l),  l=1,lmax)
[line 6:     ] ....
[line nr+4:  ] r(nr) (Vpsp(nr,l), l=1,lmax)
[line nr+5:  ] r(1)  (psi(1,l), l=1,lmax) 
[line nr+6:  ] ....
[line 2*nr+4:] r(nr) (psi(nr,l), l=1,lmax)
[line 2*nr+5:] r_semicore
if (r_semicore read) then
[line 2*nr+6:] r(1)  rho_semicore(1)
[line 2*nr+7:] ....
[line 3*nr+5:] r(nr) rho_semicore(nr)
end if
\end{verbatim}



\subsection{PSPW Car-Parrinello Output Datafiles}
\label{sec:pspw_cp_data}

\subsubsection{XYZ motion file}
Data file that stores ion positions and velocities as
a function of time in XYZ format.

\begin{verbatim}
[line 1:          ]  n_ion
[line 2:          ]  
do ii=1,n_ion
[line 2+ii:       ] atom_name(ii), x(ii),y(ii),z(ii),vx(ii),vy(ii),vz(ii)
end do
[line n_ion+3     ] n_nion

do ii=1,n_ion
[line n_ion+3+ii: ] atom_name(ii), x(ii),y(ii),z(ii), vx(ii),vy(ii),vz(ii)
end do
[line 2*n_ion+4:  ]  ....
\end{verbatim}


\subsubsection{ION\_MOTION motion file}
Datafile that stores ion positions and velocities
as a function of time

\begin{verbatim}
[line 1:          ]  it_out, n_ion, omega
[line 2:          ]  time
do ii=1,n_ion
[line 2+ii:       ] x(ii),y(ii),z(ii), vx(ii),vy(ii),vz(ii)
end do
[line n_ion+3     ] time
do 
do ii=1,n_ion
[line n_ion+3+ii: ] x(ii),y(ii),z(ii), vx(ii),vy(ii),vz(ii)
end do
[line 2*n_ion+4:  ]  ....
\end{verbatim}

\subsubsection{EMOTION motion file}
Datafile that store energies as a function of time
\begin{verbatim}
[line 1:          ]  time, E1,E2,E3,E4,E5,E6,E7,E8, (E9,E10, if Nose-Hoover)
[line 2:          ] ...
\end{verbatim}


\subsubsection{HMOTION motion file}
Datafile that stores the rotation matrix
as a function of time.

\begin{verbatim}
[line 1:          ] time
[line 2:          ] ms,ne(ms),ne(ms)
do i=1,ne(ms)
[line 2+i:        ] (hml(i,j), j=1,ne(ms)
end do
[line 3+ne(ms):   ] time
[line 4+ne(ms):   ] ....
\end{verbatim}


\subsubsection{EIGMOTION motion file}
Datafile that stores the eigenvalues for the one-electron
orbitals as a function of time.

\begin{verbatim}
[line 1:          ]  time, (eig(i), i=1,number_orbitals)
[line 2:          ] ...
\end{verbatim}


\subsubsection{OMOTION motion file}
Datafile that stores a reduced representation of the
one-electron orbitals.  To be used with a molecular
orbital viewer that will be ported to NWChem
in the near future. 

       

\section{Car-Parrinello Scheme for Ab Initio Molecular Dynamics}
\label{sec:pspw_Car-Parrinello}

Car and Parrinello developed a unified scheme for doing {\it ab initio}
molecular dynamics by combining the motion of the ion cores and a fictitious
motion for the Kohn-Sham orbitals of density-functional theory 
(R. Car and M. Parrinello, Phys. Rev. Lett. \textbf{55}, 2471, (1985)).  
At the heart of this method they introduced a fictitious kinetic energy 
functional for the Kohn-Sham orbitals.

\begin{eqnarray}
\label{appendix:b1}
KE(\{\psi_{i,\sigma}(\vec{r})\}) &=& \sum_{i,\sigma}^{occ} 
                                      \int d\vec{r}\ \mu \left| 
                                      \dot{\psi}_{i,\sigma}(\vec{r}) \right|^2 
\end{eqnarray}

\noindent
Given this kinetic energy the constrained equations of motion are found 
by taking the first variation of the auxiliary Lagrangian.
\begin{eqnarray}
\label{appendix:b2}
L &=& \sum_{i,\sigma}^{occ} \int d\vec{r}\ \mu \left| 
     \dot{\psi}_{i,\sigma}(\vec{r}) \right|^2 
     + \frac 12 \sum_I M_I \left| \dot{\vec{R}}_I \right|^2 
- E\left[ \left\{ \psi_{i,\sigma}(\vec{r})\right\},\left\{\vec{R}_I \right\} \right]  
\nonumber \\
&&+\sum_{ij,\sigma} \Lambda_{ij,\sigma} \left( \int d\vec{r}\ 
\psi_{i,\sigma}^{*}(\vec{r}) \psi_{j,\sigma}(\vec{r}) - \delta_{ij,\sigma} 
\right) 
\end{eqnarray}

\noindent
Which generates a dynamics for the wavefunctions $\psi_{i,\sigma}(\vec{r})$ and 
atoms positions $\vec{R}_I$ through the constrained equations of motion:

\begin{eqnarray}
\mu \ddot{\psi}_{i,\sigma}(\vec{r},t) &=& -\frac{\delta E}{\delta \psi_{i,\sigma }^{*}
\left( \vec{r},t \right) } + \sum\limits_j \Lambda_{ij,\sigma} 
\psi_{j,\sigma} \left( \vec{r},t \right)
\label{eq:b3}
\end{eqnarray}
\begin{eqnarray}
M_I \ddot{\vec{R}}_I &=& -\frac{\partial E}{\partial \vec{R}_I}
\label{eq:b4}
\end{eqnarray}

\noindent
where $\mu$ is the fictitious mass for the electronic degrees of freedom and 
$M_I$ are the ionic masses.  
The adjustable parameter $\mu$ is used to 
describe the relative rate at which the wavefunctions change with time.  
$\Lambda_{ij,\sigma}$ are the 
Lagrangian multipliers for the orthonormalization of the single-particle 
orbitals $\psi_{i,\sigma}(\vec{r})$. 
They are defined by the orthonormalization constraint conditions
and can be rigorously found. 
However, the equations of motion for the Lagrange multipliers
depend on the specific algorithm used to integrate
Eqs.~\ref{eq:b3}-\ref{eq:b4}.

For this method to give ionic motions that are physically meaningful
the kinetic energy of the Kohn-Sham orbitals must be relatively
small when compared to the kinetic energy of the ions.
There are two ways where this criterion can fail.
First, the numerical integrations for the Car-Parrinello equations of motion 
can often lead to large relative values of the kinetic energy of 
the Kohn-Sham orbitals relative to the kinetic energy of the ions.
This kind of failure is easily fixed by requiring a more accurate
numerical integration, i.e. use a smaller time step for the numerical
integration.
Second, during the motion of the system a the ions can be in locations where
there is an Kohn-Sham orbital level crossing, i.e. the density-functional
energy can have two states that are nearly degenerate.  This kind
of failure often occurs in the study of chemical reactions.
This kind of failure is not easily fixed and requires the use
of a more sophisticated density-functional energy that accounts
for low-lying excited electronic states.


\subsection{Verlet Algorithm for Integration}
%\subsection{Verlet Algorithm for Integrating Eqs. \ref{eq:b3} - \ref{eq:b4} }

Eqs.~\ref{eq:b3}-\ref{eq:b4} integrated using the Verlet algorithm
results in

\begin{eqnarray}
\psi_{i,\sigma}^{t+ \Delta t} 
                   &\leftarrow& 
                    2 \psi_{i,\sigma}^{t} - \psi_{i,\sigma}^{t-\Delta t}
                      + \frac{(\Delta t)^2}{\mu}
                        \left[ 
                           \frac{\delta E}{\delta \psi_{i,\sigma}^{*}}
                            + \sum_{j} \psi_{j,\sigma} \Lambda_{ji,\sigma} 
                        \right]_{t}
\label{eq:b6}
\end{eqnarray}
\begin{eqnarray}
\vec{R}_I^{t+\Delta t} &\leftarrow& 
                    2 \vec{R}_I^{t} - \vec{R}_I^{t-\Delta t}
                    + \frac{(\Delta t)^2}{M_I} 
                       \frac{\partial E}{\partial \vec{R}_I}
\label{eq:b7}
\end{eqnarray}
               
In this molecular dynamic procedure we have to know variational derivative
$\frac{\delta E}{\delta \psi_{i,\sigma}^{*}}$ and the matrix 
$\Lambda_{ij,\sigma}$. 
The variational derivative $\frac{\delta E}{\delta \psi_{i,\sigma}^{*}}$ 
can be analytically found and is
\begin{eqnarray}
\frac{\delta E}{\delta \psi_{i,\sigma}^{*}} 
      &=&  -\frac{1}{2} \nabla^2 
            \psi_{i,\sigma}(\vec{r}) \nonumber \\
      &+& \int d\vec{r^{\prime}} 
           W_{ext}(\vec{r},\vec{r^{\prime}}) 
          \psi_{i,\sigma}(\vec{r^{\prime}}) \nonumber \\
      &+& \int d\vec{r^{\prime}} 
                    \frac{n(\vec{r^{\prime}})}{|\vec{r}-\vec{r^{\prime}}|}
          \psi_{i,\sigma}(\vec{r}) \nonumber \\
      &+& \mu_{xc}^{\sigma}(\vec{r}) 
          \psi_{i,\sigma}(\vec{r}) \nonumber \\
& \equiv & \hat{H} \psi_{i,\sigma}
\label{eq:b8}
\end{eqnarray}
                        
\noindent
To find the matrix $\Lambda_{ij,\sigma}$ we impose the orthonormality
constraint on $\psi_{i,\sigma}^{t+\Delta t}$ to obtain a
matrix Riccatti equation, and then Riccatti equation is solved by an iterative
solution 
% ref does not exist
%(see section ~\ref{sec:pspw_sd2}).


\subsection{Constant Temperature Simulations: Nose-Hoover Thermostats}
\label{sec:pspw_nose}

Nose-Hoover Thermostats for the electrons and ions can also be added to the 
Car-Parrinello simulation.  In this type of simulation thermostats variables $x_e$ and $x_R$ 
are added to the simulation by adding the auxiliary energy functionals to the total energy.
\begin{eqnarray}
ION\_THERMOSTAT(x_R)      &=&  \frac{1}{2} Q_R \dot{x_R} + E_{R0}x_R \\ 
ELECTRON\_THERMOSTAT(x_e) &=&  \frac{1}{2} Q_e \dot{x_e} + E_{e0}x_e 
\end{eqnarray}

In these equations, the average kinetic energy for the ions is
\begin{eqnarray}
E_{R0} = \frac{1}{2} f k_B T
\end{eqnarray}
where $f$ is the number of atomic degrees of freedom, $k_B$ is 
Boltzmann's constant, and T is the desired temperature.  Defining
the average fictitious kinetic energy of the electrons is not as straightforward.
Bl\"{o}chl and Parrinello 
(P.E. Bl\"{o}chl and M. Parrinello, Phys. Rev. B, \textbf{45}, 9413, (1992)) 
have suggested the following formula for determining
the average fictitious kinetic energy
\begin{eqnarray}
E_{e0} = 4 k_B T \frac{\mu}{M} \sum_i <\psi_i|-\frac{1}{2} \nabla^2 |\psi_i>
\end{eqnarray}
where $\mu$ is the fictitious electronic mass, $M$ is average mass of one atom,
and $\sum_i <\psi_i|-\frac{1}{2} \nabla^2 |\psi_i>$ is the kinetic energy of the
electrons.

Bl\"{o}chl and Parrinello suggested that the choice of mass parameters, 
$Q_e$, and $Q_R$ should be made such that the period of oscillating thermostats 
should be chosen larger than the typical time scale for the dynamical events of 
interest but shorter than the simulation time.  
\begin{eqnarray}
P_{ion} &=& 2\pi \sqrt{\frac{Q_R}{4E_{R0}}}\\
P_{electron} &=& 2\pi \sqrt{\frac{Q_e}{4E_{e0}}}
\end{eqnarray}
where $P_{ion}$ and $P_{electron}$ are the periods of oscillation for the ionic and fictitious
electronic thermostats.  


In simulated annealing simulations the electronic and ionic Temperatures are scaled 
according to an exponential cooling schedule,
\begin{eqnarray}
T_e(t) = T_e^0 \exp^{-\frac{t}{\tau_e}}\\
T_{ionic}(t) = T_{ionic}^0 \exp^{-\frac{t}{\tau_{ionic}}}
\end{eqnarray}
where $T_e^0$ and $T_{ionic}^0$ are the initial temperatures, and $\tau_e$ and $\tau_{ionic}$
are the cooling rates in atomic units.  



\section{PSPW Tutorial 1: Minimizing the geometry for a C$_2$ molecule}
\label{sec:pspw_sd}

In this section we show how use the PSPW module to optimize the geometry 
for a C$_2$ molecule at the PBE96 levels. 

In the following example we show the input needed to optimize the geometry
for a C$_2$ molecule at the LDA level.  In this example, default pseudopotentials
from the pseudopotential library are used for C, the boundary condition is free-space, 
the exchange correlation functional is PBE96, The boundary condition is free-space, and 
the simulation cell cell is aperiodic and cubic with a side length of 10.0 Angstroms and has
40 grid points in each direction (cutoff energy is 44 Ry).  
\begin{verbatim}
         
start c2_pspw_pbe96
title "C2 restricted singlet dimer optimization - PBE96/44Ry"

geometry  
C    -0.62 0.0 0.0
C     0.62 0.0 0.0
end
       
pspw
   simulation_cell units angstroms
      boundary_conditions aperiodic
      SC 10.0
      ngrid 40 40 40
   end
   xc pbe96
end
set nwpw:minimizer 2
task pspw optimize
\end{verbatim}



\normalsize
\section{PSPW Tutorial 2: Running a Car-Parrinello Simulation}
\label{sec:pspw_cp}
\normalsize

In this section we show how use the PSPW module to perform a Car-Parrinello
molecular dynamic simulation for a C$_2$ molecule at the LDA level.  
Before running a PSPW Car-Parrinello  simulation the system should be
on the Born-Oppenheimer surface, i.e. the one-electron orbitals should be minimized 
with respect to the total energy (i.e. task pspw energy).  The input needed
is basically the same as for optimizing the geometry of a C$_2$ molecule at the LDA level,
except that and additional Car-Parrinello sub-block is added.  

In the following example we show the input needed to run a Car-Parrinello simulation
for a C$_2$ molecule at the LDA level.  In this example, default pseudopotentials
from the pseudopotential library are used for C, the boundary condition is free-space, 
the exchange correlation functional is LDA, The boundary condition is free-space, and 
the simulation cell cell is aperiodic and cubic with a side length of 10.0 Angstroms and has
40 grid points in each direction (cutoff energy is 44 Ry).  The time step and fake mass
for the Car-Parrinello run are specified to be 5.0 au and 600.0 au, respectively.  

\begin{verbatim}
         
start c2_pspw_lda_md
title "C2 restricted singlet dimer, LDA/44Ry - constant energy Car-Parrinello simulation"

geometry  
C    -0.62 0.0 0.0
C     0.62 0.0 0.0
end
       
pspw
   simulation_cell units angstroms
      boundary_conditions aperiodic
      lattice
        lat_a 10.00d0
        lat_b 10.00d0
        lat_c 10.00d0
      end
      ngrid 40 40 40
   end
   Car-Parrinello
     fake_mass 600.0
     time_step 5.0
     loop 10 10
   end
end
set nwpw:minimizer 2
task pspw energy
task pspw Car-Parrinello
\end{verbatim}


\normalsize
\section{PSPW Tutorial 3: optimizing a unit cell and geometry for Silicon-Carbide}
\label{sec:pspw_unitcell_optimization}

The following example demonstrates how to uses the PSPW module to optimize the unit cell
and geometry for a silicon-carbide crystal.

\begin{verbatim}
title "SiC 8 atom cubic cell - geometry and unit cell optimization"

start SiC

#**** Enter the geometry using fractional coordinates ****
geometry units au center noautosym noautoz print
  system crystal
    lat_a 8.277d0
    lat_b 8.277d0
    lat_c 8.277d0
    alpha 90.0d0
    beta  90.0d0
    gamma 90.0d0
  end
Si    -0.50000d0  -0.50000d0  -0.50000d0
Si     0.00000d0   0.00000d0  -0.50000d0
Si     0.00000d0  -0.50000d0   0.00000d0
Si    -0.50000d0   0.00000d0   0.00000d0
C     -0.25000d0  -0.25000d0  -0.25000d0
C      0.25000d0   0.25000d0  -0.25000d0
C      0.25000d0  -0.25000d0   0.25000d0
C     -0.25000d0   0.25000d0   0.25000d0
end

#***** setup the nwpw gamma point code ****
nwpw
   simulation_cell
     ngrid 16 16 16
   end
   ewald_ncut 8
end
set nwpw:minimizer 2
set nwpw:psi_nolattice .true.  # turns of unit cell checking for wavefunctions

driver
  clear
  maxiter 40
end
set includestress .true.    # this option tells driver to optimize the unit cell

task pspw optimize

\end{verbatim}




\normalsize
\section{Band Tutorial 1: Minimizing the energy of a silicon-carbide crystal by running a PSPW and Band simulation in tandem}
\label{sec:band_tutorial1}
\normalsize

The following input deck performs a PSPW energy calculation followed
by a Band energy calculation at the $\Gamma$-point  for a cubic (8-atom) 
silicon-carbide crystal.  Since the geometry is entered using fractional coordinates
the unit cell parameters do not have to be re-specified in the simulation\_cell
nwpw sub-block.  In this example, default pseudopotential from the pseudopotential
library are used for C and Si.  The advantage of running these calculations in tandem is that
the Band code uses the wavefunctions generated from the faster PSPW calculation for
its initial guess.  The PSPW energy is -38.353570, and the Band energy is -38.353570.
 
\begin{verbatim}
start SiC_band
title "SiC 8 atom cubic cell"

#**** geometry entered using fractional coordinates ****
geometry units au center noautosym noautoz print 
  system crystal 
    lat_a 8.277d0
    lat_b 8.277d0
    lat_c 8.277d0
    alpha 90.0d0
    beta  90.0d0
    gamma 90.0d0
  end
Si    -0.50000d0  -0.50000d0  -0.50000d0
Si     0.00000d0   0.00000d0  -0.50000d0
Si     0.00000d0  -0.50000d0   0.00000d0
Si    -0.50000d0   0.00000d0   0.00000d0
C     -0.25000d0  -0.25000d0  -0.25000d0
C      0.25000d0   0.25000d0  -0.25000d0
C      0.25000d0  -0.25000d0   0.25000d0
C     -0.25000d0   0.25000d0   0.25000d0
end

#***** setup the nwpw gamma point code ****
nwpw
   simulation_cell
     ngrid 16 16 16
   end
   brillouin_zone
     kvector  0.0 0.0 0.0
   end
   ewald_ncut 8
end
set nwpw:minimizer 2
set nwpw:psi_brillioun_check .false.
task pspw energy
task band energy
\end{verbatim}




\normalsize
\section{BAND Tutorial 2: optimizing a unit cell and geometry for Silicon-Carbide}
\label{sec:band_unitcell_optimization}

The following example demonstrates how to uses the BAND module to optimize the unit cell
and geometry for a silicon-carbide crystal.

\begin{verbatim}
title "SiC 8 atom cubic cell - geometry and unit cell optimization"

start SiC

#**** Enter the geometry using fractional coordinates ****
geometry units au center noautosym noautoz print
  system crystal
    lat_a 8.277d0
    lat_b 8.277d0
    lat_c 8.277d0
    alpha 90.0d0
    beta  90.0d0
    gamma 90.0d0
  end
Si    -0.50000d0  -0.50000d0  -0.50000d0
Si     0.00000d0   0.00000d0  -0.50000d0
Si     0.00000d0  -0.50000d0   0.00000d0
Si    -0.50000d0   0.00000d0   0.00000d0
C     -0.25000d0  -0.25000d0  -0.25000d0
C      0.25000d0   0.25000d0  -0.25000d0
C      0.25000d0  -0.25000d0   0.25000d0
C     -0.25000d0   0.25000d0   0.25000d0
end

#***** setup the nwpw gamma point code ****
nwpw
   simulation_cell
     ngrid 16 16 16
   end
   ewald_ncut 8
   monkhorst-pack 2 2 2 
end
set nwpw:minimizer 2

driver
  clear
  maxiter 40
end
set includestress .true.          # this option tells driver to optimize the unit cell
set nwpw:stress_numerical .true.  #currently only numerical stresses are working with band

task band optimize

\end{verbatim}





\section{PAW Tutorial}
\label{sec:paw_tutorial}

The following input deck performs for a water molecule a PSPW energy calculation followed
by a PAW energy calculation and a PAW geometry optimization calculation.  
The default unit cell parameters are used (SC=20.0, ngrid 32 32 32).  In this simulation, the
first PAW run optimizes the wavefunction and the second PAW run optimizes the wavefunction
and geometry in tandem.

\begin{verbatim}
title "paw steepest descent test"

start paw_test

charge 0

geometry units au nocenter noautoz noautosym
O      0.00000    0.00000    0.01390
H     -1.49490    0.00000   -1.18710
H      1.49490    0.00000   -1.18710
end

nwpw
   time_step 15.8
   ewald_rcut 1.50
   tolerances 1.0d-8 1.0d-8
end
set nwpw:lcao_iterations 1
set nwpw:minimizer 2
task pspw energy

task paw energy

nwpw
   time_step 5.8
   geometry_optimize
   ewald_rcut 1.50
   tolerances 1.0d-7 1.0d-7 1.0d-4
end
task paw steepest_descent

task paw optimize
\end{verbatim}




\normalsize
\section{PAW Tutorial 2: optimizing a unit cell and geometry for Silicon-Carbide}
\label{sec:pspw_unitcell_optimization}

The following example demonstrates how to uses the PAW module to optimize the unit cell
and geometry for a silicon-carbide crystal.

\begin{verbatim}
title "SiC 8 atom cubic cell - geometry and unit cell optimization"

start SiC

#**** Enter the geometry using fractional coordinates ****
geometry units au center noautosym noautoz print
  system crystal
    lat_a 8.277d0
    lat_b 8.277d0
    lat_c 8.277d0
    alpha 90.0d0
    beta  90.0d0
    gamma 90.0d0
  end
Si    -0.50000d0  -0.50000d0  -0.50000d0
Si     0.00000d0   0.00000d0  -0.50000d0
Si     0.00000d0  -0.50000d0   0.00000d0
Si    -0.50000d0   0.00000d0   0.00000d0
C     -0.25000d0  -0.25000d0  -0.25000d0
C      0.25000d0   0.25000d0  -0.25000d0
C      0.25000d0  -0.25000d0   0.25000d0
C     -0.25000d0   0.25000d0   0.25000d0
end

#***** setup the nwpw gamma point code ****
nwpw
   simulation_cell
     ngrid 16 16 16
   end
   ewald_ncut 8
end
set nwpw:minimizer 2
set nwpw:psi_nolattice .true.  # turns of unit cell checking for wavefunctions

driver
  clear
  maxiter 40
end
set includestress .true.         # this option tells driver to optimize the unit cell
set nwpw:stress_numerical .true. #currently only numerical stresses implemented in paw

task paw optimize

\end{verbatim}



\normalsize
\section{PAW Tutorial 2: Running a Car-Parrinello Simulation}
\label{sec:pspw_cp}
\normalsize

In this section we show how use the PAW module to perform a Car-Parrinello
molecular dynamic simulation for a C$_2$ molecule at the LDA level.  
Before running a PAW Car-Parrinello  simulation the system should be
on the Born-Oppenheimer surface, i.e. the one-electron orbitals should be minimized 
with respect to the total energy (i.e. task pspw energy).  The input needed
is basically the same as for optimizing the geometry of a C$_2$ molecule at the LDA level,
except that and additional Car-Parrinello sub-block is added.  

In the following example we show the input needed to run a Car-Parrinello simulation
for a C$_2$ molecule at the LDA level.  In this example, default pseudopotentials
from the pseudopotential library are used for C, the boundary condition is free-space, 
the exchange correlation functional is LDA, The boundary condition is free-space, and 
the simulation cell cell is aperiodic and cubic with a side length of 10.0 Angstroms and has
40 grid points in each direction (cutoff energy is 44 Ry).  The time step and fake mass
for the Car-Parrinello run are specified to be 5.0 au and 600.0 au, respectively.  

\begin{verbatim}
         
start c2_paw_lda_md
title "C2 restricted singlet dimer, LDA/44Ry - constant energy Car-Parrinello simulation"

geometry  
C    -0.62 0.0 0.0
C     0.62 0.0 0.0
end
       
pspw
   simulation_cell units angstroms
      boundary_conditions aperiodic
      lattice
        lat_a 10.00d0
        lat_b 10.00d0
        lat_c 10.00d0
      end
      ngrid 40 40 40
   end
   Car-Parrinello
     fake_mass 600.0
     time_step 5.0
     loop 10 10
   end
end
set nwpw:minimizer 2
task paw energy
task paw Car-Parrinello
\end{verbatim}



\section{NWPW Capabilities and Limitations}
\label{sec:pspw_limits}
\normalsize

\begin{itemize}
\item For BAND simulations you cannot use more processors than the size of the third dimension 
  (e.g. a 64x64x64 FFT grid can use at most 64 processors).
\item For BAND simulations the second and third dimensions of the FFT grid must be the same 
  (i.e. the parameters na2 and na3 must be the same for each simulation cell).
\item Wannier orbital generation only works with cubic unit cells ($\alpha=\beta=\gamma=90^o$)
\end{itemize}


\section{Questions and Difficulties}
\normalsize

Questions and encountered problems should be reported to 
nwchem-users@emsl.pnl.gov 
or to Eric J. Bylaska, Eric.Bylaska@pnl.gov





% LocalWords:  tolc wcut ncut
