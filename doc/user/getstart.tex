\label{sec:getstart}

This section provides an overview of NWChem input and program
architecture, and the syntax used to describe the input.  See Sections
\ref{sec:simplesample} and \ref{sec:realsample} for examples of NWChem
input files with detailed explanation.

NWChem consists of independent modules that perform the various
functions of the code.  Examples of modules include the input parser,
SCF energy, SCF analytic gradient, DFT energy, etc..  Data is passed
between modules and saved for restart using a disk-resident database
or dumpfile (see Section \ref{sec:arch}).

The input to NWChem is composed of commands, called directives, which
define data (such as basis sets, geometries, and filenames), and the
actions to be performed.  Directives are processed in the order
presented in the input file, with the exception of certain start-up
directives (see Section \ref{sec:inputstructure}) which provide
critical job control information and are processed before all other
input.  Most directives are specific to a particular module and define
data that is used by that module only.  A few directives (see Section
\ref{sec:toplevel}) potentially affect all modules, for instance by
specifying the total charge on the system.  

There are two types of directives.  Simple directives consist of one
line of input which may contain multiple fields.  Compound directives
group together multiple simple directives that are in some way
related and are terminated with an \verb+END+ directive.  See the
sample inputs (Sections \ref{sec:simplesample}, \ref{sec:realsample})
and the input syntax specification (Section \ref{sec:syntax}).

All input is free format, and directives or blocks of module-specific
directives can appear in any order, with the exception of the
\verb+TASK+ directive (see sections \ref{sec:inputstructure} and
\ref{sec:task}) which is used to invoke an NWChem module.  Case is
ignored except for actual data (e.g., names/tags of centers, titles).

To make the input as short and simple as possible, most options have
default values.  The user needs to supply input only for those items that
have no defaults, or for items that must be different from the defaults
for the particular application.  In the discussion of each directive, the
defaults are noted, where applicable.

The input file structure is described in the following sections, and
illustrated with two examples.  The input format and syntax for directives
is also described in detail.

\section{Input File Structure}
\label{sec:inputstructure}

The structure of an input file reflects the internal structure of
NWChem.  At the beginning of a calculation NWChem needs to determine
how much memory to use, the name of the database, whether it is a new,
restarted, or continuing job, where to put scratch/permanent files,
etc..  It is not necessary to put this information at the top of the
input file, however.  NWChem will read through the {\em entire} input
file looking for the start-up directives.  In this pass, all other
directives are ignored.

The start-up directives are
\begin{itemize}
\item \verb+START+
\item \verb+CONTINUE+
\item \verb+RESTART+
\item \verb+SCRATCH_DIR+
\item \verb+PERMANENT_DIR+
\item \verb=MEMORY=
\item \verb=ECHO=
\end{itemize}

After the input file has been scanned for the start-up directives, it
is rewound and read sequentially.  Input is processed either by the
top-level parser (for the directives listed in Section
\ref{sec:toplevel}, such as \verb+TITLE+, \verb+SET+, \ldots) or by
the parsers for specific computational modules (e.g., SCF, DFT,
\ldots).  Any directives that have already been processed (e.g.,
\verb+MEMORY+) are ignored.  Input is read until a \verb+TASK+
directive (see Section \ref{sec:task}) is encountered.  A \verb+TASK+
directive request a calculation to be performed and specifies the level
of theory and the operation to be performed.  Input processing then
stops and the specified task is executed.  The position of the
\verb+TASK+ directive in effect marks the end of the input for that
task.  Processing of the input resumes upon the successful completion
of the task and the results of that task are available to subsequent
tasks in the same input file.

The name of the input file is usually provided as an argument to the
execute command for NWChem.  That is, the execute command looks
something like the following;

\begin{verbatim}
  nwchem input_file
\end{verbatim}

The default name for the input file is \verb+nwchem.nw+.  If an input
file name \verb+input_file+ is specified without an extension, the code
assumes a default extension of \verb+input_file.nw+.  If the code cannot
locate a file named either \verb+nwchem.nw+ or \verb+input_file.nw+, an 
error is reported and execution terminates.  The following
section presents two input files to illustrate the directive syntax and 
input file format for NWChem applications.

\section{Simple Input File --- SCF geometry optimization}
\label{sec:simplesample}

A simple example of an NWChem input file is an SCF geometry optimization of
the nitrogen molecule using a Dunning cc-pvdz basis set.  This input
file contains the bare minimum of information the user must specify in
order to run this type of problem --- fewer than ten lines of input,
as follows;
\begin{verbatim}
  title; Nitrogen cc-pvdz SCF geometry optimization
  geometry  
    n 0 0 0
    n 0 0 1.08
  end
  basis
    n library cc-pvdz
  end
  task scf optimize
\end{verbatim}

Examining the input line by line, it can be seen that it contains
only four directives; \verb+TITLE+, \verb+GEOMETRY+, \verb+BASIS+, and
\verb+TASK+.  The \verb+TITLE+ directive is optional, and is used only
as a means for the user to more easily identify outputs from different
jobs.  An initial geometry is specified in Cartesian coordinates and
{\angstroms} by means of the \verb+GEOMETRY+ directive.  The Dunning 
cc-pvdz basis is obtained from the NWChem basis library, as specified
by the \verb+BASIS+ directive input.  The \verb+TASK+ directive requests 
an SCF geometry optimization.

The \verb+GEOMETRY+ directive (Section \ref{sec:geom}) defaults to Cartesian
coordinates and {\angstroms} (options include atomic units and
Z-matrix format; see Section \ref{sec:Z-matrix}).  The \verb+BASIS+ 
directive input block is structured like the \verb+GEOMETRY+ directive
input block (i.e., name,
keyword, \ldots, end) and {\em must} contain basis set information for
every atom type in the geometry with which it will be used.
Refer to Sections \ref{sec:basis} and \ref{sec:ecp}, and Appendix
\ref{sec:knownbasis} for a description of available basis sets and a
discussion of how to define new ones.

The last line of this sample input file ({\tt task scf optimize}),
tells the program to optimize the molecular geometry by minimization
of the SCF energy.  (For a description of possible tasks and the format
of the {\tt task} directive, refer to Section \ref{sec:task}.)

If the input is stored in the file \verb+n2.nw+, the command to run
the job on a typical UNIX workstation is as follows;

\begin{verbatim}
  nwchem n2
\end{verbatim}

NWChem output is to standard output, and error messages are sent to
both standard output and standard error.

\section{Water Molecule Sample Input File}
\label{sec:realsample}

A more complex sample problem is the optimization of a positively
charged water molecule at the MP2 level of theory, followed by a computation of
frequencies at the optimized geometry.  A preliminary SCF geometry
optimization is performed using an inexpensive basis set (STO-3G).
This gives a good starting guess for the geometry, and any Hessian
information generated will be used in the next optimization step.
Then the optimization is finished using second-order M{\o}ller-Plesset
perturbation theory and a basis set with polarization functions.  The
final task is to calculate the vibrational frequencies.  The input
file to accomplish these three tasks is as follows;

\begin{verbatim}
start h2o_freq

title; H2O+ frequencies with MP2 and 6-31g**

geometry units angstroms
  O       0.0  0.0  0.0
  H       0.0  0.0  1.0
  H       0.0  1.0  0.0
end

charge 1

basis "starting basis"
  H library sto-3g
  O library sto-3g
end

basis "final basis"
  H library 6-31g**
  O library 6-31g**
end

scf
  uhf
  doublet
  print low
end

set "ao basis" "starting basis"

task scf optimize

set "ao basis" "final basis"

scf
  vectors input atomic
  print none
end

set "mp2_grad:print" low

task mp2 optimize

set "mp2_grad:print" none

task mp2 freq

eof
\end{verbatim}

The {\tt start} directive (Section \ref{sec:start}) tells NWChem that
this run is to be started from the beginning.  This directive need not
be at the beginning of the input, but it is commonly placed there.
Existing database or vector files are to be ignored or overwritten.
The entry \verb+h2o_freq+ on the \verb+START+ line is the prefix used
for all files created by the calculation.  This convention allows
different jobs to run in the same directory or to share the same
scratch directory (see Section \ref{sec:dirs}), as long as they use
different names in this field.

As in the first sample problem, the geometry is given in Cartesian
coordinates.  In this case, the units are specified as
{\angstroms}.  (Since this is the default, explicit specification of the
units is not actually necessary, however.)  The {\tt CHARGE}
directive defines the total charge of the system.  This calculation is
to be done on an ion with charge +1.  Note that this is a top-level
directive, independent of other input blocks.

The next two directives are the {\tt BASIS} directives.  The names for
the basis sets are arbitrary, and they may be chosen so that they will
serve as a helpful mnemonic for later reference in subsequent input
directives.

The multiple lines of the first {\tt SCF} directive in the {\tt scf
  \ldots end} block specify details about the SCF calculation to be
performed.  For open-shell systems, the spin multiplicity has to be
specified (using {\tt doublet} in this case), or it defaults to {\tt
  singlet}.  Unrestricted Hartree-Fock is chosen here (by specifying
the keyword {\tt uhf}), rather than the default high-spin ROHF.  This
is necessary for the subsequent MP2 calculation, because only UMP2 is
available for open-shell systems currently (see Section
\ref{sec:functionality}).  The print level is set to {\tt low} to
reduce the output from the SCF module to a minimum during the geometry
optimization.

The final step in setting up the input for the SCF calculation is to
specify that the \verb+"starting basis"+ should be used.  This is
accomplished by means of the \verb+SET+ directive, which specifies that 
the \verb+"ao basis"+ is the \verb+"starting basis"+.  All molecular
orbital (MO) methods look for the \verb+"ao basis"+ in which to expand the
MOs.    In the previous example with the nitrogen molecule, it was not 
necessary to use the \verb+SET+ directive in this manner, since the 
\verb+BASIS+ directive used the default name (which is \verb+"ao basis"+).
An alternative approach that could have been used here, which avoids the 
necessity of assigning the basis set name using the
\verb+SET+ directive, would be to defer definition of the final basis
until after the first SCF calculation is complete. 

All input up to this point affects only the settings in the run-time
database.  The program takes its information from this database, so
the sequence of directives up to the first \verb+TASK+ directive is
irrelevant.  An exchange of order of the different blocks or
directives would not affect the result.  The {\tt TASK} directive,
however, must be specified last of all in the list of input directives
for a given problem.  The {\tt TASK} directive invokes the program and
directs the code to perform the specified calculation using the
parameters set in the previous directives. In this case, the first
task is an SCF calculation with geometry optimization, specified with
the input {\tt scf} and {\tt optimize}.  (See Section \ref{sec:task}
for a list of available tasks and operations.)

After the completion of any task, settings in the database are used
in subsequent tasks without change, unless they are overridden by new
input directives.  In this example, there are several important
changes between the first task (\verb+task scf optimize+) and the
second task (\verb+task mp2 optimize+).  The {\tt "ao basis"} is set
to a better basis (i.e., {\tt "final basis"}) using the \verb+SET+
directive.  The SCF output is completely discarded (as a result of the
{\tt print none} input in the {\tt SCF} directive), which means that
no output will be produced unless an error occurs.  The SCF starting
guess vectors are reset to be the atomic guess, since the STO-3G
vectors are not appropriate (see Section \ref{sec:vectors} for
details on the different possible starting guesses).

The second {\tt TASK} directive invokes an MP2 optimization, instead
of the SCF optimization.

Once the MP2 optimization is completed, the geometry obtained in the
calculation is used to perform a frequency calculation.  This task is
invoked by the keyword \verb+freq+ on the directive \verb+task mp2
freq+.  The second derivatives of the energy are calculated as
numerical derivatives of analytical gradients. The gradients as such
are not of interest in this case, so the output from the {\tt
  mp2\_grad} program is completely discarded using the directive
\verb+set "mp2_grad:print" none+.

The {\tt EOF} directive marks the end of the input to be read. It is
not necessary to specify the end-of-file as an explicit directive at
the actual end of the file.  However, using the directive allows the
user to have additional lines in the file that will not be processed
as input.  For example, a description of the calculation(s) specified
in the input or notes on the purpose of the task(s), or other
informational comments can be included in the input file in this way.
The {\tt eof} directive can also be used to remove a task (or series
of tasks) from the calculation without actually removing the relevant
input directives from the file.  Any lines in the file that occur
after the {\tt eof} directive are ignored by the program.

\section{Input Format and Syntax for Directives}
\label{sec:syntax}

This section describes the syntax used in the rest of this
documentation for describing the format of directives.  
The input format for the directives used for NWChem is similar to that
of UNIX shells, which is also used in other chemistry packages, most
notably GAMESS-UK.  An input line is parsed into whitespace (blanks or
tabs) separating tokens or fields.  Any token that contains whitespace
must be enclosed in double quotes in order to be processed correctly.
For example, the basis set with the descriptive name \verb+modified
Dunning DZ+ must appear in a directive as \verb+"modified Dunning
DZ"+, since the name consists of three separate words.  

A (physical) line in the input file is terminated with a newline
character (also known as a 'return' or 'enter' character).  A
semicolon (\verb+;+) can be also used to indicate the end of an input
line, allowing a given physical line of input to contain multiple
logical lines of input.  For example, five lines of input for the
\verb+GEOMETRY+ directive can be entered as follows;
\begin{verbatim}
  geometry
   O 0  0     0
   H 0  1.430 1.107
   H 0 -1.430 1.107
  end
\end{verbatim}
These same five lines could be entered on a single line, as
\begin{verbatim}
  geometry; O 0 0 0; H 0 1.430 1.107; H 0 -1.430 1.107; end
\end{verbatim}
This one physical input line comprises five logical
input lines.  Each logical or physical input line must be no longer
than 1023 characters.  Data is read until an end-of-file is detected,
or until an \verb+EOF+ directive is encountered.

In the input file
\begin{itemize}
\item a string, token, or field is a sequence of ASCII characters (NOTE: if 
the string includes blanks or tabs (i.e., white space) the entire string must
be enclosed in double quotes)
\item \verb+\+ at the end of a line concatenates it with the next line
  (note that a space character is inserted at this point so that it is
  {\em not} possible to split tokens across lines.  Backslash is also
  used to quote special characters such as whitespace, semi-colons, and
  hash symbols so as to avoid their special meaning (NOTE: these special
  symbols must be quoted with backslash even when enclosed within double
  quotes).
\item \verb+;+ (semicolon) is used to mark the end of a logical input 
line within a physical line of input
\item \verb+#+ (the hash or pound symbol) is the comment character.  All
characters following \verb+#+ (up to the physical end of the line) are ignored.
\end{itemize}

Directives consist of a directive name, keywords, and optional input,
and may contain one line or many.  Simple directives consist of a
single line of input with one or more fields.  Compound directives can
have multiple input lines, and can also include other optional simple
and compound directives.  A compound directive is terminated with an
END directive.  The directives START (see Section \ref{sec:start}) and
ECHO (see Section \ref{sec:echo}) are examples of simple directives.
The directive GEOMETRY (see Section \ref{sec:geom}) is an example of a
compound directive.

Some limited checking for self-consistency of the input is performed
by the input module, but most defaults are imposed by the application
modules at runtime.  It is therefore usually impossible to determine
beforehand whether or not all selected options are consistent with each
other.

\sloppy

The following notation and syntax conventions are used in the generic 
descriptions of the NWChem input in the following sections.
\begin{itemize}
\item a directive name always appears in all-capitals, in computer-type 
face; (e.g.; \verb+GEOMETRY+, \verb+BASIS+, \verb+SCF+).  Note that 
the case of directives and keywords is ignored in the actual input.
\item a keyword always appears in lower case, in computer-type face; (e.g.,
{\tt swap}, {\tt print}, {\tt units}, {\tt bqbq})
\item variable names always appear in lower case, in computer-type face, 
and enclosed in angle brackets to distinguish them from keywords (e.g.,
{\tt <input\_filename>}, {\tt <basisname>}, {\tt <tag>})
\item \verb+$variable$+ is used to indicate the substitution of the value of a
      variable
\item \verb+()+ is used to group items (the parentheses and other
      special symbols do not appear in the input)
\item \verb+||+ separate exclusive options/parameters/formats
\item \verb+[ ]+ enclose optional entries with a default value
\item \verb+< >+ enclose a type, a name of a value to be specified,
      and a default value, if any.
\item \verb+\+ is used to concatenate lines in a description.  
\item \verb+...+ is used to indicate indefinite continuation of a list
\end{itemize}

\fussy

An input parameter is identified in the description of the directive
by prefacing the item with the name of the type of data expected;
i.e.,
\begin{itemize}
\item \verb+string +  -- an ASCII character string
\item \verb+integer+ --  integer value(s) for a variable or an array
\item \verb+logical+ --  true/false logical variable
\item \verb+real   +  -- real floating point value(s) for a variable or 
\item \verb+double + -- synonymous with real
an array
\end{itemize}

If an input item is not prefaced by one of these type names,
it is assumed to be of type ``string''.

In addition, integer lists may be specified using Fortran triplet
notation which interprets \verb+lo:hi:inc+ as \verb+lo+, \verb=lo+inc=,
\verb=lo+2*inc=, \ldots, \verb+hi+.  For example, where a list of
integers is expected in the input, the following two lines are
equivalent
\begin{verbatim}
   7 10 21:27:2 1:3 99
   7 10 21 23 25 27 1 2 3 99
\end{verbatim}
 
The directive \verb+VECTORS+ (Section \ref{sec:vectors}) is presented here
as an example of an NWChem input directive.  The general form of the
directive is as follows;
\begin{verbatim}
  VECTORS [input (<string input_movecs default atomic>) || \
                   (project <string basisname> <string filename>)] \
          [swap [(alpha||beta)] <integer vec1 vec2> ...] \
          [output <string output_movecs default $file_prefix$.movecs>]
\end{verbatim}

This directive contains three optional keywords, as indicated by the 
three main sets of square brackets enclosing the keywords \verb+input+,
\verb+swap+, and \verb+output+.  The keyword \verb+input+ allows the
user to specify the source of the molecular orbital vectors.  When
this keyword is invoked, there are two mutually exclusive options for
specifying the vectors, as indicated by the \verb+||+ symbol
separating the descriptions of the two input options;
\begin{verbatim}
  (<string input_movecs default atomic>) || \
                  (project <string basisname> <string filename>) \
\end{verbatim}

The first option, \verb+(<string input_movecs default atomic>)+,
allows the user to specify an ASCII character string for the parameter
{\tt input\_movecs}.  If no entry is specified, the code assumes a
standard source of the vectors with a default of \verb+atomic+ (i.e.,
atomic guess).  The second option, {\tt(project <string basisname>
  <string filename>)}, contains the keyword \verb+project+, which
takes two additional string arguments.  When this keyword is used, the
vectors in file \verb+<filename>+ will be projected from the (smaller)
basis \verb+<basisname>+ into the current AO basis.

The second keyword, \verb+swap+, allows the user to re-order the
starting vectors.  The optional keyword \verb+alpha||beta+ allows the
user to swap the alpha and beta spin orbitals, and specify in pairs
the integer numbers of the vectors to be swapped.  As many pairs as
the user wishes to have swapped can be listed for {\tt <integer vec1
vec2 ... >}.

The third keyword, \verb+output+, allows the user to tell the code
where to store the vectors by specifying an ASCII string for the
parameter {\tt output\_movecs}.  If no entry is specified for this
parameter, the default is to write the vectors back into either the user
specified MO vectors input file or, if this is not available, the file
\verb+$file_prefix$.movecs+.

A particular example of the VECTOR directive is shown below.  It specifies
both the \verb+input+ and \verb+output+ keywords, but does not use the 
\verb+swap+ option.
\begin{verbatim}
  vectors input project "small basis" small_basis.movecs \
          output large_basis.movecs
\end{verbatim}
This directive tells the code to generate input vectors by projecting
from vectors in a smaller basis named \verb+"small basis"+, which is
stored in the file \verb+small_basis.movecs+.  The output vectors will be
stored in the file \verb+large_basis.movecs+.

The order of keyed optional entries within a directive should not matter,
unless noted otherwise in the specific instructions for a particular
directive.
