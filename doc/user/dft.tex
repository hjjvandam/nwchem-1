\label{sec:dft}

The NWChem density functional theory (DFT) module uses the
Gaussian basis set approach to compute
closed shell and open shell densities and Kohn-Sham orbitals
in the: 
\begin{itemize}
\item local density approximation (LDA), 
\item non-local density approximation (NLDA), 
\item local spin-density approximation (LSD), 
\item non-local spin-density approximation (NLSD), and
\item any empirical mixture of local and non-local approximations 
(including exact exchange).
\end{itemize}

The formal scaling of the DFT computation can be reduced by choosing
to use auxiliary Gaussian basis sets to fit the charge density (CD) and/or 
fit the exchange-correlation (XC) potential.

DFT input is provided using the compound \verb+DFT+ directive
\begin{verbatim}
  DFT
    ...
  END
\end{verbatim}
The actual DFT calculation will be performed when the input module
encounters the \verb+TASK+ directive (Section \ref{sec:task}).  
\begin{verbatim}
  TASK DFT
\end{verbatim}

Once a user has specified a geometry and a Kohn-Sham orbital basis set
the DFT module can be invoked with no input directives (defaults 
invoked throughout).  There are sub-directives which allow for 
customized application; those currently provided as options for 
the DFT module are:
\begin{verbatim}
  VECTORS [[input] (<string input_movecs default atomic>) || \
                   (project <string basisname> <string filename>)] \
           [swap [alpha||beta] <integer vec1 vec2> ...] \
           [output <string output_filename default input_movecs>] \
           [lock]


  XC [[acm] [b3lyp] [beckehandh] \
     [becke97]  [becke97-1] [hcth] \
      [HFexch <real prefactor default 1.0>] \
      [becke88 [nonlocal] <real prefactor default 1.0>] \
      [xperdew91 [nonlocal] <real prefactor default 1.0>] \
      [xpbe96 [nonlocal] <real prefactor default 1.0>] \
      [gill96 [nonlocal] <real prefactor default 1.0>] \
      [xhcth  <real prefactor default 1.0>] \
      [lyp <real prefactor default 1.0>] \
      [perdew81 <real prefactor default 1.0>] \
      [perdew86 [nonlocal] <real prefactor default 1.0>] \
      [perdew91 [nonlocal] <real prefactor default 1.0>] \
      [cpbe96 [nonlocal] <real prefactor default 1.0>] \
      [chcth  <real prefactor default 1.0>] \
      [pw91lda <real prefactor default 1.0>] \
      [slater <real prefactor default 1.0>] \
      [vwn_1 <real prefactor default 1.0>] \
      [vwn_2 <real prefactor default 1.0>] \
      [vwn_3 <real prefactor default 1.0>] \
      [vwn_4 <real prefactor default 1.0>] \
      [vwn_5 <real prefactor default 1.0>] \
      [vwn_1_rpa <real prefactor default 1.0>]]


  CONVERGENCE [[energy <real energy default 1e-7>] \
               [density <real density default 1e-5>] \
               [gradient <real gradient default 5e-4>] \
               [dampon <real dampon default 0.0>] \
               [dampoff <real dampoff default 0.0>] \
               [diison <real diison default 0.0>] \
               [diisoff <real diisoff default 0.0>] \
               [levlon <real levlon default 0.0>] \
               [levloff <real levloff default 0.0>] \
               [ncydp <integer ncydp default 2>] \
               [ncyds <integer ncyds default 30>] \
               [ncysh <integer ncysh default 30>] \
               [damp <integer ndamp default 70>] [nodamping] \
               [diis [nfock <integer nfock default 10>]] \
               [nodiis] [lshift <real lshift default 0.5>] \
               [nolevelshifting] \
               [hl_tol <real hl_tol default 0.1>]]


  GRID [(xcoarse||coarse||medium||fine||xfine) default medium] \
       [(gausleg <integer radpts default 50> 
                 <integer nagrid default 10>) ||\ 
        (lebedev <integer radpts default 50> 
                 <integer iangquad default 4>)] \ 
       [delley||becke] \
       [rm <real rm default 2.0>]
        

  TOLERANCES [[tight] [tol_rho <real tol_rho default 1e-10>] \
              [accAOfunc <integer accAOfunc default 20>] \
              [accXCfunc <integer accXCfunc default 20>] \
              [accCoul <integer accCoul default 10>] \
              [accQrad <integer accQrad default 12>] \
              [radius <real radius default 25.0>]]


  DECOMP
  DFT||ODFT
  DIRECT
  INCORE
  ITERATIONS <integer iterations default 30>
  MAX_OVL
  MULLIKEN
  MULT <integer mult default 1>
  NOIO
  PRINT||NOPRINT
\end{verbatim}
%              [accCDfunc <integer accAOfunc default 20>] \
%       [store_wght] [nquad_task <integer nquad_task default 1>] \

The following 
sections describe these keywords and
optional sub-directives that can be specified for a \verb+DFT+ calculation
in NWChem.

\section{Specification of Basis Sets for the DFT Module}

The DFT module requires at a minimum the basis set for the Kohn-Sham 
molecular orbitals.  This basis set must be in the default basis set named
{\tt "ao basis"}, or it must be assigned to this default name using the
\verb+SET+ directive (see Section \ref{sec:set}).

In addition to the basis set for the Kohn-Sham orbitals, 
the charge density fitting basis set can also be specified in the 
input directives for the DFT module.  This basis set is used for the 
evaluation of the Coulomb potential in the Dunlap scheme\footnote{B.I.~Dunlap, 
J.W.D.~Connolly and J.R.~Sabin, J.~Chem.~Phys.~{\bf 71},  4993 (1979)}.
The charge density fitting basis set must have the name {\tt "cd basis"}.
This can be the actual name of a basis set, or a basis set can be 
assigned this name using the \verb+SET+ directive, as described in
Section \ref{sec:set}.  If this basis set is not defined by input,
the $O(N^4)$y exact Coulomb contribution is computed.

The user also has the option of specifying a third basis set for the 
evaluation of the exchange-correlation potential.  This basis set must
have the name {\tt "xc basis"}.  If this basis set is not specified
by input, the exchange contribution (XC) is evaluated by numerical
quadrature.  In most applications, this approach is efficient enough,
so the {\tt "xc basis"} basis set is not generally required.

For the DFT module, the input options for defining the basis sets in a given
calculation can be summarized as follows;
\begin{itemize}
\item {\tt "ao basis"} -- Kohn-Sham molecular orbitals; required for all 
calculations
\item {\tt "cd basis"} -- charge density fitting basis set; optional, but
recommended for evaluation of the Coulomb potential
\item {\tt "xc basis"} -- exchange-correlation (XC) fitting basis set; 
optional, and usually not recommended
\end{itemize}


\section{VECTORS and MAX\_OVL --- KS-MO Vectors}

The \verb+VECTORS+ directive is the same as that in the SCF module
(Section \ref{sec:vectors}).  Currently, the \verb+LOCK+ keyword
is not supported by the DFT module, however the directive
\begin{verbatim}
  MAX_OVL
\end{verbatim}
has the same effect.

\section{XC and DECOMP --- Exchange-Correlation Potentials}
\begin{verbatim}
  XC [[acm] [b3lyp] [beckehandh] \
     [becke97]  [becke97-1] [hcth] \
      [HFexch <real prefactor default 1.0>] \
      [becke88 [nonlocal] <real prefactor default 1.0>] \
      [xperdew91 [nonlocal] <real prefactor default 1.0>] \
      [xpbe96 [nonlocal] <real prefactor default 1.0>] \
      [gill96 [nonlocal] <real prefactor default 1.0>] \
      [xhcth  <real prefactor default 1.0>] \
      [lyp <real prefactor default 1.0>] \
      [perdew81 <real prefactor default 1.0>] \
      [perdew86 [nonlocal] <real prefactor default 1.0>] \
      [perdew91 [nonlocal] <real prefactor default 1.0>] \
      [cpbe96 [nonlocal] <real prefactor default 1.0>] \
      [chcth  <real prefactor default 1.0>] \
      [pw91lda <real prefactor default 1.0>] \
      [slater <real prefactor default 1.0>] \
      [vwn_1 <real prefactor default 1.0>] \
      [vwn_2 <real prefactor default 1.0>] \
      [vwn_3 <real prefactor default 1.0>] \
      [vwn_4 <real prefactor default 1.0>] \
      [vwn_5 <real prefactor default 1.0>] \
      [vwn_1_rpa <real prefactor default 1.0>]]
\end{verbatim}

The user has the option of specifying the exchange-correlation
treatment in the DFT Module.  The default exchange-correlation
functional is defined as the local density approximation (LDA) for
closed shell systems and its counterpart the local spin-density (LSD)
approximation for open shell systems.  Within this approximation the
exchange functional is the Slater $\rho^{1/3}$ functional (from
J.C.~Slater, {\sl Quantum Theory of Molecules and Solids, Vol.~4: The
  Self-Consistent Field for Molecules and Solids} (McGraw-Hill, New
York, 1974)), and the correlation functional is the Vosko-Wilk-Nusair
(VWN) functional (functional V) (S.J.~Vosko, L.~Wilk and M.~Nusair,
Can.~J.~Phys.~{\bf 58}, 1200 (1980)).  The parameters used in this
formula are obtained by fitting to the Ceperley and
Alder\footnote{D.M.~Ceperley and B.J.~Alder, Phys. Rev. Lett. {\bf
    45}, 566 (1980).}
Quantum Monte-Carlo solution of the {\em
  homogeneous electron gas}.

These defaults can be invoked explicitly by specifying the following
keywords within the DFT module input directive,
\begin{verbatim}
  XC slater vwn_5
\end{verbatim}

The \verb+DECOMP+ directive causes the components of the energy
corresponding to each functional to be printed, rather than just the
total exchange-correlation energy which is the default.

Many alternative exchange and correlation functionals are available to
the user.  The following sections describe these options.

\subsection{Optional Exchange Functionals}

There are six exchange functionals in addition to the default exchange
functional.  These are 
\begin{itemize}

\item the Becke 1998 gradient-corrected functional (see A.D.~Becke, 
 J. Chem. Phys. {\bf 88}, 3098 (1988)), is invoked by specifying

\begin{verbatim}
   XC becke88
\end{verbatim}

\item the Perdew 1991 gradient-corrected exchange functional (J.P. Perdew,
  J.A.~Chevary, S.H.~Vosko, K.A.~Jackson, M.R.~Pederson, D.J.~Singh
  and C.~Fiolhais, Phys. Rev. B {\bf 46}, 6671 (1992)), is invoked by specifying

\begin{verbatim}
   XC xperdew91
\end{verbatim}

\item the Perdew-Burke-Ernzerhof gradient-corrected exchange functional \\
 (J.P.~Perdew, K.~Burke and M.~Ernzerhof, Physical Review Letters
{\bf 77}, 3865 (1996); {\bf 78}, 1396 (1997))), is invoked by specifying

\begin{verbatim}
   XC xpbe96
\end{verbatim}

\item the Gill 1996 gradient-corrected exchange functional (P.W.Gill , Mol. Phys. {\bf 89}, 433 (1996)), is invoked by specifying

\begin{verbatim}
   XC gill96
\end{verbatim}

\item the Hamprecht-Cohen-Tozer-Handy  gradient-corrected exchange 
functional
(F.A.Hamprecht, A.J.Cohen, D.J.Tozer and N.C.Handy, 
    J. Chem. Phys. {\bf 109}, 6264 (1998))
\begin{verbatim}
   XC xhcth
\end{verbatim}

\item The Hartree-Fock exact exchange functional, (which has $O(N^4)$
computation expense), is invoked by specifying
\begin{verbatim}
   XC HFexch
\end{verbatim}
\end{itemize}

Note that the user also has the ability to include only the local or
nonlocal contributions of a given functional.  In addition the user
can specify a multiplicative prefactor (the variable
\verb+<prefactor>+ in the input) for the local/nonlocal component or
total.  An example of this might be,
\begin{verbatim}
   XC becke88 nonlocal 0.72
\end{verbatim}
The user should be aware that the Becke88 local component is simply
the Slater exchange and should be input as such.

Any combination of the supported exchange functional options can be
used.  For example the popular Gaussian B3 exchange could be specified
as:
\begin{verbatim}
   XC slater 0.8 becke88 nonlocal 0.72 HFexch 0.2
\end{verbatim}

  
\subsection{Optional Correlation Functionals}

In addition to the default \verb+vwn_5+ correlation functional, the user has
10 alternative correlation functionals to choose from: lyp, perdew81,
perdew86, perdew91, pw91lda, \verb+vwn_1+, \verb+vwn_2+, \verb+vwn_3+,
\verb+vwn_4+, and \verb+vwn_1_rpa+.

As in the exchange functional input, individual local/nonlocal
components as well as multiplicative prefactors can be invoked where
appropriate.  Each of the correlation functionals is listed below along with
appropriate citation. 

\sloppy

\begin{itemize}
\item VWN local density functionals; S.J.~Vosko, L.~Wilk and M.~Nusair, 
  Can.~J.~Phys.~{\bf  58}, 1200 (1980); all five (5) functionals as
  described in this paper (addressed in the paper as I - V) have been
  implemented.  These functionals can be invoked with the keywords:
\begin{verbatim}
   XC vwn_1
   XC vwn_2
   XC vwn_3
   XC vwn_4
   XC vwn_5
\end{verbatim}

  Note that functionals; \verb+vwn_2+, \verb+vwn_3+, and \verb+vwn_4+
  require both sets of parameters (the Monte Carlo parameters of
  Ceperley and Alder and VWN's RPA parameters) used in fitting the
  homogeneous electron gas correlation energy.  Functionals
  \verb+vwn_1+ and \verb+vwn_5+ require only the Monte Carlo fitting
  parameters.  In order to reproduce results in the literature another
  functional was added; the \verb+vwn_1_rpa+.  This is the original
  \verb+vwn_1+ functional with RPA parameters as opposed to the
  prescribed Monte Carlo parameters.  This functional can be invoked
  with the keyword,
\begin{verbatim}
   XC vwn_1_rpa
\end{verbatim}

\item Perdew81 local density functional; J.~P.~Perdew and A.~Zunger,
  Phys.~Rev.~B {\bf23}, 5048 (1981). This functional can be invoked with the
  keyword,
\begin{verbatim}
   XC perdew81
\end{verbatim}

\item Perdew \& Wang 1991 local density functional;  J.P.~Perdew
  and Y.~Wang, Phys. Rev. B {\bf 45}, 13244 (1992).  The parameters
  used in this formula are obtained by fitting to the Ceperley and
  Alder Quantum Monte Carlo solution of the {\em
  homogeneous electron gas}.  This functional can be invoked with the
  keyword,
\begin{verbatim}
   XC pw91lda
\end{verbatim}

\item Perdew86 gradient-corrected functional; J.~P.~Perdew, Phys.~Rev.~B 
  {\bf33}, 8822 (1986).  Note that this is a nonlocal functional and
  in the absence of any local functional specification the local
  component is defaulted to the perdew81 local correlation
  functional. This functional can be invoked with the
  keyword,
\begin{verbatim}
   XC perdew86
\end{verbatim}

\item Perdew91 gradient-corrected functional;  J.P.~Perdew,
  J.A.~Chevary, S.H.~Vosko, K.A.~Jackson, M.R.~Pederson, D.J.~Singh
  and C.~Fiolhais, Phys. Rev. B {\bf 46}, 6671 (1992). Note that this
  is a nonlocal functional and in the absence of any local functional 
  specification the local component is defaulted to the \verb+pw91lda+ local 
  correlation functional.  This functional can be invoked with the keyword,
\begin{verbatim}
   XC perdew91
\end{verbatim}

\item the Perdew-Burke-Ernzerhof gradient-corrected correlation functional \\
 (J.P.~Perdew, K.~Burke and M.~Ernzerhof, Physical Review Letters
{\bf 77}, 3865 (1996); {\bf 78}, 1396 (1997))), is invoked by specifying

\begin{verbatim}
   XC cpbe96
\end{verbatim}

\item the Hamprecht-Cohen-Tozer-Handy  gradient-corrected correlation 
functional
(F.A.Hamprecht, A.J.Cohen, D.J.Tozer and N.C.Handy, 
    J. Chem. Phys. {\bf 109}, 6264 (1998))
\begin{verbatim}
   XC chcth
\end{verbatim}

\item LYP gradient-corrected functional; C.~Lee, W.~Yang and
   R.~G.~Parr, Phys.~Rev.~B {\bf 37}, 785 (1988).  Note that this
  is a local and nonlocal functional but cannot be conveniently split
  into the individual components.  The option to scale the total remains.
  This functional can be invoked with the keyword,
\begin{verbatim}
   XC lyp
\end{verbatim}

\end{itemize}

\fussy

Any combination of the supported correlation functional options can be
used.  For example the correlation component of the popular B3LYP
could be specified as:
\begin{verbatim}
   XC vwn_1_rpa 0.19 lyp 0.81
\end{verbatim}

  
\subsection{Combined Exchange and Correlation Functionals}

In addition to the options listed above for the exchange and correlation
functionals, the user has the alternative of specifying combined exchange and 
correlation functionals.
  The available hybrid functionals consist of the Becke
``{\sl half and half}'' (see A.D.~Becke, J.~Chem.~Phys.~98, 1372 (1992)), the
adiabatic connection method (see A.D.~Becke, J.~Chem.~Phys.~98, 5648
(1993)),  b3lyp (popularized by Gaussian9X), Becke 1997 (``Becke V'' paper: A.D.Becke, J. Chem. Phys., {\bf 107}, 8554 (1997)

These options can be invoked by specifying any of the following input lines,
\begin{verbatim}
   XC beckehandh
   XC acm
   XC b3lyp
   XC becke97
   Xc becke97-1
\end{verbatim}

The keyword \verb+beckehandh+ specifies that the exchange-correlation energy will be
computed as 
\begin{eqnarray*}
E_{XC} \ \approx \ \frac{1}{2} E^{\rm HF}_X + \frac{1}{2} E^{\rm
  Slater}_{X} + \frac{1}{2} E^{\rm PW91LDA}_{C}
\end{eqnarray*}
We know this is NOT the correct Becke perscribed implementation which
requires the XC potential in the energy expression.  But this is what
is currently implemented as an approximation to it.

\clearpage


The keyword \verb+acm+ specifies that the exchange-correlation energy
is computed as
\begin{eqnarray*}
E_{XC} \ &=& \ a_0 E^{\rm HF}_X + (1-a_0) E^{\rm Slater}_{X} +
a_X \Delta E^{\rm Becke88}_{X} + E^{\rm VWN}_C + a_C \Delta E^{Perdew91}_C \\
& &{\rm where } \\
a_0 &=& 0.20, \ a_X = 0.72, \ a_C = 0.81
\end{eqnarray*}
and $\Delta$ stands for a non-local component.


The keyword \verb+b3lyp+ specifies that the exchange-correlation energy
is computed as
\begin{eqnarray*}
E_{XC} \ &=& \ a_0 E^{\rm HF}_X + (1-a_0) E^{\rm Slater}_{X} +
a_X \Delta E^{\rm Becke88}_{X} + (1-a_C)E^{\rm \verb+VWN_1_RPA+}_C + a_C E^{LYP}_C \\
& &{\rm where } \\
a_0 &=& 0.20, \ a_X = 0.72, \ a_C = 0.81
\end{eqnarray*}


The keyword \verb+becke97-1+ specifies  the hybrid exchange-correlation energy
derived by Handy et al by re-fitting the Becke 1997 functional
(F.A.Hamprecht, A.J.Cohen, D.J.Tozer and N.C.Handy, 
    J. Chem. Phys. {\bf 109}, 6264 (1998))

The keyword \verb+hcth+ specifies the  exchange-correlation energy 
functional derived by Hamprecht-Cohen-Tozer-Handy 
(this is not a hybrid functional)
(F.A.Hamprecht, A.J.Cohen, D.J.Tozer and N.C.Handy, 
    J. Chem. Phys. {\bf 109}, 6264 (1998))



\section{ITERATIONS --- Number of SCF iterations}

\begin{verbatim}
  ITERATIONS <integer iterations default 30>
\end{verbatim}

The default optimization in the DFT module is to iterate on the 
Kohn-Sham (SCF) equations for a specified number of iterations
(default 30).  The keyword that controls this optimization 
is \verb+ITERATIONS+, and has the following general form,

\begin{verbatim}
   iterations <integer iterations default 30>
\end{verbatim}

The optimization procedure will stop when the specified number of
iterations is reached or convergence is met.

\section{CONVERGENCE --- SCF Convergence Control}

\begin{verbatim}
  CONVERGENCE [energy <real energy default 1e-6>] \
              [density <real density default 1e-5>] \
              [gradient <real gradient default 5e-4>] \
              [hl_tol <real hl_tol default 0.1>]
              [dampon <real dampon default 0.0>] \
              [dampoff <real dampoff default 0.0>] \
              [ncydp <integer ncydp default 2>] \
              [ncyds <integer ncyds default 30>] \
              [ncysh <integer ncysh default 30>] \
              [damp <integer ndamp default 70>] [nodamping] \
              [diison <real diison default 0.0>] \
              [diisoff <real diisoff default 0.0>] \
              [(diis [nfock <integer nfock default 10>]) || nodiis] \
              [levlon <real levlon default 0.0>] \
              [levloff <real levloff default 0.0>] \
              [(lshift <real lshift default 0.5>) || nolevelshifting] \
\end{verbatim}

Convergence is satisfied by meeting any or all of three criteria;
\begin{itemize}
\item convergence of the total energy; this is defined to be when the
  total DFT energy at iteration N and at iteration N-1 differ by a value less
  than some value (the default is 1e-6).  This value can be modified
  using the key word,
\begin{verbatim}
  CONVERGENCE energy <real energy default 1e-6>
\end{verbatim}

\item convergence of the total density; this is defined to be when the
  total DFT density matrix at iteration N and at iteration N-1 have a
  RMS difference less than some value (the default is 1e-5).  This value can be modified
  using the key word,
\begin{verbatim}
  CONVERGENCE density <real density default 1e-5>
\end{verbatim}

\item convergence of the orbital gradient; this is defined to be when the
  DIIS error vector becomes less than some value (the default is
  5e-4).  This value can be modified using the key word,
\begin{verbatim}
  CONVERGENCE gradient <real gradient default 5e-4>
\end{verbatim}
\end{itemize}

The default optimization strategy is to immediately begin direct
inversion of the iterative subspace\footnote {P.~Pulay, Chem.\ Phys.\ 
  Lett.\ {\bf 73}, 393 (1980) and P.~Pulay, J.~Comp.~Chem.~{\bf 3},
  566 (1982)}.  Damping is also initiated (using 70\% of the previous
density) for the first 2 iteration.  In addition, if the HOMO - LUMO
gap is small and the Fock matrix somewhat diagonally dominant, then
level-shifting is automatically initiated.  There are a variety of ways
to customize this procedure to whatever is desired.

An alternative optimization strategy is to specify, by using the change 
in total energy (from iterations when N and N-1), when to turn
damping, level-shifting, and/or DIIS on/off.  Start and stop keywords for
each of these is available as,
\begin{verbatim}
  CONVERGENCE  [dampon <real dampon default 0.0>] \
               [dampoff <real dampoff default 0.0>] \
               [diison <real diison default 0.0>] \
               [diisoff <real diisoff default 0.0>] \
               [levlon <real levlon default 0.0>] \
               [levloff <real levloff default 0.0>]
\end{verbatim}

So, for example, damping, DIIS, and/or level-shifting can be turned
on/off as desired.

Another strategy can be to simply specify how many iterations (cycles) you wish
each type of procedure to be used.  The necessary keywords to control
the number of damping cycles (ncydp), the number of DIIS cycles
(ncyds), and the number of level-shifting cycles (ncysh) are input as,
\begin{verbatim}
  CONVERGENCE  [ncydp <integer ncydp default 2>] \
               [ncyds <integer ncyds default 30>] \
               [ncysh <integer ncysh default 0>]
\end{verbatim}

The amount of damping, level-shifting, time at which level-shifting is
automatically imposed, and Fock matrices used in the DIIS
extrapolation can be modified by the following keywords
\begin{verbatim}
  CONVERGENCE  [damp <integer ndamp default 70>] \
               [diis [nfock <integer nfock default 10>]] \
               [lshift <real lshift default 0.5>] \
               [hl_tol <real hl_tol default 0.1>]]
\end{verbatim}

Damping is defined to be the percentage of the previous iterations
density mixed with the current iterations density.  So, for example 
\begin{verbatim}
  CONVERGENCE damp 70
\end{verbatim}
would mix 30\% of the current iteration density with 70\% of the
previous iteration density.

Level-Shifting\footnote {M.F.~Guest and 
V.R.~Saunders, Mol.~Phys.~{\bf 28}, 819 (1974)} is defined as the
amount of shift applied to the diagonal elements of the unoccupied
block of the Fock matrix.  The shift is specified by the
keyword \verb+lshift+.  For example the directive,
\begin{verbatim}
  CONVERGENCE lshift 0.5
\end{verbatim}
causes the diagonal elements of the Fock matrix
corresponding to the virtual orbitals to be shifted by 0.5 au.
By default, this level-shifting procedure is switched on whenever the
HOMO-LUMO gap is small.  Small is defined by default to be 0.05 au but
can be modified by the directive \verb+hl_tol+.  An example of
changing the HOMO-LUMO gap tolerance to 0.01 would be,
\begin{verbatim}
  CONVERGENCE hl_tol 0.01
\end{verbatim}

Direct inversion of the iterative subspace with extrapolation of up to
10 Fock matrices is a default optimization procedure.  For large
molecular systems the amount of available memory may preclude the ability to
store this number of N**2 arrays in global memory.  The user may then
specify the number of Fock matrices to be used in the extrapolation
(must be greater than three (3) to be effective).  To set the number of
Fock matrices stored and used in the extrapolation procedure to 3
would take the form,
\begin{verbatim}
  CONVERGENCE diis 3
\end{verbatim}

Finally, the user has the ability to simply turn off any optimization
procedures deemed undesirable with the obvious keywords,
\begin{verbatim}
  CONVERGENCE [nodamping] [nodiis] [nolevelshifting]
\end{verbatim}


\section{GRID --- Numerical Integration of the XC Potential}

\begin{verbatim}
  GRID [(xcoarse||coarse||medium||fine||xfine) default medium] \
       [(gausleg <integer radpts default 50> 
                 <integer nagrid default 10>) ||\ 
        (lebedev <integer radpts default 50> 
                 <integer iangquad default 4>)] \ 
       [delley||becke] \
       [rm <real rm default 2.0>]
\end{verbatim}

A numerical integration is necessary for the evaluation of the
exchange-correlation contribution to the density functional.  The
default quadrature used for the numerical integration is an
Euler-MacLaurin scheme for the radial components and a Gauss-Legendre
scheme for the angular components (see C.W.~Murray, N.C.~Handy, and
G.L.Laming, Mol.~Phys.~78, 997-1014, (1993)).  Within this numerical
integration procedure various levels of accuracy have been defined and
are available to the user.  The user can specify the level of accuracy
with the keywords; xcoarse, coarse, medium, fine, and xfine.  The
default is medium.

\begin{verbatim}
  GRID [xcoarse||coarse||medium||fine||xfine]
\end{verbatim}

Our intent is to have a numerical integration scheme which would give
us approximately the accuracy defined below regardless of molecular
composition.  
\begin{center}
  \begin{tabular}[right]{|c|c|} \hline
Keyword & {\tt Total Energy Target Accuracy} \\ \hline
{\tt xcoarse} & $1x10^{-4}$ \\ \hline
{\tt coarse}  & $1x10^{-5}$ \\ \hline
{\tt medium}  & $1x10^{-6}$ \\ \hline
{\tt fine}    & $1x10^{-7}$ \\ \hline
{\tt xfine}   & $1x10^{-8}$ \\ \hline
  \end{tabular} \\
\end{center}

In order to determine the level of radial and angular quadrature needed
to give us the target accuracy we computed total DFT energies 
at the LDA level of theory for many
homonuclear atomic, diatomic and triatomic systems in rows 1-4 of the
periodic table.  In each case all bond lengths were set to twice the
Bragg-Slater radius.  The total DFT energy of the system was computed
using the converged SCF density with atoms having radial shells
ranging from 35-235 (at fixed 48/96 angular quadratures) and angular
quadratures of 12/24-48/96 (at fixed 235 radial shells).  The error of
the numerical integration was determined by comparison to a ``best''
or most accurate calculation in which a grid of 235 radial points 48
theta and 96 phi angular points on each atom was used.  This
corresponds to approximately 1 million points per atom.  The following
tables were empirically determined to give the desired target accuracy
for DFT total energies.  These tables below show the number of radial and
angular shells which the DFT module will use for for a given atom
depending on the row it is in (in the periodic table) and the desired
accuracy.  Note, differing atom types in a given molecular system will
most likely have differing associated numerical grids.  The intent is
to generate the desired energy accuracy (with utter disregard for speed).

{\bf Important note to users.}  We clearly understand that the default
(Euler-MacLaurin/Gauss-Legendre) grids are large and result in slow
construction of the numerical components of the Kohn-Sham equations.
Alternatively, we have provided access to two-dimensional Lebedev
angular quadratures which can be used in many cases to substantially
reduce the number of grid points per atom while keeping good accuracy.
We have not yet had the opportunity to benchmark the Lebedev angular
quadratures to the same extent that we have for the Gauss-Legendre.
We therefore do not have default Lebedev quadratures for specific
target accuracy for all elements of the periodic table.  If the user
wants to significantly decrease CPU time to solution it is suggested
that a few prototype benchmark calculations be done using various
Lebedev quadratures (which we describe below) while monitoring the
numerically integrated density and total energies for the molecular
systems of interest.  For many examples we have observed speed-ups of
two or more for the same numerical accuracy when using Lebedev rather
than the default Gauss-Legendre quadrature.  In addition, we have
observed that with Lebedev angular quadratures a reduction in the
number of radial shells (perhaps by as much as 30\%) might be possible
while continuing to provide the same level of accuracy.


\begin{table}[h]
\begin{center}
\caption{Program default number of radial and angular shells empirically determined for Row 1 atoms
  (Li $\rightarrow$ F) to reach the desired accuracies.}

\vspace{.2in}

  \begin{tabular}[right]{|c|c|c|c|} \hline
Keyword & {\tt Radial} & {\tt Theta} & {\tt phi} \\ \hline
{\tt xcoarse} & 30 & 12 & 24  \\ \hline
{\tt coarse}  & 50 & 15 & 30  \\ \hline
{\tt medium}  & 70 & 18 & 36  \\ \hline
{\tt fine}    &100 & 24 & 48  \\ \hline
{\tt xfine}   &140 & 34 & 68  \\ \hline
  \end{tabular} \\
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\caption{Program default number of radial and angular shells empirically determined for Row 2 atoms
  (Na $\rightarrow$ Cl) to reach the desired accuracies.}

\vspace{.2in}

  \begin{tabular}[right]{|c|c|c|c|} \hline
Keyword & {\tt Radial} & {\tt Theta} & {\tt phi} \\ \hline
{\tt xcoarse} & 45 & 12 & 24  \\ \hline
{\tt coarse}  & 75 & 18 & 36  \\ \hline
{\tt medium}  & 95 & 24 & 48  \\ \hline
{\tt fine}    &125 & 30 & 60  \\ \hline
{\tt xfine}   &175 & 44 & 88  \\ \hline
  \end{tabular} \\
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\caption{Program default number of radial and angular shells empirically determined for Row 3 atoms
  (K $\rightarrow$ Br) to reach the desired accuracies.}

\vspace{.2in}

  \begin{tabular}[right]{|c|c|c|c|} \hline
Keyword & {\tt Radial} & {\tt Theta} & {\tt phi} \\ \hline
{\tt xcoarse} & 75 & 14 & 28  \\ \hline
{\tt coarse}  & 95 & 22 & 44  \\ \hline
{\tt medium}  &110 & 30 & 60  \\ \hline
{\tt fine}    &160 & 34 & 68  \\ \hline
{\tt xfine}   &210 & 38 & 76  \\ \hline
  \end{tabular} \\
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\caption{Program default number of radial and angular shells empirically determined for Row 4 atoms
  (Rb $\rightarrow$ I) to reach the desired accuracies.}

\vspace{.2in}

  \begin{tabular}[right]{|c|c|c|c|} \hline
Keyword & {\tt Radial} & {\tt Theta} & {\tt phi} \\ \hline
{\tt xcoarse} &105 & 16 & 32  \\ \hline
{\tt coarse}  &130 & 20 & 40  \\ \hline
{\tt medium}  &155 & 32 & 64  \\ \hline
{\tt fine}    &205 & 44 & 88  \\ \hline
{\tt xfine}   &235 & 48 & 96  \\ \hline
  \end{tabular} \\
\end{center}
\end{table}


In addition to the simple keyword specifying the desired accuracy as
described above, the user has the option of specifying a custom
quadrature of this type in which ALL atoms have the same grid
specification.  This is accomplished by using the \verb+gausleg+ keyword.

\begin{verbatim}
  GRID gausleg <integer nradpts default 50> <integer nagrid default 10> 
\end{verbatim}

In this type of grid, the number of phi points is twice the number of
theta points. So, for example, a specification of,
\begin{verbatim}
  GRID gausleg 80 20
\end{verbatim}
would be interpreted as 80 radial points, 20 theta points, and 40
phi points per center (or 64000 points per center before pruning).

A second quadrature available for the numerical integration is an
Euler-Mac\-Laurin scheme for the radial components and a Lebedev
scheme for the angular components\footnote{The subroutine 
for the Lebedev grid was derived from a routine supplied by M.~Caus\`a
of the University of Torino.}.  
Within this numerical integration procedure various levels 
of accuracy have also been defined and are available to the user.  
The input for this type of grid takes the form,
\begin{verbatim}
  GRID lebedev <integer radpts default 50> <integer iangquad default 4> 
\end{verbatim}
In this context the variable iangquad specifies a certain number of
angular points as indicated by the table below.\footnote{The first 10
quadratures up to order 59 are from
B. Delley, Journal of Computational Chemistry {\bf 17}, 1152 (1996);
the last quadrature, of oder 131, is from
V.I. Lebedev and D.N. Laikov, Doklady Mathematics {\bf 366}, 741 (1999)
}

\begin{center}
\begin{tabular}[right]{|l|r r r r r r r r r r r|} \hline
$IANGQUAD$ & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 &11\\ \hline
$N_{angular}$ & 38 & 50 & 110 & 194 & 302 & 434 & 590 & 770 & 974 &
1202& 5810\\ \hline
\end{tabular}
\end{center}

Therefore the user can specify any number of radial points along with
the level of angular quadrature (1-10).

The user can also specify grid parameters specific for a given atom type: 
parameters that must be supplied are: atom tag, number of radial points, number
of angular points and \verb+accQrad+ (all three parameters must be given).
As an example, here is a grid input line for the water molecule
\begin{verbatim}
grid lebedev 80 5 H 70 4 12 O 90 5 15 
\end{verbatim}

%       [store_wght] [nquad_task <integer nquad_task default 1>] \
%{\bf JEFF: store\_weight and nquad\_task need explaining}
%store\_weight and nquad_task keywords will remain as expert user only
% and not advertised until further tested. -jan
%

% Delley weights do not work .. need to replace with SSWs after input is
%changed  
%The user also has the option of choosing one of two types of spatial weights
%implemented in the numerical integration of the XC terms; Delley and Becke.

%\begin{verbatim}
%  GRID [(becke||delley) default becke]
%\end{verbatim}

\section{TOLERANCES --- Screening tolerances}

\begin{verbatim}
  TOLERANCES [[tight] [tol_rho <real tol_rho default 1e-10>] \
              [accAOfunc <integer accAOfunc default 20>] \
              [accXCfunc <integer accXCfunc default 20>] \
              [accCoul <integer accCoul default 10>] \
              [accQrad <integer accQrad default 12>] \
              [radius <real radius default 25.0>]]
\end{verbatim}
%              [accCDfunc <integer accAOfunc default 20>] \
%
%{\bf JEFF: tight needs explanation}
%
The user has the option of controlling screening for the tolerances in
the integral evaluations for the DFT module.  In most applications,
the default values will be adequate for the calculation, but different
values can be specified in the input for the DFT module using the
keywords described below.

The input to define a screening tolerance for evaluation of the AO 
Gaussian functions is specified with the keyword \verb+accAOfunc+, as
follows,
\begin{verbatim}
  TOLERANCES accAOfunc <integer accAOfunc>
\end{verbatim}
A Gaussian Type Function of the Orbital basis set is 
evaluated at a point $r_i$ if its value it is greater than 
$exp(-${\tt accAOfunc}$)$ ;
the default value is set to $-ln(\Delta E)$, where $\Delta E$ is the desired 
accuracy on energy.
%A Gaussian orbital basis (AO) function with exponent $\zeta$
%and radial factor $e^{-\zeta\cdot r_i^2}$ is 
%evaluated  at a point $r_i$ only if 
%$\zeta\cdot r_i^2$ is less than the value specified for ${\tt accAOfunc}$.

%The input to define a screening tolerance for evaluation of the exchange-
%correlation (XC) Gaussian fitting functions is specified with the
%keyword \verb+accXCfunc+, as follows,
%\begin{verbatim}
%  TOLERANCES accXCfunc <integer accXCfunc default 20>
%\end{verbatim}
%An exchange-correlation (XC) fitting function with exponent $\zeta$
%and radial factor $e^{-\zeta\cdot r_i^2}$ is 
%evaluated  at a point $r_i$ only if 
%$\zeta\cdot r_i^2$ is less than the value specified for ${\tt accXCfunc}$.
%
%The input to define a screening tolerance for evaluation of the
%charge-density (CD) Gaussian fitting functions is specified with the
%keyword \verb+accCDfunc+, as follows,
%\begin{verbatim}
%  TOLERANCES accCDfunc <integer accCDfunc default 20>
%\end{verbatim}
%A  charge-density (CD) fitting function with exponent $\zeta$
%and radial factor $e^{-\zeta\cdot r_i^2}$ is evaluated  at a 
%point $r_i$ only if $\zeta\cdot r_i^2$ is less than the value 
%specified for ${\tt accCDfunc}$.

The input
parameter {\tt accCoul} is used to define the tolerance in Schwarz 
screening for the Coulomb integrals.  Only integrals with estimated
values greater than $10^{(-{\tt accCoul})}$ are evaluated.

\begin{verbatim}
  TOLERANCES accCoul <integer accCoul default 10>
\end{verbatim}

The user also has the option of specifying the radial quadrature 
grid cut-off for the DFT calculation, using the keyword
\verb+accQrad+.  The input line for this option is as follows,
\begin{verbatim}
  TOLERANCES accQrad <integer accQrad default 12>
\end{verbatim}

The value entered for \verb+accQrad+ is the cutoff distance, in bohr, for grid
points around a given center or atom.  Grid points that lie more than 
\verb+accQrad+ bohr from the center or atom are neglected. 

Screening away needless computation of the XC functional (on the grid)
due to negligible density is also possible with the use of,
\begin{verbatim}
  TOLERANCES tol_rho <real tol_rho default 1e-10>
\end{verbatim}
XC functional computation is bypassed if the corresponding density
elements are less than \verb+tol_rho+.

A screening parameter, \verb+radius+, used in the screening of the
Becke or Delley spatial weights is also available as,
\begin{verbatim}
  TOLERANCES radius <real radius default 25.0>
\end{verbatim}
where radius is the cutoff value in bohr.

The tolerances as discussed previously are insured at convergence.
More sleazy tolerances are invoked early in the iterative process
which can speed things up a bit.  This can also be problematic at
times because it introduces a discontinuity in the convergence
process.  To avoid use of initial sleazy tolerances the user can
invoke the \verb+tight+ option:

\begin{verbatim}
  TOLERANCES tight 
\end{verbatim}

This option sets all tolerances to their
default/user specified values at the very first iteration.


\section{DIRECT and NOIO --- Hardware Resource Control}
\begin{verbatim}
  DIRECT||INCORE
  NOIO
\end{verbatim}

\sloppy

The inverted charge-density and exchange-correlation matrices
for a DFT calculation are normally written to disk storage.  The user
can prevent this by specifying the keyword \verb+noio+ within the
input for the DFT directive.  The input to exercise this option is
as follows,
\begin{verbatim}
   noio
\end{verbatim}
If this keyword is encountered, then the two matrices (inverted
charge-density and exchange-correlation) are computed ``on-the-fly''
whenever needed.  

The \verb+INCORE+ option is always assumed to be true but can be
overridden with the option \verb+DIRECT+ in which case all integrals
are computed ``on-the-fly''.

\fussy

\section{DFT,  ODFT and  MULT --- Open shell systems}
\begin{verbatim}
  DFT||ODFT
  MULT <integer mult default 1>
\end{verbatim}

Both {\sl closed-shell} and {\sl open-shell} systems can be studied using
the DFT module.  Specifying the keyword \verb+MULT+ within the \verb+DFT+
directive allows the user to define the spin multiplicity of the system.
The form of the input line is as follows;
\begin{verbatim}
   MULT <integer mult default 1> 
\end{verbatim}
When the keyword \verb+MULT+ is specified, the user can define the integer
variable \verb+mult+, where \verb+mult+ is equal to the number of alpha 
electrons minus beta electrons, plus 1.

The keywords \verb+DFT||ODFT+ were originally intended to specify
closed or open shell and are really unnecessary except in the context
of forcing a closed-shell system to be computed as an open shell
system (i.e., using a spin-unrestricted wavefunction).

\section{MULLIKEN --- Mulliken analysis}
\begin{verbatim}
  MULLIKEN
\end{verbatim}

Mulliken analysis of the charge distribution is invoked by the keyword:
\begin{verbatim}
  MULLIKEN
\end{verbatim}
When this keyword is encountered, Mulliken analysis of both the input 
density as well as the output density will occur.

\section{Print Control}
\begin{verbatim}
  PRINT||NOPRINT
\end{verbatim}

The \verb+PRINT||NOPRINT+ options control the level of output in the
DFT.  Known controllable print options are:

\begin{table}[htbp]
\begin{center}
\begin{tabular}{lcc}
  {\bf Name}          & {\bf Print Level} & {\bf Description} \\
 ``semi-direct info''               & default     & semi direct algorithm \\
 ``coulomb fit''                    & high        & fitting electronic charge density \\
 ``io info''                        & debug       & reading from and writing to disk  \\
 ``information''                    & low         & general information  \\
 ``quadrature''                     & high        & numerical quadrature  \\
 ``parameters''                     & default     & input parameters \\
 ``convergence''                    & default     & convergence of SCF procedure \\
 ``intermediate vectors''           & high        & intermediate molecular orbitals \\
 ``intermediate evals''             & high        & intermediate orbital energies \\
 ``intermediate overlap''           & high        & overlaps between the alpha and beta sets \\
 ``intermediate S2''                & high        & values of S2 \\
 ``interm vector symm''             & high        & symmetries of intermediate orbitals \\
 ``dft timings''                    & high        & \\
 ``initial vectors''                & high        & \\
 ``common''                         & debug       & dump of common blocks \\
 ``screening parameters''           & high        & integral accuracies \\
 ``intermediate energy info''       & high        & \\
 ``intermediate fock matrix''       & high        & \\
 ``final vectors''                  & high        & \\
 ``schwarz''                        & high        & integral screening info \& stats at completion\\
 ``all vector symmetries''          & high        & symmetries of all molecular orbitals \\
 ``final vector symmetries''        & default     & symmetries of final molecular orbitals \\
 ``multipole''                      & default     & moments of alpha, beta, and nuclear charge densities \\
\end{tabular}
\end{center}
\caption{DFT Print Control Specifications}
\end{table}




