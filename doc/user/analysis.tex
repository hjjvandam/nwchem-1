\label{sec:analysis}
\def\bmu{\mbox{\boldmath $\mu$}}
\def\bE{\mbox{\bf E}}
\def\br{\mbox{\bf r}}
\def\tT{\tilde{T}}
\def\t{\tilde{1}}
\def\ip{i\prime}
\def\jp{j\prime}
\def\ipp{i\prime\prime}
\def\jpp{j\prime\prime}
\def\etal{{\sl et al.}}
\def\nwchem{{\bf NWChem}}
\def\nwargos{{\bf nwargos}}
\def\nwtop{{\bf nwtop}}
\def\nwrst{{\bf nwrst}}
\def\nwsgm{{\bf nwsgm}}
\def\esp{{\bf esp}}
\def\md{{\bf md}}
\def\prepare{{\bf prepare}}
\def\analysis{{\bf analysis}}
\def\argos{{\bf ARGOS}}
\def\amber{{\bf AMBER}}
\def\charmm{{\bf CHARMM}}
\def\discover{{\bf DISCOVER}}
\def\ecce{{\bf ecce}}

The \analysis\ module is used to analyze molecular trajectories generated
by the \nwchem\ molecular dynamics module, or partial charges generated
by the \nwchem\ electrostatic potential fit module.

Directives for the \analysis\ module are read from an input deck,

\begin{verbatim}
analysis
 ...
end
\end{verbatim}

The analysis is performed during a molecular dynamics simulation if the
{\rm update analysis} frquency is defined in the {\rm md} input deck, or
as post analysis of trajectory files through the {\rm task} directive

\begin{verbatim}
task analysis
\end{verbatim}

or

\begin{verbatim}
task analyze
\end{verbatim}

\section{Reference coordinates}

For several analyses a set of reference coordinates is required. These
coordinates are read from a \nwchem\ restart file by the directive,

\begin{verbatim}
reference <string filename>
\end{verbatim}

where {\rm filename} is the name of an existing restart file. This
input is required.

\section{Selection}

Analyses can be applied to a selection of solute atoms. The selection
is determined by

\begin{verbatim}
select [ <integer isgm> [ <integer jsgm> ]] [ { <string atom> } ]
\end{verbatim}

where {\rm isgm} is the first segment number, {\rm jsgm} is the last 
segment number in the selection, and {\rm \{atom\}} is the set of atom
names selected from the specified residues. By default all solute
atoms are selected.
\par
For example, all protein backbone atoms are selected by

\begin{verbatim}
select _N _CA _C
\end{verbatim}

To select the backbone atoms in residues 20 to 80 only, use

\begin{verbatim}
select 20 80 _N _CA _C
\end{verbatim}

\section{File specification}

To specify the file to be analyzed when the analysis module is
invoked through a task directive

\begin{verbatim}
file <string filename> [<integer firstfile> <integer lastfile>] 
\end{verbatim}

where {\rm filename} is an existing {\rm coo} or {\rm sco} trajectory file.
If {\rm firstfile} and {\rm lastfile} are specified, the specified
{\rm filename} needs to have a {\rm ?} that will be substituted by
an 3-character integer number from {\rm firstfile} to {\rm lastfile},
and the analysis will be performed on the series of files.
For example,

\begin{verbatim}
file tr_md?.sco 3 6
\end{verbatim}

will instruct the analysis to be performed on files {\it tr\_md003.sco},
{\it tr\_md004.sco}, {\it tr\_md005.sco} and {\it tr\_md006.sco}.

\par
A subset of frames to be analyzed is specified by

\begin{verbatim}
frames [<integer firstframe default 1>] <integer lastframe>
\end{verbatim}

\section{Root mean square deviation}

To analyze the root mean square deviation from the specified reference
coordinates:

\begin{verbatim}
rmsdev
\end{verbatim}

\section{Trajectory format conversion}

The command in this section only apply when the analysis module is
invoked though a task directive.
\par
To copy frames from specified files,

\begin{verbatim}
copy [<integer freq default 1> [<integer maxfram>]] \\
     [<string format>] <string filename>
\end{verbatim}

To superimpose the selected atoms for each frame to the reference 
coordinates before copying

\begin{verbatim}
super [<integer freq default 1> [<integer maxfram>]] \\
      [<string format>] <string filename>
\end{verbatim}

The {\rm format} can be any of

\begin{tabular}{rl}
arc & \discover\ archive file\\
amb & \amber\ formatted trajectory file\\
bam & \amber\ unformatted trajectory file\\
mwm & \ecce\ mwm file\\
xyz & \ecce\ xyz file\\
eci & \ecce\ eci file\\
frm & \ecce\ frm file\\
\end{tabular}

If not specified, a {\rm sco} formatted file will be written.

A special tag can be added to the \ecce\ frm format using

\begin{verbatim}
label <integer itag> <string tag>  [ <real rtag default 0.0> ] \\
      <integer iatag> [ <integer jatag default iatag> ] [ <string anam> ]
\end{verbatim}

where tag number $itag$ is set to the string $tag$ for all atoms
anam within a distance $rtag$ from segments $iatag$ through $jatag$.
A question mark can be used in anam as a wild card character.

\section{Partial charges from ESP fitting}

A file in plt format of the electrostatic potential resulting
from partial charges generated by the ESP module is generated
by the command

\begin{verbatim}
espgrid [ <integer chgset default 1> ] \\
        [ spacing <real spac default 0.05> ] \\
        [ range <real rcut default 0.3> ]
\end{verbatim}

The input is taken from the charges file generated by the ESP module. The
resulting plt formatted file can be graphically analyzed witht the
gOpenMol program. The parameters chgset, spac and rcut specify the
charge set to be used, and the spacing and extent of the charge grid
evaluated.

The name of the charges file can be specified with

\begin{verbatim}
charges <string filchg>
\end{verbatim}

The name of the plt file can be specified with

\begin{verbatim}
plt <string filplt>
\end{verbatim}

The name of the xyz file can be specified with

\begin{verbatim}
xyz <string filxyz>
\end{verbatim}

The resulting electrostatic potential grid is in units of
kJ\ mol$^{-1}$e$^{-1}$.