\label{sec:analysis}
\def\bmu{\mbox{\boldmath $\mu$}}
\def\bE{\mbox{\bf E}}
\def\br{\mbox{\bf r}}
\def\tT{\tilde{T}}
\def\t{\tilde{1}}
\def\ip{i\prime}
\def\jp{j\prime}
\def\ipp{i\prime\prime}
\def\jpp{j\prime\prime}
\def\etal{{\sl et al.}}
\def\nwchem{{\bf NWChem}}
\def\nwargos{{\bf nwargos}}
\def\nwtop{{\bf nwtop}}
\def\nwrst{{\bf nwrst}}
\def\nwsgm{{\bf nwsgm}}
\def\esp{{\bf esp}}
\def\md{{\bf md}}
\def\prepare{{\bf prepare}}
\def\analysis{{\bf analysis}}
\def\argos{{\bf ARGOS}}
\def\amber{{\bf AMBER}}
\def\charmm{{\bf CHARMM}}
\def\discover{{\bf DISCOVER}}
\def\ecce{{\bf ecce}}

The \analysis\ module is used to analyze molecular trajectories generated
by the \nwchem\ molecular dynamics module, or partial charges generated
by the \nwchem\ electrostatic potential fit module.

Directives for the \analysis\ module are read from an input deck,

\begin{verbatim}
analysis
 ...
end
\end{verbatim}

The analysis is performed  as post-analysis of trajectory files through 
using the {\rm task} directive

\begin{verbatim}
task analysis
\end{verbatim}
or
\begin{verbatim}
task analyze
\end{verbatim}

\section{Reference coordinates}

Most analyses require a set of reference coordinates. These
coordinates are read from a \nwchem\ restart file by the directive,

\begin{verbatim}
reference <string filename>
\end{verbatim}

where {\rm filename} is the name of an existing restart file. 
This input directive is required.

\section{File specification}

The trajectory file(s) to be analyzed are specified with

\begin{verbatim}
file <string filename> [<integer firstfile> <integer lastfile>] 
\end{verbatim}

where {\rm filename} is an existing {\rm trj} trajectory file.
If {\rm firstfile} and {\rm lastfile} are specified, the specified
{\rm filename} needs to have a {\rm ?} wild card character that will 
be substituted by the 3-character integer number from {\rm firstfile} 
to {\rm lastfile}, and the analysis will be performed on the series 
of files.
For example,

\begin{verbatim}
file tr_md?.trj 3 6
\end{verbatim}

will instruct the analysis to be performed on files {\it tr\_md003.trj},
{\it tr\_md004.trj}, {\it tr\_md005.trj} and {\it tr\_md006.trj}.

\par
From the specified files the subset of frames to be analyzed is 
specified by

\begin{verbatim}
frames [<integer firstframe default 1>] <integer lastframe> \
       [<integer frequency default 1>]
\end{verbatim}

For example, to analyze the first 100 frames from the specified
trajectory files, use

\begin{verbatim}
frames 100
\end{verbatim}

To analyze every 10-th frame between frames 200 and 400 recorded on
the specified trajectory files, use

\begin{verbatim}
frames 200 400 10
\end{verbatim}

\section{Selection}

Analyses can be applied to a selection of solute atoms. The selection
is determined by

\begin{verbatim}
select [ <integer isgm> [ <integer jsgm> ]] [ { <string atom> } ]
\end{verbatim}

where {\rm isgm} is the first segment number, {\rm jsgm} is the last 
segment number in the selection, and {\rm \{atom\}} is the set of atom
names selected from the specified residues. By default all solute
atoms are selected.
\par
For example, all protein backbone atoms are selected by

\begin{verbatim}
select _N _CA _C
\end{verbatim}

To select the backbone atoms in residues 20 to 80 only, use

\begin{verbatim}
select 20 80 _N _CA _C
\end{verbatim}

This selection is reset to apply to all atoms after each file
directive.

\section{Coordinate analysis}

To analyze the root mean square deviation from the specified reference
coordinates:

\begin{verbatim}
rmsd
\end{verbatim}

To define a bond:

\begin{verbatim}
bond <integer ibonc> <string atomi> <string atomj> 
\end{verbatim}

To define an angle:

\begin{verbatim}
angle <integer ibonc> <string atomi> <string atomj> <string atomk> 
\end{verbatim}

To define a torsion:

\begin{verbatim}
torsion<integer ibonc> <string atomi> <string atomj> \
                       <string atomk> <string atoml> 
\end{verbatim}

To perform the coordinate analysis:

\begin{verbatim}
scan <string filename>
\end{verbatim}

which will create, depending on the specified analysis options
files filename.rms and filename.ana. After the scan directive
previously defined coordinate analysis options are all reset.

\section{Essential dynamics analysis}

Essential dynamics analysis is performed by

\begin{verbatim}
essential
\end{verbatim}

This can be followed by one or more

\begin{verbatim}
project <integer vector> <string filename>
\end{verbatim}

to project the trajectory onto the specified vector. This will
create files filename with extensions frm or trj, val, vec, \_min.pdb
and \_max.pdb, with the projected trajectory, the projection
value, the eigenvector, and the minimum and maximum projection
structure.

For example, an essential dynamics analysis with projection onto
the first vector on files firstvec.\{frm,val,vec,\_min.pdb,\_max.pdb\}
is generated by

\begin{verbatim}
essential
project 1 firstvec.frm
\end{verbatim}

\section{Trajectory format conversion}

To copy the selected frames from the specified trejctory file(s),
onto a new file, use

\begin{verbatim}
copy  [solute] <string filename>
\end{verbatim}

To superimpose the selected atoms for each specified frame to the 
reference coordinates before copying onto a new file, use

\begin{verbatim}
super [solute] <string filename>
\end{verbatim}

The format of the new file is determined from the extension, which
can be one of

\begin{tabular}{rl}
trj & \nwchem\ trajectory file\\
frm & \ecce\ frames file\\
amb & \amber\ formatted trajectory file\\
bam & \amber\ unformatted trajectory file\\
arc & \discover\ archive file\\
\end{tabular}

If no extension is specified, a {\rm trj} formatted file will be written.

A special tag can be added to {\rm frm} formatted files  using

\begin{verbatim}
label <integer itag> <string tag>  [ <real rtag default 0.0> ] \\
      <integer iatag> [ <integer jatag default iatag> ] [ <string anam> ]
\end{verbatim}

where tag number $itag$ is set to the string $tag$ for all atoms
anam within a distance $rtag$ from segments $iatag$ through $jatag$.
A question mark can be used in anam as a wild card character.
For example, to display atoms 34 through 45 in the color mistyrose
in the \ecce\ trajectory viewer can be specified with

\begin{verbatim}
label 1 mistyrose 34 45
\end{verbatim}

\section{Electrostatic potential from partial charges}

A file in plt format of the electrostatic potential resulting
from partial charges generated by the ESP module is generated
by the command

\begin{verbatim}
esp <string xfile> [ <integer spacing default 10> ] \
     [ <real rcut 0.3> ] [ <string pltfile> ]
\end{verbatim}

The input coordinates are taken from the {\rm xyzq} file that can
be genersted from a {\rm rst} by the prepare module. Parameters 
spacing and rcut specify the spacing and extent of the charge grid
evaluated. The resulting {\rm plt} formatted file pltfile can be
viewed with the gOpenMol program. The resulting electrostatic 
potential grid is in units of kJ\ mol$^{-1}$e$^{-1}$.

