\label{sec:intro}

NWChem is a computational chemistry package designed to run on
high-performance parallel supercomputers and workstation clusters.
Code capabilities include the calculation of molecular electronic
energies and analytic gradients using self-consistent field, Gaussian
density function theory (DFT), and second-order perturbation theory.
Geometry optimization for energy minimization and transition states is
available for all methods.  Classical molecular dynamics capabilities
provide for the simulation of macromolecules and solutions, including
the computation of free energies, using a variety of forcefields.

NWChem is scalable in both its ability to treat large problems
efficiently, and in its utilization of available parallel computing
resources.  The code uses the parallel programming tools TCGMSG and
the Global Array library developed at PNNL for the High Performance
Computing and Communication Initiative (HPCCI) grand-challenge
software program and the Environmental Molecular Sciences Laboratory
(EMSL) Project.  NWChem has been optimized to perform calculations on
large molecules using large parallel computers and it is unique in
this regard.  In contrast, its performance on small calculations
running on small computers is unremarkable.

This document is intended as an aid to chemists attempting to
use the code for their own applications.  Users are not expected to
have a detailed understanding of the code internals, but some
familiarity with the overall structure of the code, how it handles
information, and the nature of the algorithms it contains will
generally be helpful.  The following sections describe the structure
of the input file, and a give a brief overview of the code
archetecture.  All input directives recognized by the code are
described in detail, with options, defaults, and recommended usage,
where applicable.  Additional information on the molecular geometry
and basis function libraries included in the code is presented in the
appendices.

\subsection{Citation}

The EMSL Software Agreement stipulates that the use of NWChem be
acknowledged in any publications which use results obtained with
NWChem.  The acknowledgment should be of the form:
\begin{quote}

  NWChem Version \nwchemversion, as developed and distributed by
  Pacific Northwest National Laboratory, P.~O.~Box 999, Richland,
  Washington 99352 USA, and funded by the U.~S.~Department of Energy,
  was used to obtain some of these results.
\end{quote}

The words ``A modified version of'' should be added at the beginning,
if appropriate.  {\em Note: Your EMSL Software Agreement contains the
complete specification of the required acknowledgment.}

If you wish to cite NWChem in the references section of a publication,
please use the following citation:
\begin{quote}
  High Performance Computational Chemistry Group, {\em NWChem, A
   Computational Chemistry Package for Parallel Computers, Version
    \nwchemversion{}} (\nwchemyear), Pacific Northwest National
  Laboratory, Richland, Washington 99352, USA.
\end{quote}

\subsection{User Feedback}

This software comes without warranty or guarantee of support,
but we do try to meet the needs of our user community.  Please send bug
reports, requests for enhancement, or other comments to

\begin{itemize}
\item {\tt nwchem-support@emsl.pnl.gov}
\end{itemize}

When reporting problems, please provide as much information as possible, 
including;

\begin{itemize}
\item detailed description of problem
\item platform you are running on
\begin{itemize}
\item operating system
\item compiler
\end{itemize}
\item input file
\item output file
\item contact name and telephone number
\end{itemize}

Users can also subscribe to an electronic mailing list of other users
of the code.  This is intended as a general forum through which code
users can contact one another and the developers to share experience
with the code and discuss problems.  Announcements of new releases and
bug fixes will also be made to this list. 

To subscribe to the user list, send a message to 

\begin{itemize}
\item {\tt majordomo@emsl.pnl.gov}
\end{itemize}

The body of the message must contain the line 

\begin{itemize}
\item {\tt subscribe nwchem-users}
\end{itemize}

The automated list manager is capable of recognizing a number of
commands, including 'subscribe', 'unsubscribe', 'get', 'index',
'which', 'who', 'info' and 'lists'.  The command 'end' halts
processing of commands.  It will provide some help if the message
includes the line {\tt help} in the body.  Messages can be posted to
the list by sending mail to {\tt nwchem-users@emsl.pnl.gov}.  Users
are encouraged to use the support address rather than the mailing list
to report problems since the support mailer interfaces to an automated
bug tracking mechanism.

\section{Getting Started}
\label{sec:getstart}

This section provides an overview of NWChem input and program
architecture, and the syntax used to describe the input.  See Sections
\ref{sec:simplesample} and \ref{sec:realsample} for examples of NWChem
input files with detailed explanation.

NWChem consists of independent modules that perform the various
functions of the code.  Examples of modules include the input parser,
SCF energy, SCF analytic gradient, DFT energy, etc..  Data is passed
between modules and saved for restart using a disk-resident database
or dumpfile (see Section \ref{sec:arch}).

The input to NWChem is composed of commands, called directives, which
define data (such as basis sets, geometries, and filenames), and the
actions to be performed.  Directives are processed in the order
presented in the input file, with the exception of certain start-up
directives (see Section \ref{sec:inputstructure}) which provide
critical job control information and are processed before all other
input.  Most directives are specific to a particular module and define
data that is used by that module only.  A few directives (see Section
\ref{sec:toplevel}) potentially affect all modules, for instance by
specifying the total charge on the system.  

There are two types of directives.  Simple directives consist of one
line of input which may contain multiple fields.  Compound directives
group together multiple simple directives that are in some way
related and are terminated with an \verb+END+ directive.  See the
sample inputs (Sections \ref{sec:simplesample}, \ref{sec:realsample})
and the input syntax specification (Section \ref{sec:syntax}).

All input is free format, and directives or blocks of module-specific
directives can appear in any order, with the exception of the
\verb+TASK+ directive (see sections \ref{sec:inputstructure} and
\ref{sec:task}) which is used to invoke an NWChem module.  Case is
ignored except for actual data (e.g., names/tags of centers, titles).

To make the input as short and simple as possible, most options have
default values.  The user needs to supply input only for those items that
have no defaults, or for items that must be different from the defaults
for the particular application.  In the discussion of each directive, the
defaults are noted, where applicable.

The input file structure is described in the following subsections, and
illustrated with two examples.  The input format and syntax for directives
is also described in detail.

\subsection{Input File Structure}
\label{sec:inputstructure}

The structure of an input file reflects the internal structure of
NWChem.  At the beginning of a calculation NWChem needs to determine
how much memory to use, the name of the database, whether it is a new,
restarted, or continuing job, where to put scratch/permanent files,
etc..  It is not necessary to put this information at the top of the
input file, however.  NWChem will read through the {\em entire} input
file looking for the start-up directives.  In this pass, all other
directives are ignored.

The start-up directives are
\begin{itemize}
\item START
\item CONTINUE
\item RESTART
\item SCRATCH{\verb+_+}DIR
\item PERMANENT{\verb+_+}DIR
\item MEMORY
\item ECHO
\end{itemize}

After the input file has been scanned for the start-up directives, it
is rewound and read sequentially.  Input is processed either by the
top-level parser (for the directives listed in Section
\ref{sec:toplevel}, such as \verb+TITLE+, \verb+SET+, \ldots) or by
the parsers for specific computational modules (e.g., SCF, DFT,
\ldots).  Any directives that have already been processed (e.g.,
\verb+MEMORY+) are ignored.  Input is read until a \verb+TASK+
directive (see Section \ref{sec:task}) is encountered.  A \verb+TASK+
directive request a calculation to be peformed and specifies the level
of theory and the operation to be performed.  Input processing then
stops and the specified task is executed.  The position of the
\verb+TASK+ directive in effect marks the end of the input for that
task.  Processing of the input resumes upon the successful completion
of the task and the results of that task are available to subsequent
tasks in the same input file.

The name of the input file is usually provided as an argument to the
execute command for NWChem.  That is, the execute command looks
something like the following;

\begin{verbatim}
  nwchem input_file
\end{verbatim}

The default name for the input file is \verb+nwchem.nw+.  If an input
file name \verb+input_file+ is specified without an extension, the code
assumes a default extension of \verb+input_file.nw+.  If the code cannot
locate a file named either \verb+nwchem.nw+ or \verb+input_file.nw+, an 
error is reported and execution terminates.  The following
subsection presents two input files to illustrate the directive syntax and 
input file format for NWChem applications.

\subsection{Simple N2 Input File}
\label{sec:simplesample}

A simple example of an NWChem input file is an SCF geometry optimization of
the nitrogen molecule using a Dunning cc-pvdz basis set.  This input
file contains the bare minimum of information the user must specify in
order to run this type of problem --- fewer than ten lines of input,
as follows;
\begin{verbatim}
  title; Nitrogen cc-pvdz SCF geometry optimization
  geometry 
    n 0 0 0
    n 0 0 2.1
  end
  basis
    n library cc-pvdz
  end
  task scf optimize
\end{verbatim}

Examining the input line by line, it can be seen that it contains
only four directives; \verb+TITLE+, \verb+GEOMETRY+, \verb+BASIS+, and
\verb+TASK+.  The \verb+TITLE+ directive is optional, and is used only
as a means for the user to more easily identify outputs from different
jobs.  An initial geometry is specified in cartesian coordinates and
atomic units by means of the \verb+GEOMETRY+ directive.  The Dunning 
cc-pvdz basis is obtained from the NWChem basis library, as specified
by the \verb+BASIS+ directive input.  The \verb+TASK+ directive requests 
an SCF geometry optimization.

The \verb+GEOMETRY+ directive (Section \ref{sec:geom}) defaults to cartesian
coordinates and atomic units (options include {\AA}ngstr{\o}m units and
Z-matrix format; see Section \ref{sec:Z-matrix}).  The \verb+BASIS+ 
directive input block is structured like the \verb+GEOMETRY+ directive
input block (i.e., name,
keyword, \ldots, end) and {\em must} contain basis set information for
every atom type in the geometry with which it will be used.
Refer to Sections \ref{sec:basis} and \ref{sec:ecp}, and Appendix
\ref{sec:knownbasis} for a description of available basis sets and a
discussion of how to define new ones.

The last line of this sample input file ({\tt task scf optimize}),
tells the program to optimize the molecular geometry by minimization
of the SCF energy.  (For a description of possible tasks and the format
of the {\tt task} directive, refer to Section \ref{sec:task}.)

If the input is stored in the file \verb+n2.nw+, the command to run
the job on a typical UNIX workstation is as follows;

\begin{verbatim}
  nwchem n2
\end{verbatim}

NWChem output is to standard output, and error messages are sent to
both standard output and standard error.

\subsection{Water Molecule Sample Input File}
\label{sec:realsample}

A more complex sample problem is the optimization of a positively
charged water molecule at the MP2 level of theory, followed by a computation of
frequencies at the optimized geometry.  A preliminary SCF geometry
optimization is performed using an inexpensive basis set (STO-3G).
This gives a good starting guess for the geometry, and any Hessian
information generated will be used in the next optimization step.
Then the optimization is finished using second-order M{\o}ller-Plesset
perturbation theory and a basis set with polarization functions.  The
final task is to calculate the vibrational frequencies.  The input
file to accomplish these three tasks is as follows;

\begin{verbatim}
start h2o_freq

title; H2O+ frequencies with MP2 and 6-31g**

geometry units angstrom
  O       0.0  0.0  0.0
  H       0.0  0.0  1.0
  H       0.0  1.0  0.0
end

charge 1

basis "starting basis"
  H library sto-3g
  O library sto-3g
end

basis "property basis"
  H library 6-31g**
  O library 6-31g**
end

scf
  uhf
  doublet
  print low
end

stepper
  trust 0.5
  convgg 0.01
end

set "ao basis" "starting basis"

task scf optimize

set "ao basis" "property basis"

scf
  vectors input atomic
  print none
end

set "mp2_grad:print" low

stepper
  convgg 1d-6
end

task mp2 optimize

set "mp2_grad:print" none

task mp2 freq

eof
\end{verbatim}

The {\tt start} directive (Section \ref{sec:start}) tells NWChem that
this run is to be started from the beginning.  This directive need not
be at the beginning of the input, but it is commonly placed there.
Existing database or vector files are to be ignored or overwritten.
The entry \verb+h2o_freq+ on the \verb+START+ line is the prefix used
for all files created by the calculation.  This convention allows
different jobs to run in the same directory or to share the same
scratch directory (see Section \ref{sec:dirs}), as long as they use
different names in this field.

As in the first sample problem, the geometry is given in cartesian
coordinates.  In this case, the units are specified as
{\AA}ngstr{\o}m.  (Since this is the default, explicit specification of the
units is not actually necessary, however.)  The {\tt CHARGE}
directive defines the total charge of the system.  This calculation is
to be done on an ion with charge +1.  Note that this is a top-level
directive, independent of other input blocks.

The next two directives are the {\tt BASIS} directives.  The names for
the basis sets are arbitrary, and they may be chosen so that they will
serve as a helpful mnemonic for later reference in subsequent input
directives.

The multiple lines of the first {\tt SCF} directive in the {\tt scf
  \ldots end} block specify details about the SCF calculation to be
performed.  For open-shell systems, the spin multiplicity has to be
specified (using {\tt doublet} in this case), or it defaults to {\tt
  singlet}.  Unrestricted Hartree-Fock is chosen here (by specifying
the keyword {\tt uhf}), rather than the default high-spin ROHF.  This
is necessary for the subsequent MP2 calculation, because only UMP2 is
available for open-shell systems currently (see Section
\ref{sec:functionality}).  The print level is set to {\tt low} to
reduce the output from the SCF module to a minimum during the geometry
optimization.

For this calculation, the gradient convergence threshold for the
geometry optimization module {\tt STEPPER} is set to the
relaxed value of $10^{-2}$, rather than the default $10^{-4}$.  This is
acceptable because the initial optimization only serves to provide a
starting guess.  Increasing the trust radius (using the \verb+TRUST+
directive) beyond the default of $0.1$ makes the optimization more
efficient (though less robust in hard to converge cases).

The final step in setting up the input for the SCF calculation is to
specify that the \verb+"starting basis"+ should be used.  This is
accomplished by means of the \verb+SET+ directive, which specifies that 
the \verb+"ao basis"+ is the \verb+"starting basis"+.  All molecular
orbital (MO) methods look for the \verb+"ao basis"+ in which to expand the
MOs.    In the previous example with the nitrogen molecule, it was not 
necessary to use the \verb+SET+ directive in this manner, since the 
\verb+BASIS+ directive used the default name (which is \verb+"ao basis"+).
An alternative approach that could have been used here, which avoids the 
necessity of assigning the basis set name using the
\verb+SET+ directive, would be to defer definition of the property basis
until after the first SCF calculation is complete. 

All input up to this point affects only the settings in the run-time
database.  The program takes its information from this database, so
the sequence of directives up to the first \verb+TASK+ directive is
irrelevant.  An exchange of order of the different blocks or
directives would not affect the result.  The {\tt TASK} directive,
however, must be specified last of all in the list of input directives
for a given problem.  The {\tt TASK} directive invokes the program and
directs the code to perform the specified calculation using the
parameters set in the previous directives. In this case, the first
task is an SCF calculation with geometry optimization, specified with
the input {\tt scf} and {\tt optimize}.  (See Section \ref{sec:task}
for a list of available tasks and operations.)

After the completion of any task, settings in the database are used
in subsequent tasks without change, unless they are overridden by new
input directives.  In this example, there are several important
changes between the first task (\verb+task scf optimize+) and the
second task (\verb+task mp2 optimize+).  The {\tt "ao basis"} is set
to a better basis (i.e., {\tt "property basis"}) using the \verb+SET+
directive.  The SCF output is completely discarded (as a result of the
{\tt print none} input in the {\tt SCF} directive), which means that
no output will be produced unless an error occurs.  The SCF starting
guess vectors are reset to be the atomic guess, since the STO3G
vectors are not appropriate (see Section \ref{sec:vectors} for
details on the different possible starting guesses).

The convergence threshold for the geometry optimization module is reset 
to  $10^{-6}$ for the second task, a value which is smaller than 
the default of $10^{-4}$.  The default is appropriate for determination of the
optimized geometry and minimum energy, but a higher accuracy is
required in this task, for use in the subsequent computation of the 
frequencies.  The second {\tt TASK} directive invokes an MP2 
optimization, instead of the SCF optimization.

% There is currently no input block for the MP2 gradients, so parameters
% for this module have to be set in the database via the {\tt set}
% directive. Currently only print options are recognized, and in this
% example, the \verb+SET+ directive is used to reduce the amount of
% output a reasonable minimum.

Once the MP2 optimization is completed, the geometry obtained in the
calculation is used to perform a frequency calculation.  This task is
invoked by the keyword \verb+freq+ on the directive \verb+task mp2
freq+.  The second derivatives of the energy are calculated as
numerical derivatives of analytical gradients. The gradients as such
are not of interest in this case, so the output from the {\tt
  mp2\_grad} program is completely discarded using the directive
\verb+set "mp2_grad:print" none+.

The {\tt EOF} directive marks the end of the input to be read. It is
not necessary to specify the end-of-file as an explicit directive at
the actual end of the file.  However, using the directive allows the
user to have additional lines in the file that will not be processed
as input.  For example, a description of the calculation(s) specified
in the input or notes on the purpose of the task(s), or other
informational comments can be included in the input file in this way.
The {\tt eof} directive can also be used to remove a task (or series
of tasks) from the calculation without actually removing the relevent
input directives from the file.  Any lines in the file that occur
after the {\tt eof} directive are ignored by the program.

\subsection{Input Format and Syntax for Directives}
\label{sec:syntax}

This section describes the syntax used in the rest of this
documentation for describing the format of directives.  
The input format for the directives used for NWChem is similar to that
of UNIX shells, which is also used in other chemistry packages, most
notably GAMESS-UK.  An input line is parsed into whitespace (blanks or
tabs) separating tokens or fields.  Any token that contains whitespace
must be enclosed in double quotes in order to be processed correctly.
For example, the basis set with the descriptive name \verb+modified
Dunning DZ+ must appear in a directive as \verb+"modified Dunning
DZ"+, since the name consists of three separate words.  

A (physical) line in the input file is terminated with a newline
character (also known as a 'return' or 'enter' character).  A
semicolon (\verb+;+) can be also used to indicate the end of an input
line, allowing a given physical line of input to contain multiple
logical lines of input.  For example, five lines of input for the
\verb+GEOMETRY+ directive can be entered as follows;
\begin{verbatim}
  geometry
   O 0  0     0
   H 0  1.430 1.107
   H 0 -1.430 1.107
  end
\end{verbatim}
These same five lines could be entered on a single line, as
\begin{verbatim}
  geometry; O 0 0 0; H 0 1.430 1.107; H 0 -1.430 1.107; end
\end{verbatim}
This one physical input line comprises five logical
input lines.  Each logical or physical input line must be no longer
than 1023 characters.  Data is read until an end-of-file is detected,
or until an \verb+EOF+ directive is encountered\footnote{The
  free-format input library does not read past the string \verb+EOF+
  (ignoring case) on a line by itself.  This is a convenience that
  allows unused input to be left in the same file.}.

Directives consist of a directive name, keywords, and optional input,
and may contain one line or many.  Simple directives consist of a
single line of input with one or more fields.  Compound directives can
have multiple input lines, and can also include other optional simple
and compound directives.  A compound directive is terminated with an
END directive.  The directives START (see Section \ref{sec:start}) and
ECHO (see Section \ref{sec:echo}) are examples of simple directives.
The directive GEOMETRY (see Section \ref{sec:geom}) is an example of a
compound directive.

Some limited checking for self-consistency of the input is performed
by the input module, but most defaults are imposed by the application
modules at runtime.  It is therefore usually impossible to determine
beforehand whether or not all selected options are consist with each
other.

The following notation and syntax conventions are used in the generic 
descriptions of the NWChem input in the following sections.

\begin{itemize}
\item a directive name always appears in all-capitals, in computer-type 
face; (e.g.; \verb+GEOMETRY+, \verb+BASIS+, \verb+SCF+).  Note that 
the case of directives is ignored in the actual input.
\item a keyword always appears in lower case, in computer-type face; (e.g.,
{\tt swap}, {\tt print}, {\tt units}, {\tt bqbq})
\item variable names always appear in lower case, in computer-type face, 
and enclosed in angle brackets to distinguish them from keywords (e.g.,
{\tt <input\_filename>}, {\tt <basisname>}, {\tt <tag>})
\item \verb+$variable$+ is used to indicate the substitution of the value of a
      variable
\item a string, token, or field is a sequence of ASCII characters (NOTE: if 
the string includes blanks or tabs (i.e., white space) the entire string must
be enclosed in quotes)
\item \verb+()+ is used to group items (the parentheses and other
      special symbols do not appear in the input)
\item \verb+||+ separate exclusive options/parameters/formats
\item \verb+[ ]+ enclose optional entries with a default value
\item \verb+< >+ enclose a type, a name of a value to be specified,
      and a default value, if any.

\item \verb+\+ is used to concatenate lines in a description (NOTE: within 
a string, the \verb+\+ causes the preceeding character (including a blank) 
to be eliminated
\item \verb+;+ (semicolon) is used to mark the end of a logical input 
line within a physical line of input
\item \verb+#+ (the hash or pound symbol) is the comment character.  All
characters following \verb+#+ (up to the physical end of the line) are ignored.

\item \verb+...+ is used to indicate indefinite continuation of a list
\end{itemize}

An input parameter is identified in the description of the directive
by prefacing the item with the name of the type of data expected;
i.e.,

\begin{itemize}
\item \verb+string +  -- an ASCII character string
\item \verb+integer+ --  integer value(s) for a variable or an array
\item \verb+logical+ --  true/false logical variable
\item \verb+real   +  -- real floating point value(s) for a variable or 
\item \verb+double + -- double-precision
an array
\end{itemize}

If an input item is not prefaced by one of these type names,
it is assumed to be of type 'string'.
 
The directive \verb+VECTORS+ (Section \ref{sec:vectors}) is presented here
as an example of an NWChem input directive.  The general form of the
directive is as follows;
\begin{verbatim}
  VECTORS [input (<string input_movecs default atomic>) || \
                   (project <string basisname> <string filename>)] \
          [swap [(alpha|beta)] <integer vec1 vec2> ...] \
          [output <string output_movecs default $file_prefix$.movecs>]
\end{verbatim}

This directive contains three optional keywords, as indicated by the 
three main sets of square brackets enclosing the keywords \verb+input+,
\verb+swap+, and \verb+output+.  The keyword \verb+input+ allows the
user to specify the source of the molecular orbital vectors.  When
this keyword is invoked, there are two mutually exclusive options for
specifying the vectors, as indicated by the \verb+||+ symbol
separating the descriptions of the two input options;

\begin{verbatim}
  (<string input_movecs default atomic>) || \
                  (project <string basisname> <string filename>) \
\end{verbatim}

The first option, \verb+(<string input_movecs default atomic>)+,
allows the user to specify an ASCII character string for the parameter
{\tt input\_movecs}.  If no entry is specified, the code assumes a
standard source of the vectors with a default of \verb+atomic+ (i.e.,
atomic guess).  The second option, {\tt(project <string basisname>
  <string filename>)}, contains the keyword \verb+project+, which
takes two additional string arguments.  When this keyword is used, the
vectors in file \verb+<filename>+ will be projected from the (smaller)
basis \verb+<basisname>+ into the current AO basis.

The second keyword, \verb+swap+, allows the user to re-order the
starting vectors.  The optional keyword \verb+alpha|beta+ allows the
user to swap the alpha and beta spin orbitals, and specify in pairs
the integer numbers of the vectors to be swapped.  As many pairs as
the user wishes to have swapped can be listed for {\tt <integer vec1
vec2 ... >}.

The third keyword, \verb+output+, allows the user to tell the code
where to store the vectors by specifying an ASCII string for the
parameter {\tt output\_movecs}.  If no entry is specified for this
parameter, the default is to write the vectors back into either the user
specified MO vectors input file or, if this is not available, the file
\verb+$file_prefix$.movecs+.

A particular example of the VECTOR directive is shown below.  It specifies
both the \verb+input+ and \verb+output+ keywords, but does not use the 
\verb+swap+ option.

\begin{verbatim}
  vectors input project "small basis" small_basis.movecs \
          output large_basis.movecs
\end{verbatim}

This directive tells the code to generate input vectors by projecting
from vectors in a smaller basis named \verb+"small basis"+, which is
stored in the file \verb+small_basis.movecs+.  The output vectors will be
stored in the file \verb+large_basis.movecs+.

The order of keyed optional entries within a directive should not matter,
unless noted otherwise in the specific instructions for a particular
directive.

\section{NWChem Architecture}
\label{sec:arch}

As noted above, NWChem consists of independent modules that perform
the various functions of the code.  Examples of modules include the
input parser, SCF energy, SCF analytic gradient, and DFT energy.  The
independent NWChem modules can share data only through a disk-resident
database, which is a similiar to the GAMESS dumpfile or the Gaussian
checkpoint file.  This allows the modules to share data, or to share
access to files containing data.

It is not necessary for the user to be intimately familiar with the
contents of the database in order to run NWChem.  However, a nodding
acquaintance with the design of the code will help in clarifying the
logic behind the input requirements, especially when restarting jobs
or performing multiple tasks within one job.  Section
\ref{sec:database} gives a general description of the database.

As described above (Section \ref{sec:inputstructure}), all
start-up directives are processed at the beginning of the job
by the main program, and
then the input module is invoked.  Each input directive usually
results in one or more entries being made in the database.  When a
\verb+TASK+ directive is encountered, control is passed to the
appropriate module, which extracts relevant data from the database and
any associated files.  Upon completion of the task, the module will store
significant results in the database, and may also modify other
database entries in order to modify the behaviour of subsequent
computations.

\subsection{Database Structure}
\label{sec:database}

Data is shared between modules of NWChem by means of the database.  There
are three main types of information stored in the data base; (1) arrays of
data, (2) names of files that contain data, and (3) objects.  
Arrays are stored directly in the database, and contain the following
information;
\begin{enumerate}
\item the name of the array, which is a string of ASCII characters (e.g., 
      \verb+"reference energies"+)
\item the type of the data in the array 
(i.e., real, integer, logical, or character) 
\item the number (N) of data items in the array (Note: A scalar is stored as an array of unit length.)
\item the N items of data of the specified type
\end{enumerate}


From the NWChem input deck it is possible to enter data directly into
the database using the \verb+SET+ directive (see Section
\ref{sec:set}).  For example, to store a (64-bit precision)
three-element real array with the name \verb+"reference energies"+ in
the database, the directive is as follows;
\begin{verbatim}
  set "reference energies" 0.0 1.0 -76.2
\end{verbatim}
NWChem determines the data to be real (based on the type of the first
element, \verb+0.0+), counts the number
of elements in the array, and enters the array into the database.

Much of the data stored in the database is internally managed by
NWChem and should not be modified by the user.  However, other data,
including some NWChem input options, can be freely modified.  

Objects are built in the database by storing associated data as
multiple entries using an internally consistent naming convention.
This data is exclusively managed by the subroutines (or methods) that
are associated with the object.  Currently, the code has two main
objects; basis sets and geometries.  Sections \ref{sec:geom}, 
\ref{sec:basis}, and
\ref{sec:ecp} present a complete discussion of the input to describe
these objects.  

As an illustration of what comprises a geometry object, the following
table contains a partial listing of the NWChem output of a water molecule
geometry named \verb+"test geom"+.  Each entry contains the field 
\verb+test geom+, which is the unique name of the object.

\begin{verbatim}
 Contents of RTDB h2o.db
 -----------------------

 Entry                                   Type[nelem]
 ---------------------------  ----------------------
 geometry:test geom:efield              double[3]    
 geometry:test geom:coords              double[9]    
 geometry:names                         char[10]   
 geometry:test geom:ncenter                int[1]    
 geometry:ngeom                           int[1]    
 geometry:test geom:charges             double[3]    
 geometry:test geom:tags                  char[6]
 ...
\end{verbatim}

Using this convention, multiple instances of objects may be stored with
different names in the same database.  If a user needed to do calculations 
considering alternative geomteries
for the water molecule, for example, an input file could be constructed with 
all of the geometries of interest by storing them in the 
database under different names.  

% The {\tt
%   GEOMETRY} directive (Section \ref{sec:geom}) permits geometries to
% be named (the default name is \verb+geometry+).  For example, the
% input directive to define a geometry object in the database with the
% name \verb+"test water geometry"+ can be specified as follows;

The run-time database contents for the file \verb+h2o.db+ listed 
above were generated from the user-specified input directive,
\begin{verbatim}
  geometry "test geom"
    O     0.00000000    0.00000000    0.00000000
    H     0.00000000    1.43042809   -1.10715266
    H     0.00000000   -1.43042809   -1.10715266
  end
\end{verbatim}

Obviously, the geometry object contains more information than merely the
numerical input specified in this directive.  The \verb+GEOMETRY+
directive allows the user to specify different values for the x,y,z
coordinates of the atoms (or centers), and identify that object under
a unique name.  In addition, all of the other information in the 
geometry oject also available
to the specifically named objects.  (Refer to Section
\ref{sec:geom} for a complete description of the {\tt GEOMETRY}
directive.)

Unless a specific name is defined for the geometry object in the
database (such as the name \verb+"test geom"+ shown in the
example), the object in the database is assigned the default name of
\verb+geometry+.  This is the geometry object name that computational
modules will look for when executing a calculation.  The {\tt SET}
directive can be used in the input to force a module (or modules) to
look for a geometry object with a name other than \verb+geometry+
for a particular task.  For example, to specify use of the 
\verb+"test geom"+ object in the example above, the \verb+SET+
directive is as follows;

\begin{verbatim}
  set geometry "test geom"
\end{verbatim}

NWChem will automatically check for such indirections when loading
geometries.  The basis set object functions in an identical fashion,
using the default name \verb+"ao basis"+.

% , and it is intended that all
% future such objects will do so.  (Note: the naming conventions and
% internal mechanisms for associating data with specific modules or
% tasks is expected to change in the future, but the directive for
% specifying names should remain the same.)

\subsection{Persistence of data and restart}
\label{sec:persist}

The database is persistent, meaning that all input data and results
that are not destroyed in the course of execution are permanently
stored.  These data are therefore available to subsequent tasks or
jobs.  This makes the input for restart jobs very simple, since only
new or changed data must be provided.  It also makes the behavior of
successive restart jobs {\em identical} to that of multiple tasks
within one job.  

Sometimes, however, this persistence is undesirable, and it is
necessary to return an NWChem module to its default (input-free)
behavior. In such a case, the \verb+UNSET+ directive (see Section
\ref{sec:unset}) can be used to delete all database entries associated
with a given module (including both inputs and outputs).






