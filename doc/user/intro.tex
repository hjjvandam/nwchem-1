
NWChem is a quantum chemistry package that is
designed to run on high-performance parallel supercomputers as well as
workstation clusters.  It aims to be scalable in both the ability to
treat large problems efficiently, and in the usage of available
parallel computing resources.  The suite utilizes parallel programming
tools (TCGMSG and the Global Array library) developed by PNNL staff
with funding from both the High Performance Computing and
Communication Initiative (HPCCI) grand-challenge software program and
the Environmental Molecular Sciences Laboratory (EMSL) Project, which
has supplied the majority of the development costs.

NWChem has been optimized to perform calculations on large molecules
using large parallel computers and it is unique in this regard.  In
contrast, NWChem's performance on small calculations running on
small computers is unremarkable.

\subsection{Citation}

The EMSL Software Agreement stipulates that the use of NWChem be
acknowledged in any publications which use results obtained with
NWChem.  The acknowledgment should be of the form:
\begin{quote}
  NWChem Version \nwchemversion, as developed and distributed by
  Pacific Northwest National Laboratory, P.~O.~Box 999, Richland,
  Washington 99352 USA, and funded by the U.~S.~Department of Energy,
  was used to obtain some of these results.
\end{quote}
and adding the words ``A modified version of'' at the start
if appropriate.  {\em Note: Your EMSL Software Agreement contains the
actual specification of the required acknowledgment.}

If you wish to cite NWChem in the references section of a publication,
please use the following citation:
\begin{quote}
  High Performance Computational Chemistry Group, {\em NWChem, A
    Computational Chemistry Package for Parallel Computers, Version
    \nwchemversion{}} (\nwchemyear), Pacific Northwest National
  Laboratory, Richland, Washington 99352, USA.
\end{quote}

\subsection{In Case of Problems (or Compliments)}

Although this software comes without warranty or guarantee of support,
we do try to meet the needs of our user community.  Please send bug
reports, requests for enhancement, or even compliments to {\tt
nwchem-support@emsl.pnl.gov}.
Please be sure to provide as much information as you can about the
problem and provide inputs and outputs if possible.  It is also
important to know what platform you are running on.

There is also a mailing list for users of the code which provides a
more general forum for users of the code to exchange information.
To subscribe, send a mail message to {\tt majordomo@emsl.pnl.gov} with
a body containing the line {\tt subscribe nwchem-users}.  If you need
help in using the Majordomo list manager, send a message to the above
address with {\tt help} in the body.  You may post to the list by
sending mail to {\tt nwchem-users@emsl.pnl.gov}.

Although the developers do monitor the nwchem-users list, we much
prefer to receive bug reports at the {\tt nwchem-support} address,
where our problem tracking system is based.

\section{Functionality}

Current functionality includes:
\begin{itemize}
\item Self Consistent Field or Hartree Fock energy and analytic
  gradients (RHF, UHF, high-spin ROHF)
\item Gaussian Density Functional Theory (DFT) energy and analytic
  gradients with many local and
      non-local exchange-correlation potentials
\item MP2 energy using direct or semi-direct algorithms, or using the
  resolution of the identity integral approximation.  Analytic
  gradients are under development.
\item Geometry Optimization (Minimization and Transition State).
\item Second-derivatives by numerical difference of gradients.
\item Generation of the electron density file for the {\em Insight}
      graphical program.
\item Interface to the natural bond orbital package.
\end{itemize}

\section{Getting Started}
\label{sec:getstart}

  Here is the input to perform a SCF geometry optimization on the nitrogen
molecule in a Dunning cc-pvdz basis set.
\begin{verbatim}
  title; Nitrogen cc-pvdz SCF geometry optimization
  geometry 
    n 0 0 0
    n 0 0 2.1
  end
  basis
    n library cc-pvdz
  end
  task scf optimize
\end{verbatim}

If this input is in the file \verb+"n2.nw"+, then to run the job on
most UNIX workstations type
\begin{verbatim}
  nwchem n2
\end{verbatim}

Let's have a closer look at he above input (the structure will be
described in more detail in the following section). It contains only a
necessary amount of information, as NWChem will use default values
for most input parameters.

The title is only used to give the user a means to identify
outputs from different jobs quickly.

The input geometry is generally given in cartesian coordinates (for
Z-matrix inputs see section \ref{sec:Z-matrix}), and, if no further
information is given, in atomic units (Bohr). 

The basis input block is structured like the geometry block (keyword,
\ldots, end) and contains basis set information for every atom type in
the geometry. In this case a default basis set from the library is
chosen (see sections appendix \ref{knownbasis} and section
\ref{sec:basis} for a list of available basis sets or how to define
your own).

The last line ({\tt task scf optimize})
tells the program what to calculate with the information given so
far. For a description of possible tasks and the format of the input
see section \ref{sec:task}.

\subsection{Input format}

The input is keyword or directive based.  It is free format and
keywords or blocks of module-specific directives can, with certain
small restrictions, appear in any order.  Case is ignored except
for actual data (e.g., names/tags of centers, titles).

Most details of the input format should be familiar from the UNIX
shells and from other chemistry packages, most notably GAMESS-UK.  An
input line is parsed into whitespace (blanks or tabs) separated tokens
or fields.  Any token that contains whitespace (e.g., a descriptive
name for a basis set, \verb+"modified Dunning DZ"+) should be enclosed
in double quotes (\verb+"+).  A backslash (\verb+\+) concatenates one
or more physical input lines. Note that a space is inserted at the
physical line break so that it is not possible to split tokens between
lines.  A semicolon marks the end of a logical input line, or
statement, so that a physical input line may contain multiple logical
input lines.  There is a limit of 1023 characters on the size of both
logical and physical input lines.  All characters after a pound or
hash symbol (\verb+#+) are treated as comments.  Data is read until
end-of-file is detected, or until an \verb+EOF+ directive is
encountered\footnote{The
  free-format input library does not read past the string \verb+EOF+
  (ignoring case) on a line by itself.  This is a convenience so that
  unused input can be left in the same file.}.

Directives appear in two forms.  Simple directives comprise a single
line of input with one or more fields.  E.g., 
\begin{itemize}
\item the \verb+ECHO+ directive takes no additional parameters 
  and causes the input file to be echoed to standard output;
\item the \verb+START+ directive takes several optional
      parameters which specify the database name and a common prefix
      for all files.
\end{itemize}
Compound directives are spread over multiple input lines and
are terminated with an \verb+END+ directive --- the 
\verb+GEOMETRY+ directives above serve as an example. 

Some limited checking for self-consistency of the input is performed
by the input module, but most defaults are actually imposed by the
application modules at runtime. 

\subsection{Syntax for directives}

The following notation is used for definition of the directives:

\begin{itemize}
\item \verb+()+ is used to group items (the parentheses and other
      special symbols do not appear in the input)
\item \verb+||+ separate exclusive options/parameters/formats
\item \verb+[]+ enclose optional entries with a default value
\item \verb+<>+ enclose a type, a name of a value to be specified,
      and a default value if any.
\item a string/token/field is just a sequence of characters, enclosed in
      quotes if there is white space
\item \verb+\+ is used to concatenate lines in a description
\item \verb+$variable$+ is used to indicate the substitution of the value of a
      variable
\item \verb+...+ is used to indicate indefinite continuation of a list
\end{itemize}

For example,
\begin{verbatim}
  VECTORS [[input] (<string input_movecs default atomic>) || \
                   (project <string basisname> <string filename>)] \
          [swap [(alpha|beta)] <integer vec1 vec2> ...] \
          [output <string output_movecs default "$file_prefix$.movecs">]
\end{verbatim}
indicates that there are three optional keywords (\verb+input+,
\verb+swap+, and \verb+output+).  The keyword \verb+input+ is optional
(i.e., if no recognizable keyword is specified then input will be
assumed).  The \verb+input+ keyword is followed by two exclusive
options, which are to specify either a standard source of the vectors
with a default of \verb+"atomic"+ (atomic guess) or the keyword
\verb+project+ which takes two additional string arguments which
indicate that vectors should be obtained by projecting from vectors in
a smaller basis.  The \verb+swap+ keyword may be optionally applied to
the alpha or beta spin orbitals and takes as an argument a list of
pairs of integers. The \verb+output+ keyword requires a string
argument, which takes a default value constructed from the value of
the file prefix appended with \verb+".movecs"+.  For example
\begin{verbatim}
  vectors input project "small basis" "small_basis.movecs" \
          output "large_basis.movecs"
\end{verbatim}
requests input vectors to be generated by projection from
results in a smaller basis and output vectors to be stored in the file
\verb+"large_basis.movecs"+.

The order of keyed optional entries should not matter unless noted
otherwise.

\subsection{The structure of an input file}
\label{sec:inputstructure}

The structure of an input file reflects the internal structure of
NWChem.  At the start of a calculation NWChem needs to know such
things as how much memory to use, the name of the database, if it is a
startup or restart job, where to put scratch/permanent files, etc..
Rather than require all this information be at the top of the input
file, NWChem scans through {\em all} of your input looking for these
start-up directives (section \ref{sec:inputstructure}) and ignores everything else.
Since only process zero can read the input, these data are manually
broadcast to the other nodes\footnote{Once the database has been opened
process zero can insert data into the database which may be
subsequently accessed directly by all processes.}.

Next, the input file is rewound and read sequentially.  Input is
processed either by the top-level parser (e.g., the directives
\verb+TITLE+, \verb+SET+, \ldots) or by the computational modules
(e.g., SCF, DFT, \ldots).  Anything that has already been processed
(e.g., \verb+MEMORY+) is ignored.  Input is read until a \verb+TASK+
directive (section \ref{sec:task}) is encountered at which point the specified
task is executed.  Processing of the input resumes upon the successful
completion of the task.

\subsection{The input file name and the {\tt .nw} suffix}
\label{sec:inputfilename}

The name of the input file is usually provided as an argument to
NWChem.  If no input file name is provided, then the default name of
\verb+"nwchem.nw+ is used.  If the file cannot be located, then
\verb+".nw"+ is appended to the name.  If the file can sill not be
located, then an error is reported.

\subsection{Another example}

Now we can have a look at a more realistic example: The following
input starts with a very crude approximation of the geometry of a
positively charged water molecule. After a preliminary optimization
with SCF and a relatively cheap basis set (sto-3g), the optimization
is finished with second-order M{\o}ller-Plesset perturbation theory and
a basis set with polarization functions. At the final geometry the
vibrational frequencies are calculated.

\begin{verbatim}
start h2o_freq

title; H2O+ frequencies with MP2 and 6-31g**

geometry units angstrom
  O       0.0  0.0  0.0
  H       0.0  0.0  1.0
  H       0.0  1.0  0.0
end

charge 1

basis "starting basis"
  H library sto-3g
  O library sto-3g
end

basis "property basis" print
  H library 6-31g**
  O library 6-31g**
end

scf
  uhf
  doublet
  maxiter 100
  print low
end

stepper
  convge 1.0d-6
end

set "ao basis" "starting basis"

task scf optimize

set "ao basis" "property basis"

scf
  vectors input atomic
  print none
end

set "mp2_grad:print" low

stepper
  convge 1.0d-10
end

task mp2 optimize

set "mp2_grad:print" none

task mp2 freq

eof
\end{verbatim}

Let's have a closer look at this input deck. The {\tt start} directive
tells NWChem that this run is to be started from the
beginning. Existing database or vector files are ignored or
overwritten. The second entry on the start line gives an internal name
for the job, and the database as well as all temporary or permanent
files associated with it will contain this string. This implies that
different jobs running in the same directory or sharing the same
scratch directory (see section \ref{sec:dirs}) have to differ in this
name.

The geometry is again given in cartesian coordinates, this time in
{\AA}ngstr{\o}m instead of the default atomic units.

The {\tt charge} directive defines the total charge of the system, so
this calculation is done on an ion with charge +1. It is a top-level
directive, independent of other input blocks.

Next, two basis sets are defined and given (hopefully) intuitive names
by which they can be referenced later in the input, the second one is
also printed to the output file.

The {\tt scf \ldots end} block contains details about the scf
calculation to be performed. Unrestricted Hartree-Fock is chosen
rather than the default high-spin ROHF. For the subsequent MP2
calculation this is necessary, because only UMP2 is available for
open-shell systems at the moment. For open-shell systems the spin
multiplicity has to be given (it defaults to singlet). The maximum
number of iterations is set to a high value to allow convergence in
difficult cases. The print level is set to {\tt low} to reduce the
output from the scf module to a minimum.

The energy convergence threshold for the geometry optimization module
{\tt stepper} is set to a higher value than the default $1.9d-8$
because the initial optimization with scf is not intended to find the
exact minimum.

Finally the ``{\tt ao basis}'', which is the default basis for all ab
initio calculations, is set to the name of the first basis given
above.

All input up to here only affects settings in the run-time database,
from where the program takes its information. This means that the
sequence is irrelevant, and an exchange of different blocks or
directives would not affect the result. This is different for the 
{\tt task} directive. It invokes the program and does a calculation
using the parameters set before. In this case it is an SCF calculation
with geometry optimization (for a list of available tasks and
operations see section \ref{sec:task}).

After this optimization is done, settings in the database are reused
for further tasks unless they are overridden by new input directives.
In this example the ``{\tt ao basis}'' is set to the better basis for
the final calculations, scf output is completely discarded ({\tt print
  none} means no output unless an error occurs that would make the
result useless), and the starting guess is to be an SCF calculation on
the atoms. The latter is necessary because the default would be to use
existing MO vectors, but the basis has changed, and the difference is
too big to make a projection of the old vectors on the new basis
reasonable (for details on the different possible starting guesses see
section \ref{sec:vectors}).

As there is currently no input block for the MP2 gradients, parameters
for this module have to be set in the database via the {\tt set}
directive. Currently only print options are recognized, and here the
amount of output is again reduced to the reasonable minimum. The
convergence criterion for the geometry optimization program is set to
a lower value, requesting a more exact minimum search.

{\tt task mp2 optimize} calls for an optimization with MP2, starting
with the geometry resulting from the previous task.

At the final geometry a frequency calculation is performed. The second
derivatives of the energy are calculated as numerical derivatives of
analytical gradients. The gradients as such are not of interest, so
the output from the {\tt mp2\_grad} program is completely discarded.

The {\tt eof} directive marks the end of the input to be read. At the
end of the file it is not necessary, but it allows further file
contents (e.g.\ a description of the purpose of the calculation, or
any other comments that are more than a few lines) that are ignored by
the program.

\subsection{NWChem Architecture}
\label{sec:arch}

The high-level design of NWChem is still evolving and will undergo
substantial modification in the coming months.  The following features
can, however, be expected to be present in subsequent versions.

NWChem consists of independent modules (e.g., input, SCF, RIMP2) that
communicate through a database (similar in spirit to the GAMESS
dumpfile or the Gaussian checkpoint file).  The only way modules can
share data is via the database, or via files whose names are stored in
the database (which may have default values).  Everything stored
directly in the database comprises a typed array described by
\begin{enumerate}
\item a name which is a simple string of ASCII characters (e.g., 
      \verb+"reference energies"+),
\item the type of the data (real, integer, logical, or character), 
\item the number of data items, and
\item the actual data (an array of items of the specified type).
\end{enumerate}

The input module provides the \verb+SET+ directive (section
\ref{sec:set}) which stores data directly into the database.  For
instance, the directive
\begin{verbatim}
  set "reference energies" real 0 1 -76.2
\end{verbatim}
stores a real (64 bit precision) array of three elements with the
given values into the database.  The number of data items is automatically
inferred from the input line.

Objects more complex than simple arrays (e.g., a description of a
basis set, or the history of a geometry optimization) are built up by
providing a set of routines that manage the data associated with named
instances of these objects.  This is done by internally establishing
some policy about how to name quantities associated with an object.
Current examples of this include the basis and geometry objects.  In
this fashion multiple instances of such objects can be stored with
different names in the same database without confusion.  E.g., the
input
\begin{verbatim}
  geometry "test water geometry"
    O     0.00000000    0.00000000    0.00000000
    H     0.00000000    1.43042809   -1.10715266
    H     0.00000000   -1.43042809   -1.10715266
  end
\end{verbatim}
stores the geometry of water into the database with the name 
\verb+"test water geometry"+.  If the name \verb+"test water geometry"+
was not specified then the default name of \verb+"geometry"+ would
have been adopted.  What is actually stored in the database is a whole
load of stuff.  For example, for a geometry with the default name
\verb+"geometry"+:
\begin{verbatim}
 Contents of RTDB h2o.db
 -----------------------

 Entry                                   Type[nelem]
 ---------------------------  ----------------------
 geometry:geometry:efield              double[3]    
 geometry:geometry:coords              double[9]    
 geometry:names                          char[10]   
 geometry:geometry:ncenter                int[1]    
 geometry:ngeom                           int[1]    
 geometry:geometry:charges             double[3]    
 geometry:geometry:tags                  char[6]
 ...
\end{verbatim}
There is no need to be aware of this level of detail (which is subject
to change) unless you have some, hopefully, very unusual problems.

\sloppy

Most of the computational modules require a geometry with name
\verb+"geometry"+.  The input
\begin{verbatim}
  set geometry "my water geometry"
\end{verbatim}
makes an entry in the database that associates the name
\verb+"geometry"+ with the value \verb+"my water geometry"+.  The
computer code for the geometry ``object'', when asked to load a geometry
with name \verb+"geometry"+, will first attempt to translate the name
before actually attempting to load the geometry.  The basis set object
functions in an identical fashion and it is intended that all such
objects will do so.  What will change in the future is the naming
conventions and mechanisms of associating data with specific modules
or tasks.

\fussy

The database is persistent and nearly all input is permanently stored.
This makes the input for restart jobs very simple since very little
data must be provided.  It also makes the behavior of successive
restart jobs {\em identical} to that of multiple tasks within one job.
However, sometimes this persistence is undesirable and in order to
return an NWChem module to its default (input-free) behavior the
\verb+UNSET+ directive (\ref{sec:unset}) can be used to delete all
database entries associated with a given module.

